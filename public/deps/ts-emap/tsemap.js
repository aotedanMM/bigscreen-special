/*!
 * 
 *  Wed Aug 26 2020 16:31:17 GMT+0800 (GMT+08:00)
 *  version：3.1.0-beta.03
 *  tag：1598430677713
 * 
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=197)}([function(e,t,r){var n=r(4),o=r(20).f,i=r(25),a=r(22),s=r(100),l=r(138),c=r(69);e.exports=function(e,t){var r,u,f,h,p,d=e.target,y=e.global,m=e.stat;if(r=y?n:m?n[d]||s(d,{}):(n[d]||{}).prototype)for(u in t){if(h=t[u],f=e.noTargetGet?(p=o(r,u))&&p.value:r[u],!c(y?u:d+(m?".":"#")+u,e.forced)&&void 0!==f){if(typeof h==typeof f)continue;l(h,f)}(e.sham||f&&f.sham)&&i(h,"sham",!0),a(r,u,h,e)}}},function(e,t,r){var n;void 0===(n=function(){return window.g2||(window.g2=window.egis),window.g2}.apply(t,[]))||(e.exports=n)},function(e,t,r){"use strict";var n;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}void 0===(n=function(){"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});var e={_showLoading:function(e){},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){for(var t in e)return!1;return!0},ajaxGet:function(t,r,n,o){var i=jQuery.extend({},t);return i.type="get",i.success=function(i,a,s){t.showLoading&&e._showLoading(!1),e.isFunction(r)&&r.call(n,i,a,s,o)},i.error=function(i,a,s){t.showLoading&&e._showLoading(!1),console.error(t.url+" request failed!"),e.isFunction(r)&&r.call(n,null,a,i,o)},t.showLoading&&e._showLoading(!0),jQuery.ajax(i)},ajaxPost:function(t,r,n,o){var i=jQuery.extend({},t);return i.type="post",i.success=function(i,a,s){e.isFunction(r)&&r.call(n,i,a,s,o),t.showLoading&&e._showLoading(!1)},i.error=function(i,a,s){e.isFunction(r)&&r.call(n,null,a,i,o),t.showLoading&&e._showLoading(!1)},t.showLoading&&e._showLoading(!0),jQuery.ajax(i)},cancelRequest:function(e){if(e instanceof XMLHttpRequest&&4!=e.readyState)try{e.abort()}catch(e){}},getConfig:function(t){var r;t=t||{};return e.ajaxGet({url:t.url,dataType:"json",async:!1},(function(e){r=e||{}})),r}};return Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e},e.assertWithin=function(t,r){var n=function(e,t){return null!=t&&(t instanceof RegExp?t.test(e):!!function(e,t){return"null"==t.toLowerCase()&&(null==e||""==e)}(e,t)||void 0)}(t,r);if(null!=n)return n;if(r.indexOf("※")>=0)return function(t,r,n){for(var o=t.split(n),i=0,a=o.length;i<a;i++){var s=o[i];if(s&&e.assertWithin(r,s))return!0}return!1}(r,t,"※");var o=function(e,t){if(r=r.trim(),0==/[\[\(\)\]].*/i.test(r))return e==r;if(e=parseFloat(e),isNaN(e))return!1;var n=r.replace(/[\[\]\(\)]/g,"").split(",");return 1==n.length?e==parseFloat(n[0]):void 0}(t);if(null!=o)return o;var i=function(e,t){if(t&&(t=t.trim()),!/[\[\(\)\]].*/i.test(t))return e==t;if(e=parseFloat(e),isNaN(e))return!1;var r=t.replace(/[\[\]\(\)]/g,"").split(",");if(1==r.length)return e==parseFloat(r[0]);for(var n=parseFloat(r[0]),o=parseFloat(r[1]),i=[function(e,t){if(!isNaN(n)&&isNaN(o)){if(t.startsWith("["))return e>=n;if(t.startsWith("("))return e>n}},function(e,t){if(isNaN(n)&&!isNaN(o)){if(t.endsWith("]"))return e<=o;if(t.endsWith(")"))return e<o}},function(e,t){var r=!0;return t.startsWith("[")?r=r&&e>=n:t.startsWith("(")&&(r=r&&e>n),!!r&&(t.endsWith("]")?r=r&&e<=o:t.endsWith(")")&&(r=r&&e<o),r)}],a=void 0,s=0,l=i.length;s<l&&null==(a=i[s](e,t));s++);return a}(t,r);return null!=i&&i},e.getEquivalentNum=function(e,t,r){var n=parseInt(e),o=t,i=r=r||10;if(isNaN(n))return i;var a=n+"",s=a.length;i=(s-1)*t;for(var l=0;l<s;l++){i+=parseInt(a[l])*(o/=10)}return i<r&&(i=r),Math.round(i)},e.getValByVarPath=function(e){var t=null;if(e){for(var r=e.split("."),n=window,o=0,i=r.length;o<i;o++){var a=r[o];if("window"!==a){if(!n)break;n=n[a]}}t=n}return t},e.lastId=0,e.stamp=function(e){return e instanceof Object?(e._unique_id=e._unique_id||++this.lastId,e._unique_id):NaN},e.newUUID=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.newUUID32=function(){return this.newUUID().replace(/-/g,"")},e.replacePlaceHolder=function(e,t){if(!t)return"";var r=/([\w\_\-\d]+)/g,n=t.match(/(\$\{[\w\_\-\d]{0,}\})/g),o=t;if(n&&n.length>0)for(var i=0,a=n.length;i<a;i++){var s=n[i],l="",c=s.match(r);c&&1==c.length&&(l=e[c[0]]||""),o=o.replace(s,l)}return o},e.Browser=function(){function e(e,t){return-1!==e.indexOf(t)}var t,r="ActiveXObject"in window,n=function(e){return e&&!document.addEventListener}(r),i=navigator.userAgent.toLowerCase(),a=e(i,"webkit"),s=e(i,"chrome"),l=e(i,"phantom"),c=e(i,"android"),u=e(i,"android [23]"),f=e(i,"gecko"),h=("undefined"==typeof orientation?"undefined":o(orientation))!==void 0+"",p=!window.PointerEvent&&window.MSPointerEvent,d=function(e){return window.PointerEvent&&window.navigator.pointerEnabled||e}(p),y="devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,m=document.documentElement,g=function(e,t){return e&&"transition"in t.style}(r,m),v=function(e){return"WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!e}(u),b="MozPerspective"in m.style,_="OTransition"in m.style,w=(t=[g,v,b,_,l],!window.L_DISABLE_3D&&(t[0]||t[1]||t[2]||t[3])&&!t[4]),S=function(e,t){return!window.L_NO_TOUCH&&!e&&(t||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)}(l,d);return{ie:r,ielt9:n,webkit:a,gecko:f&&!a&&!window.opera&&!r,android:c,android23:u,chrome:s,ie3d:g,webkit3d:v,gecko3d:b,opera3d:_,any3d:w,mobile:h,mobileWebkit:h&&a,mobileWebkit3d:h&&v,mobileOpera:h&&window.opera,touch:S,msPointer:p,pointer:d,retina:y}},e}.apply(t,[]))||(e.exports=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")()}).call(this,r(200))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(5);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,r){var n=r(4),o=r(102),i=r(16),a=r(66),s=r(106),l=r(141),c=o("wks"),u=n.Symbol,f=l?u:u&&u.withoutSetter||a;e.exports=function(e){return i(c,e)||(s&&i(u,e)?c[e]=u[e]:c[e]=f("Symbol."+e)),c[e]}},function(e,t,r){"use strict";var n,o=r(155),i=r(9),a=r(4),s=r(5),l=r(16),c=r(75),u=r(25),f=r(22),h=r(13).f,p=r(36),d=r(55),y=r(7),m=r(66),g=a.Int8Array,v=g&&g.prototype,b=a.Uint8ClampedArray,_=b&&b.prototype,w=g&&p(g),S=v&&p(v),L=Object.prototype,x=L.isPrototypeOf,P=y("toStringTag"),E=m("TYPED_ARRAY_TAG"),T=o&&!!d&&"Opera"!==c(a.opera),C=!1,A={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},k=function(e){return s(e)&&l(A,c(e))};for(n in A)a[n]||(T=!1);if((!T||"function"!=typeof w||w===Function.prototype)&&(w=function(){throw TypeError("Incorrect invocation")},T))for(n in A)a[n]&&d(a[n],w);if((!T||!S||S===L)&&(S=w.prototype,T))for(n in A)a[n]&&d(a[n].prototype,S);if(T&&p(_)!==S&&d(_,S),i&&!l(S,P))for(n in C=!0,h(S,P,{get:function(){return s(this)?this[E]:void 0}}),A)a[n]&&u(a[n],E,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:T,TYPED_ARRAY_TAG:C&&E,aTypedArray:function(e){if(k(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(d){if(x.call(w,e))return e}else for(var t in A)if(l(A,n)){var r=a[t];if(r&&(e===r||x.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(i){if(r)for(var n in A){var o=a[n];o&&l(o.prototype,e)&&delete o.prototype[e]}S[e]&&!r||f(S,e,r?t:T&&v[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var n,o;if(i){if(d){if(r)for(n in A)(o=a[n])&&l(o,e)&&delete o[e];if(w[e]&&!r)return;try{return f(w,e,r?t:T&&g[e]||t)}catch(e){}}for(n in A)!(o=a[n])||o[e]&&!r||f(o,e,t)}},isView:function(e){var t=c(e);return"DataView"===t||l(A,t)},isTypedArray:k,TypedArray:w,TypedArrayPrototype:S}},function(e,t,r){var n=r(3);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(32),o=Math.min;e.exports=function(e){return e>0?o(n(e),9007199254740991):0}},function(e,t,r){"use strict";var n,o;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n=[r(21),r(2),r(37)],void 0===(o=function(e,t,r){var n=e.extend({options:{id:null,name:null,map:null},includes:r.prototype,initialize:function(r){e.setOptions(this,r),this._moveAttrFromOpts(["map","id","name"]),this.appEvent=null,this.map&&this.map instanceof G.Map&&(this.appEvent=this.map.getAppEvent()),this.id=this.id||t.newUUID32(),this.loaded=!1},destroy:function(){for(var e in this.unload(),this)this[e]=null,delete this[e]},load:function(){this.loaded||(this.addListeners(),this.loaded=!0,this.fire("load"))},unload:function(){this.loaded&&(this.removeListeners(),this.loaded=!1,this.fire("unload"))},isLoaded:function(){return this.loaded},_checkLoaded:function(){if(this.isLoaded())return!0;throw new Error("component id = "+this.id+" not loaded yet !")},addListeners:function(){},removeListeners:function(){}});return n.include({_moveAttrFromOpts:function(e,t){if((e=e||[]).constructor==Array)for(var r=0,n=e.length;r<n;r++){var o=e[r];o&&(this[o]=this.options[o],t||(this.options[o]=null,delete this.options[o]))}},isNotNull:function(e){return null!=e&&null!=i(e)}}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(1)],void 0===(o=function(e,t){var r={_wktReader:null,_wktWriter:null,_geoJSONReader:null,_geoJSONWriter:null,getWktReader:function(){return null==this._wktReader&&(this._wktReader=new jsts.io.WKTReader(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._wktReader},getWktWriter:function(){return null==this._wktWriter&&(this._wktWriter=new jsts.io.WKTWriter(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._wktWriter},getGeoJSONReader:function(){return null==this._geoJSONReader&&(this._geoJSONReader=new jsts.io.GeoJSONReader(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._geoJSONReader},getGeoJSONWriter:function(){return null==this._geoJSONWriter&&(this._geoJSONWriter=new jsts.io.GeoJSONWriter(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._geoJSONWriter}},n=/^\-?\d{0,}(\.\d{0,})?$/;return r.validateLngLat=function(t,r){if(n.test(t)&&n.test(r)){var o=parseFloat(t),i=parseFloat(r);if(e.assertWithin(o,"[-180,180]")&&e.assertWithin(i,"[-90,90]"))return[o,i]}return!1},r.validateCoordinate=function(e,t){return!(!n.test(e)||!n.test(t))&&[parseFloat(e),parseFloat(t)]},r.getSpiderfy=function(e,t,r,n,o){var i,a=1*(r=r||10),s=1*(o=o||28),l=1*(n=n||5)*2*Math.PI,c=0,u=[];for(i=t-1;i>=0;i--){c+=s/a+5e-4*i;var f=e[0]+a*Math.cos(c),h=e[1]+a*Math.sin(c);u[i]=[f,h],a+=l/c}return u},r.getCirclePonits=function(e){var t=e.center,r=e.count||128,n=parseFloat(e.radius),o=e.spatialReference||3857,i=2*Math.PI/r,a=360/r,s=[],l=t[0],c=t[1];if("4326"==o||"4490"==o)for(var u=0;u<r;u++){var f=a*u,h=this.getGeographyDistancePoint(t,f,n);s.push(h)}else for(u=0;u<r;u++){var p=i*u,d=l+n*Math.cos(p),y=c+n*Math.sin(p);s.push([d,y])}return s},r.getGeographyDistancePoint=function(t,r,n){if(!e.isArray(t))throw new Error("参数错误！");t[0]=l(t[0]),t[1]=l(t[1]),n/=6378137,r=r*Math.PI/180;var o=t[1]*Math.PI/180,i=t[0]*Math.PI/180,a=Math.asin(Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(r)),s=i+Math.atan2(Math.sin(r)*Math.sin(n)*Math.cos(o),Math.cos(n)-Math.sin(o)*Math.sin(a));return isNaN(a)||isNaN(s)?null:[180*s/Math.PI,180*a/Math.PI];function l(e){var t=e;return Math.abs(t)<1e-5&&(t=1e-5),t}},r.getGeometryCenter=function(e){var r=new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)),n=new jsts.io.WKTReader(r);if(e.getGeometryType()==t.sfs.GeometryType.Point)return e;if(e.getGeometryType()==t.sfs.GeometryType.Polyline)return e.middlePoint();if(e.getGeometryType()==t.sfs.GeometryType.Polygon||e.getGeometryType()==t.sfs.GeometryType.MultiPolygon){var o=n.read(e.asWkt()).getCentroid();return o=t.sfs.GeometryFormatter.fromWKT(o.toString())}},r.meter2Rad=function(e){return 360*e/(2*Math.PI*6378137)},r.calRadius=function(e,t){var r=Math.PI/180,n=e.x-2/r*Math.asin(Math.sin(t/2/6378.137/1e3)/Math.cos(r*e.y));return Math.abs(n-e.x)},r.measureLength=function(e){if(!(e instanceof t.sfs.Polyline||e instanceof t.sfs.LineString))throw new Error("参数类型错误！");var r=new t.sfs.CoordinateTransform;return new t.sfs.MeasureService({projectService:r}).length(e)},r.measureArea=function(e){if(!(e instanceof t.sfs.Polygon))throw new Error("参数类型错误！");var r=new t.sfs.CoordinateTransform;return new t.sfs.MeasureService({projectService:r}).area(e)},r.simplify=function(e,t){var r=e.getLength()/e.getNumPoints()*3.82;return r>t&&(r=t),e=jsts.simplify.DouglasPeuckerSimplifier.simplify(e,r)},r.toJstsGeometry=function(e){return(r._getJstsGeometry(e)||{}).geometry||null},r.fromJstsGeometry=function(e){var t={g2geom:1,wkt:2,geojson:3};if(!((e=e||{}).jstsGeom instanceof jsts.geom.Geometry&&t[e.type]))throw new Error("参数错误！");return r._fromJstsGeometry({geometry:e.jstsGeom,type:t[e.type],spatialReference:e.spatialReference})},r._getJstsGeometry=function(e){if(!e)return null;var t,n;if(e instanceof jsts.geom.Geometry)n=e,t=0;else if(null!=r._getG2GeometryType(e)){var o=e.asWkt();n=r.getWktReader().read(o),t=1}else"string"==typeof e?(n=r.getWktReader().read(e),t=2):(n=r.getGeoJSONReader().read(e),t=3);if(n){var i=r.getGeoJSONWriter().write(n);if(i&&i.type){if("POLYGON"==i.type.toUpperCase())c(i.coordinates);else if("MULTIPOLYGON"==i.type.toUpperCase())for(var a=i.coordinates,s=0,l=a.length;s<l;s++){c(a[s])}n=r.getGeoJSONReader().read(i)}}return{type:t,geometry:n};function c(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],o=n[0],i=n[n.length-1];o&&2==o.length&&i&&2==i.length&&(o[0]==i[0]&&o[1]==i[1]||n.push([o[0],o[1]]))}}},r._fromJstsGeometry=function(e){var r=e.geometry,n=e.type||1,o=null;if(r)switch(n){case 1:(o=t.sfs.GeometryFormatter.fromWKT(r.toString())).spatialReference=e.spatialReference||"4326";break;case 2:o=r.toString();break;case 3:"jsts.geom.GeometryCollection"==r.CLASS_NAME&&0==r.geometries.length&&(r=null),r&&(o=(o=t.sfs.GeometryFormatter.fromWKT(r.toString())).asGeoJson())}return o},r._getG2GeometryType=function(r){var n=t.sfs,o=null;for(var i in n){var a=n[i];if(e.isFunction(a)){if(r instanceof a){o=a;break}if(r.$type&&r.$type.split(",")[0]===i){o=a;break}}}return o},r.getG2GeometryType=function(e){return r._getG2GeometryType(e)},r.getGeometryEnvlop=function(e){if(!e||e.length<1)return null;for(var r=null,n=null,o=0,i=[],a=0,s=e.length;a<s;a++){var l=e[a];if(l){var c=this._getJstsGeometry(l);if(c){var u=c.geometry;if(o=c.type,i.push(u),u)if(r)r.expandToInclude(u.getEnvelopeInternal());else if("jsts.geom.Point"==u.CLASS_NAME){var f=u.coordinate.x,h=u.coordinate.y;r=new jsts.geom.Envelope(f-1e-6,f+1e-6,h-1e-6,h+1e-6)}else r=u.getEnvelopeInternal()}}}if(r){var p="POLYGON((";switch(p+=r.getMinX()+" "+r.getMinY()+",",p+=r.getMaxX()+" "+r.getMinY()+",",p+=r.getMaxX()+" "+r.getMaxY()+",",p+=r.getMinX()+" "+r.getMaxY()+",",p+=r.getMinX()+" "+r.getMinY(),p+="))",o){case 1:n=t.sfs.GeometryFormatter.fromWKT(p);break;case 2:n=p;break;case 3:n=(n=t.sfs.GeometryFormatter.fromWKT(p)).asGeoJson()}}return n},r.getPlotEnvlop=function(e,n){var o=null,i=null;n=n||4326;if(e)for(var a in e){var s=e[a];if(s){var l=f(s);l&&(i=i?i.union(l).getEnvelope():l)}}if(i){var c=i.toString();if((o=t.sfs.GeometryFormatter.fromWKT(c)).shell){for(var u=0;u<o.shell.points.length;u++)o.shell.points[u].spatialReference=n;o.shell.spatialReference=n}o.spatialReference=n}return o;function f(e){for(var t=e.elements||[],n=[],o=null,i=0,a=t.length;i<a;i++){var s=t[i];if(s){var l=s.geometry;n.push(l.asWkt())}}if(n.length>0){var c=r._unionGeometry(n);o=r.getWktReader().read(c).getEnvelope()}return o}},r._unionGeometry=function(e){if(!e||e.length<1)return null;for(var r=0,n=e.length,o=null,i=null,a=0,s=360/(2*Math.PI*6378137);r<n;r++){var l,c=e[r],u=this._getJstsGeometry(c);u&&((l=u.geometry)instanceof jsts.geom.Point||(l=jsts.simplify.DouglasPeuckerSimplifier.simplify(l,s)),a=u.type),l&&(o?o.contains(l)||(o=o.within(l)?l:o.union(l)):o=l)}if(o)switch(a){case 1:i=t.sfs.GeometryFormatter.fromWKT(o.toString());break;case 2:i=o.toString();break;case 3:i=(i=t.sfs.GeometryFormatter.fromWKT(o.toString())).asGeoJson()}return i},r._getUnionPolygonGeometryByTurf=function(e){for(var t=null,r=0;r<e.length;r++){var n=turf.polygon(e[r].coordinates);t=0===r?n:turf.union(t,n)}return t.geometry},r.esriGeom2TSGISGeom=function(e,r,n){var o=n;r.spatialReference&&(o=r.spatialReference.latestWkid);var i=ArcGISToGeoJSON.arcgisToGeoJSON(r);return t.sfs.GeometryFactory.createGeometryFromGeoJson(i,o)},r.getDistance=function(e,t,r){r=r||4326;var n=new egis.sfs.CoordinateTransform,o=egis.sfs.GeometryFactory.createGeometryFromGeoJson(e),i=egis.sfs.GeometryFactory.createGeometryFromGeoJson(t);o.spatialReference=r,i.spatialReference=r;var a=n.transform(o,3857),s=n.transform(i,3857),l=G.utils.GeometryUtil.getWktReader().read(a.asWkt()),c=G.utils.GeometryUtil.getWktReader().read(s.asWkt());return l.distance(c)},r}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(9),o=r(135),i=r(6),a=r(39),s=Object.defineProperty;t.f=n?s:function(e,t,r){if(i(e),t=a(t,!0),i(r),o)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){"use strict";var n,o;n=[r(2),r(12),r(97),r(38),r(1)],void 0===(o=function(e,t,r,n,o){var i={createBaseLayer:function(t,n,i){if(!e.isObject(t))throw new Error("参数类型错误!");var a=null;if("group"==t.type){var s=t.layers,l=t.id||e.newUUID();if("MBTileLayer"===t.layerClass){for(var c=[],u=0,f=s.length;u<f;u++){var h=g(s[u]);h._type=r.TYPES.BASE_LAYER_TAG,c.push(h)}a=c}else{for(var p=new o.carto.GroupLayer({id:l,name:t.title||"",zIndex:t.zIndex,layers:[]}),d=0,y=s.length;d<y;d++){var m=g(s[d]);p.addLayer(m)}a=p}}else(a=g(t)).name=t.title||"";return e.isArray(a)?a.forEach((function(e){e._type=r.TYPES.BASE_LAYER_TAG,e.layerGroups=t.layerGroups||""})):(a._type=r.TYPES.BASE_LAYER_TAG,a.layerGroups=t.layerGroups||""),a;function g(e){n&&(e.restHttp=n),i&&(e.map=i);var r=e.layerClass||"TileLayer",a=new o.carto[r](e);return t.zIndex&&a.setZIndex(t.zIndex),a}},getBaseLayer:function(e){for(var t=e.getMap().layers,n=[],o=0,i=t.length;o<i;o++){var a=t[o];a&&a._type==r.TYPES.BASE_LAYER_TAG&&n.push(a)}return n},removeBaseLayer:function(e){for(var t=i.getBaseLayer(e),r=e.getMap(),n=0,o=t.length;n<o;n++){var a=t[n];r.removeLayer(a)}return t},isBaseLayer:function(e){return e&&e._type===r.TYPES.BASE_LAYER_TAG},removeBaseLayerById:function(e,t){var r=i.getLayerById(e,t);r&&e.getMap().removeLayer(r)},ClearLayerByName:function(e,t){var r=e.getMap().findLayer(t);r&&r.clear()},ClearAllLayer:function(e){for(var t=0;t<e.getMap().layers.length;t++)e.getMap().layers[t].clear()},switchBaseLayer:function(t){if(!t||!t.layerOpts)throw new Error("参数类型错误！");var o=t.map,a=i.removeBaseLayer(o),s=[],l=t.restHttp;if(e.isArray(t.layerOpts))for(var c=0,u=t.layerOpts.length;c<u;c++){var f=t.layerOpts[c];if(e.isObject(f)){var h=i.createBaseLayer(f,l);o.addLayer(h),s.push(h)}}else{h=i.createBaseLayer(t.layerOpts,l);o.addLayer(h),s.push(h)}var p=o.getLayers();for(c=0,u=p.length;c<u;c++){var d=p[c];d._type!==r.TYPES.BASE_LAYER_TAG&&(d.getZIndex()>0||d.setZIndex(1))}var y={};y.old=a,y.new=s,o.fire(n.SWITCH_BASE_LAYER,y)},getLayerById:function(e,t){if(t){var r=(e instanceof G.Map?e.getMap():e).layers,n={};for(var i in r){a(n,r[i],t)}return n.layer||null}return null;function a(e,t,r){if(!e.layer)if(t.id!=r){if(t instanceof o.carto.GroupLayer){var n=t.groupLayers;for(var i in n){a(e,n[i],r)}}}else e.layer=t}}},a={point:1,polyline:2,polygon:3},s=[{id:"default-point-group",name:"点图层组"},{id:"default-polyline-group",name:"线图层组"},{id:"default-polygon-group",name:"面图层组"}];i.defaultGroupLayers=s,i.initGroupLayers=function(e,t){e._group_layer_indexes=t||[12,11,10];var r=i.getGroupLayerZIndex(e);if(!e._group_layer_initialized){for(var n=2;n>=0;n--){var a=s[n],l=new o.carto.GroupLayer({id:a.id,name:a.name,layers:[],zIndex:r[n]});e.addLayer(l)}e._group_layer_initialized=!0}},i.addLayer2Group=function(e,t,r){var o=a[r]||1,l=s[o-1],c=i.getLayerById(e,l.id),u=i.getGroupLayerZIndex(e);return!!c&&(c.addLayer(t),t.setZIndex(u[o-1]),e.fire(n.LAYER_CHANGED,{type:"add",layers:[t]}),!0)},i.removeLayerFromGroup=function(e,t,r){var o=s[(a[r]||1)-1],l=i.getLayerById(e,o.id);return!!l&&(l.removeLayer(t),e.fire(n.LAYER_CHANGED,{type:"remove",layers:[t]}),!0)},i.getGroupLayerZIndex=function(e){return e._group_layer_indexes},i.addImageLayer=function(e){var t=new o.carto.ImageLayer({id:e.id,name:e.name,imageType:702,extent:[e.pointArr[0].x,e.pointArr[0].y,e.pointArr[1].x,e.pointArr[1].y],crossOrigin:"anonymous",url:e.url});e.map.addLayer(t)},i.clearImageLayer=function(e,t){e.findLayer(t)&&e.getMap().removeLayer(e.findLayer(t))},i.addElementLayer=function(e){var t;null==e.map.findLayer(e.name)?(t=new o.carto.ElementLayer({map:e.map.getMap(),name:e.name,id:e.id}),e.map.getMap().addLayer(t)):t=e.map.findLayer(e.name);var r=G.utils.RenderUtil.geoinfoToElement(e.geoInfo,e.symbol,e.eleInfo);t.add(r)},i.getLayerExtent=function(e){e instanceof r.BaseLayer&&(e=e.getLayer());var n=function e(t){var r=[],n=[];if(t instanceof o.carto.FeatureLayer)r=t.features;else if(t instanceof o.carto.ElementLayer)r=t.elements;else{if(!(t instanceof o.carto.ClusterLayer)){if(t instanceof o.carto.GroupLayer){var i=t.groupLayers;for(var a in i){var s=i[a],l=e(s)||[];n=n.concat(l)}return n}throw new Error("图层类型错误！")}r=t.elements}for(var c in r){var u=r[c];u&&u.geometry&&n.push(u.geometry)}return n}(e);return t.getGeometryEnvlop(n)},i.setLayerSymbol=function(t,r,n){if(!r&&0==n.length)throw new Error("参数类型错误！");e.isEmptyObject(r.symbol)&&(r.symbol={});var a={TextSymbol:"TextSymbol",SimpleMarkerSymbol:"SimpleMarkerSymbol",PictureMarkerSymbol:"PicturemarkerSymbol",SimpleLineSymbol:"SimpleLineSymbol",SimpleFillSymbol:"SimpleFillSymbol"};if(r instanceof o.carto.GroupLayer){var s=r.id.substr(0,r.id.length-12);l(i.getLayerById(t,s+"elementLayer")),l(i.getLayerById(t,s+"featureLayer"))}else l(r);function l(e){if(e instanceof o.carto.ElementLayer)for(var t=0;t<n.length;t++){e.symbol[n[t].type]=n[t].options;var r=e.elements,i=a[n[t].type];if(r.length>0)for(var s=0;s<r.length;s++){(l=new o.sfs[i](n[t].options)).$type==r[s].symbol.$type&&(r[s].symbol=l,e.update(r[s],!0))}}else{i=a[n[0].type];var l=new o.sfs[i](n[0].options),c=new o.render.SimpleRenderer({symbol:l});e.featureRenders.length=0,e.render(c)}}},i.getLayerSymbol=function(t,r){if(!t&&!r)throw new Error("参数类型错误！");var n={};return e.isEmptyObject(t.symbol)?n={}:(n.type=r,n.options=t.symbol[r]),n};return i.selectElementOnMap=function(e,t,n){if(!e||0==t.length)throw new Error("传入参数错误");n||(n="intersects");for(var i=G.utils.GeometryUtil.toJstsGeometry(e),a={},s=0;s<t.length;s++){var l=t[s],c=l.getLayerId();l instanceof r.DistributeLayer&&(l=l.getLayer()),a[c]=u(l,i,n)}return a;function u(e,t,r){var n=[];if(e instanceof o.carto.ElementLayer||e instanceof o.carto.FeatureLayer)for(var i=e.getCount(),a=0;a<i;a++){var s=e.get(a),l=G.utils.GeometryUtil.toJstsGeometry(f(s));t[r](l)&&n.push(s)}else if(e instanceof o.carto.GroupLayer)for(var c=e.groupLayers,h=0,p=c.length;h<p;h++){var d=c[h];n=n.concat(u(d,t,r))}return n}function f(e){if(e instanceof o.sfs.PlotElement){var t=e.elements;return t[t.length-1].geometry}return e.geometry}},i.addElementLayerToMap=function(e,t){var r=new o.carto.ElementLayer({map:t,name:e.name,id:e.id,zIndex:e.zIndex,attr:e.attr,visible:e.visible,groupType:e.groupType});return r.attr=e.attr,"point"==e.groupType||"line"==e.groupType||"polygon"==e.groupType?i.addLayer2Group(t,r,e.groupType):t.addLayer(r),r},i}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(11)],void 0===(o=function(e){return e.extend({options:{map:null},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)}})}.apply(t,n))||(e.exports=o)},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(24);e.exports=function(e){return Object(n(e))}},function(e,t,r){"use strict";var n,o;n=[r(2),r(12),r(1)],void 0===(o=function(e,t,r){var n={symbol2ImageHtml:function(e,t){var n;t=t||{};var o=this,i=e.$type.split(",")[0],a={PictureMarkerSymbol:function(){if(e.source.indexOf("data:image/png;base64,")>-1)var t=e.source;else t="data:image/png;base64,"+e.source;return console.log(e.source),console.log(t),console.log("============================"),n='<img src="'+t+'" alt="">'},SimpleMarkerSymbol:function(){var r=e.size;return r=r>10?10:r,isNaN(t.size)||(r=t.size),n='<svg width="25px" height="25px" version="1.0.0">',n+="<circle",n+=' cx="12" ',n+=' cy="12" ',n+=' r="'+r+'" ',n+=' stroke="'+u(e.borderColor)+'" ',n+=' stroke-opacity="'+e.borderColor.a/255+'" ',n+=' stroke-width="'+e.borderThickness+'" ',n+=' fill="'+u(e.fillColor)+'"',n+=' fill-opacity="'+e.fillColor.a/255+'" ',n+="></svg>"},SimpleLineSymbol:function(){n='<svg width="30px" height="20px" version="1.0.0">',n+="<line",n+=' x1="5" y1="10"',n+=' x2="25" y2="10"',n+=' stroke="'+u(e.color)+'" ';var t=parseInt(e.style);return 1!=t&&5!=t&&(n+=' stroke-dasharray="5,5"'),n+=' stroke-opacity="'+e.color.a/255+'" ',n+=' stroke-width="'+e.width+'" ',n+="></svg>"},SimpleFillSymbol:function(){return n='<svg width="30px" height="20px" version="1.0.0">',n+="<polygon",n+=' points="0,0,0,20,25,20,25,0" ',n+=' stroke="'+u(e.borderColor)+'" ',n+=' stroke-opacity="'+e.borderColor.a/255+'" ',n+=' stroke-width="'+e.borderThickness+'" ',n+=' fill="'+u(e.fillColor)+'"',n+=' fill-opacity="'+e.fillColor.a/255+'" ',n+="></svg>"},CurrencySymbol:function(){var t=e.markerSymbol||e.fillSymbol;n=o.symbol2ImageHtml(t);var r=e.textSymbol;if(r){n+='<span style="',n+="position: relative;",n+="left: -20px;",n+="top: -8px;",n+="font-size: 10px;";var i="#fff";return r.foreground&&(i=r.foreground.toHex().substr(0,7)),n+="color:"+i+";",r.fontFamilyName&&(n+="font-family:"+r.fontFamilyName+";"),r.fontWeight&&(n+="font-weight:"+r.fontWeight+";"),n+='">10</span>'}}};if(e&&"pixelcluster"==e.$type){var s=e.fillStrokeWidth||10,l=new r.sfs.SimpleMarkerSymbol({borderColor:e.fillStrokeColor,fillColor:e.fillColor,borderThickness:s/2,size:s});n=function(e,r,n){var o=isNaN(e.borderThickness)?0:e.borderThickness,i=e.size,a=i+o,s=1;r=isNaN(r)?12:r,n=isNaN(n)?5:n;a>r&&(s=r/(a=r));o*=s,(i*=s)>n&&(o+=i-n,i=n);isNaN(t.size)||(i=t.size);var l=r,c='<svg width="25px" height="25px" version="1.0.0">';return c+="<circle",c+=' cx="'+l+'" ',c+=' cy="'+l+'" ',c+=' r="'+i+'" ',c+=' fill="rgb(255,255,255)"',c+=' fill-opacity="0" ',c+=' stroke="'+u(e.borderColor)+'"',c+=' stroke-width="'+o+'" ',c+=' stroke-opacity="'+e.borderColor.a/255+'" />',c+="<circle",c+=' cx="'+l+'" ',c+=' cy="'+l+'" ',c+=' r="'+i+'" ',c+=' fill="'+u(e.fillColor)+'"',c+=' fill-opacity="'+e.fillColor.a/255+'"/>',c+="</svg>"}(l,12,7),n+='<span style="',n+="position: relative;",n+="left: -16px;",n+="top: -8px;",n+="font-size: 10px;";var c="#fff";e.textFillColor&&(c=e.textFillColor.toHex().substr(0,7)),n+="color:"+c+";",n+='">1</span>'}else"function"==typeof a[i]&&(n=a[i]());return n;function u(e){if(e)return"rgb("+e.r+","+e.g+","+e.b+")"}},object2Symbol:function(t){if(0==arguments.length)throw new Error("参数错误！");if(1==arguments.length){t=arguments[0];if(e.isString(t))try{t=JSON.parse(t)}catch(e){}return n.object2Symbol(t.type,t.options)}var o=arguments[0],i=arguments[1],a={TextSymbol:function(e){return c(e,["foreground","borderColor"]),new r.sfs.TextSymbol(e)},PictureMarkerSymbol:function(t){var n=t.source||"",o=t.sourceKey||"";return o=o.trim(),t.width=isNaN(t.width)?20:t.width,t.height=isNaN(t.height)?20:t.height,t.offsetX=isNaN(t.offsetX)?t.width/2:t.offsetX,t.offsetY=isNaN(t.offsetY)?t.height/2:t.offsetY,o&&!n&&(o.indexOf(".")<0?t.source=window[o]||G.icons[o]:t.source=e.getValByVarPath(o)),new r.sfs.PictureMarkerSymbol(t)},VectorMarkerSymbol:function(e){return new r.sfs.VectorMarkerSymbol(e)},SimpleMarkerSymbol:function(e){return e.size=isNaN(e.size)?5:e.size,e.offsetX=isNaN(e.offsetX)?e.size/2:e.offsetX,e.offsetY=isNaN(e.offsetY)?e.size/2:e.offsetY,c(e,["borderColor","fillColor"]),new r.sfs.SimpleMarkerSymbol(e)},SimpleLineSymbol:function(e){return c(e,["color"]),new r.sfs.SimpleLineSymbol(e)},SimpleFillSymbol:function(e){return c(e,["borderColor","fillColor"]),new r.sfs.SimpleFillSymbol(e)}},s=a[o||"PictureMarkerSymbol"];if(!e.isFunction(s))throw new Error("type值错误！");var l=jQuery.extend(!0,{},i);return s(l);function c(e,t){e=e||{};for(var r=0,o=(t=t||[]).length;r<o;r++){var i=t[r];e[i]&&(e[i]=n._getColor(e[i]))}}},symbol2Object:function(t){var r=null;if(t&&t.$type){var o=t.$type,i=/^(.*Symbol),http\:\/\/www.Gs.com$/;i.test(o)&&(r=i.exec(o)[1])}if(!r)throw new Error("参数类型错误！");var a=JSON.parse(JSON.stringify(t));delete a.$type,function(t){for(var r=["color","borderColor","fillColor","foreground"],o=0,i=r.length;o<i;o++){var a=r[o],s=t[a];e.isObject(s)&&(t[a]=n.color2Object(s))}}(a);return{type:{TextSymbol:"TextSymbol",SimpleMarkerSymbol:"SimpleMarkerSymbol",PictureMarkerSymbol:"PictureMarkerSymbol",VectorMarkerSymbol:"VectorMarkerSymbol",SimpleLineSymbol:"SimpleLineSymbol",SimpleFillSymbol:"SimpleFillSymbol"}[r],options:a}},object2Color:function(e){return n._getColor(e)},color2Object:function(t){var n={};if(e.isString(t))try{t=r.sfs.Color.fromHex(t)}catch(e){}return t&&"Color,http://www.Gs.com"==t.$type&&(n.a=t.a,n.r=t.r,n.g=t.g,n.b=t.b),n},_getColor:function(t){if(e.isObject(t)){var n=jQuery.extend(!0,{},t);return n.alpha&&(n.a=n.alpha,delete n.alpha),new r.sfs.Color(n)}return"string"==typeof t?r.sfs.Color.fromHex(t):t},geoinfoToElement:function(o,i,a){var s;console.log(i),s=i.$type?i:n.object2Symbol(i.type,i.options),console.log(s);var l,c=r.sfs.GeometryFactory,u=e.isObject(o),f=e.isString(o);(a=a||{}).hasOwnProperty("id")||(a.id=e.newUUID32());var h=[];if(null!=t.getG2GeometryType(o)?l=o:u?l=c.createGeometryFromGeoJson(o):f&&(l=c.createGeometryFromWkt(o)),l){if(a.layer instanceof r.carto.FeatureLayer){var p=new r.sfs.Feature({geometry:l,values:a.property});return p.symbol=s,p.id=a.id,p.name=a.name,p}var d=new r.sfs.Element({geometry:l,symbol:s,id:a.id,name:a.name}),y=a.property,m=new r.sfs.Attribute({name:"data",value:y});return h.push(m),d.attributeSet.attributes=h,a.layer&&a.layer.add(d),d}throw new Error("geoinfo格式错误！")}};return n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(49),o=r(65),i=r(17),a=r(10),s=r(71),l=[].push,c=function(e){var t=1==e,r=2==e,c=3==e,u=4==e,f=6==e,h=5==e||f;return function(p,d,y,m){for(var g,v,b=i(p),_=o(b),w=n(d,y,3),S=a(_.length),L=0,x=m||s,P=t?x(p,S):r?x(p,0):void 0;S>L;L++)if((h||L in _)&&(v=w(g=_[L],L,b),e))if(t)P[L]=v;else if(v)switch(e){case 3:return!0;case 5:return g;case 6:return L;case 2:l.call(P,g)}else if(u)return!1;return f?-1:c||u?u:P}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6)}},function(e,t,r){var n=r(9),o=r(82),i=r(46),a=r(27),s=r(39),l=r(16),c=r(135),u=Object.getOwnPropertyDescriptor;t.f=n?u:function(e,t){if(e=a(e),t=s(t,!0),c)try{return u(e,t)}catch(e){}if(l(e,t))return i(!o.f.call(e,t),e[t])}},function(e,t,r){"use strict";var n;void 0===(n=function(){var e={extend:function(e){var t,r,n,o;for(r=1,n=arguments.length;r<n;r++)for(t in o=arguments[r])e[t]=o[t];return e},create:Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}()};!function(){function t(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var r=0;function n(e){var t=+new Date,n=Math.max(0,16-(t-r));return r=t+n,window.setTimeout(e,n)}var o=window.requestAnimationFrame||t("RequestAnimationFrame")||n,i=window.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};e.requestAnimFrame=function(e,t,r){if(!r||o!==n)return o.call(window,function(e,t){var r=Array.prototype.slice;if(e.bind)return e.bind.apply(e,r.call(arguments,1));var n=r.call(arguments,2);return function(){return e.apply(t,n.length?n.concat(r.call(arguments)):arguments)}}(e,t));e.call(t)},e.cancelAnimFrame=function(e){e&&i.call(window,e)}}();var t=function(){};return t.setOptions=function(t,r){for(var n in t.hasOwnProperty("options")||(t.options=t.options?e.create(t.options):{}),r)t.options[n]=r[n];return t.options},t.extend=function(t){var r=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=r.__super__=this.prototype,o=e.create(n);for(var i in o.constructor=r,r.prototype=o,this)this.hasOwnProperty(i)&&"prototype"!==i&&(r[i]=this[i]);return t.statics&&(e.extend(r,t.statics),delete t.statics),t.includes&&(e.extend.apply(null,[o].concat(t.includes)),delete t.includes),o.options&&(t.options=e.extend(e.create(o.options),t.options)),e.extend(o,t),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=o._initHooks.length;e<t;e++)o._initHooks[e].call(this)}},r},t.include=function(t){return t="prototype"in t?t.prototype:t,e.extend(this.prototype,t),this},t.mergeOptions=function(t){return e.extend(this.prototype.options,t),this},t.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),r="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(r),this},t.defaults=function(e,t,r){for(var n in t)t.hasOwnProperty(n)&&(r?null!=t[n]:null==e[n])&&(e[n]=t[n]);return e},t.inherits=function(e,t){var r=e.prototype;function n(){}for(var o in n.prototype=t.prototype,e.prototype=new n,r)e.prototype[o]=r[o];e.prototype.constructor=e,e.superClass=t},t.mixin=function(e,r,n){e="prototype"in e?e.prototype:e,r="prototype"in r?r.prototype:r,t.defaults(e,r,n)},t.prototype={equals:function(e,t){return r(e,t)&&r(t,e);function r(e,t){if(e&&e.constructor==Object){if(t&&t.constructor==Object){for(var n in e){var o=e[n],i=t[n];if(!(r(o,i)&&r(i,o)))return!1}return!0}return!1}return e===t}}},t}.apply(t,[]))||(e.exports=n)},function(e,t,r){var n=r(4),o=r(25),i=r(16),a=r(100),s=r(101),l=r(28),c=l.get,u=l.enforce,f=String(String).split("String");(e.exports=function(e,t,r,s){var l=!!s&&!!s.unsafe,c=!!s&&!!s.enumerable,h=!!s&&!!s.noTargetGet;"function"==typeof r&&("string"!=typeof t||i(r,"name")||o(r,"name",t),u(r).source=f.join("string"==typeof t?t:"")),e!==n?(l?!h&&e[t]&&(c=!0):delete e[t],c?e[t]=r:o(e,t,r)):c?e[t]=r:a(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||s(this)}))},function(e,t,r){"use strict";var n;void 0===(n=function(){var e={},t=null;return e._getLogger=function(){return null==t&&e.setOptions({type:"console"}),t},e.setOptions=function(e){if(e)if("log4js"===e.type){if(!window.log4javascript)throw new Error("log4javascript is not defined!");var r={popup:new log4javascript.PopupAppender,inpage:new log4javascript.InPageAppender};t=window.log4javascript.getLogger("main"),log.addAppender(r[e.appender||"popup"])}else t=(e.type,window.console)},e.info=function(t){e._getLogger().info(t)},e.trace=function(t){e._getLogger().trace(t)},e.debug=function(t){e._getLogger().debug(t)},e.warn=function(t){e._getLogger().warn(t)},e.error=function(t){e._getLogger().error(t)},e.clear=function(){e._getLogger().clear(obj)},e}.apply(t,[]))||(e.exports=n)},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var n=r(9),o=r(13),i=r(46);e.exports=n?function(e,t,r){return o.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(9),o=r(3),i=r(16),a=Object.defineProperty,s={},l=function(e){throw e};e.exports=function(e,t){if(i(s,e))return s[e];t||(t={});var r=[][e],c=!!i(t,"ACCESSORS")&&t.ACCESSORS,u=i(t,0)?t[0]:l,f=i(t,1)?t[1]:void 0;return s[e]=!!r&&!o((function(){if(c&&!n)return!0;var e={length:-1};c?a(e,1,{enumerable:!0,get:l}):e[1]=1,r.call(e,u,f)}))}},function(e,t,r){var n=r(65),o=r(24);e.exports=function(e){return n(o(e))}},function(e,t,r){var n,o,i,a=r(137),s=r(4),l=r(5),c=r(25),u=r(16),f=r(83),h=r(67),p=s.WeakMap;if(a){var d=new p,y=d.get,m=d.has,g=d.set;n=function(e,t){return g.call(d,e,t),t},o=function(e){return y.call(d,e)||{}},i=function(e){return m.call(d,e)}}else{var v=f("state");h[v]=!0,n=function(e,t){return c(e,v,t),t},o=function(e){return u(e,v)?e[v]:{}},i=function(e){return u(e,v)}}e.exports={set:n,get:o,has:i,enforce:function(e){return i(e)?o(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!l(t)||(r=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(139),o=r(16),i=r(145),a=r(13).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});o(t,e)||a(t,e,{value:i.f(e)})}},function(e,t,r){var n=r(24),o=/"/g;e.exports=function(e,t,r,i){var a=String(n(e)),s="<"+t;return""!==r&&(s+=" "+r+'="'+String(i).replace(o,"&quot;")+'"'),s+">"+a+"</"+t+">"}},function(e,t,r){var n=r(3);e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(139),o=r(4),i=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?i(n[e])||i(o[e]):n[e]&&n[e][t]||o[e]&&o[e][t]}},function(e,t,r){var n=r(16),o=r(17),i=r(83),a=r(113),s=i("IE_PROTO"),l=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=o(e),n(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?l:null}},function(e,t,r){var n,o;n=[r(1)],void 0===(o=function(e){var t,r=Array.prototype.slice,n=function(e){this._$handlers={},e&&this.delegateMapEvents(e.map)};return(n.prototype={constructor:n,once:function(e,t,r){this._$handlers||(this._$handlers={});var n=this._$handlers;if(!t||!e)return this;n[e]||(n[e]=[]);for(var o=0;o<n[e].length;o++)if(n[e][o].h===t)return this;return n[e].push({h:t,one:!0,ctx:r||this}),this},addEventListener:function(e,t,r){this._$handlers||(this._$handlers={});var n=this._$handlers;if(!t||!e)return this;n[e]||(n[e]=[]);for(var o=0;o<n[e].length;o++)if(n[e][o].h===t)return this;return n[e].push({h:t,one:!1,ctx:r||this}),this},listens:function(e,t){this._$handlers||(this._$handlers={});var r=this._$handlers;if(t){for(var n=0;n<r[e].length;n++)if(r[e][n].h==t)return!0;return!1}return!(!r[e]||!r[e].length)},removeEventListener:function(e,t){this._$handlers||(this._$handlers={});var r=this._$handlers;if(!e)return this._$handlers={},this;if(t){if(r[e]){for(var n=[],o=0,i=r[e].length;o<i;o++)r[e][o].h!=t&&n.push(r[e][o]);r[e]=n}r[e]&&0===r[e].length&&delete r[e]}else delete r[e];return this},fireEvent:function(e){this._$handlers||(this._$handlers={});var t=[];if(this._$handlers[e]){var n=arguments,o=n.length;o>3&&(n=r.call(n,1));for(var i=this._$handlers[e],a=i.length,s=0;s<a;){var l=null;switch(o){case 1:l=i[s].h.call(i[s].ctx);break;case 2:l=i[s].h.call(i[s].ctx,n[1]);break;case 3:l=i[s].h.call(i[s].ctx,n[1],n[2]);break;default:l=i[s].h.apply(i[s].ctx,n)}t.push(l),i[s].one?(i.splice(s,1),a--):s++}}return t},fireWithContext:function(e){if(this._$handlers||(this._$handlers={}),this._$handlers[e]){var t=arguments,n=t.length;n>4&&(t=r.call(t,1,t.length-1));for(var o=t[t.length-1],i=this._$handlers[e],a=i.length,s=0;s<a;){switch(n){case 1:i[s].h.call(o);break;case 2:i[s].h.call(o,t[1]);break;case 3:i[s].h.call(o,t[1],t[2]);break;default:i[s].h.apply(o,t)}i[s].one?(i.splice(s,1),a--):s++}}return this}}).on=n.prototype.addEventListener,n.prototype.off=n.prototype.removeEventListener,n.prototype.fire=n.prototype.fireEvent,t={click:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"clickDelegates_",api:"MapClick"},dblclick:{args:["screenX","screenY","mapX","mapY"],var:"dblClickDelegates_",api:"MapDblClick"},mousemove:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"mouseMoveDelegates_",api:"MapMouseMove"},mousedown:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"mouseDownDelegates_",api:"MapMouseDown"},mouseup:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"mouseUpDelegates_",api:"MapMouseUp"},extentchanged:{args:["left","top","right","bottom"],var:"extentChangedDelegates_",api:"MapExtentChange"},resize:{args:["newSize","oldSize"],var:"resizeDelegates_",api:"MapResize"},resolutionchanged:{args:["newResolution","oldResolution","level"],var:"resolutionChangedDelegates_",api:"MapResolutionChange"}},n.prototype.delegateMapEvents=function(r){if(!(r instanceof e.carto.Map))throw new Error("map对象必须为g2.carto.Map类型！");var n=this,o={};for(var i in function(){for(var e in t){var r=t[e];this[r.var]=[],this[r.var]["_"+e+"_index"]=0}}.call(n),t){t[i];var a=s(i);r.on(i,a),o[i]=a}function s(e){var t=function(){for(var e=[],t=0,r=arguments.length;t<r;t++)e.push(arguments[t]);l.call(n,arguments.callee._event,e)};return t._event=e,t}function l(e,r){var n=t[e];if(n){for(var o=this[n.var],i=n.args,a={},s=0,l=i.length;s<l;s++)a[i[s]]=r[s];if("[object Array]"==Object.prototype.toString.call(o))for(s=0,l=o.length;s<l;s++){var c=o[s];if(c)try{c.callback.call(c.context,a)}catch(e){console.error(e)}}}}this._g2mapListeners=o},n.prototype.unDelegateMapEvents=function(t){if(t instanceof e.carto.Map&&this._g2mapListeners)for(var r in this._g2mapListeners)try{t.un(r,this._g2mapListeners[r])}catch(e){}},n.prototype._on=function(e,r,n){var o=!1;try{var i=t[e];if(i){var a=this[i.var],s="_"+e+"_index",l=a[s];a[l]={context:n,callback:r},a[s]=l+1,o=!0}}catch(e){console.error(e.message)}return o},n.prototype.isMapEvent=function(e){return t.hasOwnProperty(e)},n.prototype._off=function(e,r,n){var o=!1,i="[object Function]"==Object.prototype.toString.call(r),a=!!n;try{for(var s=this[t[e].var],l=s.length-1;l>=0;l--){var c=s[l];c&&u(c)&&(s[l]=void 0,s.splice(l,1),o=!0)}}catch(e){console.error(e.message)}function u(e){return e=e||{},i&&a?e.callback===r&&e.context===n:i?e.callback===r:!!a&&e.context===n}return o},n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n;void 0===(n=function(){return{SWITCH_BASE_LAYER:"switch_base_layer",CLEAR_MAP:"clear_map",PLOT_CREATED:"plot_created",PLOT_UPDATED:"plot_updated",PLOT_MOUSEUP:"plot_mouseup",PLOT_DELETE:"plot_delete",PLOT_CANCELED:"plot_canceled",PLOT_CLICKED:"plot_clicked",COLLABORATIVE_PLOT_CREATED:"collaborative_plot_created",COLLABORATIVE_PLOT_UPDTAED:"collaborative_plot_updated",COLLABORATIVE_PLOT_DELETE:"collaborative_plot_delete",GLOBAL_VALUE_SETTED:"global_val_setted",LAYER_CHANGED:"some_layer_changed"}}.apply(t,[]))||(e.exports=n)},function(e,t,r){var n=r(5);e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=!1},function(e,t,r){var n=r(13).f,o=r(16),i=r(7)("toStringTag");e.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,i)&&n(e,i,{configurable:!0,value:t})}},function(e,t){e.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.opts=t||{}}},function(e,t,r){"use strict";var n=r(3);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){"use strict";var n=r(0),o=r(4),i=r(9),a=r(124),s=r(8),l=r(114),c=r(51),u=r(46),f=r(25),h=r(10),p=r(156),d=r(172),y=r(39),m=r(16),g=r(75),v=r(5),b=r(48),_=r(55),w=r(53).f,S=r(173),L=r(19).forEach,x=r(60),P=r(13),E=r(20),T=r(28),C=r(88),A=T.get,k=T.set,R=P.f,O=E.f,I=Math.round,M=o.RangeError,F=l.ArrayBuffer,D=l.DataView,j=s.NATIVE_ARRAY_BUFFER_VIEWS,G=s.TYPED_ARRAY_TAG,N=s.TypedArray,B=s.TypedArrayPrototype,U=s.aTypedArrayConstructor,z=s.isTypedArray,W=function(e,t){for(var r=0,n=t.length,o=new(U(e))(n);n>r;)o[r]=t[r++];return o},Y=function(e,t){R(e,t,{get:function(){return A(this)[t]}})},q=function(e){var t;return e instanceof F||"ArrayBuffer"==(t=g(e))||"SharedArrayBuffer"==t},V=function(e,t){return z(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},H=function(e,t){return V(e,t=y(t,!0))?u(2,e[t]):O(e,t)},J=function(e,t,r){return!(V(e,t=y(t,!0))&&v(r)&&m(r,"value"))||m(r,"get")||m(r,"set")||r.configurable||m(r,"writable")&&!r.writable||m(r,"enumerable")&&!r.enumerable?R(e,t,r):(e[t]=r.value,e)};i?(j||(E.f=H,P.f=J,Y(B,"buffer"),Y(B,"byteOffset"),Y(B,"byteLength"),Y(B,"length")),n({target:"Object",stat:!0,forced:!j},{getOwnPropertyDescriptor:H,defineProperty:J}),e.exports=function(e,t,r){var i=e.match(/\d+$/)[0]/8,s=e+(r?"Clamped":"")+"Array",l="get"+e,u="set"+e,y=o[s],m=y,g=m&&m.prototype,P={},E=function(e,t){R(e,t,{get:function(){return function(e,t){var r=A(e);return r.view[l](t*i+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var o=A(e);r&&(n=(n=I(n))<0?0:n>255?255:255&n),o.view[u](t*i+o.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};j?a&&(m=t((function(e,t,r,n){return c(e,m,s),C(v(t)?q(t)?void 0!==n?new y(t,d(r,i),n):void 0!==r?new y(t,d(r,i)):new y(t):z(t)?W(m,t):S.call(m,t):new y(p(t)),e,m)})),_&&_(m,N),L(w(y),(function(e){e in m||f(m,e,y[e])})),m.prototype=g):(m=t((function(e,t,r,n){c(e,m,s);var o,a,l,u=0,f=0;if(v(t)){if(!q(t))return z(t)?W(m,t):S.call(m,t);o=t,f=d(r,i);var y=t.byteLength;if(void 0===n){if(y%i)throw M("Wrong length");if((a=y-f)<0)throw M("Wrong length")}else if((a=h(n)*i)+f>y)throw M("Wrong length");l=a/i}else l=p(t),o=new F(a=l*i);for(k(e,{buffer:o,byteOffset:f,byteLength:a,length:l,view:new D(o)});u<l;)E(e,u++)})),_&&_(m,N),g=m.prototype=b(B)),g.constructor!==m&&f(g,"constructor",m),G&&f(g,G,s),P[s]=m,n({global:!0,forced:m!=y,sham:!j},P),"BYTES_PER_ELEMENT"in m||f(m,"BYTES_PER_ELEMENT",i),"BYTES_PER_ELEMENT"in g||f(g,"BYTES_PER_ELEMENT",i),x(s)}):e.exports=function(){}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=Object.prototype.hasOwnProperty,i=Object.prototype.toString,a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,l=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===i.call(e)},c=function(e){if(!e||"[object Object]"!==i.call(e))return!1;var t,r=o.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&o.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!r&&!n)return!1;for(t in e);return void 0===t||o.call(e,t)},u=function(e,t){a&&"__proto__"===t.name?a(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},f=function(e,t){if("__proto__"===t){if(!o.call(e,t))return;if(s)return s(e,t).value}return e[t]};e.exports=function e(){var t,r,o,i,a,s,h=arguments[0],p=1,d=arguments.length,y=!1;for("boolean"==typeof h&&(y=h,h=arguments[1]||{},p=2),(null==h||"object"!==n(h)&&"function"!=typeof h)&&(h={});p<d;++p)if(null!=(t=arguments[p]))for(r in t)o=f(h,r),h!==(i=f(t,r))&&(y&&i&&(c(i)||(a=l(i)))?(a?(a=!1,s=o&&l(o)?o:[]):s=o&&c(o)?o:{},u(h,{name:r,newValue:e(y,s,i)})):void 0!==i&&u(h,{name:r,newValue:i}));return h}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(32),o=Math.max,i=Math.min;e.exports=function(e,t){var r=n(e);return r<0?o(r+t,0):i(r,t)}},function(e,t,r){var n,o=r(6),i=r(142),a=r(104),s=r(67),l=r(143),c=r(99),u=r(83),f=u("IE_PROTO"),h=function(){},p=function(e){return"<script>"+e+"<\/script>"},d=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;d=n?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(n):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var r=a.length;r--;)delete d.prototype[a[r]];return d()};s[f]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(h.prototype=o(e),r=new h,h.prototype=null,r[f]=e):r=d(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(33);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(7),o=r(48),i=r(13),a=n("unscopables"),s=Array.prototype;null==s[a]&&i.f(s,a,{configurable:!0,value:o(null)}),e.exports=function(e){s[a][e]=!0}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t,r){var n=r(6),o=r(33),i=r(7)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[i])?t:o(r)}},function(e,t,r){var n=r(140),o=r(104).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},function(e,t,r){"use strict";var n=r(39),o=r(13),i=r(46);e.exports=function(e,t,r){var a=n(t);a in e?o.f(e,a,i(0,r)):e[a]=r}},function(e,t,r){var n=r(6),o=r(153);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return n(r),o(i),t?e.call(r,i):r.__proto__=i,r}}():void 0)},function(e,t,r){var n=r(67),o=r(5),i=r(16),a=r(13).f,s=r(66),l=r(76),c=s("meta"),u=0,f=Object.isExtensible||function(){return!0},h=function(e){a(e,c,{value:{objectID:"O"+ ++u,weakData:{}}})},p=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,c)){if(!f(e))return"F";if(!t)return"E";h(e)}return e[c].objectID},getWeakData:function(e,t){if(!i(e,c)){if(!f(e))return!0;if(!t)return!1;h(e)}return e[c].weakData},onFreeze:function(e){return l&&p.REQUIRED&&f(e)&&!i(e,c)&&h(e),e}};n[c]=!0},function(e,t,r){var n=r(1),o=r(2),i=function(e){this.$type="PlotSchema,http://www.Gs.com";var t=e||{};this.id=t.id,this.name=t.name,this.userId=t.userId,this.createTime=null,this.elements=[],this.extent=null};i.prototype.addElement=function(e){this.elements.push(e)},i.prototype.getCount=function(){return this.elements.length},i.prototype.getElement=function(e){return this.elements[e]},i.fromJson=function(e){var t;t=o.isString(e)?JSON.parse(e):e;var r=new i({id:t.id,name:t.name,userId:t.userId});if(t.extent){var a=new n.sfs.Envelope({minx:t.extent.minx,maxx:t.extent.maxx,miny:t.extent.miny,maxy:t.extent.maxy});r.extent=a}if(t.camera){var s={heading:t.camera.heading,pitch:t.camera.pitch,roll:t.camera.roll,position:new n.sfs.Point({x:t.camera.position.x,y:t.camera.position.y,z:t.camera.position.z,spatialReference:t.camera.position.spatialReference})};r.camera=s}for(var l=new n.core.Deserializer,c=0;c<t.elements.length;c++){var u=l.createJsInstance(t.elements[c]);r.addElement(u)}return r},e.exports=i},function(e,t){function r(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,l,"next",e)}function l(e){r(a,o,i,s,l,"throw",e)}s(void 0)}))}}var o={},i="safety";function a(e){return e&&e.success?null:new Error(e.msg)}function s(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],o=n.tag;for(var i in delete n.tag,o)"[object Object]"==Object.prototype.toString.call(o[i])?n[i]=o[i].tag:n[i]=o[i];n.id=n._id,delete n._id}return e}var l={};o.getMetas=function(e){return new Promise(function(){var t=n(regeneratorRuntime.mark((function t(r,n){var o,s,c,u,f,h,p,d,y,m,g,v,b,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o=new Array(e.tables.length),s={},c=0;c<e.tables.length;c++)u=e.tables[c],l.hasOwnProperty(u)?o[c]=l[u]:s[u]=c;if(!((f=Object.keys(s)).length>0)){t.next=14;break}return h={dataSetId:{$in:f}},p=e.url+"/dataSet/query",(d={}).eId=i,d.query=JSON.stringify(h),t.next=11,e.httpRequest.get(p,"json",d,"application/x-www-form-urlencoded",{});case 11:if(y=t.sent,null==(m=a(y)))for(g=y.data.result,v=0;v<g.length;v++)b=g[v],_=s[b.dataSetId],o[_]=b,l[b.dataSetId]=b;else n(m);case 14:r(o);case 15:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},o.query=function(e){return new Promise(function(){var t=n(regeneratorRuntime.mark((function t(r,n){var o,l,c,u,f,h,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(c in o=e.url+"/dataOperate/query",(l={}).eId=e.eId||i,l.dataSetId=e.table,e.data)u=Object.prototype.toString.call(e.data[c]),l[c]="[object Object]"==u||"[object Array]"==u?JSON.stringify(e.data[c]):e.data[c]||null;return t.next=7,e.httpRequest.post(o,"json",l,"application/x-www-form-urlencoded; charset=UTF-8",{});case 7:f=t.sent,null==(h=a(f))?((p=f.data).total=p.totalCount,delete p.totalCount,p.list=s(p.result),delete p.result,e.dataParser&&(p=e.dataParser(p)),r(p)):n(h);case 10:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},o.queryMulti=function(e){return new Promise(function(){var t=n(regeneratorRuntime.mark((function t(r,n){var o,l,c,u,f,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.url+"/dataOperate/queryMulti",(l={}).eId=e.eId||i,l.data=JSON.stringify(e.data),t.next=6,e.httpRequest.post(o,"json",l,"application/x-www-form-urlencoded; charset=UTF-8",{});case 6:if(c=t.sent,null==(u=a(c))){for(h in f=c.data)f[h]=s(f[h]);e.dataParser&&(f=e.dataParser(f)),r(f)}else n(u);case 9:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},o.aggregateMulti=function(e){return new Promise(function(){var t=n(regeneratorRuntime.mark((function t(r,n){var o,l,c,u,f,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.url+"/dataStatics/aggregateMulti",(l={}).eId=e.eId||i,l.data=JSON.stringify(e.aggregateList),t.next=6,e.httpRequest.post(o,"json",l,"application/x-www-form-urlencoded; charset=UTF-8",{});case 6:if(c=t.sent,null==(u=a(c))){for(h in f=c.data)f[h]=s(f[h]);e.dataParser&&(f=e.dataParser(f)),r(f)}else n(u);case 9:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},o.clear=function(){for(var e in l)delete l[e]},e.exports=o},function(e,t,r){var n=r(34);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){"use strict";var n=r(35),o=r(13),i=r(7),a=r(9),s=i("species");e.exports=function(e){var t=n(e),r=o.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(22);e.exports=function(e,t,r){for(var o in t)n(e,o,t[o],r);return e}},function(e,t,r){var n=r(24),o="["+r(90)+"]",i=RegExp("^"+o+o+"*"),a=RegExp(o+o+"*$"),s=function(e){return function(t){var r=String(n(t));return 1&e&&(r=r.replace(i,"")),2&e&&(r=r.replace(a,"")),r}};e.exports={start:s(1),end:s(2),trim:s(3)}},function(e,t,r){"use strict";var n,o;n=[r(12),r(2),r(1)],void 0===(o=function(e,t,r){var n={};function o(e,t){var r=e[0],n=e[1],o=t[0],i=t[1],a=Math.abs(r-o),s=Math.abs(n-i),l=s/Math.sqrt(Math.pow(a,2)+Math.pow(s,2)),c=Math.acos(l),u=Math.floor(180/(Math.PI/c));return o>r&&i>n&&(u=180-u),o==r&&i>n&&(u=180),o>r&&i==n&&(u=90),o<r&&i>n&&(u=180+u),o<r&&i==n&&(u=270),o<r&&i<n&&(u=360-u),180-u}function i(e,t,r){for(var n,i,a,s,l,c,u=0,f=0,h=1;h<e.length&&(n=e[h-1],i=e[h],a=n.x,s=n.y,l=i.x,c=i.y,!((u+=f=Math.sqrt(Math.pow(a-l,2)+Math.pow(s-c,2)))>=t));h++);var p=o([e[h-1].x,e[h-1].y],[e[h].x,e[h].y]),d=(t-(u-f))/f;return[n.x+(i.x-n.x)*d,n.y+(i.y-n.y)*d,p]}return n._getJstsGeometry=e._getJstsGeometry,n._fromJstsGeometry=e._fromJstsGeometry,n.unionGeometry=function(t){return e._unionGeometry(t)},n.differGeom=function(e,t){if(!e||!t)return null;var n,o,i=null,a=0,s=t.length,l=360/(2*Math.PI*6378137),c=this._getJstsGeometry(e);if(c)for(n=c.geometry,n=jsts.simplify.DouglasPeuckerSimplifier.simplify(n,l),o=c.type;a<s;a++){var u=this._getJstsGeometry(t[a]);if(u)(e=u.geometry)&&n&&(e=jsts.simplify.DouglasPeuckerSimplifier.simplify(e,l),n.within(e)?n=null:n.intersects(e)&&(n=n.difference(e)))}if(n)switch(o){case 1:i=r.sfs.GeometryFormatter.fromWKT(n.toString());break;case 2:i=n.toString();break;case 3:"jsts.geom.GeometryCollection"==n.CLASS_NAME&&0==n.geometries.length&&(n=null),n&&(i=(i=r.sfs.GeometryFormatter.fromWKT(n.toString())).asGeoJson())}return i},n.interGeom=function(e,t){if(!e||!t)return null;var n,o,i=null,a=0,s=t.length,l=360/(2*Math.PI*6378137),c=this._getJstsGeometry(e);if(c)for(n=c.geometry,n=jsts.simplify.DouglasPeuckerSimplifier.simplify(n,l),o=c.type;a<s;a++){var u=this._getJstsGeometry(t[a]);if(u)(e=u.geometry)&&n&&(e=jsts.simplify.DouglasPeuckerSimplifier.simplify(e,l),n.within(e)?n=e:n.intersects(e)&&(n=n.intersection(e)))}if(n)switch(o){case 1:i=r.sfs.GeometryFormatter.fromWKT(n.toString());break;case 2:i=n.toString();break;case 3:"jsts.geom.GeometryCollection"==n.CLASS_NAME&&0==n.geometries.length&&(n=null),n&&(i=(i=r.sfs.GeometryFormatter.fromWKT(n.toString())).asGeoJson())}return i},n.getBuffer=function(t){t.spatialReference=t.spatialReference||r.sfs.EnumSpatialReference.EPSG4326;e.getWktReader();var n=this._getJstsGeometry(t.geometry)||{};if(!n||!n.geometry)return null;var o=t.radius,i=t.spatialReference==r.sfs.EnumSpatialReference.EPSG4326||t.spatialReference==r.sfs.EnumSpatialReference.EPSG4490||!1,a=n.geometry,s=null;if(a instanceof jsts.geom.Point)if(i){var l=e.getCirclePonits({center:[a.getX(),a.getY()],radius:o,count:128,spatialReference:t.spatialReference});l.push([l[0][0],l[0][1]]);var c={type:"Polygon",coordinates:[l]};s=e.getGeoJSONReader().read(c)}else s=a.buffer(o);else a instanceof jsts.geom.Geometry&&(i&&(o=e.meter2Rad(o)),s=a.buffer(o));return this._fromJstsGeometry({geometry:s,type:n.type,spatialReference:t.spatialReference})},n.getBuffer_turf=function(t){t.spatialReference=t.spatialReference||r.sfs.EnumSpatialReference.EPSG4326;e.getWktReader();var n=this._getJstsGeometry(t.geometry)||{};if(!n||!n.geometry)return null;var o=t.radius,i=t.spatialReference==r.sfs.EnumSpatialReference.EPSG4326||t.spatialReference==r.sfs.EnumSpatialReference.EPSG4490||!1,a=n.geometry,s=null,l=null;if(a instanceof jsts.geom.Point){if(i){(p=e.getCirclePonits({center:[a.getX(),a.getY()],radius:o,count:128,spatialReference:t.spatialReference})).push([p[0][0],p[0][1]]);var c={type:"Polygon",coordinates:[p]};s=e.getGeoJSONReader().read(c)}else s=a.buffer(o);l=this._fromJstsGeometry({geometry:s,type:n.type,spatialReference:t.spatialReference})}else if(a instanceof jsts.geom.Geometry)if(i){if(console.log(t.geometry),o=e.meter2Rad(o),"Polygon"===t.geometry.type){for(var u=t.geometry.coordinates[0],f=[t.geometry],h=0;h<u.length;h++){if(i){var p;(p=e.getCirclePonits({center:[u[h][0],u[h][1]],radius:o,count:128,spatialReference:t.spatialReference})).push([p[0][0],p[0][1]]);c={type:"Polygon",coordinates:[p]};s=e.getGeoJSONReader().read(c)}else s=a.buffer(o);var d=this._fromJstsGeometry({geometry:s,type:n.type,spatialReference:t.spatialReference});f.push(d)}console.log(f);var y=e._getUnionPolygonGeometryByTurf(f);console.log(y),l=y}}else s=a.buffer(o),l=this._fromJstsGeometry({geometry:s,type:n.type,spatialReference:t.spatialReference});return l},n.caculateDisatance=function(e,n,o){if(!t.isArray(e)||!t.isArray(n))throw new Error("参数类型错误！");o=isNaN(o)?4326:o;var i=new r.sfs.Point({x:e[0],y:e[1]}),a=new r.sfs.Point({x:n[0],y:n[1]}),s=new r.sfs.Polyline({spatialReference:o}),l=new r.sfs.Path({spatialReference:o});l.addPoint(i),l.addPoint(a),s.addGeometry(l);var c=new r.sfs.CoordinateTransform;return new r.sfs.MeasureService({projectService:c}).length(s)},n.point2SegmentDistance=function(e,t,r,n,o,i){var a,s,l={},c=(o-r)*(e-r)+(i-n)*(t-n);if(c<=0)return l.nearest=[r,n],l.distance=Math.sqrt((e-r)*(e-r)+(t-n)*(t-n)),l;if(c>=(o-r)*(o-r)+(i-n)*(i-n))return l.nearest=[o,i],l.distance=Math.sqrt((e-o)*(e-o)+(t-i)*(t-i)),l;if(r==o)a=r,s=t,l.nearest=[a,s],l.distance=Math.abs(e-a);else if(n==i)a=e,s=n,l.nearest=[a,s],l.distance=Math.abs(t-s);else{var u,f,h;s=(u=(n-i)/(r-o))*(a=(t-(h=-1/u)*e-(f=n-u*r))/(u-h))+f,l.nearest=[a,s],l.distance=Math.sqrt((e-a)*(e-a)+(t-s)*(t-s))}return l},n.getPointAlongPath=function(t){var n,a,s,l,c=new r.sfs.CoordinateTransform;try{var u;n=t.pathGeometry,a=t.pathSrid||3857,l=t.step,(u=n instanceof r.sfs.Polyline?n:r.sfs.GeometryFactory.createGeometryFromGeoJson(n)).spatialReference=t.pathSrid,3857!=a&&(u=c.transform(u,3857)),s=e.toJstsGeometry(u)}catch(e){throw new Error("参数错误！")}var f=[],h=s.points,p=l,d=s.getLength(),y=o([h[0].x,h[0].y],[h[1].x,h[1].y]);for(g(f,[h[0].x,h[0].y,y],a,3857);p<=d;){g(f,i(h,p,a),a,3857),p+=l}var m=o([h[h.length-2].x,h[h.length-2].y],[h[h.length-1].x,h[h.length-1].y]);return g(f,[h[h.length-1].x,h[h.length-1].y,m],a,3857),f;function g(e,t,n,o){var i=new r.sfs.Point({x:t[0],y:t[1],spatialReference:o});i=c.transform(i,n),t[0]=i.x,t[1]=i.y,t[2]=t[2],e.push(t)}},n.getPointOnPath=function(t){var n,o,a,s,l=new r.sfs.CoordinateTransform;try{var c;n=t.pathGeometry,o=t.pathSrid||3857,s=t.distance,(c=n instanceof r.sfs.Polyline?n:r.sfs.GeometryFactory.createGeometryFromGeoJson(n)).spatialReference=t.pathSrid,3857!=o&&(c=l.transform(c,3857)),a=e.toJstsGeometry(c)}catch(e){throw new Error("参数错误！")}var u,f=a.points,h=a.getLength()<s;if(!h){u=i(f,s);var p=new r.sfs.Point({x:u[0],y:u[1],spatialReference:3857});3857!=o&&(p=l.transform(p,o),u[0]=p.x,u[1]=p.y,u[2]=u[2])}return{point:u,arrival:h}},n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(21),o=n.extend({options:{zIndex:1},initialize:function(e){n.setOptions(this,e)},destroy:function(){},getLegends:function(){},add:function(e){},update:function(e){},remove:function(e){},clear:function(){},setVisible:function(e){},getVisible:function(){},onResolutionChanged:function(e){},onClick:function(e){},onMouseMove:function(e){},onMouseUp:function(e){},onMouseDown:function(e){}});e.exports=o},function(e,t,r){var n=r(3),o=r(34),i="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?i.call(e,""):Object(e)}:Object},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+n).toString(36)}},function(e,t){e.exports={}},function(e,t,r){var n=r(27),o=r(10),i=r(47),a=function(e){return function(t,r,a){var s,l=n(t),c=o(l.length),u=i(a,c);if(e&&r!=r){for(;c>u;)if((s=l[u++])!=s)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){var n=r(3),o=/#|\.prototype\./,i=function(e,t){var r=s[a(e)];return r==c||r!=l&&("function"==typeof t?n(t):!!t)},a=i.normalize=function(e){return String(e).replace(o,".").toLowerCase()},s=i.data={},l=i.NATIVE="N",c=i.POLYFILL="P";e.exports=i},function(e,t,r){var n=r(140),o=r(104);e.exports=Object.keys||function(e){return n(e,o)}},function(e,t,r){var n=r(5),o=r(59),i=r(7)("species");e.exports=function(e,t){var r;return o(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!o(r.prototype)?n(r)&&null===(r=r[i])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},function(e,t,r){var n=r(3),o=r(7),i=r(107),a=o("species");e.exports=function(e){return i>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t){e.exports={}},function(e,t,r){var n=r(75),o=r(73),i=r(7)("iterator");e.exports=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){var n=r(111),o=r(34),i=r(7)("toStringTag"),a="Arguments"==o(function(){return arguments}());e.exports=n?o:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:a?o(t):"Object"==(n=o(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t,r){var n=r(3);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,r){var n=r(6),o=r(110),i=r(10),a=r(49),s=r(74),l=r(150),c=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,t,r,u,f){var h,p,d,y,m,g,v,b=a(t,r,u?2:1);if(f)h=e;else{if("function"!=typeof(p=s(e)))throw TypeError("Target is not iterable");if(o(p)){for(d=0,y=i(e.length);y>d;d++)if((m=u?b(n(v=e[d])[0],v[1]):b(e[d]))&&m instanceof c)return m;return new c(!1)}h=p.call(e)}for(g=h.next;!(v=g.call(h)).done;)if("object"==typeof(m=l(h,b,v.value,u))&&m&&m instanceof c)return m;return new c(!1)}).stop=function(e){return new c(!0,e)}},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(126),__webpack_require__(2),__webpack_require__(12),__webpack_require__(406),__webpack_require__(23),__webpack_require__(18),__webpack_require__(1)],__WEBPACK_AMD_DEFINE_RESULT__=function(BaseLayer,CommonUtil,GeometryUtil,layerExtend,LoggerUtil,RenderUtil,g2){var layer=BaseLayer.extend({options:{idKey:"id",attributeField:"",geometryField:null,symbolConfigUrl:"",defaultSymbolKey:"default"},initialize:function(e){BaseLayer.prototype.initialize.call(this,e),this.type=this.constructor.type,CommonUtil.isObject(this.options.symbolConfig)&&(this.symbolConfig=jQuery.extend(!0,{},this.options.symbolConfig),delete this.options.symbolConfig),this.layer=new g2.carto.ElementLayer({id:this.options.layerId,name:this.options.layerName||"",map:this.map}),this.options.idKey.indexOf(".")<0?this._getRecordId=function(e){return e[this.options.idKey]}:this._getRecordId=function(e){if(e){var t=this.options.idKey.split("."),r=e;if(t.length>0)for(var n=0,o=t.length;n<o;n++){var i=t[n];if(!r||!i){r=null;break}r=r[i]}if(null!=r)return r;LoggerUtil.error("fail to  get id of "+JSON.stringify(e))}},this.currentSymbols=[],this.allSymbols=[],this.renderFields=[],this._getSymbolCfg();var t=new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5));this.wktReader=new jsts.io.WKTReader(t)},_addListeners:function(){BaseLayer.prototype._addListeners.call(this),this.map.listen("click",this._mapClickListener,this)},_removeListeners:function(){this.map.off("click",this._mapClickListener,this),BaseLayer.prototype._removeListeners.call(this)},_mapClickListener:function(e){var t=this.hitTest(e.screenX,e.screenY);t&&this.fire("click",{element:t.element,layer:t.layer})},_createSymbol:function(e,t){return RenderUtil.object2Symbol(e,t)},addElements:function(e,t){},_getGeometry:function(e,t,r){if(!e)return null;var n=this.options.geometryField,o=null;try{if(n){var i=e[n];try{"string"==typeof i?(i=this.wktReader.read(i).toString(),o=g2.sfs.GeometryFactory.createGeometryFromWkt(i,t)):o=g2.sfs.GeometryFactory.createGeometryFromGeoJson(i,t)}catch(e){}}else{var a,s;a=this._getXyVal(e,this.options.xField),s=this._getXyVal(e,this.options.yField),o=new g2.sfs.Point({x:a,y:s,spatialReference:t})}if(o instanceof g2.sfs.Point)GeometryUtil.validateCoordinate(o.x,o.y,t)||(o=null)}catch(t){LoggerUtil.warn("record "+e._id+" 没有坐标 ")}return t&&r&&t!=r&&(o=this.projService.transform(o,r)),o},_getXyVal:function _getXyVal(data,field){var val;try{val=field.indexOf(".")<0?data[field]:parseFloat(eval("data."+field))}catch(e){}return val},getSymbol:function(e,t){return this._getSymbol(e,t)},_getSymbol:function(e,t){var r;t=this._getSymbol_Zoom(t),r=this._getSymbol_DataObj(e,this.options.attributeField),r=this._getDataOrData2(r,e);var n=this._getSymbol_symKeyObj(this.renderFields,r),o=n.symKey,i=n.rangeStr;o=this._getSymbol_symKeyLookstr(o,"$_$");for(var a,s,l=1,c=this.allSymbols.length,u=[];l<c;l++){var f=this.allSymbols[l];if(f){var h=f.symbolKey;if(h==o){a=f;break}if(h.startsWith(o)&&h.indexOf("zoomLevel$=$")>=0){var p=h.split("$_$");i=p[p.length-1].split("$=$")[1];CommonUtil.assertWithin(t,i)&&(s=i,a=f),u.push(i)}}}var d=this.symbolConfig,y=d.defaultSymbol,m={};a?m={symbol:this._doGetSymbol(r,a,y),zoomRange:s,zoomRanges:u,symbolKey:a.symbolKey}:m={symbol:this._doGetSymbol(r,d,y),zoomRange:!1,symbolKey:this.options.defaultSymbolKey};return m},getHighlightSymbol:function(e){var t=null,r=this.getElementSymbol(e);if(r){var n=this.symbolConfig.highlight;n&&(t=this._generateNewSymbol(r,n))}return t},updateSymbol:function(e){try{var t,r=0;t=this.elements;for(var n=0,o=t.length;n<o;n++){var i=t[n];if(!1!==i._zoomRange){var a=this._getSymbol(i._data,e);a.zoomRange!==i._zoomRange&&(i.symbol=a.symbol,this.layer.update(i,!0),i._zoomRange=a.zoomRange,i._symbolKey=a.symbolKey,r++)}}r>0&&this._onSymbolsUpdated()}catch(e){LoggerUtil.error(e)}},removeElements:function(e){},setMetaData:function(e){this.metaData=e||{}},validateGeometry:function(e){return!!e&&!(e instanceof g2.sfs.Point&&(isNaN(e.x)||isNaN(e.y)))},destroy:function(){this.clear(),BaseLayer.prototype.destroy.call(this)}});return layer.include({getElementById:function(e){var t=this._getLayerElementById(this.layer,e);return t?t.element:null},getElementSymbol:function(e){var t,r,n=this.elements;for(t in n){var o=n[t];o.id==e&&(r=o)}return r&&r.symbol?r.symbol:null},getSymbolSize:function(e){var t=[];return e instanceof g2.sfs.SimpleMarkerSymbol?(t.push(2*e.size),t.push(2*e.size),t.push(e.offsetX||0),t.push(e.offsetY||0)):e instanceof g2.sfs.PictureMarkerSymbol&&(t.push(e.width),t.push(e.height),t.push(e.offsetX||0),t.push(e.offsetY||0)),t},clear:function(){this.layer.clear(),Object.prototype.hasOwnProperty.call(this,"elements")?this.elements=[]:Object.prototype.hasOwnProperty.call(this,"features")&&(this.features=[]),this._onSymbolsUpdated(),this._onElementChanged(),delete this.noneSpatialArr,this.noneSpatialArr=[]},getLayer:function(){return this.layer},getLayerId:function(){if(this.layer&&this.layer.getLayerId)return this.layer.getLayerId()},getVisible:function(){return this.layer.visible},setVisible:function(e){this.layer.setVisible(e||!1),e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})},getLayerName:function(){return this.layer.getLayerName()},getLayerType:function(){return this.layer.getLayerType()},find:function(e){var t=this.getLayer(),r=null;if(t instanceof g2.carto.GroupLayer)for(var n=t.groupLayers,o=0,i=n.length;o<i;o++){var a=n[o];if(a&&a.find){var s=a.find(e);if(s){r=s;break}}}else r=t.find(e);return r},getElements:function(){return this.elements},hitTest:function(e,t){return this.layer.hitTest(e,t)}}),layerExtend.includeGetSymbol(layer),layerExtend.includeFindElementById(layer),layerExtend.includeGenerateNewSymbol(layer),layerExtend.includeParseSymbolCfg(layer),layer}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,r){"use strict";var n;void 0===(n=function(){var e="api_dev",t="dev",r="pro",n={_getRelative:function(){var o={};return o[t]=n.getBasePath(),o[e]=n.getBasePath(),o[r]=n.getBasePath()+"/deps/tsemap",o[n._getMode()]},_getMode:function(){return window.devMode||r},getBasePath:function(){var e=window.webApp;return e&&e.lastIndexOf("/")!=e.length-1&&(e+="/"),e},getStaticPath:function(){return n._getRelative()+"resources/static/"},getLibPath:function(){var o={};return o[e]=n._getRelative()+"deps/emaplib",o[t]=o[e],o[r]=n._getRelative()+"deps/lib",o[n._getMode()]},_getRequireJsPath:function(e,t){if(window.require){var r=requirejs.s.contexts,n=null;for(var o in r)if(!t||t==o){var i=r[o];if(i.config.paths.hasOwnProperty(e)){n=i.nameToUrl(e);break}}return n}throw new Error("requirejs未引入！")},_extractCtrlModulePath:function(e){try{var t=n._getRequireJsPath(e);null==t&&e.indexOf("Ctrl")+"Ctrl".length==e.length&&(t=n.getRelativePath()+"controls/"+e+"/js/"+e+".js");var r="^(.*)/[^/]+/"+e+".js$";return new RegExp(r).test(t)?new RegExp(r).exec(t)[1]+"/":null}catch(e){}},getControlPath:function(e){return n._extractCtrlModulePath(e)},getModulePath:function(e){return n._extractCtrlModulePath(e)},getUiPath:function(t){return n._getMode()==e?n.getBasePath()+"/src/ui/"+t:n.getBasePath()+"/deps/tsemap/ui/"+t},loadCss:function(e){var t=document.getElementsByTagName("head")[0];if("[object Array]"==Object.prototype.toString.call(e))for(var r=0,n=e.length;r<n;r++){var o=e[r];if(!a(o)){var i=document.createElement("link");i.setAttribute("href",o),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),t.appendChild(i)}}function a(e){var t=jQuery("link").filter((function(){return"stylesheet"==jQuery(this).attr("rel")}));if("[object String]"==Object.prototype.toString.call(e)){if(null==(e=s(e)))return!0;for(var r=0,n=t.length;r<n;r++){if(s(t.eq(r).attr("href"))==e)return!0}return!1}return!0}function s(e){var t=/^(.*\.css)(\?.*)?$/;return"[object String]"==Object.prototype.toString.call(e)&&t.test(e)?(e=t.exec(e)[1]).trim().replace(/\/\//g,"/").replace(/\\/g,"/"):null}},getLocaleValue:function(e){return t("app_local",e)||t("tsemap_local",e);function t(e,t){var r=null;try{var n=window.baseLocal[e];if(n&&"string"==typeof t){var o=t.split("."),i=0;for(r=n;r&&i<o.length;)r=r[o[i]],i++}}catch(e){r=null}return r=r||null}},getRelativePath:function(){return n._getScriptPath(/[\/^]tsemap[\-\._]?([\w\-\._]*)\.js\??/)},_getScriptPath:function(e){var t,r,n,o=document.getElementsByTagName("script"),i=null;for(t=0,r=o.length;t<r;t++)(n=o[t].src).match(e)&&(i=(i=n.split(e)[0])?i+"/":"");return i}};return n}.apply(t,[]))||(e.exports=n)},function(e,t,r){"use strict";var n,o;n=[r(1)],void 0===(o=function(e){var t={TEXT:"text",TAILEDTEXT:"tailedtext",POINT:"point",POLYLINE:"line",POLYGON:"polygon",COMPOSITE:"composite",OVERLAY:"overlay"};(e=e||{}).algm=e.algm||{};var r={Text:{title:"文本",algorithm:"PointAlgorithm",type:t.TEXT},TAILEDTEXT:{title:"文本",algorithm:"PointAlgorithm",type:t.TAILEDTEXT},Point:{title:"点",algorithm:"PointAlgorithm",type:t.POINT},Overlay:{title:"动图",algorithm:"PointAlgorithm",type:t.POINT},Polyline:{title:"折线",algorithm:"PolylineAlgorithm",type:t.POLYLINE},Curve:{title:"曲线",algorithm:"CurveAlgorithm",type:t.POLYLINE},Camber:{title:"弧线",algorithm:"CamberAlgorithm",type:t.POLYLINE},FreePolyline:{title:"自由标绘线",algorithm:"FreePolylineAlgorithm",type:t.POLYLINE},Polygon:{title:"多边形",algorithm:"PolygonAlgorithm",type:t.POLYGON},Circle:{title:"圆",algorithm:"CircleAlgorithm",type:t.POLYGON},Rectangle:{title:"矩形",algorithm:"RectangleAlgorithm",type:t.POLYGON},Ellipse:{title:"椭圆",algorithm:"EllipseAlgorithm",type:t.POLYGON},Sector:{title:"扇形",algorithm:"SectorAlgorithm",type:t.POLYGON},Arc:{title:"圆弧",algorithm:"ArcAlgorithm",type:t.POLYGON},CloseCurve:{title:"封闭曲线",algorithm:"CloseCurveAlgorithm",type:t.POLYGON},FreePolygon:{title:"自由标绘面",algorithm:"FreePolygonAlgorithm",type:t.POLYGON},DoubleArrow:{title:"双箭头",algorithm:"DoubleArrowAlgorithm",type:t.POLYGON},SwallowTailArrow:{title:"燕尾箭头",algorithm:"SwallowtailArrowAlgorithm",type:t.POLYGON},MultiArrow:{title:"多箭头",algorithm:"MultiArrowAlgorithm",type:t.POLYGON},BeelineArrow:{title:"细直箭头",algorithm:"BeelineArrowAlgorithm",type:t.COMPOSITE},CurveArrow:{title:"单曲箭头",algorithm:"CurveArrowAlgorithm",type:t.COMPOSITE},SimpleArrow:{title:"单箭头",algorithm:"SimpleArrowAlgorithm",type:t.POLYGON},SlightnessArrow:{title:"直箭头",algorithm:"SlightnessArrowAlgorithm",type:t.POLYGON},ShockWay:{title:"突击方向",algorithm:"ShockWayAlgorithm",type:t.POLYGON},Arsenal:{title:"武警",algorithm:"ArsenalProperty",type:t.COMPOSITE},ExpertProtect:{title:"专家",algorithm:"ExpertProtectAlgorithm",type:t.COMPOSITE},Engineer:{title:"工程",algorithm:"PowerRepairAlgorithm",type:t.COMPOSITE},Army:{title:"军队",algorithm:"ArmyAlgorithm",type:t.COMPOSITE},FireProtect:{title:"消防",algorithm:"FireProtectAlgorithm",type:t.COMPOSITE},MedicalCure:{title:"医疗",algorithm:"MedicalCureAlgorithm",type:t.COMPOSITE},PowerRepair:{title:"电力抢修",algorithm:"PowerRepairAlgorithm",type:t.COMPOSITE},ProChymic:{title:"防化",algorithm:"ProchymicAlgorithm",type:t.COMPOSITE},ProSuccor:{title:"专业救援",algorithm:"ProsuccorAlgorithm",type:t.COMPOSITE},AirWay:{title:"空中运输",algorithm:"AirwayAlgorithm",type:t.COMPOSITE},Cannon:{title:"炮弹路线",algorithm:"CannonAlgorithm",type:t.POLYLINE},AirMobile:{title:"空中机动",algorithm:"AirMobileAlgorithm",type:t.COMPOSITE},ArtilleryManenCampment:{title:"高射炮兵营地",algorithm:"ArtilleryManenCampmentAlgorithm",type:t.COMPOSITE},MotorbikeTeam:{title:"摩托化行军纵队",algorithm:"MotorbikeTeamAlgorithm",type:t.COMPOSITE},AntiairCraftForces:{title:"防空兵行军纵队",algorithm:"AntiAirCraftForceAlgorithm",type:t.COMPOSITE},TankAndMusketer:{title:"坦克及步战车进攻队形",algorithm:"TankAndMusketerAlgorithm",type:t.COMPOSITE},AttackOrder:{title:"进攻队形",algorithm:"AttackOrderAlgorithm",type:t.COMPOSITE},AttackTurnDefend2:{title:"由进攻转入防守2",algorithm:"AttackTurnDefend2Algorithm",type:t.POLYLINE},AttackTurnDefend1:{title:"由进攻转入防守1",algorithm:"AttackTurnDefend1Algorithm",type:t.POLYLINE},Artillery:{title:"炮兵行军纵队",algorithm:"ArtilleryAlgorithm",type:t.COMPOSITE},RecceSearch:{title:"侦查搜索",algorithm:"RecceSearchAlgorithm",type:t.POLYLINE},Patroller:{title:"流动哨",algorithm:"PatrolLeralAlgorithm",type:t.POLYLINE},TankAttack:{title:"坦克营进攻队形",algorithm:"TankAttackAlgorithm",type:t.COMPOSITE},Musketry:{title:"步兵战斗车连",algorithm:"MusketryAlgorithm",type:t.POLYLINE},NavalShips:{title:"水上救援舰艇",algorithm:"NavalShipsAlgorithm",type:t.COMPOSITE},PedrailColumn:{title:"救援车辆纵队",algorithm:"PedrailColumnAlgorithm",type:t.COMPOSITE},PipeLaying:{title:"输油管线",algorithm:"PipeLayingAlgorithm",type:t.POLYLINE},PolygonText:{title:"警戒区域",algorithm:"PolygonTextAlgorithm",type:t.COMPOSITE},Railage:{title:"铁路输送",algorithm:"RailAgeAlgorithm",type:t.COMPOSITE},RoundsLine:{title:"海上搜救队形",algorithm:"RoundsLineAlgorithm",type:t.POLYLINE},CommunicateLine:{title:"通信光缆线路",algorithm:"CommunicateLineAlgorithm",type:t.COMPOSITE},PatrolLine:{title:"隔离线1",algorithm:"PatrolLineAlgorithm",type:t.POLYLINE},WarBoundary:{title:"隔离线2",algorithm:"WarBoundaryAlgorithm",type:t.POLYLINE},FinderLine:{title:"海上封锁线",algorithm:"FinderLineAlgorithm",type:t.POLYLINE},FixedPipeLaying:{title:"固定输油管线",algorithm:"FixedPipeLayingAlgorithm",type:t.COMPOSITE},LandMobile:{title:"陆地机动技术",algorithm:"LandMobileAlgorithm",type:t.COMPOSITE},ForbidFlyLine:{title:"警戒线",algorithm:"ForbidFlyLineAlgorithm",type:t.COMPOSITE},LineAbatis3:{title:"大型输电线路",algorithm:"LineAbatis3Algorithm",type:t.POLYLINE},LineAbatis2:{title:"中型输电线路",algorithm:"LineAbatis2Algorithm",type:t.POLYLINE},LineAbatis1:{title:"小型输电线路",algorithm:"LineAbatis1Algorithm",type:t.POLYLINE},LaighStake:{title:"生态隔离线",algorithm:"LaighstakeAlgorithm",type:t.POLYLINE},HelicopterTransport:{title:"直升机输送",algorithm:"HelicopterTransportAlgorithm",type:t.COMPOSITE},MissileMarch:{title:"事故车辆行进路线",algorithm:"MissileMarchAlgorithm",type:t.COMPOSITE},HighWay:{title:"公路运输",algorithm:"HighwayAlgorithm",type:t.COMPOSITE},MusketerByTank:{title:"灾民撤离",algorithm:"MusketerByTankAlgorithm",type:t.COMPOSITE},TankMusColumn:{title:"专业救援队形2",algorithm:"TankMusColumnAlgorithm",type:t.COMPOSITE},Trench:{title:"危险路段",algorithm:"TrenchAlgorithm",type:t.POLYLINE},Waterage:{title:"水路运输",algorithm:"WaterAgeAlgorithm",type:t.COMPOSITE},RendezvousArea1:{title:"集结区域",algorithm:"RendezvousArea1Algorithm",type:t.POLYLINE},RendezvousArea2:{title:"事故区域蔓延",algorithm:"RendezvousArea2Algorithm",type:t.POLYLINE},RendezvousArea3:{title:"事故区域控制",algorithm:"RendezvousArea3Algorithm",type:t.POLYLINE},RendezvousArea4:{title:"物质集散地",algorithm:"RendezvousArea4Algorithm",type:t.POLYLINE},OriginalBirth:{title:"空中救援队伍",algorithm:"OriginalBirthAlgorithm",type:t.POLYLINE},SeaMobile:{title:"海上机动技术",algorithm:"SeaMobileAlgorithm",type:t.COMPOSITE},Stake:{title:"在建铁路",algorithm:"StakeAlgorithm",type:t.POLYLINE},UnderProp2:{title:"支撑点2",algorithm:"UnderProp2Algorithm",type:t.POLYLINE},UnderProp3:{title:"支撑点3",algorithm:"UnderProp3Algorithm",type:t.POLYLINE},ImportantPlace:{title:"要点",algorithm:"ImportantPlaceAlgorithm",type:t.COMPOSITE},CurrentTaskLine:{title:"遭破坏的线路",algorithm:"CurrentTaskLineAlgorithm",type:t.POLYLINE},LatterTaskLine:{title:"遭破坏的道路",algorithm:"LatterTaskLineAlgorithm",type:t.POLYLINE}},n={};for(var o in r)n[o]=o;return{PATTERNS:t,TYPES:r,TYPES_KEYS:n,COMMANDNAMES:{NoopTool:"NoopTool",PlotEdit:"PlotEdit"}}}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(1),o={emptyFeatureCol:function(){return{type:"FeatureCollection",features:[]}},featureSet2GeoJson:function(e){for(var t=this.emptyFeatureCol(),r=0;r<e.getCount();r++){var n=e.getFeature(r),o={};o.id=n.objectId,o.geometry=n.geometry.asGeoJson(),o.properties={};for(var i=0;i<n.fields.getCount();i++){var a=n.fields.getField(i).name,s=n.getValue(a);o.properties[a]=s}t.features.push(o)}return t},getFeatureById:function(e,t){for(var r={feature:null,index:-1},n=0;n<t.getCount();n++)if(e==t.getFeature(n).objectId){r.index=n,r.feature=t.getFeature(n);break}return r},createFields:function(e,t){for(var r=new n.sfs.Fields,o=0,i=e.length;o<i;o++){var a=new n.sfs.Field({name:e[o],alias:t[o]});r.add(a)}return r}};e.exports=o},function(e,t,r){"use strict";var n={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!n.call({1:2},1);t.f=i?function(e){var t=o(this,e);return!!t&&t.enumerable}:n},function(e,t,r){var n=r(102),o=r(66),i=n("keys");e.exports=function(e){return i[e]||(i[e]=o(e))}},function(e,t,r){var n=r(7)("iterator"),o=!1;try{var i=0,a={next:function(){return{done:!!i++}},return:function(){o=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var i={};i[n]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(e){}return r}},function(e,t,r){"use strict";var n=r(27),o=r(50),i=r(73),a=r(28),s=r(112),l=a.set,c=a.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){l(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=c(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},function(e,t,r){var n=r(33),o=r(17),i=r(65),a=r(10),s=function(e){return function(t,r,s,l){n(r);var c=o(t),u=i(c),f=a(c.length),h=e?f-1:0,p=e?-1:1;if(s<2)for(;;){if(h in u){l=u[h],h+=p;break}if(h+=p,e?h<0:f<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:f>h;h+=p)h in u&&(l=r(l,u[h],h,c));return l}};e.exports={left:s(!1),right:s(!0)}},function(e,t,r){"use strict";var n=r(0),o=r(4),i=r(69),a=r(22),s=r(56),l=r(77),c=r(51),u=r(5),f=r(3),h=r(84),p=r(41),d=r(88);e.exports=function(e,t,r){var y=-1!==e.indexOf("Map"),m=-1!==e.indexOf("Weak"),g=y?"set":"add",v=o[e],b=v&&v.prototype,_=v,w={},S=function(e){var t=b[e];a(b,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(m&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return m&&!u(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(m&&!u(e))&&t.call(this,0===e?0:e)}:function(e,r){return t.call(this,0===e?0:e,r),this})};if(i(e,"function"!=typeof v||!(m||b.forEach&&!f((function(){(new v).entries().next()})))))_=r.getConstructor(t,e,y,g),s.REQUIRED=!0;else if(i(e,!0)){var L=new _,x=L[g](m?{}:-0,1)!=L,P=f((function(){L.has(1)})),E=h((function(e){new v(e)})),T=!m&&f((function(){for(var e=new v,t=5;t--;)e[g](t,t);return!e.has(-0)}));E||((_=t((function(t,r){c(t,_,e);var n=d(new v,t,_);return null!=r&&l(r,n[g],n,y),n}))).prototype=b,b.constructor=_),(P||T)&&(S("delete"),S("has"),y&&S("get")),(T||x)&&S(g),m&&b.clear&&delete b.clear}return w[e]=_,n({global:!0,forced:_!=v},w),p(_,e),m||r.setStrong(_,e,y),_}},function(e,t,r){var n=r(5),o=r(55);e.exports=function(e,t,r){var i,a;return o&&"function"==typeof(i=t.constructor)&&i!==r&&n(a=i.prototype)&&a!==r.prototype&&o(e,a),e}},function(e,t){var r=Math.expm1,n=Math.exp;e.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:n(e)-1}:r},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,r){"use strict";var n=r(40),o=r(4),i=r(3);e.exports=n||!i((function(){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete o[e]}))},function(e,t,r){"use strict";var n=r(6);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){"use strict";var n,o,i=r(92),a=r(119),s=RegExp.prototype.exec,l=String.prototype.replace,c=s,u=(n=/a/,o=/b*/g,s.call(n,"a"),s.call(o,"a"),0!==n.lastIndex||0!==o.lastIndex),f=a.UNSUPPORTED_Y||a.BROKEN_CARET,h=void 0!==/()??/.exec("")[1];(u||h||f)&&(c=function(e){var t,r,n,o,a=this,c=f&&a.sticky,p=i.call(a),d=a.source,y=0,m=e;return c&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),m=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(d="(?: "+d+")",m=" "+m,y++),r=new RegExp("^(?:"+d+")",p)),h&&(r=new RegExp("^"+d+"$(?!\\s)",p)),u&&(t=a.lastIndex),n=s.call(c?r:a,m),c?n?(n.input=n.input.slice(y),n[0]=n[0].slice(y),n.index=a.lastIndex,a.lastIndex+=n[0].length):a.lastIndex=0:u&&n&&(a.lastIndex=a.global?n.index+n[0].length:t),h&&n&&n.length>1&&l.call(n[0],r,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(n[o]=void 0)})),n}),e.exports=c},function(e,t,r){var n=r(32),o=r(24),i=function(e){return function(t,r){var i,a,s=String(o(t)),l=n(r),c=s.length;return l<0||l>=c?e?"":void 0:(i=s.charCodeAt(l))<55296||i>56319||l+1===c||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):i:e?s.slice(l,l+2):a-56320+(i-55296<<10)+65536}};e.exports={codeAt:i(!1),charAt:i(!0)}},function(e,t,r){"use strict";r(168);var n=r(22),o=r(3),i=r(7),a=r(93),s=r(25),l=i("species"),c=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),u="$0"==="a".replace(/./,"$0"),f=i("replace"),h=!!/./[f]&&""===/./[f]("a","$0"),p=!o((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));e.exports=function(e,t,r,f){var d=i(e),y=!o((function(){var t={};return t[d]=function(){return 7},7!=""[e](t)})),m=y&&!o((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[l]=function(){return r},r.flags="",r[d]=/./[d]),r.exec=function(){return t=!0,null},r[d](""),!t}));if(!y||!m||"replace"===e&&(!c||!u||h)||"split"===e&&!p){var g=/./[d],v=r(d,""[e],(function(e,t,r,n,o){return t.exec===a?y&&!o?{done:!0,value:g.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}}),{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:h}),b=v[0],_=v[1];n(String.prototype,e,b),n(RegExp.prototype,d,2==t?function(e,t){return _.call(e,this,t)}:function(e){return _.call(e,this)})}f&&s(RegExp.prototype[d],"sham",!0)}},function(e,t,r){var n=r(34),o=r(93);e.exports=function(e,t){var r=e.exec;if("function"==typeof r){var i=r.call(e,t);if("object"!=typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==n(e))throw TypeError("RegExp#exec called on incompatible receiver");return o.call(e,t)}},function(e,t,r){"use strict";var n,o;n=[r(126),r(78),r(127),r(407),r(408),r(409),r(411),r(412),r(129),r(413),r(414),r(415),r(416),r(417),r(418)],void 0===(o=function(e,t,r,n,o,i,a,s,l,c,u,f,h,p,d){var y={LayerFactory:f,BaseLayer:e,DistributeLayer:t,PointLayer:r,LineLayer:a,PolygonLayer:s,PointClusterLayer:o,FeaturePointLayer:n,PointDuplicateLayer:i,StatisticsLayer:l,PieStatisticsLayer:c,RingStatisticsLayer:u,ElementLayerProxy:h,ele:{PointElement:p,PolygonElement:d}};return y.TYPES={ELEMENT_POINT_LAYER:r.type,FEATURE_POINT_LAYER:n.type,ELEMENT_POINT_PIXEL_CLUSTER:o.type,ELEMENT_POINT_DUPLICATE:i.type,ELEMENT_POLYLINE_LAYER:a.type,ELEMENT_POLYGON_LAYER:s.type,PIE_STATISTICS_LAYER:c.type,RING_STATISTICS_LAYER:u.type,BASE_LAYER_TAG:"_base_layer_tag"},y}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(469),o=r(2),i=r(1),a=r(45),s={};function l(e){return(e=e||{}).table?e.table+"."+e.column:"tag."+e.column}s.parseSqlFragment=function(e,t,r){var i=function(e,t,r){if(o.isArray(t))for(var n=0;n<t.length;n++){var i=t[n];if(i){var a=i.expr;if(a&&a.table&&!r.hasOwnProperty(a.table))throw new Error(e+"参数中字段【"+a.column+"】的表别名【"+a.table+"】错误！")}}},a={select:{prefix:"select ",suffix:" from a",resultKey:"columns",checker:i},where:{prefix:"select * from a where ",suffix:"",resultKey:"where",checker:function(e,t,r){if(!t||!o.isObject(t.left))throw new Error("错误的where格式！");!function e(t,r,n){if(r.hasOwnProperty("left"))e(t,r.left,n),r.right&&r.right.hasOwnProperty("left")&&e(t,r.right.left,n);else{var o=r.table;if(o&&!n.hasOwnProperty(o))throw new Error(t+"参数中字段【"+r.column+"】的表别名【"+o+"】错误！")}}(e,t,r)}},sort:{prefix:"select * from a where 1=1 order by ",suffix:"",resultKey:"orderby",checker:i}};if(a.hasOwnProperty(e)){var s,l=a[e],c=l.prefix+t+l.suffix;try{s=n.parse(c)[l.resultKey]}catch(t){throw new Error(e+"格式错误！")}return l.checker(e,s,r||{}),s}throw new Error("frag参数错误！")};var c={AND:{type:"relation",val:"$and"},OR:{type:"relation",val:"$or"},"=":{fn:function(e,t){t[l(e.left)]=e.right.value}},">":{fn:function(e,t){t[l(e.left)]={$gt:e.right.value}}},">=":{fn:function(e,t){t[l(e.left)]={$ge:e.right.value}}},"<":{fn:function(e,t){t[l(e.left)]={$lt:e.right.value}}},"<=":{fn:function(e,t){t[l(e.left)]={$le:e.right.value}}},"<>":{fn:function(e,t){t[l(e.left)]={$nin:[e.right.value]}}},IN:{fn:function(e,t){for(var r=[],n=0;n<e.right.value.length;n++){var o=e.right.value[n];r.push(o.value)}t[l(e.left)]={$in:r}}},"NOT IN":{fn:function(e,t){for(var r=[],n=0;n<e.right.value.length;n++){var o=e.right.value[n];r.push(o.value)}t[l(e.left)]={$nin:r}}},LIKE:{fn:function(e,t){var r=e.right.value.trim();r="^"+r.replace(/%/g,".*")+"$",t[l(e.left)]={$regex:r}}},"NOT LIKE":{fn:function(e,t){var r=e.right.value.trim();r="^"+r.replace(/%/g,".*")+"$",t[l(e.left)]={$regex:r}}},BETWEEN:{fn:function(e,t){for(var r=[],n=0;n<e.right.value.length;n++){var o=e.right.value[n];r.push(o.value)}var i=[],a=l(e.left),s={},c={};s[a]={$ge:r[0]},c[a]={$le:r[1]},i.push(s),i.push(c),t.$and=i}}},u={intersects:{key:"intersects",map:"$geoIntersects"},within:{key:"within",map:"$geoWithin"},near:{key:"near",map:"$geoNear"}};s.translateWhere=function(e){var t={};return function e(t,r){var n=c[t.operator];if("relation"===n.type){var o=n.val,i=[],a={},s={};e(t.left,a),e(t.right,s),Object.keys(a).length>0&&i.push(a),Object.keys(s).length>0&&i.push(s),r[o]=i}else"column_ref"==t.left.type&&n.fn(t,r)}(e,t),t=function(e){for(var t=["$and","$or"],r=a(!0,{},e);n(r););return r;function n(e){for(var r=!1,n=0;n<t.length;n++){var o=t[n];if(e.hasOwnProperty(o)){for(var i=e[o],a=[],s=0;s<i.length;s++){var l=i[s];l.hasOwnProperty(t[0])&&0==l[t[0]].length?delete l[t[0]]:l.hasOwnProperty(t[1])&&0==l[t[1]].length?delete l[t[1]]:l.hasOwnProperty(o)?(a=a.concat(l[o]),r=!0):a.push(l)}e[o]=a;break}}return r}}(t)},s.translateSelect=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].expr.column;"geom"==n?t.push(n):t.push("tag."+n)}return t.join(" ")},s.translateSort=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].expr.column,o="ASC"==e[r].type?"":"-";t.push(o+"tag."+n)}return t.join(" ")},s.translateSortAggregate=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r].expr.column,o="ASC"==e[r].type?1:-1;t["tag."+n]=o}return t},s.parseGeometryFilter=function(e){var t={},r={},n=e.geometry;if(e.inputSr!=e.dataSr){var o=new i.sfs.CoordinateTransform,a=i.sfs.GeometryFactory.createGeometryFromGeoJson(e.geomtry);a.spatialReference=e.inputSr,n=o.transform(a,e.dataSr).asGeoJson()}return r[u[e.spatialRel].map]={$geometry:n},t.geom=r,t},e.exports=s},function(e,t,r){var n=r(4),o=r(5),i=n.document,a=o(i)&&o(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(4),o=r(25);e.exports=function(e,t){try{o(n,e,t)}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(136),o=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return o.call(e)}),e.exports=n.inspectSource},function(e,t,r){var n=r(40),o=r(136);(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.4",mode:n?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(35),o=r(53),i=r(105),a=r(6);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=i.f;return r?t.concat(r(e)):t}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(3);e.exports=!!Object.getOwnPropertySymbols&&!n((function(){return!String(Symbol())}))},function(e,t,r){var n,o,i=r(4),a=r(108),s=i.process,l=s&&s.versions,c=l&&l.v8;c?o=(n=c.split("."))[0]+n[1]:a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(o=n[1]),e.exports=o&&+o},function(e,t,r){var n=r(35);e.exports=n("navigator","userAgent")||""},function(e,t,r){"use strict";var n=r(17),o=r(47),i=r(10);e.exports=function(e){for(var t=n(this),r=i(t.length),a=arguments.length,s=o(a>1?arguments[1]:void 0,r),l=a>2?arguments[2]:void 0,c=void 0===l?r:o(l,r);c>s;)t[s++]=e;return t}},function(e,t,r){var n=r(7),o=r(73),i=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||a[i]===e)}},function(e,t,r){var n={};n[r(7)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){"use strict";var n=r(0),o=r(151),i=r(36),a=r(55),s=r(41),l=r(25),c=r(22),u=r(7),f=r(40),h=r(73),p=r(152),d=p.IteratorPrototype,y=p.BUGGY_SAFARI_ITERATORS,m=u("iterator"),g=function(){return this};e.exports=function(e,t,r,u,p,v,b){o(r,t,u);var _,w,S,L=function(e){if(e===p&&C)return C;if(!y&&e in E)return E[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},x=t+" Iterator",P=!1,E=e.prototype,T=E[m]||E["@@iterator"]||p&&E[p],C=!y&&T||L(p),A="Array"==t&&E.entries||T;if(A&&(_=i(A.call(new e)),d!==Object.prototype&&_.next&&(f||i(_)===d||(a?a(_,d):"function"!=typeof _[m]&&l(_,m,g)),s(_,x,!0,!0),f&&(h[x]=g))),"values"==p&&T&&"values"!==T.name&&(P=!0,C=function(){return T.call(this)}),f&&!b||E[m]===C||l(E,m,C),h[t]=C,p)if(w={values:L("values"),keys:v?C:L("keys"),entries:L("entries")},b)for(S in w)(y||P||!(S in E))&&c(E,S,w[S]);else n({target:t,proto:!0,forced:y||P},w);return w}},function(e,t,r){var n=r(3);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){"use strict";var n=r(4),o=r(9),i=r(155),a=r(25),s=r(61),l=r(3),c=r(51),u=r(32),f=r(10),h=r(156),p=r(242),d=r(36),y=r(55),m=r(53).f,g=r(13).f,v=r(109),b=r(41),_=r(28),w=_.get,S=_.set,L=n.ArrayBuffer,x=L,P=n.DataView,E=P&&P.prototype,T=Object.prototype,C=n.RangeError,A=p.pack,k=p.unpack,R=function(e){return[255&e]},O=function(e){return[255&e,e>>8&255]},I=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},M=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},F=function(e){return A(e,23,4)},D=function(e){return A(e,52,8)},j=function(e,t){g(e.prototype,t,{get:function(){return w(this)[t]}})},G=function(e,t,r,n){var o=h(r),i=w(e);if(o+t>i.byteLength)throw C("Wrong index");var a=w(i.buffer).bytes,s=o+i.byteOffset,l=a.slice(s,s+t);return n?l:l.reverse()},N=function(e,t,r,n,o,i){var a=h(r),s=w(e);if(a+t>s.byteLength)throw C("Wrong index");for(var l=w(s.buffer).bytes,c=a+s.byteOffset,u=n(+o),f=0;f<t;f++)l[c+f]=u[i?f:t-f-1]};if(i){if(!l((function(){L(1)}))||!l((function(){new L(-1)}))||l((function(){return new L,new L(1.5),new L(NaN),"ArrayBuffer"!=L.name}))){for(var B,U=(x=function(e){return c(this,x),new L(h(e))}).prototype=L.prototype,z=m(L),W=0;z.length>W;)(B=z[W++])in x||a(x,B,L[B]);U.constructor=x}y&&d(E)!==T&&y(E,T);var Y=new P(new x(2)),q=E.setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||s(E,{setInt8:function(e,t){q.call(this,e,t<<24>>24)},setUint8:function(e,t){q.call(this,e,t<<24>>24)}},{unsafe:!0})}else x=function(e){c(this,x,"ArrayBuffer");var t=h(e);S(this,{bytes:v.call(new Array(t),0),byteLength:t}),o||(this.byteLength=t)},P=function(e,t,r){c(this,P,"DataView"),c(e,x,"DataView");var n=w(e).byteLength,i=u(t);if(i<0||i>n)throw C("Wrong offset");if(i+(r=void 0===r?n-i:f(r))>n)throw C("Wrong length");S(this,{buffer:e,byteLength:r,byteOffset:i}),o||(this.buffer=e,this.byteLength=r,this.byteOffset=i)},o&&(j(x,"byteLength"),j(P,"buffer"),j(P,"byteLength"),j(P,"byteOffset")),s(P.prototype,{getInt8:function(e){return G(this,1,e)[0]<<24>>24},getUint8:function(e){return G(this,1,e)[0]},getInt16:function(e){var t=G(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=G(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return M(G(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return M(G(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return k(G(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return k(G(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){N(this,1,e,R,t)},setUint8:function(e,t){N(this,1,e,R,t)},setInt16:function(e,t){N(this,2,e,O,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){N(this,2,e,O,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){N(this,4,e,I,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){N(this,4,e,I,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){N(this,4,e,F,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){N(this,8,e,D,t,arguments.length>2?arguments[2]:void 0)}});b(x,"ArrayBuffer"),b(P,"DataView"),e.exports={ArrayBuffer:x,DataView:P}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t,r){"use strict";var n=r(32),o=r(24);e.exports="".repeat||function(e){var t=String(o(this)),r="",i=n(e);if(i<0||i==1/0)throw RangeError("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r}},function(e,t,r){var n,o,i,a=r(4),s=r(3),l=r(34),c=r(49),u=r(143),f=r(99),h=r(164),p=a.location,d=a.setImmediate,y=a.clearImmediate,m=a.process,g=a.MessageChannel,v=a.Dispatch,b=0,_={},w=function(e){if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},S=function(e){return function(){w(e)}},L=function(e){w(e.data)},x=function(e){a.postMessage(e+"",p.protocol+"//"+p.host)};d&&y||(d=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return _[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},n(b),b},y=function(e){delete _[e]},"process"==l(m)?n=function(e){m.nextTick(S(e))}:v&&v.now?n=function(e){v.now(S(e))}:g&&!h?(i=(o=new g).port2,o.port1.onmessage=L,n=c(i.postMessage,i,1)):!a.addEventListener||"function"!=typeof postMessage||a.importScripts||s(x)?n="onreadystatechange"in f("script")?function(e){u.appendChild(f("script")).onreadystatechange=function(){u.removeChild(this),w(e)}}:function(e){setTimeout(S(e),0)}:(n=x,a.addEventListener("message",L,!1))),e.exports={set:d,clear:y}},function(e,t,r){var n=r(5),o=r(34),i=r(7)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==o(e))}},function(e,t,r){"use strict";var n=r(3);function o(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=n((function(){var e=o("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=n((function(){var e=o("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},function(e,t,r){var n=r(118);e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(7)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){"use strict";var n=r(94).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},function(e,t,r){var n=r(3),o=r(90);e.exports=function(e){return n((function(){return!!o[e]()||"​᠎"!="​᠎"[e]()||o[e].name!==e}))}},function(e,t,r){var n=r(4),o=r(3),i=r(84),a=r(8).NATIVE_ARRAY_BUFFER_VIEWS,s=n.ArrayBuffer,l=n.Int8Array;e.exports=!a||!o((function(){l(1)}))||!o((function(){new l(-1)}))||!i((function(e){new l,new l(null),new l(1.5),new l(e)}),!0)||o((function(){return 1!==new l(new s(2),1,void 0).length}))},function(e,t,r){"use strict";var n,o;n=[r(1),r(21),r(2),r(14),r(37),r(38),r(97)],void 0===(o=function(e,t,r,n,o,i,a){var s=function(e){this.initialize(e),this.callInitHooks()},l=e.carto.Map;return s.prototype={options:{},constructor:s,initialize:function(e){t.setOptions(this,e);var r=this.options.mapOpts||this.options;isNaN(r.defaultExtent.zoom)||(r.defaultExtent.level=r.defaultExtent.zoom),r.fullExtent&&(isNaN(r.fullExtent.zoom)||(r.fullExtent.level=r.fullExtent.zoom)),l.call(this,r),r.targetId&&this.init({targetId:r.targetId}),this.id=r.targetId,this.layerSet={},this.listen("postrender",(function(){try{var e=document.getElementsByClassName("ol-attribution"),t=e.length>0?e[0]:null;null!=t&&t.parentElement.removeChild(t)}catch(e){}}))},init:function(e){e&&e.targetId&&(this.options.targetId=e.targetId),l.prototype.init.call(this,e)},destroy:function(){},callInitHooks:function(){if(!this._initHooksCalled){this._initHooksCalled=!0;for(var e=0,t=this._initHooks.length;e<t;e++)this._initHooks[e].call(this)}}},t.defaults(s,t,!0),t.inherits(s,l),s.include({getMap:function(){return this},initialGroupLayers:function(e){n.initGroupLayers(this,e)},getAppEvent:function(){return this._appEvent||(this._appEvent=new o({map:this})),this._appEvent},updateViewSize:function(){this.map.updateSize()},changeExtent:function(t,r){var n=this.getMap(),o=new e.sfs.Point({x:t[0],y:t[1],spatialReference:n.spatialReference});n.setCenter(o),n.zoomTo(parseInt(r))},clear:function(t){t=t||{};var n=this.getMap().layers,o=t.filterFn||!1,s=t.matchRegex||!1,l=t.ignoreRegex||!1,c={filterFn:function(e,t){t(e)&&d.call(this,e)},matchRegex:function(e,t){p(e.id,t)&&d.call(this,e)},ignoreRegex:function(e,t){p(e.id,t)||d.call(this,e)},all:d};this.fire(i.CLEAR_MAP);for(var u=0,f=n.length;u<f;u++){var h=n[u];if(h){if(h._type==a.TYPES.BASE_LAYER_TAG)continue;r.isFunction(o)?c.filterFn.call(this,h,o):r.isArray(s)?c.matchRegex.call(this,h,s):r.isArray(l)?c.ignoreRegex.call(this,h,l):c.all.call(this,h)}}function p(e,t){var r=!1;if(t&&t.length>0)for(var n=0,o=t.length;n<o;n++){var i=t[n];if(i instanceof RegExp&&i.test(e)){r=!0;break}}return r}function d(t){if(t instanceof e.carto.GroupLayer)for(var r=t.groupLayers,n=0,o=r.length;n<o;n++){var i=r[n];d.call(this,i)}else t&&t.clear()}},addLayer:function(e){var t=this,n=e;n instanceof a.BaseLayer?(n=e.getLayer(),l.prototype.addLayer.call(this,n),n._maxZoom&&n.setMaxZoom(n._maxZoom),this.layerSet[e.id]=e):r.isArray(n)?n.forEach((function(e){l.prototype.addLayer.call(t,e),e._maxZoom&&e.setMaxZoom(e._maxZoom),e._minZoom&&e.setMinZoom(e._minZoom),t.layerSet[e.id]=e})):(l.prototype.addLayer.call(this,e),e.groupLayers?e.groupLayers.forEach((function(e){e._maxZoom&&e.setMaxZoom(e._maxZoom),e._minZoom&&e.setMinZoom(e._minZoom)})):(e._maxZoom&&e.setMaxZoom(e._maxZoom),e._minZoom&&e.setMinZoom(e._minZoom)),this.layerSet[e.id]=e),this.fire(i.LAYER_CHANGED,{type:"add",layers:[e]})},removeLayer:function(e){var t=e;t instanceof a.BaseLayer&&(t=e.getLayer()),l.prototype.removeLayer.call(this,t),this.layerSet[e.id]=null,delete this.layerSet[e.id],this.fire(i.LAYER_CHANGED,{type:"remove",layers:[e]})},getLayerById:function(e){return this.layerSet.hasOwnProperty(e)?this.layerSet[e]:n.getLayerById(this,e)}}),s.include({addScaleLineCtrl:function(e){opts=opts||{};e=opts.className||"ol-scale-line";this.getMap().addScaleLineControl(e),this._scaleLineCtrlClass=e},removeScaleLineCtrl:function(){jQuery("#"+this.id).fin(".ol-overlaycontainer-stopevent ."+this._scaleLineCtrlClass).remove()}}),s.include({listen:function(e,t,r){this.getAppEvent().isMapEvent(e)?this.getAppEvent()._on(e,t,r):o.prototype.on.call(this,e,t,r)},off:function(e,t,r){this.getAppEvent().isMapEvent(e)?this.getAppEvent()._off(e,t,r):o.prototype.off.call(this,e,t,r)},fire:function(){o.prototype.fire.apply(this,arguments)},once:function(){o.prototype.once.apply(this,arguments)}}),s.include({_getMapCenter:function(){var e=this.getCenter();return r.isArray(e)?e:[e.x,e.y]}}),s}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(21),r(2),r(18),r(37),r(1)],void 0===(o=function(e,t,r,n,o){var i=e.extend({options:{id:null,name:null,spatialReference:null,dataSpatialReference:null,symbolUpdateCallback:function(e){},callbackContext:window},includes:n.prototype,initialize:function(t){e.setOptions(this,t),this.map=this.options.map,this.options.layerId=this.options.layerId||this.options.id,this.options.layerName=this.options.layerName||this.options.name,this.id=this.options.layerId,this.name=this.options.layerName,this.options.spatialReference=this.map.spatialReference,this.options.dataSpatialReference=this.options.dataSpatialReference||this.options.spatialReference,this.projService=new o.sfs.CoordinateTransform({}),this._invokeSymbolUpdateCallback=!0,this._currentExtent=[NaN,NaN,NaN,NaN],this._addListeners()},_addListeners:function(){},_removeListeners:function(){},_onSymbolsUpdated:function(){},destroy:function(){try{this._removeListeners()}catch(e){}}});return i.include({getElements:function(){},getElementById:function(e){},clear:function(){},getLayer:function(){},getLayerId:function(){},setVisible:function(e){},getVisible:function(){},setZIndex:function(e){return this.getLayer().setZIndex(e)},getZIndex:function(){return this.getLayer().getZIndex()},getLayerName:function(){},hitTest:function(e,t){},getLayerExtent:function(){return this._currentExtent},toggleInvokeSymbolUpdateCallback:function(e){"boolean"==typeof e||(e=!this._invokeSymbolUpdateCallback),this._invokeSymbolUpdateCallback=e}}),i.include({_getColor:function(e){return r._getColor(e)},_envelopeFromGeom:function(e){try{var t,r,n,o,i=e.shell.points;t=r=1e7,n=o=-1e7;for(var a=0,s=i.length;a<s;a++){var l=i[a];t=Math.min(t,l.x),r=Math.min(r,l.y),n=Math.max(n,l.x),o=Math.max(o,l.y)}return[t,r,n,o]}catch(e){return[NaN,NaN,NaN,NaN]}},invokeCallback:function(e,r){var n=this.options.callbackContext||window;"string"==typeof e&&(e=this.options[e]),t.isFunction(e)&&e.call(n,r)}}),i}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(78),r(2),r(12),r(128),r(23),r(1)],void 0===(o=function(e,t,r,n,o,i){var a=e.extend({options:{symbolConfig:!1,xField:"LONGITUDE",yField:"LATITUDE"},initialize:function(t){e.prototype.initialize.call(this,t),this.noneSpatialArr=[],this.elements=[],this.currentZoom=this.map.getZoomLevel()},_addListeners:function(){e.prototype._addListeners.call(this),this.map.listen("extentchanged",this._extentChangeListener,this)},_removeListeners:function(){this.map.off("extentchanged",this._extentChangeListener,this),e.prototype._removeListeners.call(this)},_extentChangeListener:function(){var e=this.map.getZoomLevel();this.updateSymbol(e),this.currentZoom=e},_mapClickListener:function(e){var t=this.hitTest(e.screenX,e.screenY);t&&this.fire("click",{element:t.element,layer:t.layer})},addElements:function(e,r){if(t.isArray(e)){r=r||{};for(var n=this.map.getZoomLevel(),a=this.options.spatialReference,s=r.dataSpatialReference||this.options.dataSpatialReference,l=0,c=e.length;l<c;l++){var u=e[l],f=this._getGeometry(u,s,a);if(this.validateGeometry(f)){var h=this._getSymbol(u,n),p=this._getRecordId(u),d=new i.sfs.Element({id:p,geometry:f,symbol:h.symbol});d._data=u,d._zoomRange=h.zoomRange,d._symbolKey=h.symbolKey,this.elements.push(d),this.layer.add(d)}else this.noneSpatialArr.push(u)}this._onSymbolsUpdated(),this._onElementChanged()}else o.error("dataArr is not an array")},removeElements:function(e){if(t.isArray(e)){for(var r=e.length-1;r>=0;r--){var n=e[r];this.layer.remove(n)}this._onSymbolsUpdated(),this._onElementChanged()}},hitTest:function(e,t){var r=[],n=this.layer.hitTest(e,t);return n&&r.push(n),r[0]||null},setVisible:function(e){this.layer.setVisible(e||!1),e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})},clear:function(){this.elements=[],e.prototype.clear.call(this)},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(a,"type",{value:11,configurable:!1,writable:!1}),a}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2)],void 0===(o=function(e){var t=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}};return t.prototype={addObject:function(t,r){var n=this._getCoord(r.x),o=this._getCoord(r.y),i=this._grid,a=i[o]=i[o]||{},s=a[n]=a[n]||[],l=e.stamp(t);this._objectPoint[l]=r,s.push(t)},updateObject:function(e,t){this.removeObject(e),this.addObject(e,t)},removeObject:function(t,r){var n,o,i=this._getCoord(r.x),a=this._getCoord(r.y),s=this._grid,l=s[a]=s[a]||{},c=l[i]=l[i]||[];for(delete this._objectPoint[e.stamp(t)],n=0,o=c.length;n<o;n++)if(c[n]===t)return c.splice(n,1),1===o&&delete l[i],!0},eachObject:function(e,t){var r,n,o,i,a,s,l=this._grid;for(r in l)for(n in a=l[r])for(o=0,i=(s=a[n]).length;o<i;o++)e.call(t,s[o])&&(o--,i--)},eachCell:function(e,t){var r,n,o,i,a=this._grid;for(r in a)for(n in o=a[r])i=o[n],e.call(t,i,r,n)},getNearObject:function(t){var r,n,o,i,a,s,l,c,u=this._getCoord(t.x),f=this._getCoord(t.y),h=this._objectPoint,p=this._sqCellSize,d=null;for(r=f-1;r<=f+1;r++)if(i=this._grid[r])for(n=u-1;n<=u+1;n++)if(a=i[n])for(o=0,s=a.length;o<s;o++)l=a[o],(c=this._sqDist(h[e.stamp(l)],t))<p&&(p=c,d=l);return d},getObjects:function(e,t){var r=this._grid[e];return r?r[t]:null},_getCoord:function(e){return Math.floor(e/this._cellSize)},_sqDist:function(e,t){var r=t.x-e.x,n=t.y-e.y;return r*r+n*n},clear:function(){for(var e in this._grid){var t=this._grid[e];for(var r in t)t[r]=null,delete t[r];this._grid[e]=null,delete this._grid[e]}for(var e in this._objectPoint)delete this._objectPoint[e]},destroy:function(){for(var e in this.clear(),this._grid=null,delete this._grid,this._objectPoint)this._objectPoint[e]=null,delete this._objectPoint[e]}},t}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(126),r(2),r(1)],void 0===(o=function(e,t,r){return e.extend({options:{geometryField:"",xField:"LONGITUDE",yField:"LATITUDE",showZero:!1,symbolConfigUrl:""},initialize:function(r){e.prototype.initialize.call(this,r),t.isObject(this.options.symbolConfig)&&(this.symbolConfig=jQuery(!0,{},this.options.symbolConfig),delete this.options.symbolConfig),this.currentSymbols=[],this.statisticsData=null,this._visible=!0},_addListeners:function(){},_removeListeners:function(){},updateStatistics:function(e){},setVisible:function(e){},getVisible:function(){return this._visible},clear:function(){this.statisticsData=null},_updateLayer:function(e){},getLayer:function(){},_mergeStatisticsData:function(e,t){for(var r in t){var n=t[r],o=e[r];o?jQuery.extend(!0,o,n):e[r]=n}},_onSymbolsUpdated:function(){},_onElementChanged:function(){var e=this.getElements(),t=[];if(e&&e.length>0){for(var r=0,n=e.length;r<n;r++){var o=e[r];o&&o.geometry&&t.push(o.geometry)}var i=G.utils.GeometryUtil.getGeometryEnvlop(t);this._currentExtent=this._envelopeFromGeom(i)}else this._currentExtent=[NaN,NaN,NaN,NaN]},destroy:function(){if(this.clear(),this._removeListeners(),this.statisticsDataType){for(var t in this.statisticsDataType)delete this.statisticsDataType[t];this.statisticsDataType=null}if(this.statisticsData){for(var t in this.statisticsData)delete this.statisticsData[t];this.statisticsData=null}for(var t in this.options)delete this.options[t];for(var t in this)delete this[t];e.prototype.destroy.call(this)}})}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n;void 0===(n=function(){var e={x_PI:52.35987755982988,PI:3.141592653589793,a:6378245,ee:.006693421622965943,bd09togcj02:function(t){var r=+t.split(",")[0]-.0065,n=+t.split(",")[1]-.006,o=Math.sqrt(r*r+n*n)-2e-5*Math.sin(n*e.x_PI),i=Math.atan2(n,r)-3e-6*Math.cos(r*e.x_PI);return o*Math.cos(i)+","+o*Math.sin(i)},gcj02tobd09:function(t){var r=+t.split(",")[0],n=+t.split(",")[1],o=Math.sqrt(r*r+n*n)+2e-5*Math.sin(n*e.x_PI),i=Math.atan2(n,r)+3e-6*Math.cos(r*e.x_PI);return o*Math.cos(i)+.0065+","+(o*Math.sin(i)+.006)},wgs84togcj02:function(t){var r=+t.split(",")[0],n=+t.split(",")[1];if(e.out_of_china(r,n))return r+","+n;var o=e.transformlat(r-105,n-35),i=e.transformlng(r-105,n-35),a=n/180*e.PI,s=Math.sin(a);s=1-e.ee*s*s;var l=Math.sqrt(s);return o=180*o/(e.a*(1-e.ee)/(s*l)*e.PI),r+(i=180*i/(e.a/l*Math.cos(a)*e.PI))+","+(n+o)},gcj02towgs84:function(t){var r=+t.split(",")[0],n=+t.split(",")[1];if(e.out_of_china(r,n))return r+","+n;var o=e.transformlat(r-105,n-35),i=e.transformlng(r-105,n-35),a=n/180*e.PI,s=Math.sin(a);s=1-e.ee*s*s;var l=Math.sqrt(s);return o=180*o/(e.a*(1-e.ee)/(s*l)*e.PI),2*r-(r+(i=180*i/(e.a/l*Math.cos(a)*e.PI)))+","+(2*n-(n+o))},transformlat:function(t,r){var n=2*(t=+t)-100+3*(r=+r)+.2*r*r+.1*t*r+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*e.PI)+20*Math.sin(2*t*e.PI))/3,n+=2*(20*Math.sin(r*e.PI)+40*Math.sin(r/3*e.PI))/3,n+=2*(160*Math.sin(r/12*e.PI)+320*Math.sin(r*e.PI/30))/3},transformlng:function(t,r){var n=300+(t=+t)+2*(r=+r)+.1*t*t+.1*t*r+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*e.PI)+20*Math.sin(2*t*e.PI))/3,n+=2*(20*Math.sin(t*e.PI)+40*Math.sin(t/3*e.PI))/3,n+=2*(150*Math.sin(t/12*e.PI)+300*Math.sin(t/30*e.PI))/3},out_of_china:function(e,t){t=+t;return!((e=+e)>73.66&&e<135.05&&t>3.86&&t<53.55)}};return e}.apply(t,[]))||(e.exports=n)},function(e,t,r){var n=r(21),o=r(2),i=r(183),a=r(1),s=n.extend({options:{},initialize:function(e){n.setOptions(this,e)},destroy:function(){},buildElement:function(e){var t=this.buildGeometry(e),r=this.buildSymbol(e),n=this.buildAttributeSet(e),i=null;if(t){var s=e[this.options.idField];null!=s&&""!==s||(s=o.newUUID32()),(i=new a.sfs.Element({id:s,geometry:t,symbol:r})).attributeSet=n}return i},buildElementFromGFeature:function(e){var t=null;try{for(var r=e.properties,n=null,o={},i=0;i<r.length;i++){if(r[i].$type.indexOf("GeometryProperty")>-1)n=r[i].geometry;else o[e.fields.fields[i].name]=r[i].value}t=new a.sfs.Element({id:e._id,geometry:n});var s=this.buildAttributeSet(o||{});t.attributeSet=s}catch(e){console.warn(e)}return t},buildElementFromGeoJSON:function(e){var t=null;try{t=new a.sfs.Element({id:e.id,geometry:a.sfs.GeometryFactory.createGeometryFromGeoJson(e.geometry)});var r=this.buildAttributeSet(e.properties||{});t.attributeSet=r}catch(e){console.warn(e)}return t},buildElementFromEsriJSON:function(e){var t;e=(new i).fromArcgis(e);try{t=this.buildElement(e)}catch(e){console.warn(e)}return t},buildElementFromKml:function(e){var t;e=(new i).fromKml(e);try{t=this.buildElement(e)}catch(e){console.warn(e)}return t},buildFeature:function(e,t){var r,n=new a.sfs.Fields,i=[];try{r=this.buildGeometry(e)}catch(e){console.warn(e)}var s=new a.sfs.Feature({objectId:e[this.options.idField]||o.newUUID32(),fields:n,values:i,geometry:r});if(s.id=s.objectId,t){var l=this.buildAttributeSet(e);s.attributeSet=l}else for(var c in e){var u=new a.sfs.Field({name:c}),f=new a.sfs.Value;f.setValue(e[c]),n.add(u),i.push(f)}return s},buildFeatureFromGeoJSON:function(e,t){return this.buildFeature(e,t)},buildFeatureFromEsriJSON:function(e,t){return e=(new i).fromArcgis(e),this.buildFeature(e,t)},buildFeatureFromKml:function(e,t){return e=(new i).fromKml(e),this.buildFeature(e,t)},buildGeometry:function(e){return this.options.geometryBuilder.build(e)},buildSymbol:function(e){return this.options.symbolBuilder.build(e)},buildAttributeSet:function(e){var t=new a.sfs.AttributeSet;for(var r in e){var n=new a.sfs.Attribute({name:r,value:e[r]});t.add(n)}return t}});e.exports=s},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"getAddressByKeyword",value:function(e){}},{key:"getAddressByLocation",value:function(e){}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.params=null,this.symbol=null,this.defaultSymbol=null,this.points=[],this.movingPoint=null,this.drawing=!1}var t,n,o;return t=e,(n=[{key:"onClick",value:function(e){this.params=e,this.options.map.setCursor("crosshair"),e.symbol?this.symbol=G.utils.RenderUtil.object2Symbol(e.symbol):this.symbol=this.defaultSymbol,this.points=[],this.movingPoint=null,this.drawing=!0,this.options.map.stopDbClick()}},{key:"deactivate",value:function(){this.params=null,this.options.map.setCursor(""),this.symbol=null,this.points=[],this.movingPoint=null,this.drawing=!1,this.options.map.resumeDbClick()}},{key:"onMouseDown",value:function(e,t,r,n,o,i,a){}},{key:"onMouseUp",value:function(e,t,r,n,o,i,a){}},{key:"onMouseMove",value:function(e,t,r,n,o,i,a){}},{key:"onMouseClick",value:function(e,t,r,n,o,i,a){}},{key:"onDblclick",value:function(e,t,r,n,o,i,a){}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){var n=r(11),o=r(37),i=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.featureTypeList=[],this.listenEvents={},this._last_mouse_over=null;var t=this;this.eventDispatcher={listens:function(e){return t.listens(e)},listener:function(e,r){var n=t._getFeatureType(e);return n&&n.listeners[r]?n.listeners[r]:null},fire:function(e,r){t.fire(e,r)}}},destroy:function(){n.prototype.destroy.call(this)},load:function(){n.prototype.load.call(this),this.map.initialGroupLayers()},unload:function(){this.removeAll(),n.prototype.unload.call(this)},add:function(e){},update:function(e){},clear:function(e){var t=this._getFeatureType(e);t&&t.renderer.clear(),this._fireUpdateEvent()},clearAll:function(){for(var e=this.featureTypeList.length-1;e>=0;e--){this.featureTypeList[e].renderer.clear()}this._fireUpdateEvent()},remove:function(e){for(var t=0;t<this.featureTypeList.length;t++){var r=this.featureTypeList[t];if(r.featureType==e){r.renderer.destroy(),r.renderer=null,this.featureTypeList.splice(t,1),this._fireUpdateEvent();break}}},removeAll:function(){for(var e=this.featureTypeList.length-1;e>=0;e--){var t=this.featureTypeList[e];t.renderer.destroy(),t.renderer=null,this.featureTypeList.splice(e,1)}this.featureTypeList=[],this._fireUpdateEvent()},getLayer:function(e){},visitFeature:function(e,t){},setVisible:function(e,t){var r=this._getFeatureType(e);return!!r&&(r.renderer.setVisible(!!t),this._fireUpdateEvent(),!0)},getVisible:function(e){var t=this._getFeatureType(e);if(t)return t.renderer.getVisible()},getFeatureTypeNames:function(){for(var e=[],t=this.featureTypeList.length-1;t>=0;t--){var r=this.featureTypeList[t];e.push(r.featureType)}return e},on:function(e,t,r){this.listenEvents[e]=!0,o.prototype.on.call(this,e,t,r)},off:function(e,t){o.prototype.off.call(this,e,t);var r=this._$handlers[e];(!r||r&&0==r.length)&&(this.listenEvents[e]=!1)},listens:function(e){if(this.listenEvents[e])return!0;for(var t=this.featureTypeList.length-1;t>=0;t--){var r=this.featureTypeList[t];if(r.listeners&&r.listeners.hasOwnProperty(e))return!0}return!1},_getFeatureType:function(e){for(var t=0;t<this.featureTypeList.length;t++){var r=this.featureTypeList[t];if(r.featureType==e)return r}return null},_fireUpdateEvent:function(e){this.fire("feature-change",e)}});e.exports=i},function(e,t,r){var n=r(9),o=r(3),i=r(99);e.exports=!n&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(4),o=r(100),i=n["__core-js_shared__"]||o("__core-js_shared__",{});e.exports=i},function(e,t,r){var n=r(4),o=r(101),i=n.WeakMap;e.exports="function"==typeof i&&/native code/.test(o(i))},function(e,t,r){var n=r(16),o=r(103),i=r(20),a=r(13);e.exports=function(e,t){for(var r=o(t),s=a.f,l=i.f,c=0;c<r.length;c++){var u=r[c];n(e,u)||s(e,u,l(t,u))}}},function(e,t,r){var n=r(4);e.exports=n},function(e,t,r){var n=r(16),o=r(27),i=r(68).indexOf,a=r(67);e.exports=function(e,t){var r,s=o(e),l=0,c=[];for(r in s)!n(a,r)&&n(s,r)&&c.push(r);for(;t.length>l;)n(s,r=t[l++])&&(~i(c,r)||c.push(r));return c}},function(e,t,r){var n=r(106);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(9),o=r(13),i=r(6),a=r(70);e.exports=n?Object.defineProperties:function(e,t){i(e);for(var r,n=a(t),s=n.length,l=0;s>l;)o.f(e,r=n[l++],t[r]);return e}},function(e,t,r){var n=r(35);e.exports=n("document","documentElement")},function(e,t,r){var n=r(27),o=r(53).f,i={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==i.call(e)?function(e){try{return o(e)}catch(e){return a.slice()}}(e):o(n(e))}},function(e,t,r){var n=r(7);t.f=n},function(e,t,r){"use strict";var n=r(17),o=r(47),i=r(10),a=Math.min;e.exports=[].copyWithin||function(e,t){var r=n(this),s=i(r.length),l=o(e,s),c=o(t,s),u=arguments.length>2?arguments[2]:void 0,f=a((void 0===u?s:o(u,s))-c,s-l),h=1;for(c<l&&l<c+f&&(h=-1,c+=f-1,l+=f-1);f-- >0;)c in r?r[l]=r[c]:delete r[l],l+=h,c+=h;return r}},function(e,t,r){"use strict";var n=r(59),o=r(10),i=r(49),a=function(e,t,r,s,l,c,u,f){for(var h,p=l,d=0,y=!!u&&i(u,f,3);d<s;){if(d in r){if(h=y?y(r[d],d,t):r[d],c>0&&n(h))p=a(e,t,h,o(h.length),p,c-1)-1;else{if(p>=9007199254740991)throw TypeError("Exceed the acceptable array length");e[p]=h}p++}d++}return p};e.exports=a},function(e,t,r){"use strict";var n=r(19).forEach,o=r(43),i=r(26),a=o("forEach"),s=i("forEach");e.exports=a&&s?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){"use strict";var n=r(49),o=r(17),i=r(150),a=r(110),s=r(10),l=r(54),c=r(74);e.exports=function(e){var t,r,u,f,h,p,d=o(e),y="function"==typeof this?this:Array,m=arguments.length,g=m>1?arguments[1]:void 0,v=void 0!==g,b=c(d),_=0;if(v&&(g=n(g,m>2?arguments[2]:void 0,2)),null==b||y==Array&&a(b))for(r=new y(t=s(d.length));t>_;_++)p=v?g(d[_],_):d[_],l(r,_,p);else for(h=(f=b.call(d)).next,r=new y;!(u=h.call(f)).done;_++)p=v?i(f,g,[u.value,_],!0):u.value,l(r,_,p);return r.length=_,r}},function(e,t,r){var n=r(6);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&n(i.call(e)),t}}},function(e,t,r){"use strict";var n=r(152).IteratorPrototype,o=r(48),i=r(46),a=r(41),s=r(73),l=function(){return this};e.exports=function(e,t,r){var c=t+" Iterator";return e.prototype=o(n,{next:i(1,r)}),a(e,c,!1,!0),s[c]=l,e}},function(e,t,r){"use strict";var n,o,i,a=r(36),s=r(25),l=r(16),c=r(7),u=r(40),f=c("iterator"),h=!1;[].keys&&("next"in(i=[].keys())?(o=a(a(i)))!==Object.prototype&&(n=o):h=!0),null==n&&(n={}),u||l(n,f)||s(n,f,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:h}},function(e,t,r){var n=r(5);e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){"use strict";var n=r(27),o=r(32),i=r(10),a=r(43),s=r(26),l=Math.min,c=[].lastIndexOf,u=!!c&&1/[1].lastIndexOf(1,-0)<0,f=a("lastIndexOf"),h=s("indexOf",{ACCESSORS:!0,1:0}),p=u||!f||!h;e.exports=p?function(e){if(u)return c.apply(this,arguments)||0;var t=n(this),r=i(t.length),a=r-1;for(arguments.length>1&&(a=l(a,o(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:c},function(e,t){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(e,t,r){var n=r(32),o=r(10);e.exports=function(e){if(void 0===e)return 0;var t=n(e),r=o(t);if(t!==r)throw RangeError("Wrong length or index");return r}},function(e,t,r){"use strict";var n=r(13).f,o=r(48),i=r(61),a=r(49),s=r(51),l=r(77),c=r(112),u=r(60),f=r(9),h=r(56).fastKey,p=r(28),d=p.set,y=p.getterFor;e.exports={getConstructor:function(e,t,r,c){var u=e((function(e,n){s(e,u,t),d(e,{type:t,index:o(null),first:void 0,last:void 0,size:0}),f||(e.size=0),null!=n&&l(n,e[c],e,r)})),p=y(t),m=function(e,t,r){var n,o,i=p(e),a=g(e,t);return a?a.value=r:(i.last=a={index:o=h(t,!0),key:t,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=a),n&&(n.next=a),f?i.size++:e.size++,"F"!==o&&(i.index[o]=a)),e},g=function(e,t){var r,n=p(e),o=h(t);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==t)return r};return i(u.prototype,{clear:function(){for(var e=p(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,f?e.size=0:this.size=0},delete:function(e){var t=p(this),r=g(this,e);if(r){var n=r.next,o=r.previous;delete t.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),t.first==r&&(t.first=n),t.last==r&&(t.last=o),f?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=p(this),n=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!g(this,e)}}),i(u.prototype,r?{get:function(e){var t=g(this,e);return t&&t.value},set:function(e,t){return m(this,0===e?0:e,t)}}:{add:function(e){return m(this,e=0===e?0:e,e)}}),f&&n(u.prototype,"size",{get:function(){return p(this).size}}),u},setStrong:function(e,t,r){var n=t+" Iterator",o=y(t),i=y(n);c(e,t,(function(e,t){d(this,{type:n,target:e,state:o(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),u(t)}}},function(e,t){var r=Math.log;e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:r(1+e)}},function(e,t,r){var n=r(5),o=Math.floor;e.exports=function(e){return!n(e)&&isFinite(e)&&o(e)===e}},function(e,t,r){"use strict";var n=r(9),o=r(3),i=r(70),a=r(105),s=r(82),l=r(17),c=r(65),u=Object.assign,f=Object.defineProperty;e.exports=!u||o((function(){if(n&&1!==u({b:1},u(f({},"a",{enumerable:!0,get:function(){f(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol();return e[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=u({},e)[r]||"abcdefghijklmnopqrst"!=i(u({},t)).join("")}))?function(e,t){for(var r=l(e),o=arguments.length,u=1,f=a.f,h=s.f;o>u;)for(var p,d=c(arguments[u++]),y=f?i(d).concat(f(d)):i(d),m=y.length,g=0;m>g;)p=y[g++],n&&!h.call(d,p)||(r[p]=d[p]);return r}:u},function(e,t,r){var n=r(9),o=r(70),i=r(27),a=r(82).f,s=function(e){return function(t){for(var r,s=i(t),l=o(s),c=l.length,u=0,f=[];c>u;)r=l[u++],n&&!a.call(s,r)||f.push(e?[r,s[r]]:s[r]);return f}};e.exports={entries:s(!0),values:s(!1)}},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,r){var n=r(4);e.exports=n.Promise},function(e,t,r){var n=r(108);e.exports=/(iphone|ipod|ipad).*applewebkit/i.test(n)},function(e,t,r){var n,o,i,a,s,l,c,u,f=r(4),h=r(20).f,p=r(34),d=r(117).set,y=r(164),m=f.MutationObserver||f.WebKitMutationObserver,g=f.process,v=f.Promise,b="process"==p(g),_=h(f,"queueMicrotask"),w=_&&_.value;w||(n=function(){var e,t;for(b&&(e=g.domain)&&e.exit();o;){t=o.fn,o=o.next;try{t()}catch(e){throw o?a():i=void 0,e}}i=void 0,e&&e.enter()},b?a=function(){g.nextTick(n)}:m&&!y?(s=!0,l=document.createTextNode(""),new m(n).observe(l,{characterData:!0}),a=function(){l.data=s=!s}):v&&v.resolve?(c=v.resolve(void 0),u=c.then,a=function(){u.call(c,n)}):a=function(){d.call(f,n)}),e.exports=w||function(e){var t={fn:e,next:void 0};i&&(i.next=t),o||(o=t,a()),i=t}},function(e,t,r){var n=r(6),o=r(5),i=r(167);e.exports=function(e,t){if(n(e),o(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){"use strict";var n=r(33),o=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new o(e)}},function(e,t,r){"use strict";var n=r(0),o=r(93);n({target:"RegExp",proto:!0,forced:/./.exec!==o},{exec:o})},function(e,t,r){"use strict";var n=r(94).charAt,o=r(28),i=r(112),a=o.set,s=o.getterFor("String Iterator");i(String,"String",(function(e){a(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),r=t.string,o=t.index;return o>=r.length?{value:void 0,done:!0}:(e=n(r,o),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(10),o=r(116),i=r(24),a=Math.ceil,s=function(e){return function(t,r,s){var l,c,u=String(i(t)),f=u.length,h=void 0===s?" ":String(s),p=n(r);return p<=f||""==h?u:(l=p-f,(c=o.call(h,a(l/h.length))).length>l&&(c=c.slice(0,l)),e?u+c:c+u)}};e.exports={start:s(!1),end:s(!0)}},function(e,t,r){var n=r(108);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},function(e,t,r){var n=r(360);e.exports=function(e,t){var r=n(e);if(r%t)throw RangeError("Wrong offset");return r}},function(e,t,r){var n=r(17),o=r(10),i=r(74),a=r(110),s=r(49),l=r(8).aTypedArrayConstructor;e.exports=function(e){var t,r,c,u,f,h,p=n(e),d=arguments.length,y=d>1?arguments[1]:void 0,m=void 0!==y,g=i(p);if(null!=g&&!a(g))for(h=(f=g.call(p)).next,p=[];!(u=h.call(f)).done;)p.push(u.value);for(m&&d>2&&(y=s(y,arguments[2],2)),r=o(p.length),c=new(l(this))(r),t=0;r>t;t++)c[t]=m?y(p[t],t):p[t];return c}},function(e,t,r){"use strict";var n=r(61),o=r(56).getWeakData,i=r(6),a=r(5),s=r(51),l=r(77),c=r(19),u=r(16),f=r(28),h=f.set,p=f.getterFor,d=c.find,y=c.findIndex,m=0,g=function(e){return e.frozen||(e.frozen=new v)},v=function(){this.entries=[]},b=function(e,t){return d(e.entries,(function(e){return e[0]===t}))};v.prototype={get:function(e){var t=b(this,e);if(t)return t[1]},has:function(e){return!!b(this,e)},set:function(e,t){var r=b(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=y(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,r,c){var f=e((function(e,n){s(e,f,t),h(e,{type:t,id:m++,frozen:void 0}),null!=n&&l(n,e[c],e,r)})),d=p(t),y=function(e,t,r){var n=d(e),a=o(i(t),!0);return!0===a?g(n).set(t,r):a[n.id]=r,e};return n(f.prototype,{delete:function(e){var t=d(this);if(!a(e))return!1;var r=o(e);return!0===r?g(t).delete(e):r&&u(r,t.id)&&delete r[t.id]},has:function(e){var t=d(this);if(!a(e))return!1;var r=o(e);return!0===r?g(t).has(e):r&&u(r,t.id)}}),n(f.prototype,r?{get:function(e){var t=d(this);if(a(e)){var r=o(e);return!0===r?g(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return y(this,e,t)}}:{add:function(e){return y(this,e,!0)}}),f}}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){var n=r(3),o=r(7),i=r(40),a=o("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),i&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host}))},function(e,t,r){"use strict";r(85);var n=r(0),o=r(35),i=r(176),a=r(22),s=r(61),l=r(41),c=r(151),u=r(28),f=r(51),h=r(16),p=r(49),d=r(75),y=r(6),m=r(5),g=r(48),v=r(46),b=r(402),_=r(74),w=r(7),S=o("fetch"),L=o("Headers"),x=w("iterator"),P=u.set,E=u.getterFor("URLSearchParams"),T=u.getterFor("URLSearchParamsIterator"),C=/\+/g,A=Array(4),k=function(e){return A[e-1]||(A[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},R=function(e){try{return decodeURIComponent(e)}catch(t){return e}},O=function(e){var t=e.replace(C," "),r=4;try{return decodeURIComponent(t)}catch(e){for(;r;)t=t.replace(k(r--),R);return t}},I=/[!'()~]|%20/g,M={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},F=function(e){return M[e]},D=function(e){return encodeURIComponent(e).replace(I,F)},j=function(e,t){if(t)for(var r,n,o=t.split("&"),i=0;i<o.length;)(r=o[i++]).length&&(n=r.split("="),e.push({key:O(n.shift()),value:O(n.join("="))}))},G=function(e){this.entries.length=0,j(this.entries,e)},N=function(e,t){if(e<t)throw TypeError("Not enough arguments")},B=c((function(e,t){P(this,{type:"URLSearchParamsIterator",iterator:b(E(e).entries),kind:t})}),"Iterator",(function(){var e=T(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r})),U=function(){f(this,U,"URLSearchParams");var e,t,r,n,o,i,a,s,l,c=arguments.length>0?arguments[0]:void 0,u=this,p=[];if(P(u,{type:"URLSearchParams",entries:p,updateURL:function(){},updateSearchParams:G}),void 0!==c)if(m(c))if("function"==typeof(e=_(c)))for(r=(t=e.call(c)).next;!(n=r.call(t)).done;){if((a=(i=(o=b(y(n.value))).next).call(o)).done||(s=i.call(o)).done||!i.call(o).done)throw TypeError("Expected sequence with length 2");p.push({key:a.value+"",value:s.value+""})}else for(l in c)h(c,l)&&p.push({key:l,value:c[l]+""});else j(p,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:c+"")},z=U.prototype;s(z,{append:function(e,t){N(arguments.length,2);var r=E(this);r.entries.push({key:e+"",value:t+""}),r.updateURL()},delete:function(e){N(arguments.length,1);for(var t=E(this),r=t.entries,n=e+"",o=0;o<r.length;)r[o].key===n?r.splice(o,1):o++;t.updateURL()},get:function(e){N(arguments.length,1);for(var t=E(this).entries,r=e+"",n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){N(arguments.length,1);for(var t=E(this).entries,r=e+"",n=[],o=0;o<t.length;o++)t[o].key===r&&n.push(t[o].value);return n},has:function(e){N(arguments.length,1);for(var t=E(this).entries,r=e+"",n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){N(arguments.length,1);for(var r,n=E(this),o=n.entries,i=!1,a=e+"",s=t+"",l=0;l<o.length;l++)(r=o[l]).key===a&&(i?o.splice(l--,1):(i=!0,r.value=s));i||o.push({key:a,value:s}),n.updateURL()},sort:function(){var e,t,r,n=E(this),o=n.entries,i=o.slice();for(o.length=0,r=0;r<i.length;r++){for(e=i[r],t=0;t<r;t++)if(o[t].key>e.key){o.splice(t,0,e);break}t===r&&o.push(e)}n.updateURL()},forEach:function(e){for(var t,r=E(this).entries,n=p(e,arguments.length>1?arguments[1]:void 0,3),o=0;o<r.length;)n((t=r[o++]).value,t.key,this)},keys:function(){return new B(this,"keys")},values:function(){return new B(this,"values")},entries:function(){return new B(this,"entries")}},{enumerable:!0}),a(z,x,z.entries),a(z,"toString",(function(){for(var e,t=E(this).entries,r=[],n=0;n<t.length;)e=t[n++],r.push(D(e.key)+"="+D(e.value));return r.join("&")}),{enumerable:!0}),l(U,"URLSearchParams"),n({global:!0,forced:!i},{URLSearchParams:U}),i||"function"!=typeof S||"function"!=typeof L||n({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,r,n,o=[e];return arguments.length>1&&(t=arguments[1],m(t)&&(r=t.body,"URLSearchParams"===d(r)&&((n=t.headers?new L(t.headers):new L).has("content-type")||n.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=g(t,{body:v(0,String(r)),headers:v(0,n)}))),o.push(t)),S.apply(this,o)}}),e.exports={URLSearchParams:U,getState:E}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"get",value:function(e,t,r,n,o){}},{key:"post",value:function(e,t,r,n,o){}},{key:"put",value:function(e,t,r,n,o){}},{key:"delete",value:function(e,t,r,n,o){}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){"use strict";var n,o;n=[r(125),r(2),r(21),r(1)],void 0===(o=function(e,t,r,n){var o=function(e){r.setOptions(this,e)};return o.prototype={options:{},addTo:function(e){this.remove(),this.options.gmap=e;var t=this._fcontainer=this.onAdd(e),r=this.getPosition();if("[object String]"===Object.prototype.toString.call(r)){var n=e._controlCorners[r];$(n).append($(t))}else{n=e._controlCorners.drift;$(n).append($(t)),r&&"[object Object]"===Object.prototype.toString.call(r)&&!$.isEmptyObject(r)&&($(t).css(r),$(t).css({position:"absolute"})),$(t).css({"pointer-events":"auto"}),$(t).addClass("gs-container-subdrift")}return this.created&&this.created(),this},remove:function(){return this.options.gmap?(jQuery(this._fcontainer).remove(),this.onRemove&&this.onRemove(this.options.gmap),this.options.gmap=null,this):this},constructor:o,getPosition:function(){return this.options.position},setPosition:function(e){jQuery(this._fcontainer).remove(),this.onRemove&&this.onRemove(this.options.gmap),this.options.position=e,this.addTo(this.options.gmap)},onAdd:function(){var e=document.createElement("div");return this.options.id&&(e.id=this.options.id),this.options.className&&(e.className=this.options.className),this.container=e,this.container},getFontainer:function(){return this._fcontainer},getID:function(){var e=this.options?this.options:this.options.id;return(e=e||ctrl.id)||(e="ctr"+t.stamp(this)),e}},e.include({addControl:function(e){if(e instanceof G.base.ControlBase){if(this._controls.push(e),!(e.getID?e.getID():"ctr"+t.stamp(e)))throw new Error("参数类型错误！");return e.addTo?e.addTo(this):e.onAdd(),this}return n.carto.Map.prototype.addControl.call(this,e)},removeControl:function(e){if(e instanceof G.base.ControlBase){for(var t=!1,r=this._controls.length-1;r>=0;r--){var o=this._controls[r];if(o===e||o.id===e){o.remove?o.remove():o.onRemove(),this._controls.splice(r,1),t=!0;break}}return t}return n.carto.Map.prototype.removeControl.call(this,e)},getControlById:function(e){for(var t=this._controls.length,r=null,n=0;n<t;n++){var o=this._controls[n];if(o.id===e){r=o;break}}return r},_initControlPos:function(){var e=this._controlCorners={},t=jQuery("#"+this.id),r=t;r.append('<div class="Corners"></div>');var n=r.find(".Corners").last();n.css({position:"absolute",width:"100%",height:"100%"}),this._setContainerParentStyles(n[0],t[0]);function o(t,r){var o="gs-container-"+t+r;n.append('<div class="'+o+'"></div>'),e[t+r]=n.find("."+o)[0]}o("top","left"),o("top","right"),o("bottom","left"),o("bottom","right"),function(){n.append('<div class="gs-container-drift"></div>');var t=r.find(".gs-container-drift");e.drift=t[0]}()},_clearPos:function(){jQuery("#"+this.id+" .Corners").remove(),jQuery("#"+this.id+" .Drift").remove()},_setContainerParentStyles:function(e,t){console.log(e),e.style.top="0px",e.style.left="0px"}}),e.addInitHook((function(){this._controls=[],!0===this.options.initControlContainer&&this._initControlPos&&this._initControlPos()})),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(79),r(23)],void 0===(o=function(e,t,r){var n="class",o="plugin",i={_mergeAndCheckBeans:function(n,o){var i={};if(e.isArray(n))for(var a=0,s=n.length;a<s;a++){(f=n[a])&&(i[f.id]=f)}if(e.isArray(o)){var l=0;for(s=o.length;l<s;l++){(f=o[l])&&(i[f.id]&&r.info("override bean :"+f.id),i[f.id]=f)}}var c=[];if(this._isPackMode())for(var u in i){(f=i[u])&&(f.path?this._isGlobalVar(f.path)||(f.path=p.call(this,f.path)):delete f.path,c.push(f))}else for(var u in i){var f;if(f=i[u]){if(!e.isString(f.path)){var h=this._getBeanTypeById(f.id);f.path=this.getResourcePath()+"/js/"+h+"/"+f.id+".js"}this._isGlobalVar(f.path)||(f.path=p.call(this,f.path)),c.push(f)}}function p(r){var n={base:t.getBasePath(),resource:this.getResourcePath()};return e.replacePlaceHolder(n,r)}this.options.beans=c},_isPackMode:function(){return e.isObject(this.BEANS)},_extractBeanPath:function(){for(var t=this.options.beans,r=[],n=0,o=t.length;n<o;n++){var i=t[n];e.isString(i.path)&&(this._isGlobalVar(i.path)||r.push(i.path))}return r},_isGlobalVar:function(t){return e.isString(t)&&/^var\:.*$/.test(t)},getBean:function(e){return this._beans[e]||null},_initializeBean:function(r,i){var a=this._beans[r],s=!1,l=this.options.beans;if(null==a)for(var c=0,u=l.length;c<u;c++){var f=l[c],h=f.properties||[];if(f&&f.id==r){try{if(f.type==n){if(a=i[c],this._beans[f.id]=a,e.isArray(h)&&h.length>0&&e.isObject(a.prototype)){var p=a.prototype.options||{},d=m.call(this,h,i,l);for(var y in d=g.call(this,f,d))p[y]=d[y];a.prototype.options=p}}else if(f.type==o)s=!0,a=i[c],this._beans[f.id]=a;else{d=m.call(this,h,i,l);d=g.call(this,f,d),e.isFunction(i[c])?a=new i[c](d):e.isObject(i[c])&&(a=i[c]),this._beans[f.id]=a}}catch(e){throw new Error("failed to construct bean ["+r+"]\r\n message: "+e.message)}break}}//!isPlugin 处理第三方库无返回值的情况
if(!s&&null==a)throw new Error("bean ["+r+"] cannot be initialized !");return a;function m(t,r,n){for(var o={},i={},a=0,s=n.length;a<s;a++){var l=n[a];if(l&&l.id)i["${"+l.id+"}"]=l.id}for(a=0,s=t.length;a<s;a++){var c=t[a],u=c.name,f=c.value;if(e.isString(f))if(i.hasOwnProperty(f)){var h=i[f];o[u]=this._initializeBean(h,r)}else{var p=/([\w\_\-\d]+)/g,d=f.match(/(\$\{[\w\.\_\-\d]{0,}\})/g);if(e.isArray(d))for(var y=0,m=d.length;y<m;y++){var g=d[y],v=g.match(p);if(e.isArray(v)&&v.length>0){var b=v.join("."),_=e.getValByVarPath(b);f=f==="${"+b+"}"?_:f.replace(g,_)}}o[u]=f}else o[u]=f}return o}function g(e,r){return r.appEvent=this.appEvent,r.locale=t.getLocaleValue(this.options.name)||{},r.parentOpts=this.options,v.call(this,e.id,r),r}function v(e,t){var r={component:function(e){e.map=this.map},dispatcher:function(e){},view:function(e){e.imgPath=this._imgPath,e.cssPath=this._cssPath,e.htmlPath=this._htmlPath,e.configPath=this._configPath},service:function(e){e.configPath=this._configPath}},n=this._getBeanTypeById(e);n&&r[n]&&r[n].call(this,t)}},_getBeanTypeById:function(e){var t={"^.*component$":"component","^.*dispatcher$":"dispatcher","^.*view$":"view","^.*service$":"service"},r="misc";for(var n in e&&(e=e.toLowerCase()),t)if(new RegExp(n,"i").test(e)){r=t[n];break}return r},_initializeBeans:function(){for(var t=[],r=this.options.beans,n=this.BEANS,o=0,i=0,a=r.length;i<a;i++){var s=r[i];if(e.isString(s.path))this._isGlobalVar(s.path)?t.push(e.getValByVarPath(s.path.replace(/var:/g,""))):t.push(arguments[o++]);else{var l=n[s.id];if(!l)throw new Error("bean :"+s.id+" clazz not defined!");t.push(l)}}for(i=0,a=r.length;i<a;i++){s=r[i];this._initializeBean(s.id,t)}},_activateDispatchers:function(){for(var e in this._beans){this._beans[e]&&"dispatcher"===this._getBeanTypeById(e)&&this.getBean(e).dispatch()}},_destroyBeans:function(){for(var e in this._beans){var t=this._beans[e];if(t.destroy)try{t.destroy()}catch(e){}this._beans[e]=null,delete this._beans[e]}}};function a(r){var n=r.beans;delete r.beans,r.hasOwnProperty("resourcePath")&&(this.BEANS=null,this.setResourcePath(r.resourcePath));var o=this.getResourcePath();this._staticPath=r.staticPath||t.getStaticPath(),this._cssPath=r.cssPath||o+"css/",this._configPath=r.configPath||o+"config/",this._imgPath=r.imgPath||o+"img/",this._htmlPath=r.htmlPath||o+"html/";var i={};e.isString(this.options.config)&&(i=e.getConfig({url:this._configPath+this.options.config,async:!1}));var a=null;if(e.isObject(i))for(var s in a=i.beans,delete i.beans,i)this.options.hasOwnProperty(s)||(this.options[s]=i[s]);this._beans={},this._mergeAndCheckBeans(a,n)}function s(){var t=this,r=this._extractBeanPath();function n(){this._initializeBeans.apply(this,arguments),this._activateDispatchers(),this.fire("BEAN_INITIALIZED",{})}window.hasOwnProperty("requireNoConflict")?window.requireNoConflict(r,(function(){n.apply(t,arguments)})):e.isFunction(window.require)&&e.isFunction(window.define)?window.require(r,(function(){n.apply(t,arguments)})):n.apply(t,[])}function l(){this._destroyBeans()}return{enable:function(e){if(e&&e.prototype){if(e.prototype.initialize){var t=e.prototype.initialize;e.prototype.initialize=function(e){t.apply(this,arguments),a.apply(this,arguments)}}if("Control"==e.prototype.TYPE){var r=e.prototype.onAdd;e.prototype.onAdd=function(){r.call(this),s.call(this)};var n=e.prototype.onRemove;e.prototype.onRemove=function(){n.call(this),l.call(this)}}else if("Module"==e.prototype.TYPE){var o=e.prototype.onOpen;e.prototype.onOpen=function(){o.call(this),s.call(this)};var c=e.prototype.onClose;e.prototype.onClose=function(){c.call(this),l.call(this)}}for(var u in i)e.prototype[u]=i[u]}}}}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(434),r(2),r(14),r(18),r(63),r(12),r(1)],void 0===(o=function(e,t,r,n,o,i,a,s){var l=e.extend({options:{collision:"visibility",symbol:{type:"SimpleLineSymbol",options:{color:{a:250,r:0,g:0,b:0},style:5,width:2}}},initialize:function(t){e.prototype.initialize.call(this,t),this._tailLables=[],this._tailOpts={tailLength:!0,tailAlign:!0,tailAngle:!0,symbol:!0,showArrow:!0,arrowSymbol:!0,arrowShape:!0,arrowLength:!0,arrowScale:!0,arrowAngle:!0,domClassName:!0,domStyle:!0},this._lastLevel=this.map.getZoomLevel(),this.map.listen("extentchanged",this._onExtentChange,this);try{this.map.map.listen("pointerdrag",this._onMapDragg,this)}catch(e){}},clear:function(){for(var e=0,t=this._tailLables.length;e<t;e++)try{this._tailLables[e].destroy()}catch(e){}this._tailLables=[]},destroy:function(){this.map.off("extentchanged",this._onExtentChange,this);try{this.map.map.un("pointerdrag",this._onMapDragg,this)}catch(e){}e.prototype.destroy.call(this)}});return l.include({_onExtentChange:function(e){var t="";t=this._lastLevel==this.map.getZoomLevel()?"updateDom":"update";for(var r=0,n=this._tailLables.length;r<n;r++)try{this._tailLables[r][t]()}catch(e){}this._lastLevel=this.map.getZoomLevel(),this._detectCollision()},_onMapDragg:function(e){e.pixel,e.coordinate;for(var t=0,r=this._tailLables.length;t<r;t++)try{this._tailLables[t].updateDom()}catch(e){}this._detectCollision()},_detectCollision:function(){({none:function(){},visibility:function(){for(var e=[],t=0,r=this._tailLables.length;t<r;t++){var n=this._tailLables[t];o(n,e)?n.toggleVisible(!1):(n.toggleVisible(!0),e.push(n))}function o(e,t){for(var r=!1,n=0,o=t.length;n<o;n++){var i=t[n];if(e.intersects(i)){r=!0;break}}return r}}})[this.options.collision].call(this)},_getLayer:function(){if(!this._layer){var e=this.options.layerId,t=n.getLayerById(this.map,e);t||(t=new s.carto.ElementLayer({map:this.map,id:e}),this.map.addLayer(t)),this._layer=t}return this._layer},_getTailedLabel:function(e){for(var t=null,r=this._tailLables.length-1;r>=0;r--){var n=this._tailLables[r];if(n&&n.getId()==e){t=n;break}}return t}}),l.include({add:function(e){var r=jQuery.extend(!0,{},e);for(var n in this._tailOpts)r[n]=r[n]||this.options[n];r.layer=this._getLayer(),r.map=this.map;var o=new t(r);return o.setContent(r.label),this._tailLables.push(o),this._detectCollision(),o.getId()},update:function(e,t,r){var n=!1,o=this._getTailedLabel(e);return null!=o&&(o.setContent(t),null!=r&&o.update(r||{}),n=!0),n},remove:function(e){for(var t=!1,r=this._tailLables.length-1;r>=0;r--){var n=this._tailLables[r];if(n&&n.getId()==e){n.destroy(),this._tailLables.splice(r,1),t=!0;break}}for(var o=this._layer.elements.length-1;o>=0;o--){var i=this._layer.elements[o];if(i&&i.id==e){this._layer.remove(i);break}}return t},removeAll:function(){for(var e=this._tailLables.length-1;e>=0;e--){var t=this._tailLables[e];t&&(t.destroy(),this._tailLables.splice(e,1))}this._layer.clear()},getLayer:function(){return this._getLayer()}}),l}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(2),o=r(1),i={};i=Object.assign(i,{verify:function(e,t){if(!n.isArray(e))return!1;if(!this._verifyCoordsReg(e))return!1;var r=this.getBbox(t);return this._isCoordWithinBbox(e,r)},getBbox:function(e){var t=[-179.999999,-89.999999],r=[179.999999,89.999999],n=this._transformFromWgs84(t,e);n.toString()==t.toString()&&(n=[-180,-90]);var o=this._transformFromWgs84(r,e);return o.toString()==r.toString()&&(o=[180,90]),n.concat(o)},withinChina:function(e,t){if(!this.verify(e,t))return!1;var r=this._transformToWgs84(e,t);return this._isWithinChinaWgs84(r)},_transformToWgs84:function(e,t){return this._transform(e,t,4326)},_transformFromWgs84:function(e,t){return this._transform(e,4326,t)},_transform:function(e,t,r){var n=new o.sfs.CoordinateTransform,i=new o.sfs.Point({x:e[0],y:e[1]});i.setSpatialReference(t);var a=n.transform(i,r);return[a.x,a.y]},_isWithinChinaWgs84:function(e){for(var t=[[79.4462,42.8899,96.33,49.2204],[109.6872,39.3742,135.0002,54.1415],[73.1246,29.5297,124.143255,42.8899],[82.9684,26.7186,97.0352,29.5297],[97.0253,20.414096,124.367395,29.5297],[107.975793,17.871542,111.744104,20.414096],[108.168592,3.231964,119.373474,20.541749]],r=[[101.8652,20.0988,106.665,22.284],[106.4525,20.4878,108.051,21.5422],[109.0323,50.3257,119.127,55.8175],[127.4568,49.5574,137.0227,55.8175],[131.2662,42.5692,137.0227,44.8922],[125.178223,34.560859,130.209961,39.926588],[128.605957,39.429884,132.077635,41.804078],[131.879881,41.754922,135.703123,44.527843],[131.432559,36.949891,139.350583,42.455887]],n=0;n<t.length;n++){var o=t[n];if(this._isCoordWithinBbox(e,o)){for(var i=0;i<r.length;i++){var a=r[i];if(this._isCoordWithinBbox(e,a))return!1}return!0}}return!1},_isCoordWithinBbox:function(e,t){var r=e[0],n=e[1],o=t[0],i=t[1],a=t[2],s=t[3];return r<=a&&r>=o&&n>=i&&n<=s},_verifyCoordsReg:function(e){for(var t=/^[+-]?[\d]+([\.][\d]+)?([Ee][+-]?[\d]+)?$/,r=!0,o=0;o<e.length;o++){var i=e[o];if(!n.isString(i)&&isNaN(i)){r=!1;break}if(!t.test(i)){r=!1;break}}return r}}),e.exports=i},function(e,t,r){var n=r(453),o=r(454),i={};i=Object.assign(i,{fromKml:function(e){return o.kml(e)},fromGpx:function(e){return o.gpx(e)},fromArcgis:function(e,t){return n.arcgisToGeoJSON(e,t)},toArcgis:function(e,t){return n.geojsonToArcGIS(e,t)}}),e.exports=i},function(e,t,r){var n=r(21),o=r(1),i=r(18),a=n.extend({options:{},initialize:function(e){n.setOptions(this,e);var t="SimpleMarkerSymbol",r={borderColor:{a:200,r:200,g:200,b:200},fillColor:{a:200,r:0,g:100,b:255},borderThickness:1,size:4};this.defaultSymbols={Point:i.object2Symbol(t,r),Polyline:o.sfs.SimpleLineSymbol(),Polygon:o.sfs.SimpleFillSymbol()}},build:function(e){},destroy:function(){}});e.exports=a},function(module,exports,__webpack_require__){var Class=__webpack_require__(21),GeometryUtil=__webpack_require__(12),CoordUtil=__webpack_require__(182),g2=__webpack_require__(1),GeometryBuilder=Class.extend({options:{sourceSr:4326,targetSr:4326,geometryField:["geom"],geometryType:"point"},initialize:function(e){Class.setOptions(this,e),this.projService=new g2.sfs.CoordinateTransform({})},destroy:function(){},getGeometryType:function(){return this.options.geometryType},build:function(e){var t=this._build(e);if(!this.check(t))throw t=null,"无效坐标";return t},check:function(e){var t=this._check(e);return t},_build:function(e){var t=this.options.sourceSr,r=this.options.targetSr,n=this.options.geometryField,o=null;try{if(1==n.length){var i=e[n[0]];try{o="string"==typeof i?g2.sfs.GeometryFactory.createGeometryFromWkt(i,t):g2.sfs.GeometryFactory.createGeometryFromGeoJson(i,t)}catch(e){}}else if(2==n.length){var a,s;a=this._getXyVal(e,n[0]),s=this._getXyVal(e,n[1]),o=new g2.sfs.Point({x:a,y:s,spatialReference:t})}}catch(e){throw e}return t&&r&&t!=r&&(o=this.projService.transform(o,r)),o},_check:function(e){var t=this.options.sourceSr,r=!0;if(e instanceof g2.sfs.Point){var n=GeometryUtil.validateCoordinate(e.x,e.y,t);if(!n)throw r=!1,new Error("无效坐标！");if(!CoordUtil.verify(n,t))throw r=!1,new Error("无效坐标！")}return r},_getXyVal:function _getXyVal(data,field){var val;try{val=field.indexOf(".")<0?data[field]:parseFloat(eval("data."+field))}catch(e){}return val}});module.exports=GeometryBuilder},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"getPageList",value:function(e){}},{key:"getList",value:function(e){}},{key:"getListBatch",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"getDistrict",value:function(e){}},{key:"getSubDistrict",value:function(e){}},{key:"getDistrictByPoint",value:function(e){}},{key:"districtStatistics",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"stat",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"rescueDispatch",value:function(e){}},{key:"materialDispatch",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"getTyphoonsByYear",value:function(e){}},{key:"getTyphoonInfo",value:function(e){}},{key:"getCurrent",value:function(){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"getForecastRealtime",value:function(e){}},{key:"getForecastTimeline",value:function(e){}},{key:"getForecastByTime",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){"use strict";function n(e,t,r,o){this.message=e,this.expected=t,this.found=r,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(n,Error),n.buildMessage=function(e,t){var r={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,o,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(o=e[t],r[o.type](o));if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){t=void 0!==t?t:{};var r,o={},i={start:It},a=It,s=Et("(",!1),l=Et(")",!1),c=Et(";",!1),u=Et("=",!1),f=Et("KEY",!0),h=Et("INDEX",!0),p=Ct("column_clause"),d=function(e,t){return rn(e,t)},y=Et("`",!1),m=function(e,t){var r={type:"expr_list"},n=function(e,t,r){for(var n,o=rn(e,t),i=[],a=0;a<o.length;a++)"param"==(n=o[a]).type?(n.room=r,n.pos=a):i.push(n);return i}(e,t,r);return r.value=n,r},g=function(e,t){return nn(e,t)},v=Et("!",!1),b=Et(">=",!1),_=Et(">",!1),w=Et("<=",!1),S=Et("<>",!1),L=Et("<",!1),x=Et("!=",!1),P=function(e,t){return{op:e,right:t}},E=function(e){return e[0]+" "+e[2]},T=function(e,t){return{op:e,right:t}},C=function(e,t){return{op:e,right:t}},A=Et("+",!1),k=Et("-",!1),R=Et("*",!1),O=Et("/",!1),I=Et("%",!1),M=function(e){return e.paren=!0,e},F=function(e){return!0===on[e.toUpperCase()]},D=/^[^`]/,j=Tt(["`"],!0,!1),G=function(e,t){return e+t.join("")},N=/^[A-Za-z_]/,B=Tt([["A","Z"],["a","z"],"_"],!1,!1),U=/^[A-Za-z0-9_]/,z=Tt([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),W=/^[A-Za-z0-9_:]/,Y=Tt([["A","Z"],["a","z"],["0","9"],"_",":"],!1,!1),q=Ct("PARAM[:param, ?]"),V=Et(":",!1),H=Et("?",!1),J=/^[0-9a-zA-Z_]/,Q=Tt([["0","9"],["a","z"],["A","Z"],"_"],!1,!1),Z=Et('"',!1),X=Et("'",!1),K=/^[^'\\\0-\x1F\x7F]/,$=Tt(["'","\\",["\0",""],""],!0,!1),ee=/^[^"\\\0-\x1F\x7F]/,te=Tt(['"',"\\",["\0",""],""],!0,!1),re=Et("\\'",!1),ne=Et('\\"',!1),oe=Et("\\\\",!1),ie=Et("\\/",!1),ae=Et("\\b",!1),se=Et("\\f",!1),le=Et("\\n",!1),ce=Et("\\r",!1),ue=Et("\\t",!1),fe=Et("\\u",!1),he=(Tt(["\n","\r"],!1,!1),Ct("LITERAL INT")),pe=Et(".",!1),de=Ct("NUMBER"),ye=/^[0-9]/,me=Tt([["0","9"]],!1,!1),ge=/^[1-9]/,ve=Tt([["1","9"]],!1,!1),be=Ct("HEX"),_e=/^[0-9a-fA-F]/,we=Tt([["0","9"],["a","f"],["A","F"]],!1,!1),Se=/^[eE]/,Le=Tt(["e","E"],!1,!1),xe=/^[+\-]/,Pe=Tt(["+","-"],!1,!1),Ee=Et("NULL",!0),Te=Et("TRUE",!0),Ce=Et("FALSE",!0),Ae=(Et("SHOW",!0),Et("DROP",!0),Et("SELECT",!0)),ke=Et("UPDATE",!0),Re=Et("CREATE",!0),Oe=Et("DELETE",!0),Ie=Et("INSERT",!0),Me=Et("REPLACE",!0),Fe=(Et("EXPLAIN",!0),Et("INTO",!0)),De=Et("FROM",!0),je=Et("SET",!0),Ge=Et("AS",!0),Ne=Et("TABLE",!0),Be=Et("ON",!0),Ue=Et("LEFT",!0),ze=Et("INNER",!0),We=Et("JOIN",!0),Ye=Et("UNION",!0),qe=Et("VALUES",!0),Ve=Et("IF",!0),He=Et("EXISTS",!0),Je=Et("WHERE",!0),Qe=Et("GROUP",!0),Ze=Et("BY",!0),Xe=Et("ORDER",!0),Ke=(Et("HAVING",!0),Et("LIMIT",!0)),$e=Et("ASC",!0),et=Et("DESC",!0),tt=Et("ALL",!0),rt=Et("DISTINCT",!0),nt=Et("BETWEEN",!0),ot=Et("IN",!0),it=Et("IS",!0),at=Et("LIKE",!0),st=Et("CONTAINS",!0),lt=Et("NOT",!0),ct=Et("AND",!0),ut=Et("OR",!0),ft=Et("COUNT",!0),ht=(Et("MAX",!0),Et("MIN",!0),Et("SUM",!0),Et("AVG",!0),Et(",",!1)),pt=Et("[",!1),dt=Et("]",!1),yt=Ct("WHITE_SPACE"),mt=/^[ \t\n\r]/,gt=Tt([" ","\t","\n","\r"],!1,!1),vt=(Ct("EOF"),Et("$",!1)),bt=Et("return",!0),_t=Et(":=",!1),wt=0,St=[{line:1,column:1}],Lt=0,xt=[],Pt=0;if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=i[t.startRule]}function Et(e,t){return{type:"literal",text:e,ignoreCase:t}}function Tt(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ct(e){return{type:"other",description:e}}function At(t){var r,n=St[t];if(n)return n;for(r=t-1;!St[r];)r--;for(n={line:(n=St[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return St[t]=n,n}function kt(e,t){var r=At(e),n=At(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Rt(e){wt<Lt||(wt>Lt&&(Lt=wt,xt=[]),xt.push(e))}function Ot(e,t,r){return new n(n.buildMessage(e,t),e,t,r)}function It(){var t,r,n,i;return t=wt,(r=Vr())!==o?((n=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Dt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Ir())!==o&&(s=Vr())!==o&&(l=Dt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Ir())!==o&&(s=Vr())!==o&&(l=Dt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=function(e,t){for(var r=e,n=0;n<t.length;n++)r._next=t[n][3],r=r._next;return e}(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())===o&&(n=function(){var t,r,n,i,a;t=wt,(r=function(){var t,r,n,i;t=wt,"update"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(ke));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&Vr()!==o&&(n=Wt())!==o&&Vr()!==o&&function(){var t,r,n,i;t=wt,"set"===e.substr(wt,3).toLowerCase()?(r=e.substr(wt,3),wt+=3):(r=o,0===Pt&&Rt(je));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(i=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Jt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Jt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Jt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=d(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())!==o&&Vr()!==o&&(a=qt())!==o?(t,l=i,c=a,r={type:"update",db:(s=n).db,table:s.table,set:l,where:c},t=r):(wt=t,t=o);var s,l,c;return t}())===o&&(n=function(){var t,r,n;t=wt,function(){var t,r,n,i;t=wt,"delete"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(Oe));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(r=Nt())!==o&&Vr()!==o?((n=qt())===o&&(n=null),n!==o?(t,t={type:"delete",from:r,where:n}):(wt=t,t=o)):(wt=t,t=o);return t}())===o&&(n=function(){var t,r,n,i,a;t=wt,(r=function(){var t,r;t=wt,(r=function(){var t,r,n,i;t=wt,"insert"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(Ie));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(t,r="insert");(t=r)===o&&(t=wt,(r=function(){var t,r,n,i;t=wt,"replace"===e.substr(wt,7).toLowerCase()?(r=e.substr(wt,7),wt+=7):(r=o,0===Pt&&Rt(Me));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(t,r="replace"),t=r);return t}())!==o&&Vr()!==o&&function(){var t,r,n,i;t=wt,"into"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(Fe));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(n=Wt())!==o&&Vr()!==o&&Yr()!==o&&Vr()!==o&&(i=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=fr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=fr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=fr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=d(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())!==o&&Vr()!==o&&qr()!==o&&Vr()!==o&&(a=function(){var t,r;t=wt,function(){var t,r,n,i;t=wt,"values"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(qe));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(r=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Qt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Qt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Qt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=d(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())!==o?(t,t=r):(wt=t,t=o);return t}())!==o?(t,l=i,c=a,r={type:r,db:(s=n).db,table:s.table,columns:l,values:c},t=r):(wt=t,t=o);var s,l,c;return t}())===o&&(n=function(){var t,r,n,i,a,u,f,h,p,d,y,m,g;t=wt,function(){var t,r,n,i;t=wt,"create"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(Re));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&function(){var t,r,n,i;t=wt,"table"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Ne));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o?(r=wt,(n=function(){var t,r,n,i;t=wt,"if"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(Ve));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(i=Vr())!==o&&(a=Nr())!==o&&(u=Vr())!==o&&(f=function(){var t,r,n,i;t=wt,"exists"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(He));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(h=Vr())!==o?r=n=[n,i,a,u,f,h]:(wt=r,r=o),r===o&&(r=null),r!==o&&(n=Wt())!==o&&(i=Vr())!==o?(40===e.charCodeAt(wt)?(a="(",wt++):(a=o,0===Pt&&Rt(s)),a!==o&&(u=Vr())!==o&&(f=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Mt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Mt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Mt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=rn(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())!==o&&(h=Vr())!==o?(41===e.charCodeAt(wt)?(p=")",wt++):(p=o,0===Pt&&Rt(l)),p!==o&&Vr()!==o?((d=function(){var e,t,r,n,i,a;if(e=wt,(t=Ft())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Ft())!==o?n=i=[i,a]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Ft())!==o?n=i=[i,a]:(wt=n,n=o);r!==o?(e,s=t,r.forEach((function(e){var t=e[1];Object.keys(t).forEach((function(e){s[e]=t[e].column}))})),e=t=s):(wt=e,e=o)}else wt=e,e=o;var s;return e}())===o&&(d=null),d!==o&&Vr()!==o?((y=function(){var e,t,r,n,i,a;if(e=wt,(t=lr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=lr())!==o?n=i=[i,a]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=lr())!==o?n=i=[i,a]:(wt=n,n=o);r!==o?(e,s=[t],r.forEach((function(e){s.push(e)})),e=t=s):(wt=e,e=o)}else wt=e,e=o;var s;return e}())===o&&(y=null),y!==o&&Vr()!==o?(59===e.charCodeAt(wt)?(m=";",wt++):(m=o,0===Pt&&Rt(c)),m===o&&(m=null),m!==o?((g=Vr())===o&&(g=null),g!==o?(t,t={type:"create_table",name:n,columns:f,tableOptions:d,partitionOptions:y}):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o);return t}()),n!==o?(t,(i=n).params=an,t=r=i):(wt=t,t=o)):(wt=t,t=o),t===o&&(t=wt,(r=function(){var e,t;e=[],t=Jr();for(;t!==o;)e.push(t),t=Jr();return e}())!==o&&(t,r=r),t=r),t}function Mt(){var t,r,n,i,a,c,u,p,d,y;if((t=function(){var t,r,n,i,a,c,u,p;t=wt,r=wt,n=wt,i=[],a=pr();for(;a!==o;)i.push(a),a=pr();i!==o&&(a=Vr())!==o?("key"===e.substr(wt,3).toLowerCase()?(c=e.substr(wt,3),wt+=3):(c=o,0===Pt&&Rt(f)),c===o&&("index"===e.substr(wt,5).toLowerCase()?(c=e.substr(wt,5),wt+=5):(c=o,0===Pt&&Rt(h))),c!==o?n=i=[i,a,c]:(wt=n,n=o)):(wt=n,n=o);r=n!==o?e.substring(r,wt):n;r!==o&&(n=Vr())!==o&&(i=fr())!==o&&(a=Vr())!==o?(40===e.charCodeAt(wt)?(c="(",wt++):(c=o,0===Pt&&Rt(s)),c!==o&&(u=jt())!==o?(41===e.charCodeAt(wt)?(p=")",wt++):(p=o,0===Pt&&Rt(l)),p!==o?(t,d=r,y=i,m=[],u.forEach((function(e){m.push(e.expr.column)})),t=r={type:d,name:y,columns:m}):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o);var d,y,m;return t}())===o)if(t=wt,(r=fr())!==o)if(Vr()!==o)if((n=function(){var e,t;e=wt,(t=vr())===o&&(t=ur());t!==o&&(e,t=function(e){if("function"===e.type){var t=[];return e.args.value.forEach((function(e){t.push(e.value)})),{type:e.name,args:t}}return{type:e}}(t));return e=t}())!==o){for(i=[],a=wt,(c=Vr())!==o?((u=br())===o&&(u=pr()),u!==o?a=c=[c,u]:(wt=a,a=o)):(wt=a,a=o);a!==o;)i.push(a),a=wt,(c=Vr())!==o?((u=br())===o&&(u=pr()),u!==o?a=c=[c,u]:(wt=a,a=o)):(wt=a,a=o);i!==o?(t,p=r,d=n,y=[],i.forEach((function(e){y.push(e[1])})),t=r={name:p,type:d,ext:y}):(wt=t,t=o)}else wt=t,t=o;else wt=t,t=o;else wt=t,t=o;return t}function Ft(){var t,r,n,i;return t=wt,(r=lr())!==o&&Vr()!==o?(61===e.charCodeAt(wt)?(n="=",wt++):(n=o,0===Pt&&Rt(u)),n===o&&(n=null),n!==o&&Vr()!==o&&(i=lr())!==o?(t,t=r=function(e,t){var r={},n="column_ref"===e.type?e.column:e.value,o="column_ref"===t.type?t.column:t.value;return r[n]=o,r}(r,i)):(wt=t,t=o)):(wt=t,t=o),t}function Dt(){var t,r,n,i,a,c,u;return(t=function(){var t,r,n,i,a,s,l,c;t=wt,function(){var t,r,n,i;t=wt,"select"===e.substr(wt,6).toLowerCase()?(r=e.substr(wt,6),wt+=6):(r=o,0===Pt&&Rt(Ae));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o?((r=Fr())===o&&(r=null),r!==o&&Vr()!==o&&(n=jt())!==o&&Vr()!==o?((i=Nt())===o&&(i=null),i!==o&&Vr()!==o?((a=qt())===o&&(a=null),a!==o&&Vr()!==o?((s=function(){var t,r;t=wt,function(){var t,r,n,i;t=wt,"group"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Qe));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&Mr()!==o&&Vr()!==o&&(r=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=cr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=cr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=cr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=d(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())!==o?(t,t=r):(wt=t,t=o);return t}())===o&&(s=null),s!==o&&Vr()!==o?((l=function(){var t,r;t=wt,function(){var t,r,n,i;t=wt,"order"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Xe));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&Mr()!==o&&Vr()!==o&&(r=function(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Vt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Vt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Vt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,t=d(t,r),e=t):(wt=e,e=o)}else wt=e,e=o;return e}())!==o?(t,t=r):(wt=t,t=o);return t}())===o&&(l=null),l!==o&&Vr()!==o?((c=function(){var t,r,n,i,a,s;t=wt,function(){var t,r,n,i;t=wt,"limit"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Ke));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(r=Ht())!==o&&Vr()!==o?(n=wt,(i=Wr())!==o&&(a=Vr())!==o&&(s=Ht())!==o?n=i=[i,a,s]:(wt=n,n=o),n===o&&(n=null),n!==o?(t,c=[r],(l=n)?c.push(l[2]):c.unshift({type:"number",value:0}),t=c):(wt=t,t=o)):(wt=t,t=o);var l,c;return t}())===o&&(c=null),c!==o?(t,t={type:"select",distinct:r,columns:n,from:i,where:a,groupby:s,orderby:l,limit:c}):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o);return t}())===o&&(t=wt,r=wt,40===e.charCodeAt(wt)?(n="(",wt++):(n=o,0===Pt&&Rt(s)),n!==o&&(i=Vr())!==o&&(a=Dt())!==o&&(c=Vr())!==o?(41===e.charCodeAt(wt)?(u=")",wt++):(u=o,0===Pt&&Rt(l)),u!==o?r=n=[n,i,a,c,u]:(wt=r,r=o)):(wt=r,r=o),r!==o&&(t,r=r[2]),t=r),t}function jt(){var t,r,n,i,a,s,l,c;if(Pt++,t=wt,(r=function(){var t,r,n,i;t=wt,"all"===e.substr(wt,3).toLowerCase()?(r=e.substr(wt,3),wt+=3):(r=o,0===Pt&&Rt(tt));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="ALL"):(wt=t,t=o)):(wt=t,t=o);return t}())===o&&(r=wt,(n=function(){var t;42===e.charCodeAt(wt)?(t="*",wt++):(t=o,0===Pt&&Rt(R));return t}())!==o?(i=wt,Pt++,a=dr(),Pt--,a===o?i=void 0:(wt=i,i=o),i!==o?r=n=[n,i]:(wt=r,r=o)):(wt=r,r=o)),r!==o&&(t,r="*"),(t=r)===o)if(t=wt,(r=Gt())!==o){for(n=[],i=wt,(a=Vr())!==o&&(s=Wr())!==o&&(l=Vr())!==o&&(c=Gt())!==o?i=a=[a,s,l,c]:(wt=i,i=o);i!==o;)n.push(i),i=wt,(a=Vr())!==o&&(s=Wr())!==o&&(l=Vr())!==o&&(c=Gt())!==o?i=a=[a,s,l,c]:(wt=i,i=o);n!==o?(t,t=r=d(r,n)):(wt=t,t=o)}else wt=t,t=o;return Pt--,t===o&&(r=o,0===Pt&&Rt(p)),t}function Gt(){var e,t,r;return e=wt,(t=or())!==o&&Vr()!==o?((r=function(){var e,t,r;e=wt,(t=Rr())===o&&(t=null);t!==o&&Vr()!==o&&(r=ur())!==o?(e,e=t=r):(wt=e,e=o);return e}())===o&&(r=null),r!==o?(e,e=t={expr:t,as:r}):(wt=e,e=o)):(wt=e,e=o),e}function Nt(){var t,r;return t=wt,function(){var t,r,n,i;t=wt,"from"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(De));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(r=function(){var e,t,r,n;if(e=wt,(t=Ut())!==o){for(r=[],n=Bt();n!==o;)r.push(n),n=Bt();r!==o?(e,i=t,(a=r).unshift(i),e=t=a):(wt=e,e=o)}else wt=e,e=o;var i,a;return e}())!==o?(t,t=r):(wt=t,t=o),t}function Bt(){var e,t,r;return e=wt,Vr()!==o&&(t=Wr())!==o&&Vr()!==o&&(r=Ut())!==o?(e,e=r):(wt=e,e=o),e===o&&(e=wt,Vr()!==o&&(t=function(){var e,t,r,n;e=wt,(t=zt())!==o&&Vr()!==o&&(r=Ut())!==o&&Vr()!==o?((n=Yt())===o&&(n=null),n!==o?(e,i=t,s=n,(a=r).join=i,a.on=s,e=t=a):(wt=e,e=o)):(wt=e,e=o);var i,a,s;return e}())!==o?(e,e=t):(wt=e,e=o)),e}function Ut(){var e,t,r,n,i,a;return e=wt,(t=Wt())!==o&&Vr()!==o?((r=Rr())===o&&(r=null),r!==o&&Vr()!==o?((n=ur())===o&&(n=null),n!==o?(e,a=n,e=t="var"==(i=t).type?(i.as=a,i):{db:i.db,table:i.table,as:a}):(wt=e,e=o)):(wt=e,e=o)):(wt=e,e=o),e}function zt(){var t,r,n,i;return t=wt,(r=function(){var t,r,n,i;t=wt,"left"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(Ue));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(n=Vr())!==o&&(i=Or())!==o?(t,t=r="LEFT JOIN"):(wt=t,t=o),t===o&&(t=wt,r=wt,(n=function(){var t,r,n,i;t=wt,"inner"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(ze));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(i=Vr())!==o?r=n=[n,i]:(wt=r,r=o),r===o&&(r=null),r!==o&&(n=Or())!==o?(t,t=r="INNER JOIN"):(wt=t,t=o)),t}function Wt(){var t,r,n,i,a,s,l,c,u;return t=wt,96===e.charCodeAt(wt)?(r="`",wt++):(r=o,0===Pt&&Rt(y)),r===o&&(r=null),r!==o&&(n=ur())!==o?(i=wt,(a=Vr())!==o&&(s=zr())!==o&&(l=Vr())!==o&&(c=pr())!==o?i=a=[a,s,l,c]:(wt=i,i=o),i===o&&(i=null),i!==o?(96===e.charCodeAt(wt)?(a="`",wt++):(a=o,0===Pt&&Rt(y)),a===o&&(a=null),a!==o?(t,t=r=function(e,t){var r={db:"",table:e};return t&&(r.db=e,r.table=t[3]),r}(n,i)):(wt=t,t=o)):(wt=t,t=o)):(wt=t,t=o),t===o&&(t=wt,(r=en())!==o&&(t,(u=r).db="",u.table=u.name,r=u),t=r),t}function Yt(){var t,r;return t=wt,function(){var t,r,n,i;t=wt,"on"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(Be));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(r=Xt())!==o?(t,t=r):(wt=t,t=o),t}function qt(){var t,r;return t=wt,function(){var t,r,n,i;t=wt,"where"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Je));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}()!==o&&Vr()!==o&&(r=Xt())!==o?(t,t=r):(wt=t,t=o),t}function Vt(){var t,r,n;return t=wt,(r=Xt())!==o&&Vr()!==o?((n=function(){var t,r,n,i;t=wt,"desc"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(et));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="DESC"):(wt=t,t=o)):(wt=t,t=o);return t}())===o&&(n=function(){var t,r,n,i;t=wt,"asc"===e.substr(wt,3).toLowerCase()?(r=e.substr(wt,3),wt+=3):(r=o,0===Pt&&Rt($e));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="ASC"):(wt=t,t=o)):(wt=t,t=o);return t}()),n===o&&(n=null),n!==o?(t,t=r=function(e,t){var r={expr:e,type:"ASC"};return"DESC"==t&&(r.type="DESC"),r}(r,n)):(wt=t,t=o)):(wt=t,t=o),t}function Ht(){var e;return(e=function(){var e,t;Pt++,e=wt,(t=xr())!==o&&(e,t={type:"number",value:t});Pt--,(e=t)===o&&(t=o,0===Pt&&Rt(he));return e}())===o&&(e=gr()),e}function Jt(){var t,r,n,i;return t=wt,(r=hr())!==o&&Vr()!==o?(61===e.charCodeAt(wt)?(n="=",wt++):(n=o,0===Pt&&Rt(u)),n!==o&&Vr()!==o&&(i=or())!==o?(t,t=r={column:r,value:i}):(wt=t,t=o)):(wt=t,t=o),t}function Qt(){var e,t;return e=wt,Yr()!==o&&Vr()!==o&&(t=Zt())!==o&&Vr()!==o&&qr()!==o?(e,e=t):(wt=e,e=o),e}function Zt(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Xt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Xt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Xt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=m(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function Xt(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Kt())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Ur())!==o&&(s=Vr())!==o&&(l=Kt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Ur())!==o&&(s=Vr())!==o&&(l=Kt())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=g(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function Kt(){var e,t,r,n,i,a,s,l;if(e=wt,(t=$t())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Br())!==o&&(s=Vr())!==o&&(l=$t())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Br())!==o&&(s=Vr())!==o&&(l=$t())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=g(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function $t(){var t,r,n,i,a;return t=wt,(r=Nr())===o&&(r=wt,33===e.charCodeAt(wt)?(n="!",wt++):(n=o,0===Pt&&Rt(v)),n!==o?(i=wt,Pt++,61===e.charCodeAt(wt)?(a="=",wt++):(a=o,0===Pt&&Rt(u)),Pt--,a===o?i=void 0:(wt=i,i=o),i!==o?r=n=[n,i]:(wt=r,r=o)):(wt=r,r=o)),r!==o&&(n=Vr())!==o&&(i=$t())!==o?(t,t=r={type:"unary_expr",operator:"NOT",expr:i}):(wt=t,t=o),t===o&&(t=er()),t}function er(){var t,r,n;return t=wt,(r=or())!==o&&Vr()!==o?((n=function(){var t;(t=function(){var e,t,r,n,i,a,s;e=wt,t=[],r=wt,(n=Vr())!==o&&(i=tr())!==o&&(a=Vr())!==o&&(s=or())!==o?r=n=[n,i,a,s]:(wt=r,r=o);if(r!==o)for(;r!==o;)t.push(r),r=wt,(n=Vr())!==o&&(i=tr())!==o&&(a=Vr())!==o&&(s=or())!==o?r=n=[n,i,a,s]:(wt=r,r=o);else t=o;t!==o&&(e,t={type:"arithmetic",tail:t});return e=t}())===o&&(t=function(){var e,t,r,n;e=wt,(t=rr())!==o&&Vr()!==o&&(r=Yr())!==o&&Vr()!==o&&(n=Zt())!==o&&Vr()!==o&&qr()!==o?(e,t=T(t,n),e=t):(wt=e,e=o);e===o&&(e=wt,(t=rr())!==o&&Vr()!==o&&(r=en())!==o?(e,t=C(t,r),e=t):(wt=e,e=o));return e}())===o&&(t=function(){var t,r,n,i;t=wt,(r=function(){var t,r,n,i;t=wt,"between"===e.substr(wt,7).toLowerCase()?(r=e.substr(wt,7),wt+=7):(r=o,0===Pt&&Rt(nt));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="BETWEEN"):(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&Vr()!==o&&(n=or())!==o&&Vr()!==o&&Br()!==o&&Vr()!==o&&(i=or())!==o?(t,t=r={op:r,right:{type:"expr_list",value:[n,i]}}):(wt=t,t=o);return t}())===o&&(t=function(){var t,r,n;t=wt,(r=function(){var t,r,n,i;t=wt,"is"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(it));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="IS"):(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&Vr()!==o&&(n=or())!==o?(t,r=P(r,n),t=r):(wt=t,t=o);return t}())===o&&(t=function(){var e,t,r;e=wt,(t=function(){var e,t,r,n,i;e=wt,t=wt,(r=Nr())!==o&&(n=Vr())!==o&&(i=jr())!==o?t=r=[r,n,i]:(wt=t,t=o);t!==o&&(e,t=E(t));(e=t)===o&&(e=jr());return e}())!==o&&Vr()!==o&&(r=er())!==o?(e,t=P(t,r),e=t):(wt=e,e=o);return e}())===o&&(t=function(){var e,t,r,n;e=wt,(t=nr())!==o&&Vr()!==o&&(r=Yr())!==o&&Vr()!==o&&(n=Zt())!==o&&Vr()!==o&&qr()!==o?(e,t=T(t,n),e=t):(wt=e,e=o);e===o&&(e=wt,(t=nr())!==o&&Vr()!==o&&(r=en())!==o?(e,t=C(t,r),e=t):(wt=e,e=o));return e}());return t}())===o&&(n=null),n!==o?(t,t=r=function(e,t){if(t){return"arithmetic"==t.type?nn(e,t.tail):tn(t.op,e,t.right)}return e}(r,n)):(wt=t,t=o)):(wt=t,t=o),t}function tr(){var t;return">="===e.substr(wt,2)?(t=">=",wt+=2):(t=o,0===Pt&&Rt(b)),t===o&&(62===e.charCodeAt(wt)?(t=">",wt++):(t=o,0===Pt&&Rt(_)),t===o&&("<="===e.substr(wt,2)?(t="<=",wt+=2):(t=o,0===Pt&&Rt(w)),t===o&&("<>"===e.substr(wt,2)?(t="<>",wt+=2):(t=o,0===Pt&&Rt(S)),t===o&&(60===e.charCodeAt(wt)?(t="<",wt++):(t=o,0===Pt&&Rt(L)),t===o&&(61===e.charCodeAt(wt)?(t="=",wt++):(t=o,0===Pt&&Rt(u)),t===o&&("!="===e.substr(wt,2)?(t="!=",wt+=2):(t=o,0===Pt&&Rt(x)))))))),t}function rr(){var e,t,r,n,i;return e=wt,t=wt,(r=Nr())!==o&&(n=Vr())!==o&&(i=Dr())!==o?t=r=[r,n,i]:(wt=t,t=o),t!==o&&(e,t=E(t)),(e=t)===o&&(e=Dr()),e}function nr(){var e,t,r,n,i;return e=wt,t=wt,(r=Nr())!==o&&(n=Vr())!==o&&(i=Gr())!==o?t=r=[r,n,i]:(wt=t,t=o),t!==o&&(e,t=E(t)),(e=t)===o&&(e=Gr()),e}function or(){var e,t,r,n,i,a,s,l;if(e=wt,(t=ar())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=ir())!==o&&(s=Vr())!==o&&(l=ar())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=ir())!==o&&(s=Vr())!==o&&(l=ar())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=g(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function ir(){var t;return 43===e.charCodeAt(wt)?(t="+",wt++):(t=o,0===Pt&&Rt(A)),t===o&&(45===e.charCodeAt(wt)?(t="-",wt++):(t=o,0===Pt&&Rt(k))),t}function ar(){var e,t,r,n,i,a,s,l;if(e=wt,(t=lr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=sr())!==o&&(s=Vr())!==o&&(l=lr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=sr())!==o&&(s=Vr())!==o&&(l=lr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=nn(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function sr(){var t;return 42===e.charCodeAt(wt)?(t="*",wt++):(t=o,0===Pt&&Rt(R)),t===o&&(47===e.charCodeAt(wt)?(t="/",wt++):(t=o,0===Pt&&Rt(O)),t===o&&(37===e.charCodeAt(wt)?(t="%",wt++):(t=o,0===Pt&&Rt(I)))),t}function lr(){var t,r;return(t=br())===o&&(t=function(){var t;(t=function(){var t,r,n;t=wt,(r=function(){var t,r,n,i;t=wt,"count"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(ft));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="COUNT"):(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&Vr()!==o&&Yr()!==o&&Vr()!==o&&(n=function(){var t,r,n;t=wt,(r=function(){var t,r;t=wt,42===e.charCodeAt(wt)?(r="*",wt++):(r=o,0===Pt&&Rt(R));r!==o&&(t,r={type:"star",value:"*"});return t=r}())!==o&&(t,r={expr:r});(t=r)===o&&(t=wt,(r=Fr())===o&&(r=null),r!==o&&Vr()!==o&&(n=cr())!==o?(t,t=r={distinct:r,expr:n}):(wt=t,t=o));return t}())!==o&&Vr()!==o&&qr()!==o?(t,t=r={type:"aggr_func",name:r,args:n}):(wt=t,t=o);return t}())===o&&(t=function(){var t,r,n;t=wt,(r=function(){var t,r,n;t=wt,r=[],J.test(e.charAt(wt))?(n=e.charAt(wt),wt++):(n=o,0===Pt&&Rt(Q));if(n!==o)for(;n!==o;)r.push(n),J.test(e.charAt(wt))?(n=e.charAt(wt),wt++):(n=o,0===Pt&&Rt(Q));else r=o;r!==o&&(t,r=r.join(""));return t=r}())!==o&&Vr()!==o&&Yr()!==o&&Vr()!==o&&(n=or())!==o&&Vr()!==o&&qr()!==o?(t,t=r={type:"aggr_func",name:r,args:{expr:n}}):(wt=t,t=o);return t}());return t}())===o&&(t=vr())===o&&(t=cr())===o&&(t=gr())===o&&(t=wt,Yr()!==o&&Vr()!==o&&(r=Xt())!==o&&Vr()!==o&&qr()!==o?(t,t=M(r)):(wt=t,t=o),t===o&&(t=en())),t}function cr(){var e,t,r;return e=wt,(t=ur())!==o&&Vr()!==o&&zr()!==o&&Vr()!==o&&(r=fr())!==o?(e,e=t={type:"column_ref",table:t,column:r}):(wt=e,e=o),e===o&&(e=wt,(t=fr())!==o&&(e,t=function(e){return{type:"column_ref",table:"",column:e}}(t)),e=t),e}function ur(){var e,t;return e=wt,(t=pr())!==o?(wt,(F(t)?o:void 0)!==o?(e,e=t=t):(wt=e,e=o)):(wt=e,e=o),e}function fr(){var t,r,n,i;if(t=wt,(r=hr())!==o?(wt,(n=(n=F(r))?o:void 0)!==o?(t,t=r=r):(wt=t,t=o)):(wt=t,t=o),t===o)if(t=wt,96===e.charCodeAt(wt)?(r="`",wt++):(r=o,0===Pt&&Rt(y)),r!==o){if(n=[],D.test(e.charAt(wt))?(i=e.charAt(wt),wt++):(i=o,0===Pt&&Rt(j)),i!==o)for(;i!==o;)n.push(i),D.test(e.charAt(wt))?(i=e.charAt(wt),wt++):(i=o,0===Pt&&Rt(j));else n=o;n!==o?(96===e.charCodeAt(wt)?(i="`",wt++):(i=o,0===Pt&&Rt(y)),i!==o?(t,t=r=n.join("")):(wt=t,t=o)):(wt=t,t=o)}else wt=t,t=o;return t}function hr(){var e,t,r,n;if(e=wt,(t=dr())!==o){for(r=[],n=mr();n!==o;)r.push(n),n=mr();r!==o?(e,e=t=G(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function pr(){var e,t,r,n;if(e=wt,(t=dr())!==o){for(r=[],n=yr();n!==o;)r.push(n),n=yr();r!==o?(e,e=t=G(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function dr(){var t;return N.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(B)),t}function yr(){var t;return U.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(z)),t}function mr(){var t;return W.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(Y)),t}function gr(){var t,r,n,i,a;return Pt++,t=wt,58===e.charCodeAt(wt)?(r=":",wt++):(r=o,0===Pt&&Rt(V)),r!==o&&(n=pr())!==o?t=r=[r,n]:(wt=t,t=o),t===o&&(t=wt,63===e.charCodeAt(wt)?(r="?",wt++):(r=o,0===Pt&&Rt(H)),r!==o&&(t,a={type:"param",value:(i=r).length>1?i[1]:i[0]},an.push(a),r=a),t=r),Pt--,t===o&&(r=o,0===Pt&&Rt(q)),t}function vr(){var e,t,r;return e=wt,(t=ur())!==o&&Vr()!==o&&Yr()!==o&&Vr()!==o&&(r=function(){var e,t;return(e=Zt())===o&&(e=wt,(t="")!==o&&(e,t={type:"expr_list",value:[]}),e=t),e}())!==o&&Vr()!==o&&qr()!==o?(e,e=t={type:"function",name:t,args:r}):(wt=e,e=o),e}function br(){var t;return(t=function(){var t,r,n,i,a;t=wt,r=wt,34===e.charCodeAt(wt)?(n='"',wt++):(n=o,0===Pt&&Rt(Z));if(n!==o){for(i=[],a=wr();a!==o;)i.push(a),a=wr();i!==o?(34===e.charCodeAt(wt)?(a='"',wt++):(a=o,0===Pt&&Rt(Z)),a!==o?r=n=[n,i,a]:(wt=r,r=o)):(wt=r,r=o)}else wt=r,r=o;if(r===o)if(r=wt,39===e.charCodeAt(wt)?(n="'",wt++):(n=o,0===Pt&&Rt(X)),n!==o){for(i=[],a=_r();a!==o;)i.push(a),a=_r();i!==o?(39===e.charCodeAt(wt)?(a="'",wt++):(a=o,0===Pt&&Rt(X)),a!==o?r=n=[n,i,a]:(wt=r,r=o)):(wt=r,r=o)}else wt=r,r=o;r!==o&&(t,r={type:"string",value:r[1].join("")});return t=r}())===o&&(t=Lr())===o&&(t=function(){var t,r;t=wt,(r=function(){var t,r,n,i;t=wt,"true"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(Te));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(t,r={type:"bool",value:!0});(t=r)===o&&(t=wt,(r=function(){var t,r,n,i;t=wt,"false"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Ce));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(t,r={type:"bool",value:!1}),t=r);return t}())===o&&(t=function(){var t,r;t=wt,(r=function(){var t,r,n,i;t=wt,"null"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(Ee));r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(t,r={type:"null",value:null});return t=r}()),t}function _r(){var t;return K.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt($)),t===o&&(t=Sr()),t}function wr(){var t;return ee.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(te)),t===o&&(t=Sr()),t}function Sr(){var t,r,n,i,a,s,l,c,u,f;return t=wt,"\\'"===e.substr(wt,2)?(r="\\'",wt+=2):(r=o,0===Pt&&Rt(re)),r!==o&&(t,r="'"),(t=r)===o&&(t=wt,'\\"'===e.substr(wt,2)?(r='\\"',wt+=2):(r=o,0===Pt&&Rt(ne)),r!==o&&(t,r='"'),(t=r)===o&&(t=wt,"\\\\"===e.substr(wt,2)?(r="\\\\",wt+=2):(r=o,0===Pt&&Rt(oe)),r!==o&&(t,r="\\"),(t=r)===o&&(t=wt,"\\/"===e.substr(wt,2)?(r="\\/",wt+=2):(r=o,0===Pt&&Rt(ie)),r!==o&&(t,r="/"),(t=r)===o&&(t=wt,"\\b"===e.substr(wt,2)?(r="\\b",wt+=2):(r=o,0===Pt&&Rt(ae)),r!==o&&(t,r="\b"),(t=r)===o&&(t=wt,"\\f"===e.substr(wt,2)?(r="\\f",wt+=2):(r=o,0===Pt&&Rt(se)),r!==o&&(t,r="\f"),(t=r)===o&&(t=wt,"\\n"===e.substr(wt,2)?(r="\\n",wt+=2):(r=o,0===Pt&&Rt(le)),r!==o&&(t,r="\n"),(t=r)===o&&(t=wt,"\\r"===e.substr(wt,2)?(r="\\r",wt+=2):(r=o,0===Pt&&Rt(ce)),r!==o&&(t,r="\r"),(t=r)===o&&(t=wt,"\\t"===e.substr(wt,2)?(r="\\t",wt+=2):(r=o,0===Pt&&Rt(ue)),r!==o&&(t,r="\t"),(t=r)===o&&(t=wt,"\\u"===e.substr(wt,2)?(r="\\u",wt+=2):(r=o,0===Pt&&Rt(fe)),r!==o&&(n=kr())!==o&&(i=kr())!==o&&(a=kr())!==o&&(s=kr())!==o?(t,l=n,c=i,u=a,f=s,t=r=String.fromCharCode(parseInt("0x"+l+c+u+f))):(wt=t,t=o)))))))))),t}function Lr(){var e,t;return e=wt,(t=function(){var e,t,r,n;e=wt,(t=xr())!==o&&(r=Pr())!==o&&(n=Er())!==o&&Vr()!==o?(e,t=function(e,t,r){var n=parseFloat(e+t+r);return n%1!=0?n.toString():n.toString()+".0"}(t,r,n),e=t):(wt=e,e=o);e===o&&(e=wt,(t=xr())!==o&&(r=Pr())!==o&&(n=Vr())!==o?(e,t=function(e,t){var r=parseFloat(e+t);return r%1!=0?r.toString():r.toString()+".0"}(t,r),e=t):(wt=e,e=o),e===o&&(e=wt,(t=xr())!==o&&(r=Er())!==o&&(n=Vr())!==o?(e,t=parseFloat(t+r).toString(),e=t):(wt=e,e=o),e===o&&(e=wt,(t=xr())!==o&&(r=Vr())!==o?(e,t=function(e){return parseFloat(e).toString()}(t),e=t):(wt=e,e=o))));return e}())!==o&&(e,t={type:"number",value:t}),e=t}function xr(){var t,r,n,i;return t=wt,(r=Ar())!==o&&(n=Tr())!==o?(t,t=r=r+n):(wt=t,t=o),t===o&&(t=Cr())===o&&(t=wt,45===e.charCodeAt(wt)?(r="-",wt++):(r=o,0===Pt&&Rt(k)),r===o&&(43===e.charCodeAt(wt)?(r="+",wt++):(r=o,0===Pt&&Rt(A))),r!==o&&(n=Ar())!==o&&(i=Tr())!==o?(t,t=r=function(e,t,r){return"-"+t+r}(0,n,i)):(wt=t,t=o),t===o&&(t=wt,45===e.charCodeAt(wt)?(r="-",wt++):(r=o,0===Pt&&Rt(k)),r===o&&(43===e.charCodeAt(wt)?(r="+",wt++):(r=o,0===Pt&&Rt(A))),r!==o&&(n=Cr())!==o?(t,t=r="-"+n):(wt=t,t=o))),t}function Pr(){var t,r,n;return t=wt,46===e.charCodeAt(wt)?(r=".",wt++):(r=o,0===Pt&&Rt(pe)),r!==o&&(n=Tr())!==o?(t,t=r="."+n):(wt=t,t=o),t}function Er(){var t,r,n;return t=wt,(r=function(){var t,r,n;t=wt,Se.test(e.charAt(wt))?(r=e.charAt(wt),wt++):(r=o,0===Pt&&Rt(Le));r!==o?(xe.test(e.charAt(wt))?(n=e.charAt(wt),wt++):(n=o,0===Pt&&Rt(Pe)),n===o&&(n=null),n!==o?(t,t=r=r+n):(wt=t,t=o)):(wt=t,t=o);return t}())!==o&&(n=Tr())!==o?(t,t=r=r+n):(wt=t,t=o),t}function Tr(){var e,t,r;if(e=wt,t=[],(r=Cr())!==o)for(;r!==o;)t.push(r),r=Cr();else t=o;return t!==o&&(e,t=t.join("")),e=t}function Cr(){var t;return Pt++,ye.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(me)),Pt--,t===o&&(o,0===Pt&&Rt(de)),t}function Ar(){var t;return Pt++,ge.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(ve)),Pt--,t===o&&(o,0===Pt&&Rt(de)),t}function kr(){var t;return Pt++,_e.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(we)),Pt--,t===o&&(o,0===Pt&&Rt(be)),t}function Rr(){var t,r,n,i;return t=wt,"as"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(Ge)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o),t}function Or(){var t,r,n,i;return t=wt,"join"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(We)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o),t}function Ir(){var t,r,n,i;return t=wt,"union"===e.substr(wt,5).toLowerCase()?(r=e.substr(wt,5),wt+=5):(r=o,0===Pt&&Rt(Ye)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o),t}function Mr(){var t,r,n,i;return t=wt,"by"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(Ze)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?t=r=[r,n]:(wt=t,t=o)):(wt=t,t=o),t}function Fr(){var t,r,n,i;return t=wt,"distinct"===e.substr(wt,8).toLowerCase()?(r=e.substr(wt,8),wt+=8):(r=o,0===Pt&&Rt(rt)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="DISTINCT"):(wt=t,t=o)):(wt=t,t=o),t}function Dr(){var t,r,n,i;return t=wt,"in"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(ot)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="IN"):(wt=t,t=o)):(wt=t,t=o),t}function jr(){var t,r,n,i;return t=wt,"like"===e.substr(wt,4).toLowerCase()?(r=e.substr(wt,4),wt+=4):(r=o,0===Pt&&Rt(at)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="LIKE"):(wt=t,t=o)):(wt=t,t=o),t}function Gr(){var t,r,n,i;return t=wt,"contains"===e.substr(wt,8).toLowerCase()?(r=e.substr(wt,8),wt+=8):(r=o,0===Pt&&Rt(st)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="CONTAINS"):(wt=t,t=o)):(wt=t,t=o),t}function Nr(){var t,r,n,i;return t=wt,"not"===e.substr(wt,3).toLowerCase()?(r=e.substr(wt,3),wt+=3):(r=o,0===Pt&&Rt(lt)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="NOT"):(wt=t,t=o)):(wt=t,t=o),t}function Br(){var t,r,n,i;return t=wt,"and"===e.substr(wt,3).toLowerCase()?(r=e.substr(wt,3),wt+=3):(r=o,0===Pt&&Rt(ct)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="AND"):(wt=t,t=o)):(wt=t,t=o),t}function Ur(){var t,r,n,i;return t=wt,"or"===e.substr(wt,2).toLowerCase()?(r=e.substr(wt,2),wt+=2):(r=o,0===Pt&&Rt(ut)),r!==o?(n=wt,Pt++,i=dr(),Pt--,i===o?n=void 0:(wt=n,n=o),n!==o?(t,t=r="OR"):(wt=t,t=o)):(wt=t,t=o),t}function zr(){var t;return 46===e.charCodeAt(wt)?(t=".",wt++):(t=o,0===Pt&&Rt(pe)),t}function Wr(){var t;return 44===e.charCodeAt(wt)?(t=",",wt++):(t=o,0===Pt&&Rt(ht)),t}function Yr(){var t;return 40===e.charCodeAt(wt)?(t="(",wt++):(t=o,0===Pt&&Rt(s)),t}function qr(){var t;return 41===e.charCodeAt(wt)?(t=")",wt++):(t=o,0===Pt&&Rt(l)),t}function Vr(){var e,t;for(e=[],t=Hr();t!==o;)e.push(t),t=Hr();return e}function Hr(){var t;return Pt++,mt.test(e.charAt(wt))?(t=e.charAt(wt),wt++):(t=o,0===Pt&&Rt(gt)),Pt--,t===o&&(o,0===Pt&&Rt(yt)),t}function Jr(){var t,r,n,i;return t=wt,r=wt,Pt++,n=function(){var e,t;e=wt,(t="")!==o&&(e,sn=[],t=!0);return e=t}(),Pt--,n!==o?(wt=r,r=void 0):r=o,r!==o&&(n=Vr())!==o?((i=function(){var t,r,n;t=wt,(r=en())!==o&&Vr()!==o&&function(){var t;":="===e.substr(wt,2)?(t=":=",wt+=2):(t=o,0===Pt&&Rt(_t));return t}()!==o&&Vr()!==o&&(n=Qr())!==o?(t,t=r={type:"assign",left:r,right:n}):(wt=t,t=o);return t}())===o&&(i=function(){var t,r;t=wt,function(){var t;"return"===e.substr(wt,6).toLowerCase()?(t=e.substr(wt,6),wt+=6):(t=o,0===Pt&&Rt(bt));return t}()!==o&&Vr()!==o&&(r=Qr())!==o?(t,t={type:"return",expr:r}):(wt=t,t=o);return t}()),i!==o?(t,t=r={stmt:i,vars:sn}):(wt=t,t=o)):(wt=t,t=o),t}function Qr(){var t;return(t=Dt())===o&&(t=function(){var e,t,r,n,i;e=wt,(t=en())!==o&&Vr()!==o&&(r=zt())!==o&&Vr()!==o&&(n=en())!==o&&Vr()!==o&&(i=Yt())!==o?(e,e=t={type:"join",ltable:t,rtable:n,op:r,on:i}):(wt=e,e=o);return e}())===o&&(t=Zr())===o&&(t=function(){var t,r;t=wt,function(){var t;return 91===e.charCodeAt(wt)?(t="[",wt++):(t=o,0===Pt&&Rt(pt)),t}()!==o&&Vr()!==o&&(r=$r())!==o&&Vr()!==o&&function(){var t;return 93===e.charCodeAt(wt)?(t="]",wt++):(t=o,0===Pt&&Rt(dt)),t}()!==o?(t,t={type:"array",value:r}):(wt=t,t=o);return t}()),t}function Zr(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Xr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=ir())!==o&&(s=Vr())!==o&&(l=Xr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=ir())!==o&&(s=Vr())!==o&&(l=Xr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=g(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function Xr(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Kr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=sr())!==o&&(s=Vr())!==o&&(l=Kr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=sr())!==o&&(s=Vr())!==o&&(l=Kr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=g(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function Kr(){var e,t;return(e=br())===o&&(e=en())===o&&(e=function(){var e,t,r;e=wt,(t=ur())!==o&&Vr()!==o&&Yr()!==o&&Vr()!==o&&(r=$r())!==o&&Vr()!==o&&qr()!==o?(e,e=t={type:"function",name:t,args:{type:"expr_list",value:r}}):(wt=e,e=o);return e}())===o&&(e=gr())===o&&(e=wt,Yr()!==o&&Vr()!==o&&(t=Zr())!==o&&Vr()!==o&&qr()!==o?(e,e=M(t)):(wt=e,e=o)),e}function $r(){var e,t,r,n,i,a,s,l;if(e=wt,(t=Kr())!==o){for(r=[],n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Kr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);n!==o;)r.push(n),n=wt,(i=Vr())!==o&&(a=Wr())!==o&&(s=Vr())!==o&&(l=Kr())!==o?n=i=[i,a,s,l]:(wt=n,n=o);r!==o?(e,e=t=d(t,r)):(wt=e,e=o)}else wt=e,e=o;return e}function en(){var t,r,n,i,a;return t=wt,function(){var t;36===e.charCodeAt(wt)?(t="$",wt++):(t=o,0===Pt&&Rt(vt));return t}()!==o&&(r=pr())!==o&&(n=function(){var t,r,n,i,a;t=wt,r=[],n=wt,46===e.charCodeAt(wt)?(i=".",wt++):(i=o,0===Pt&&Rt(pe));i!==o&&(a=pr())!==o?n=i=[i,a]:(wt=n,n=o);for(;n!==o;)r.push(n),n=wt,46===e.charCodeAt(wt)?(i=".",wt++):(i=o,0===Pt&&Rt(pe)),i!==o&&(a=pr())!==o?n=i=[i,a]:(wt=n,n=o);r!==o&&(t,r=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r][1]);return t}(r));return t=r}())!==o?(t,i=r,a=n,sn.push(i),t={type:"var",name:i,members:a}):(wt=t,t=o),t}function tn(e,t,r){return{type:"binary_expr",operator:e,left:t,right:r}}function rn(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}function nn(e,t){for(var r=e,n=0;n<t.length;n++)r=tn(t[n][1],r,t[n][3]);return r}var on={SHOW:!0,DROP:!0,SELECT:!0,UPDATE:!0,CREATE:!0,DELETE:!0,INSERT:!0,REPLACE:!0,EXPLAIN:!0,ALL:!0,DISTINCT:!0,AS:!0,TABLE:!0,INTO:!0,FROM:!0,SET:!0,LEFT:!0,ON:!0,INNER:!0,JOIN:!0,UNION:!0,VALUES:!0,EXISTS:!0,WHERE:!0,GROUP:!0,BY:!0,HAVING:!0,ORDER:!0,ASC:!0,DESC:!0,LIMIT:!0,BETWEEN:!0,IN:!0,IS:!0,LIKE:!0,CONTAINS:!0,NOT:!0,AND:!0,OR:!0,TRUE:!0,FALSE:!0,NULL:!0},an=[],sn=[];if((r=a())!==o&&wt===e.length)return r;throw r!==o&&wt<e.length&&Rt({type:"end"}),Ot(xt,Lt<e.length?e.charAt(Lt):null,Lt<e.length?kt(Lt,Lt+1):kt(Lt,Lt))}}},function(e,t){var r={"\0":"\\0","'":"\\'",'"':'\\"',"\b":"\\b","\n":"\\n","\r":"\\r","\t":"\\t","":"\\Z","\\":"\\\\"};function n(e){var t=e.type,n=e.value;return"string"===t?n="'"+function(e){for(var t,n,o=[],i=0;i<e.length;i++)t=e[i],(n=r[t])&&(t=n),o.push(t);return o.join("")}(n)+"'":"bool"===t?n=n?"TRUE":"FALSE":"null"===t?n="NULL":"star"===t&&(n="*"),e.paren?"("+n+")":n}function o(e){for(var t=[],r=0;r<e.length;r++)t.push(i(e[r]));return t}function i(e){var t;switch(e.type){case"unary_expr":t=function(e){var t=e.operator+" "+i(e.expr);return e.paren?"("+t+")":t}(e);break;case"binary_expr":t=function(e){var t=e.operator,r=e.left,n=e.right,o=i(r),a=i(n);Array.isArray(a)&&("="===t&&(t="IN"),a="BETWEEN"===t?a[0]+" AND "+a[1]:"("+a.join(", ")+")");var s=o+" "+t+" "+a;return e.paren?"("+s+")":s}(e);break;case"aggr_func":t=function(e){var t=e.args,r=i(t.expr),n=e.name;return"COUNT"===n&&t.distinct&&(r="DISTINCT "+r),n+"("+r+")"}(e);break;case"function":t=function(e){var t=i(e.args),r=e.name+"("+t.join(", ")+")";return e.paren?"("+r+")":r}(e);break;case"column_ref":t=function(e){var t=e.column;return e.table&&(t=e.table+"."+t),e.paren?"("+t+")":t}(e);break;case"expr_list":t=o(e.value);break;case"var":throw new Error("unsupported type `var`");case"param":t=function(e){return"?"===e.value?"?":":"+e.value}(e);break;default:t=n(e)}return t}function a(e,t){var r,n,a=e.distinct,s=e.columns,l=e.from,c=e.where,u=e.groupby,f=e.orderby,h=e.limit,p=[];if(t=t||{},p.push("SELECT"),a&&p.push(a),"*"===s)p.push("*");else{for(n=[],v=0;v<s.length;v++){var d=s[v];r=i(d.expr),d.as&&(r+=" AS "+d.as),n.push(r)}p.push(n.join(", "))}if(Array.isArray(l)){var y=l[0];for(p.push("FROM"),n=[],r=y.table,!1!==t.keep_db&&y.db&&(r=y.db+"."+r),y.as&&(r+=" AS "+y.as),n.push(r),v=1;v<l.length;v++){var m=l[v];r=m.join?" "+m.join+" ":", ",!1!==t.keep_db&&m.db&&(r+=m.db+"."),r+=m.table,m.as&&(r+=" AS "+m.as),m.on&&(r+=" ON "+i(m.on)),n.push(r)}p.push(n.join(""))}if(c&&p.push("WHERE "+i(c)),Array.isArray(u)){var g=o(u);p.push("GROUP BY "+g.join(", "))}if(Array.isArray(f)){n=[];for(var v=0;v<f.length;v++){var b=f[v];r=i(b.expr),r+=" "+b.type,n.push(r)}p.push("ORDER BY "+n.join(", "))}return Array.isArray(h)&&(r=!1!==t.offset?"LIMIT "+h[0].value+", "+h[1].value:"LIMIT "+(h[0].value+h[1].value),p.push(r)),p.join(" ")}e.exports=function(e,t){var r,n={keep_db:!0,offset:!1};for(var o in t)n[o]=t[o];switch(e.type){case"select":r=function(e,t){var r=a(e,t),n=[];for(n.push(r);e._next;)r=a(e._next,t),n.push("UNION"),n.push(r),e=e._next;return n.join(" ")}(e,n);break;case"update":r=function(e,t){var r=["UPDATE"];!1===(t=t||{}).keep_db?r.push(e.table):r.push(e.db+"."+e.table),r.push("SET");var n,o,a=[],s=e.set;for(n=0;n<s.length;n++)o=s[n].column+" = "+i(s[n].value),a.push(o);return r.push(a.join(", ")),e.where&&(o="WHERE ",o+=i(e.where),r.push(o)),r.join(" ")}(e,n);break;case"insert":case"replace":r=function(e,t){t=t||{};var r,n=[];n.push(e.type.toUpperCase()),n.push("INTO"),!1===t.keep_db?n.push(e.table):n.push(e.db+"."+e.table),n.push("("+e.columns.join(", ")+")"),n.push("VALUES");var o=[],a=e.values;for(r=0;r<a.length;r++){for(var s=a[r].value,l=[],c=0;c<s.length;c++)l.push(i(s[c]));o.push("("+l.join(", ")+")")}return n.push(o.join(", ")),n.join(" ")}(e,n);break;case"delete":default:throw new Error("ERROR TYPE :"+e.type+", NOT SUPPORTED")}return r},e.exports.exprToSQL=i},function(e,t,r){var n=r(45),o={TIANDITU:{VEC_C:{layers:"vec",matrixSet:"c",format:"tiles",tileType:102,crossOrigin:"*",url:"http://t0.tianditu.gov.cn/vec_c/wmts?tk={token}",projection:"EPSG:4326",token:""},CVA_C:{layers:"cva",matrixSet:"c",format:"tiles",tileType:102,crossOrigin:"*",url:"http://t0.tianditu.gov.cn/cva_c/wmts?tk={token}",projection:"EPSG:4326",token:""},IMG_C:{layers:"img",matrixSet:"c",format:"tiles",tileType:102,crossOrigin:"*",url:"http://t0.tianditu.gov.cn/img_c/wmts?tk={token}",projection:"EPSG:4326",token:""},CIA_C:{layers:"cia",matrixSet:"c",format:"tiles",tileType:102,crossOrigin:"*",url:"http://t0.tianditu.gov.cn/cia_c/wmts?tk={token}",projection:"EPSG:4326",token:""},TER_C:{layers:"ter",matrixSet:"c",format:"tiles",tileType:102,crossOrigin:"*",url:"http://t0.tianditu.gov.cn/ter_c/wmts?tk={token}",projection:"EPSG:4326",token:""},CTA_C:{layers:"cta",matrixSet:"c",format:"tiles",tileType:102,crossOrigin:"*",url:"http://t0.tianditu.gov.cn/cta_c/wmts?tk={token}",projection:"EPSG:4326",token:""}},BAIDU:{},GAODE:{},GOOGLE:{},WMS:{},WMTS:{layers:"",matrixSet:"",format:"",tileType:102,crossOrigin:"*",url:"",projection:"EPSG:4326"},XYZ:{},extend:function(e,t){var r=e.split("."),i=o;try{for(var a=0;a<r.length;a++)i=i[r[a]]}catch(t){throw new Error("key = "+e+" 不存在！")}var s=n(!0,{},i);return n(!0,s,t||{})}};e.exports=o},function(e,t,r){var n=r(196),o=r(81),i=(r(14),r(2),r(1),n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.gvInstance=null,this.gvOptions=null,this.initListeners()},destroy:function(){this.clear(),this.destroyGvInstance(),this.featureCol=null,this.gvOptions=null,n.prototype.destroy.call(this)},getGvInstance:function(e){},destroyGvInstance:function(){this.gvInstance&&(this.gvInstance.unbind(this.options.map),this.removeListeners(),this.gvInstance=null)},getGvOptions:function(){return this.gvOptions=this.options.renderOption.style||this.options.renderOption.chart,this.gvOptions},render:function(){var e=this.featureSet,t=o.featureSet2GeoJson(e),r=new gv.source.GeoJsonSource(t),n=this.getGvInstance();n.setDataSource(r),n.render()},clear:function(){this.layer.clear(),this.featureSet.features=[]},setVisible:function(e){var t=this.getGvInstance();return!!t&&(t.setVisible(!!e),!0)},getVisible:function(){var e=this.getGvInstance();if(e)return e.getVisible()},addListeners:function(){this.gvInstance&&(this.gvInstance.on("click",this.onClick),this.gvInstance.on("mouseover",this.onMouseOver),this.gvInstance.on("mouseout",this.onMouseOut))},removeListeners:function(){this.gvInstance&&(this.gvInstance.un("click",this.onClick),this.gvInstance.un("mouseover",this.onMouseOver),this.gvInstance.un("mouseout",this.onMouseOut))}}));e.exports=i},function(e,t,r){var n=r(64),o=r(81),i=r(1),a=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.featureSet=new i.sfs.FeatureSet,this.layer=new i.carto.FeatureLayer({}),this.fields=null},destroy:function(){this.featureSet=null,this.layer=null},add:function(e){for(var t=e.length,r=0;r<t;r++){var n=e[r],o=this.options.featureBuilder.buildFeature(n);o._original_data=n,this.featureSet.add(o)}this.layer.addFeatures(this.featureSet),this.render()},update:function(e){for(var t=e.length,r=0;r<t;r++){var n=e[r],i=o.getFeatureById(n[this.options.idField],this.featureSet);i.index>=0&&this.featureSet.features.splice(i.index,1);var a=this.options.featureBuilder.buildFeature(n);a._original_data=n,this.featureSet.add(a)}this.layer.addFeatures(this.featureSet),this.render()},remove:function(e){this.layer.clear();var t=o.getFeatureById(e,this.featureSet);t.index>=0&&this.featureSet.features.splice(t.index,1),this.render()},getLayer:function(){return this.layer},onResolutionChanged:function(e){var t=this.options.renderOption.zoomRange||[],r=-1,n=-1,o=Math.round(e.level);if(null!=this.lastLevel){if(o!=this.lastLevel){for(var i=0;i<t.length;i++){var a=t[i];o>=a.range[0]&&o<=a.range[1]&&(n=i),this.lastLevel>=a.range[0]&&this.lastLevel<=a.range[1]&&(r=i)}n!=r&&this.options.eventDispatcher.fire("zoomrangechange",{range:t[n]}),this.lastLevel=o}}else this.lastLevel=o},initListeners:function(){var e=this;this.onClick=function(t){e.options.eventDispatcher.listens("click")&&e.fireEvent("click",t)},this.onMouseOver=function(t){e.options.eventDispatcher.listens("mouseover")&&e.fireEvent("mouseover",t)},this.onMouseOut=function(t){e.options.eventDispatcher.listens("mouseout")&&e.fireEvent("mouseout",t)}},fireEvent:function(e,t){var r={};for(var n in t)r[n]=t[n];r.featureType=this.options.id,r.featureName=this.options.name,this.options.eventDispatcher.fire(e,r)}});e.exports=a},function(e,t,r){e.exports=r(198)},function(e,t,r){"use strict";r.r(t);r(199),r(201),r(202),r(203),r(204),r(205),r(206),r(207),r(208),r(209),r(210),r(211),r(212),r(213),r(214),r(215),r(216),r(217),r(218),r(219),r(220),r(221),r(222),r(223),r(224),r(225),r(226),r(85),r(227),r(228),r(229),r(230),r(231),r(232),r(233),r(234),r(235),r(236),r(237),r(238),r(239),r(240),r(241),r(243),r(244),r(245),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(267),r(268),r(269),r(270),r(271),r(272),r(274),r(275),r(276),r(277),r(278),r(279),r(281),r(283),r(285),r(286),r(287),r(288),r(289),r(290),r(291),r(292),r(293),r(294),r(295),r(296),r(297),r(298),r(299),r(300),r(301),r(302),r(303),r(304),r(305),r(307),r(308),r(311),r(312),r(313),r(315),r(316),r(317),r(318),r(319),r(320),r(321),r(322),r(323),r(324),r(325),r(326),r(168),r(327),r(328),r(329),r(330),r(331),r(332),r(333),r(169),r(334),r(335),r(336),r(337),r(338),r(339),r(340),r(341),r(342),r(343),r(344),r(345),r(346),r(347),r(348),r(349),r(350),r(351),r(352),r(353),r(354),r(355),r(356),r(357),r(358),r(359),r(361),r(362),r(363),r(364),r(365),r(366),r(367),r(368),r(369),r(370),r(371),r(372),r(373),r(374),r(375),r(376),r(377),r(378),r(379),r(380),r(381),r(382),r(383),r(384),r(385),r(386),r(387),r(388),r(389),r(390),r(391),r(392),r(393),r(394),r(395),r(396),r(397),r(398),r(399),r(400),r(403),r(177),r(404);var n=r(405),o=r(125),i=r(419),a=r(97),s=r(428),l=r(452),c=r(456),u=r(463),f=r(478),h=r(481),p=r(484),d=r(492),y=r(509),m=r(520),g=r(532),v=r(537),b={};b.Map=o,b.base=i,b.plot=s,b.utils=l,b.data=f,b.misc=h,b.lys=a,b.components=p,b.common=d,b.interact=y,b.render=m,b.model=g,b.biz=v,b.servicev2=u,b.service=c,b.version=n,window.G=b},function(e,t,r){"use strict";var n=r(0),o=r(4),i=r(35),a=r(40),s=r(9),l=r(106),c=r(141),u=r(3),f=r(16),h=r(59),p=r(5),d=r(6),y=r(17),m=r(27),g=r(39),v=r(46),b=r(48),_=r(70),w=r(53),S=r(144),L=r(105),x=r(20),P=r(13),E=r(82),T=r(25),C=r(22),A=r(102),k=r(83),R=r(67),O=r(66),I=r(7),M=r(145),F=r(29),D=r(41),j=r(28),G=r(19).forEach,N=k("hidden"),B=I("toPrimitive"),U=j.set,z=j.getterFor("Symbol"),W=Object.prototype,Y=o.Symbol,q=i("JSON","stringify"),V=x.f,H=P.f,J=S.f,Q=E.f,Z=A("symbols"),X=A("op-symbols"),K=A("string-to-symbol-registry"),$=A("symbol-to-string-registry"),ee=A("wks"),te=o.QObject,re=!te||!te.prototype||!te.prototype.findChild,ne=s&&u((function(){return 7!=b(H({},"a",{get:function(){return H(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=V(W,t);n&&delete W[t],H(e,t,r),n&&e!==W&&H(W,t,n)}:H,oe=function(e,t){var r=Z[e]=b(Y.prototype);return U(r,{type:"Symbol",tag:e,description:t}),s||(r.description=t),r},ie=c?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Y},ae=function(e,t,r){e===W&&ae(X,t,r),d(e);var n=g(t,!0);return d(r),f(Z,n)?(r.enumerable?(f(e,N)&&e[N][n]&&(e[N][n]=!1),r=b(r,{enumerable:v(0,!1)})):(f(e,N)||H(e,N,v(1,{})),e[N][n]=!0),ne(e,n,r)):H(e,n,r)},se=function(e,t){d(e);var r=m(t),n=_(r).concat(fe(r));return G(n,(function(t){s&&!le.call(r,t)||ae(e,t,r[t])})),e},le=function(e){var t=g(e,!0),r=Q.call(this,t);return!(this===W&&f(Z,t)&&!f(X,t))&&(!(r||!f(this,t)||!f(Z,t)||f(this,N)&&this[N][t])||r)},ce=function(e,t){var r=m(e),n=g(t,!0);if(r!==W||!f(Z,n)||f(X,n)){var o=V(r,n);return!o||!f(Z,n)||f(r,N)&&r[N][n]||(o.enumerable=!0),o}},ue=function(e){var t=J(m(e)),r=[];return G(t,(function(e){f(Z,e)||f(R,e)||r.push(e)})),r},fe=function(e){var t=e===W,r=J(t?X:m(e)),n=[];return G(r,(function(e){!f(Z,e)||t&&!f(W,e)||n.push(Z[e])})),n};(l||(C((Y=function(){if(this instanceof Y)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=O(e),r=function(e){this===W&&r.call(X,e),f(this,N)&&f(this[N],t)&&(this[N][t]=!1),ne(this,t,v(1,e))};return s&&re&&ne(W,t,{configurable:!0,set:r}),oe(t,e)}).prototype,"toString",(function(){return z(this).tag})),C(Y,"withoutSetter",(function(e){return oe(O(e),e)})),E.f=le,P.f=ae,x.f=ce,w.f=S.f=ue,L.f=fe,M.f=function(e){return oe(I(e),e)},s&&(H(Y.prototype,"description",{configurable:!0,get:function(){return z(this).description}}),a||C(W,"propertyIsEnumerable",le,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!l,sham:!l},{Symbol:Y}),G(_(ee),(function(e){F(e)})),n({target:"Symbol",stat:!0,forced:!l},{for:function(e){var t=String(e);if(f(K,t))return K[t];var r=Y(t);return K[t]=r,$[r]=t,r},keyFor:function(e){if(!ie(e))throw TypeError(e+" is not a symbol");if(f($,e))return $[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),n({target:"Object",stat:!0,forced:!l,sham:!s},{create:function(e,t){return void 0===t?b(e):se(b(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:ce}),n({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:ue,getOwnPropertySymbols:fe}),n({target:"Object",stat:!0,forced:u((function(){L.f(1)}))},{getOwnPropertySymbols:function(e){return L.f(y(e))}}),q)&&n({target:"JSON",stat:!0,forced:!l||u((function(){var e=Y();return"[null]"!=q([e])||"{}"!=q({a:e})||"{}"!=q(Object(e))}))},{stringify:function(e,t,r){for(var n,o=[e],i=1;arguments.length>i;)o.push(arguments[i++]);if(n=t,(p(t)||void 0!==e)&&!ie(e))return h(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!ie(t))return t}),o[1]=t,q.apply(null,o)}});Y.prototype[B]||T(Y.prototype,B,Y.prototype.valueOf),D(Y,"Symbol"),R[N]=!0},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(0),o=r(9),i=r(4),a=r(16),s=r(5),l=r(13).f,c=r(138),u=i.Symbol;if(o&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var f={},h=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof h?new u(e):void 0===e?u():u(e);return""===e&&(f[t]=!0),t};c(h,u);var p=h.prototype=u.prototype;p.constructor=h;var d=p.toString,y="Symbol(test)"==String(u("test")),m=/^Symbol\((.*)\)[^)]+$/;l(p,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=d.call(e);if(a(f,e))return"";var r=y?t.slice(7,-1):t.replace(m,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:h})}},function(e,t,r){r(29)("asyncIterator")},function(e,t,r){r(29)("hasInstance")},function(e,t,r){r(29)("isConcatSpreadable")},function(e,t,r){r(29)("iterator")},function(e,t,r){r(29)("match")},function(e,t,r){r(29)("replace")},function(e,t,r){r(29)("search")},function(e,t,r){r(29)("species")},function(e,t,r){r(29)("split")},function(e,t,r){r(29)("toPrimitive")},function(e,t,r){r(29)("toStringTag")},function(e,t,r){r(29)("unscopables")},function(e,t,r){"use strict";var n=r(0),o=r(3),i=r(59),a=r(5),s=r(17),l=r(10),c=r(54),u=r(71),f=r(72),h=r(7),p=r(107),d=h("isConcatSpreadable"),y=p>=51||!o((function(){var e=[];return e[d]=!1,e.concat()[0]!==e})),m=f("concat"),g=function(e){if(!a(e))return!1;var t=e[d];return void 0!==t?!!t:i(e)};n({target:"Array",proto:!0,forced:!y||!m},{concat:function(e){var t,r,n,o,i,a=s(this),f=u(a,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(i=-1===t?a:arguments[t],g(i)){if(h+(o=l(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<o;r++,h++)r in i&&c(f,h,i[r])}else{if(h>=9007199254740991)throw TypeError("Maximum allowed index exceeded");c(f,h++,i)}return f.length=h,f}})},function(e,t,r){var n=r(0),o=r(146),i=r(50);n({target:"Array",proto:!0},{copyWithin:o}),i("copyWithin")},function(e,t,r){"use strict";var n=r(0),o=r(19).every,i=r(43),a=r(26),s=i("every"),l=a("every");n({target:"Array",proto:!0,forced:!s||!l},{every:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(0),o=r(109),i=r(50);n({target:"Array",proto:!0},{fill:o}),i("fill")},function(e,t,r){"use strict";var n=r(0),o=r(19).filter,i=r(72),a=r(26),s=i("filter"),l=a("filter");n({target:"Array",proto:!0,forced:!s||!l},{filter:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(19).find,i=r(50),a=r(26),s=!0,l=a("find");"find"in[]&&Array(1).find((function(){s=!1})),n({target:"Array",proto:!0,forced:s||!l},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i("find")},function(e,t,r){"use strict";var n=r(0),o=r(19).findIndex,i=r(50),a=r(26),s=!0,l=a("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){s=!1})),n({target:"Array",proto:!0,forced:s||!l},{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i("findIndex")},function(e,t,r){"use strict";var n=r(0),o=r(147),i=r(17),a=r(10),s=r(32),l=r(71);n({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=i(this),r=a(t.length),n=l(t,0);return n.length=o(n,t,t,r,0,void 0===e?1:s(e)),n}})},function(e,t,r){"use strict";var n=r(0),o=r(147),i=r(17),a=r(10),s=r(33),l=r(71);n({target:"Array",proto:!0},{flatMap:function(e){var t,r=i(this),n=a(r.length);return s(e),(t=l(r,0)).length=o(t,r,r,n,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},function(e,t,r){"use strict";var n=r(0),o=r(148);n({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(e,t,r){var n=r(0),o=r(149);n({target:"Array",stat:!0,forced:!r(84)((function(e){Array.from(e)}))},{from:o})},function(e,t,r){"use strict";var n=r(0),o=r(68).includes,i=r(50);n({target:"Array",proto:!0,forced:!r(26)("indexOf",{ACCESSORS:!0,1:0})},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},function(e,t,r){"use strict";var n=r(0),o=r(68).indexOf,i=r(43),a=r(26),s=[].indexOf,l=!!s&&1/[1].indexOf(1,-0)<0,c=i("indexOf"),u=a("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:l||!c||!u},{indexOf:function(e){return l?s.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(65),i=r(27),a=r(43),s=[].join,l=o!=Object,c=a("join",",");n({target:"Array",proto:!0,forced:l||!c},{join:function(e){return s.call(i(this),void 0===e?",":e)}})},function(e,t,r){var n=r(0),o=r(154);n({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},function(e,t,r){"use strict";var n=r(0),o=r(19).map,i=r(72),a=r(26),s=i("map"),l=a("map");n({target:"Array",proto:!0,forced:!s||!l},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(3),i=r(54);n({target:"Array",stat:!0,forced:o((function(){function e(){}return!(Array.of.call(e)instanceof e)}))},{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);t>e;)i(r,e,arguments[e++]);return r.length=t,r}})},function(e,t,r){"use strict";var n=r(0),o=r(86).left,i=r(43),a=r(26),s=i("reduce"),l=a("reduce",{1:0});n({target:"Array",proto:!0,forced:!s||!l},{reduce:function(e){return o(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(86).right,i=r(43),a=r(26),s=i("reduceRight"),l=a("reduce",{1:0});n({target:"Array",proto:!0,forced:!s||!l},{reduceRight:function(e){return o(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(59),i=[].reverse,a=[1,2];n({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),i.call(this)}})},function(e,t,r){"use strict";var n=r(0),o=r(5),i=r(59),a=r(47),s=r(10),l=r(27),c=r(54),u=r(7),f=r(72),h=r(26),p=f("slice"),d=h("slice",{ACCESSORS:!0,0:0,1:2}),y=u("species"),m=[].slice,g=Math.max;n({target:"Array",proto:!0,forced:!p||!d},{slice:function(e,t){var r,n,u,f=l(this),h=s(f.length),p=a(e,h),d=a(void 0===t?h:t,h);if(i(f)&&("function"!=typeof(r=f.constructor)||r!==Array&&!i(r.prototype)?o(r)&&null===(r=r[y])&&(r=void 0):r=void 0,r===Array||void 0===r))return m.call(f,p,d);for(n=new(void 0===r?Array:r)(g(d-p,0)),u=0;p<d;p++,u++)p in f&&c(n,u,f[p]);return n.length=u,n}})},function(e,t,r){"use strict";var n=r(0),o=r(19).some,i=r(43),a=r(26),s=i("some"),l=a("some");n({target:"Array",proto:!0,forced:!s||!l},{some:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(33),i=r(17),a=r(3),s=r(43),l=[],c=l.sort,u=a((function(){l.sort(void 0)})),f=a((function(){l.sort(null)})),h=s("sort");n({target:"Array",proto:!0,forced:u||!f||!h},{sort:function(e){return void 0===e?c.call(i(this)):c.call(i(this),o(e))}})},function(e,t,r){r(60)("Array")},function(e,t,r){"use strict";var n=r(0),o=r(47),i=r(32),a=r(10),s=r(17),l=r(71),c=r(54),u=r(72),f=r(26),h=u("splice"),p=f("splice",{ACCESSORS:!0,0:0,1:2}),d=Math.max,y=Math.min;n({target:"Array",proto:!0,forced:!h||!p},{splice:function(e,t){var r,n,u,f,h,p,m=s(this),g=a(m.length),v=o(e,g),b=arguments.length;if(0===b?r=n=0:1===b?(r=0,n=g-v):(r=b-2,n=y(d(i(t),0),g-v)),g+r-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(u=l(m,n),f=0;f<n;f++)(h=v+f)in m&&c(u,f,m[h]);if(u.length=n,r<n){for(f=v;f<g-n;f++)p=f+r,(h=f+n)in m?m[p]=m[h]:delete m[p];for(f=g;f>g-n+r;f--)delete m[f-1]}else if(r>n)for(f=g-n;f>v;f--)p=f+r-1,(h=f+n-1)in m?m[p]=m[h]:delete m[p];for(f=0;f<r;f++)m[f+v]=arguments[f+2];return m.length=g-n+r,u}})},function(e,t,r){r(50)("flat")},function(e,t,r){r(50)("flatMap")},function(e,t,r){"use strict";var n=r(0),o=r(4),i=r(114),a=r(60),s=i.ArrayBuffer;n({global:!0,forced:o.ArrayBuffer!==s},{ArrayBuffer:s}),a("ArrayBuffer")},function(e,t){var r=Math.abs,n=Math.pow,o=Math.floor,i=Math.log,a=Math.LN2;e.exports={pack:function(e,t,s){var l,c,u,f=new Array(s),h=8*s-t-1,p=(1<<h)-1,d=p>>1,y=23===t?n(2,-24)-n(2,-77):0,m=e<0||0===e&&1/e<0?1:0,g=0;for((e=r(e))!=e||e===1/0?(c=e!=e?1:0,l=p):(l=o(i(e)/a),e*(u=n(2,-l))<1&&(l--,u*=2),(e+=l+d>=1?y/u:y*n(2,1-d))*u>=2&&(l++,u/=2),l+d>=p?(c=0,l=p):l+d>=1?(c=(e*u-1)*n(2,t),l+=d):(c=e*n(2,d-1)*n(2,t),l=0));t>=8;f[g++]=255&c,c/=256,t-=8);for(l=l<<t|c,h+=t;h>0;f[g++]=255&l,l/=256,h-=8);return f[--g]|=128*m,f},unpack:function(e,t){var r,o=e.length,i=8*o-t-1,a=(1<<i)-1,s=a>>1,l=i-7,c=o-1,u=e[c--],f=127&u;for(u>>=7;l>0;f=256*f+e[c],c--,l-=8);for(r=f&(1<<-l)-1,f>>=-l,l+=t;l>0;r=256*r+e[c],c--,l-=8);if(0===f)f=1-s;else{if(f===a)return r?NaN:u?-1/0:1/0;r+=n(2,t),f-=s}return(u?-1:1)*r*n(2,f-t)}}},function(e,t,r){var n=r(0),o=r(8);n({target:"ArrayBuffer",stat:!0,forced:!o.NATIVE_ARRAY_BUFFER_VIEWS},{isView:o.isView})},function(e,t,r){"use strict";var n=r(0),o=r(3),i=r(114),a=r(6),s=r(47),l=r(10),c=r(52),u=i.ArrayBuffer,f=i.DataView,h=u.prototype.slice;n({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:o((function(){return!new u(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(void 0!==h&&void 0===t)return h.call(a(this),e);for(var r=a(this).byteLength,n=s(e,r),o=s(void 0===t?r:t,r),i=new(c(this,u))(l(o-n)),p=new f(this),d=new f(i),y=0;n<o;)d.setUint8(y++,p.getUint8(n++));return i}})},function(e,t,r){var n=r(25),o=r(246),i=r(7)("toPrimitive"),a=Date.prototype;i in a||n(a,i,o)},function(e,t,r){"use strict";var n=r(6),o=r(39);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return o(n(this),"number"!==e)}},function(e,t,r){"use strict";var n=r(5),o=r(13),i=r(36),a=r(7)("hasInstance"),s=Function.prototype;a in s||o.f(s,a,{value:function(e){if("function"!=typeof this||!n(e))return!1;if(!n(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,r){var n=r(9),o=r(13).f,i=Function.prototype,a=i.toString,s=/^\s*function ([^ (]*)/;n&&!("name"in i)&&o(i,"name",{configurable:!0,get:function(){try{return a.call(this).match(s)[1]}catch(e){return""}}})},function(e,t,r){var n=r(4);r(41)(n.JSON,"JSON",!0)},function(e,t,r){"use strict";var n=r(87),o=r(157);e.exports=n("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),o)},function(e,t,r){var n=r(0),o=r(158),i=Math.acosh,a=Math.log,s=Math.sqrt,l=Math.LN2;n({target:"Math",stat:!0,forced:!i||710!=Math.floor(i(Number.MAX_VALUE))||i(1/0)!=1/0},{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?a(e)+l:o(e-1+s(e-1)*s(e+1))}})},function(e,t,r){var n=r(0),o=Math.asinh,i=Math.log,a=Math.sqrt;n({target:"Math",stat:!0,forced:!(o&&1/o(0)>0)},{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):i(t+a(t*t+1)):t}})},function(e,t,r){var n=r(0),o=Math.atanh,i=Math.log;n({target:"Math",stat:!0,forced:!(o&&1/o(-0)<0)},{atanh:function(e){return 0==(e=+e)?e:i((1+e)/(1-e))/2}})},function(e,t,r){var n=r(0),o=r(115),i=Math.abs,a=Math.pow;n({target:"Math",stat:!0},{cbrt:function(e){return o(e=+e)*a(i(e),1/3)}})},function(e,t,r){var n=r(0),o=Math.floor,i=Math.log,a=Math.LOG2E;n({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-o(i(e+.5)*a):32}})},function(e,t,r){var n=r(0),o=r(89),i=Math.cosh,a=Math.abs,s=Math.E;n({target:"Math",stat:!0,forced:!i||i(710)===1/0},{cosh:function(e){var t=o(a(e)-1)+1;return(t+1/(t*s*s))*(s/2)}})},function(e,t,r){var n=r(0),o=r(89);n({target:"Math",stat:!0,forced:o!=Math.expm1},{expm1:o})},function(e,t,r){r(0)({target:"Math",stat:!0},{fround:r(259)})},function(e,t,r){var n=r(115),o=Math.abs,i=Math.pow,a=i(2,-52),s=i(2,-23),l=i(2,127)*(2-s),c=i(2,-126);e.exports=Math.fround||function(e){var t,r,i=o(e),u=n(e);return i<c?u*(i/c/s+1/a-1/a)*c*s:(r=(t=(1+s/a)*i)-(t-i))>l||r!=r?u*(1/0):u*r}},function(e,t,r){var n=r(0),o=Math.hypot,i=Math.abs,a=Math.sqrt;n({target:"Math",stat:!0,forced:!!o&&o(1/0,NaN)!==1/0},{hypot:function(e,t){for(var r,n,o=0,s=0,l=arguments.length,c=0;s<l;)c<(r=i(arguments[s++]))?(o=o*(n=c/r)*n+1,c=r):o+=r>0?(n=r/c)*n:r;return c===1/0?1/0:c*a(o)}})},function(e,t,r){var n=r(0),o=r(3),i=Math.imul;n({target:"Math",stat:!0,forced:o((function(){return-5!=i(4294967295,5)||2!=i.length}))},{imul:function(e,t){var r=+e,n=+t,o=65535&r,i=65535&n;return 0|o*i+((65535&r>>>16)*i+o*(65535&n>>>16)<<16>>>0)}})},function(e,t,r){var n=r(0),o=Math.log,i=Math.LOG10E;n({target:"Math",stat:!0},{log10:function(e){return o(e)*i}})},function(e,t,r){r(0)({target:"Math",stat:!0},{log1p:r(158)})},function(e,t,r){var n=r(0),o=Math.log,i=Math.LN2;n({target:"Math",stat:!0},{log2:function(e){return o(e)/i}})},function(e,t,r){r(0)({target:"Math",stat:!0},{sign:r(115)})},function(e,t,r){var n=r(0),o=r(3),i=r(89),a=Math.abs,s=Math.exp,l=Math.E;n({target:"Math",stat:!0,forced:o((function(){return-2e-17!=Math.sinh(-2e-17)}))},{sinh:function(e){return a(e=+e)<1?(i(e)-i(-e))/2:(s(e-1)-s(-e-1))*(l/2)}})},function(e,t,r){var n=r(0),o=r(89),i=Math.exp;n({target:"Math",stat:!0},{tanh:function(e){var t=o(e=+e),r=o(-e);return t==1/0?1:r==1/0?-1:(t-r)/(i(e)+i(-e))}})},function(e,t,r){r(41)(Math,"Math",!0)},function(e,t,r){var n=r(0),o=Math.ceil,i=Math.floor;n({target:"Math",stat:!0},{trunc:function(e){return(e>0?i:o)(e)}})},function(e,t,r){"use strict";var n=r(9),o=r(4),i=r(69),a=r(22),s=r(16),l=r(34),c=r(88),u=r(39),f=r(3),h=r(48),p=r(53).f,d=r(20).f,y=r(13).f,m=r(62).trim,g=o.Number,v=g.prototype,b="Number"==l(h(v)),_=function(e){var t,r,n,o,i,a,s,l,c=u(e,!1);if("string"==typeof c&&c.length>2)if(43===(t=(c=m(c)).charCodeAt(0))||45===t){if(88===(r=c.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=c.slice(2)).length,s=0;s<a;s++)if((l=i.charCodeAt(s))<48||l>o)return NaN;return parseInt(i,n)}return+c};if(i("Number",!g(" 0o1")||!g("0b1")||g("+0x1"))){for(var w,S=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof S&&(b?f((function(){v.valueOf.call(r)})):"Number"!=l(r))?c(new g(_(t)),r,S):_(t)},L=n?p(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;L.length>x;x++)s(g,w=L[x])&&!s(S,w)&&y(S,w,d(g,w));S.prototype=v,v.constructor=S,a(o,"Number",S)}},function(e,t,r){r(0)({target:"Number",stat:!0},{EPSILON:Math.pow(2,-52)})},function(e,t,r){r(0)({target:"Number",stat:!0},{isFinite:r(273)})},function(e,t,r){var n=r(4).isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&n(e)}},function(e,t,r){r(0)({target:"Number",stat:!0},{isInteger:r(159)})},function(e,t,r){r(0)({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})},function(e,t,r){var n=r(0),o=r(159),i=Math.abs;n({target:"Number",stat:!0},{isSafeInteger:function(e){return o(e)&&i(e)<=9007199254740991}})},function(e,t,r){r(0)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){r(0)({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,r){var n=r(0),o=r(280);n({target:"Number",stat:!0,forced:Number.parseFloat!=o},{parseFloat:o})},function(e,t,r){var n=r(4),o=r(62).trim,i=r(90),a=n.parseFloat,s=1/a(i+"-0")!=-1/0;e.exports=s?function(e){var t=o(String(e)),r=a(t);return 0===r&&"-"==t.charAt(0)?-0:r}:a},function(e,t,r){var n=r(0),o=r(282);n({target:"Number",stat:!0,forced:Number.parseInt!=o},{parseInt:o})},function(e,t,r){var n=r(4),o=r(62).trim,i=r(90),a=n.parseInt,s=/^[+-]?0[Xx]/,l=8!==a(i+"08")||22!==a(i+"0x16");e.exports=l?function(e,t){var r=o(String(e));return a(r,t>>>0||(s.test(r)?16:10))}:a},function(e,t,r){"use strict";var n=r(0),o=r(32),i=r(284),a=r(116),s=r(3),l=1..toFixed,c=Math.floor,u=function(e,t,r){return 0===t?r:t%2==1?u(e,t-1,r*e):u(e*e,t/2,r)};n({target:"Number",proto:!0,forced:l&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){l.call({})}))},{toFixed:function(e){var t,r,n,s,l=i(this),f=o(e),h=[0,0,0,0,0,0],p="",d="0",y=function(e,t){for(var r=-1,n=t;++r<6;)n+=e*h[r],h[r]=n%1e7,n=c(n/1e7)},m=function(e){for(var t=6,r=0;--t>=0;)r+=h[t],h[t]=c(r/e),r=r%e*1e7},g=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==h[e]){var r=String(h[e]);t=""===t?r:t+a.call("0",7-r.length)+r}return t};if(f<0||f>20)throw RangeError("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(p="-",l=-l),l>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(l*u(2,69,1))-69)<0?l*u(2,-t,1):l/u(2,t,1),r*=4503599627370496,(t=52-t)>0){for(y(0,r),n=f;n>=7;)y(1e7,0),n-=7;for(y(u(10,n,1),0),n=t-1;n>=23;)m(1<<23),n-=23;m(1<<n),y(1,1),m(2),d=g()}else y(0,r),y(1<<-t,0),d=g()+a.call("0",f);return d=f>0?p+((s=d.length)<=f?"0."+a.call("0",f-s)+d:d.slice(0,s-f)+"."+d.slice(s-f)):p+d}})},function(e,t,r){var n=r(34);e.exports=function(e){if("number"!=typeof e&&"Number"!=n(e))throw TypeError("Incorrect invocation");return+e}},function(e,t,r){var n=r(0),o=r(160);n({target:"Object",stat:!0,forced:Object.assign!==o},{assign:o})},function(e,t,r){"use strict";var n=r(0),o=r(9),i=r(91),a=r(17),s=r(33),l=r(13);o&&n({target:"Object",proto:!0,forced:i},{__defineGetter__:function(e,t){l.f(a(this),e,{get:s(t),enumerable:!0,configurable:!0})}})},function(e,t,r){"use strict";var n=r(0),o=r(9),i=r(91),a=r(17),s=r(33),l=r(13);o&&n({target:"Object",proto:!0,forced:i},{__defineSetter__:function(e,t){l.f(a(this),e,{set:s(t),enumerable:!0,configurable:!0})}})},function(e,t,r){var n=r(0),o=r(161).entries;n({target:"Object",stat:!0},{entries:function(e){return o(e)}})},function(e,t,r){var n=r(0),o=r(76),i=r(3),a=r(5),s=r(56).onFreeze,l=Object.freeze;n({target:"Object",stat:!0,forced:i((function(){l(1)})),sham:!o},{freeze:function(e){return l&&a(e)?l(s(e)):e}})},function(e,t,r){var n=r(0),o=r(77),i=r(54);n({target:"Object",stat:!0},{fromEntries:function(e){var t={};return o(e,(function(e,r){i(t,e,r)}),void 0,!0),t}})},function(e,t,r){var n=r(0),o=r(3),i=r(27),a=r(20).f,s=r(9),l=o((function(){a(1)}));n({target:"Object",stat:!0,forced:!s||l,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(i(e),t)}})},function(e,t,r){var n=r(0),o=r(9),i=r(103),a=r(27),s=r(20),l=r(54);n({target:"Object",stat:!0,sham:!o},{getOwnPropertyDescriptors:function(e){for(var t,r,n=a(e),o=s.f,c=i(n),u={},f=0;c.length>f;)void 0!==(r=o(n,t=c[f++]))&&l(u,t,r);return u}})},function(e,t,r){var n=r(0),o=r(3),i=r(144).f;n({target:"Object",stat:!0,forced:o((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:i})},function(e,t,r){var n=r(0),o=r(3),i=r(17),a=r(36),s=r(113);n({target:"Object",stat:!0,forced:o((function(){a(1)})),sham:!s},{getPrototypeOf:function(e){return a(i(e))}})},function(e,t,r){r(0)({target:"Object",stat:!0},{is:r(162)})},function(e,t,r){var n=r(0),o=r(3),i=r(5),a=Object.isExtensible;n({target:"Object",stat:!0,forced:o((function(){a(1)}))},{isExtensible:function(e){return!!i(e)&&(!a||a(e))}})},function(e,t,r){var n=r(0),o=r(3),i=r(5),a=Object.isFrozen;n({target:"Object",stat:!0,forced:o((function(){a(1)}))},{isFrozen:function(e){return!i(e)||!!a&&a(e)}})},function(e,t,r){var n=r(0),o=r(3),i=r(5),a=Object.isSealed;n({target:"Object",stat:!0,forced:o((function(){a(1)}))},{isSealed:function(e){return!i(e)||!!a&&a(e)}})},function(e,t,r){var n=r(0),o=r(17),i=r(70);n({target:"Object",stat:!0,forced:r(3)((function(){i(1)}))},{keys:function(e){return i(o(e))}})},function(e,t,r){"use strict";var n=r(0),o=r(9),i=r(91),a=r(17),s=r(39),l=r(36),c=r(20).f;o&&n({target:"Object",proto:!0,forced:i},{__lookupGetter__:function(e){var t,r=a(this),n=s(e,!0);do{if(t=c(r,n))return t.get}while(r=l(r))}})},function(e,t,r){"use strict";var n=r(0),o=r(9),i=r(91),a=r(17),s=r(39),l=r(36),c=r(20).f;o&&n({target:"Object",proto:!0,forced:i},{__lookupSetter__:function(e){var t,r=a(this),n=s(e,!0);do{if(t=c(r,n))return t.set}while(r=l(r))}})},function(e,t,r){var n=r(0),o=r(5),i=r(56).onFreeze,a=r(76),s=r(3),l=Object.preventExtensions;n({target:"Object",stat:!0,forced:s((function(){l(1)})),sham:!a},{preventExtensions:function(e){return l&&o(e)?l(i(e)):e}})},function(e,t,r){var n=r(0),o=r(5),i=r(56).onFreeze,a=r(76),s=r(3),l=Object.seal;n({target:"Object",stat:!0,forced:s((function(){l(1)})),sham:!a},{seal:function(e){return l&&o(e)?l(i(e)):e}})},function(e,t,r){r(0)({target:"Object",stat:!0},{setPrototypeOf:r(55)})},function(e,t,r){var n=r(111),o=r(22),i=r(306);n||o(Object.prototype,"toString",i,{unsafe:!0})},function(e,t,r){"use strict";var n=r(111),o=r(75);e.exports=n?{}.toString:function(){return"[object "+o(this)+"]"}},function(e,t,r){var n=r(0),o=r(161).values;n({target:"Object",stat:!0},{values:function(e){return o(e)}})},function(e,t,r){"use strict";var n,o,i,a,s=r(0),l=r(40),c=r(4),u=r(35),f=r(163),h=r(22),p=r(61),d=r(41),y=r(60),m=r(5),g=r(33),v=r(51),b=r(34),_=r(101),w=r(77),S=r(84),L=r(52),x=r(117).set,P=r(165),E=r(166),T=r(309),C=r(167),A=r(310),k=r(28),R=r(69),O=r(7),I=r(107),M=O("species"),F="Promise",D=k.get,j=k.set,G=k.getterFor(F),N=f,B=c.TypeError,U=c.document,z=c.process,W=u("fetch"),Y=C.f,q=Y,V="process"==b(z),H=!!(U&&U.createEvent&&c.dispatchEvent),J=R(F,(function(){if(!(_(N)!==String(N))){if(66===I)return!0;if(!V&&"function"!=typeof PromiseRejectionEvent)return!0}if(l&&!N.prototype.finally)return!0;if(I>=51&&/native code/.test(N))return!1;var e=N.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[M]=t,!(e.then((function(){}))instanceof t)})),Q=J||!S((function(e){N.all(e).catch((function(){}))})),Z=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},X=function(e,t,r){if(!t.notified){t.notified=!0;var n=t.reactions;P((function(){for(var o=t.value,i=1==t.state,a=0;n.length>a;){var s,l,c,u=n[a++],f=i?u.ok:u.fail,h=u.resolve,p=u.reject,d=u.domain;try{f?(i||(2===t.rejection&&te(e,t),t.rejection=1),!0===f?s=o:(d&&d.enter(),s=f(o),d&&(d.exit(),c=!0)),s===u.promise?p(B("Promise-chain cycle")):(l=Z(s))?l.call(s,h,p):h(s)):p(o)}catch(e){d&&!c&&d.exit(),p(e)}}t.reactions=[],t.notified=!1,r&&!t.rejection&&$(e,t)}))}},K=function(e,t,r){var n,o;H?((n=U.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),c.dispatchEvent(n)):n={promise:t,reason:r},(o=c["on"+e])?o(n):"unhandledrejection"===e&&T("Unhandled promise rejection",r)},$=function(e,t){x.call(c,(function(){var r,n=t.value;if(ee(t)&&(r=A((function(){V?z.emit("unhandledRejection",n,e):K("unhandledrejection",e,n)})),t.rejection=V||ee(t)?2:1,r.error))throw r.value}))},ee=function(e){return 1!==e.rejection&&!e.parent},te=function(e,t){x.call(c,(function(){V?z.emit("rejectionHandled",e):K("rejectionhandled",e,t.value)}))},re=function(e,t,r,n){return function(o){e(t,r,o,n)}},ne=function(e,t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,X(e,t,!0))},oe=function(e,t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(e===r)throw B("Promise can't be resolved itself");var o=Z(r);o?P((function(){var n={done:!1};try{o.call(r,re(oe,e,n,t),re(ne,e,n,t))}catch(r){ne(e,n,r,t)}})):(t.value=r,t.state=1,X(e,t,!1))}catch(r){ne(e,{done:!1},r,t)}}};J&&(N=function(e){v(this,N,F),g(e),n.call(this);var t=D(this);try{e(re(oe,this,t),re(ne,this,t))}catch(e){ne(this,t,e)}},(n=function(e){j(this,{type:F,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=p(N.prototype,{then:function(e,t){var r=G(this),n=Y(L(this,N));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=V?z.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&X(this,r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n,t=D(e);this.promise=e,this.resolve=re(oe,e,t),this.reject=re(ne,e,t)},C.f=Y=function(e){return e===N||e===i?new o(e):q(e)},l||"function"!=typeof f||(a=f.prototype.then,h(f.prototype,"then",(function(e,t){var r=this;return new N((function(e,t){a.call(r,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof W&&s({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return E(N,W.apply(c,arguments))}}))),s({global:!0,wrap:!0,forced:J},{Promise:N}),d(N,F,!1,!0),y(F),i=u(F),s({target:F,stat:!0,forced:J},{reject:function(e){var t=Y(this);return t.reject.call(void 0,e),t.promise}}),s({target:F,stat:!0,forced:l||J},{resolve:function(e){return E(l&&this===i?N:this,e)}}),s({target:F,stat:!0,forced:Q},{all:function(e){var t=this,r=Y(t),n=r.resolve,o=r.reject,i=A((function(){var r=g(t.resolve),i=[],a=0,s=1;w(e,(function(e){var l=a++,c=!1;i.push(void 0),s++,r.call(t,e).then((function(e){c||(c=!0,i[l]=e,--s||n(i))}),o)})),--s||n(i)}));return i.error&&o(i.value),r.promise},race:function(e){var t=this,r=Y(t),n=r.reject,o=A((function(){var o=g(t.resolve);w(e,(function(e){o.call(t,e).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}})},function(e,t,r){var n=r(4);e.exports=function(e,t){var r=n.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){"use strict";var n=r(0),o=r(40),i=r(163),a=r(3),s=r(35),l=r(52),c=r(166),u=r(22);n({target:"Promise",proto:!0,real:!0,forced:!!i&&a((function(){i.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=l(this,s("Promise")),r="function"==typeof e;return this.then(r?function(r){return c(t,e()).then((function(){return r}))}:e,r?function(r){return c(t,e()).then((function(){throw r}))}:e)}}),o||"function"!=typeof i||i.prototype.finally||u(i.prototype,"finally",s("Promise").prototype.finally)},function(e,t,r){var n=r(0),o=r(35),i=r(33),a=r(6),s=r(3),l=o("Reflect","apply"),c=Function.apply;n({target:"Reflect",stat:!0,forced:!s((function(){l((function(){}))}))},{apply:function(e,t,r){return i(e),a(r),l?l(e,t,r):c.call(e,t,r)}})},function(e,t,r){var n=r(0),o=r(35),i=r(33),a=r(6),s=r(5),l=r(48),c=r(314),u=r(3),f=o("Reflect","construct"),h=u((function(){function e(){}return!(f((function(){}),[],e)instanceof e)})),p=!u((function(){f((function(){}))})),d=h||p;n({target:"Reflect",stat:!0,forced:d,sham:d},{construct:function(e,t){i(e),a(t);var r=arguments.length<3?e:i(arguments[2]);if(p&&!h)return f(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(c.apply(e,n))}var o=r.prototype,u=l(s(o)?o:Object.prototype),d=Function.apply.call(e,u,t);return s(d)?d:u}})},function(e,t,r){"use strict";var n=r(33),o=r(5),i=[].slice,a={},s=function(e,t,r){if(!(t in a)){for(var n=[],o=0;o<t;o++)n[o]="a["+o+"]";a[t]=Function("C,a","return new C("+n.join(",")+")")}return a[t](e,r)};e.exports=Function.bind||function(e){var t=n(this),r=i.call(arguments,1),a=function(){var n=r.concat(i.call(arguments));return this instanceof a?s(t,n.length,n):t.apply(e,n)};return o(t.prototype)&&(a.prototype=t.prototype),a}},function(e,t,r){var n=r(0),o=r(9),i=r(6),a=r(39),s=r(13);n({target:"Reflect",stat:!0,forced:r(3)((function(){Reflect.defineProperty(s.f({},1,{value:1}),1,{value:2})})),sham:!o},{defineProperty:function(e,t,r){i(e);var n=a(t,!0);i(r);try{return s.f(e,n,r),!0}catch(e){return!1}}})},function(e,t,r){var n=r(0),o=r(6),i=r(20).f;n({target:"Reflect",stat:!0},{deleteProperty:function(e,t){var r=i(o(e),t);return!(r&&!r.configurable)&&delete e[t]}})},function(e,t,r){var n=r(0),o=r(5),i=r(6),a=r(16),s=r(20),l=r(36);n({target:"Reflect",stat:!0},{get:function e(t,r){var n,c,u=arguments.length<3?t:arguments[2];return i(t)===u?t[r]:(n=s.f(t,r))?a(n,"value")?n.value:void 0===n.get?void 0:n.get.call(u):o(c=l(t))?e(c,r,u):void 0}})},function(e,t,r){var n=r(0),o=r(9),i=r(6),a=r(20);n({target:"Reflect",stat:!0,sham:!o},{getOwnPropertyDescriptor:function(e,t){return a.f(i(e),t)}})},function(e,t,r){var n=r(0),o=r(6),i=r(36);n({target:"Reflect",stat:!0,sham:!r(113)},{getPrototypeOf:function(e){return i(o(e))}})},function(e,t,r){r(0)({target:"Reflect",stat:!0},{has:function(e,t){return t in e}})},function(e,t,r){var n=r(0),o=r(6),i=Object.isExtensible;n({target:"Reflect",stat:!0},{isExtensible:function(e){return o(e),!i||i(e)}})},function(e,t,r){r(0)({target:"Reflect",stat:!0},{ownKeys:r(103)})},function(e,t,r){var n=r(0),o=r(35),i=r(6);n({target:"Reflect",stat:!0,sham:!r(76)},{preventExtensions:function(e){i(e);try{var t=o("Object","preventExtensions");return t&&t(e),!0}catch(e){return!1}}})},function(e,t,r){var n=r(0),o=r(6),i=r(5),a=r(16),s=r(3),l=r(13),c=r(20),u=r(36),f=r(46);n({target:"Reflect",stat:!0,forced:s((function(){var e=l.f({},"a",{configurable:!0});return!1!==Reflect.set(u(e),"a",1,e)}))},{set:function e(t,r,n){var s,h,p=arguments.length<4?t:arguments[3],d=c.f(o(t),r);if(!d){if(i(h=u(t)))return e(h,r,n,p);d=f(0)}if(a(d,"value")){if(!1===d.writable||!i(p))return!1;if(s=c.f(p,r)){if(s.get||s.set||!1===s.writable)return!1;s.value=n,l.f(p,r,s)}else l.f(p,r,f(0,n));return!0}return void 0!==d.set&&(d.set.call(p,n),!0)}})},function(e,t,r){var n=r(0),o=r(6),i=r(153),a=r(55);a&&n({target:"Reflect",stat:!0},{setPrototypeOf:function(e,t){o(e),i(t);try{return a(e,t),!0}catch(e){return!1}}})},function(e,t,r){var n=r(9),o=r(4),i=r(69),a=r(88),s=r(13).f,l=r(53).f,c=r(118),u=r(92),f=r(119),h=r(22),p=r(3),d=r(28).set,y=r(60),m=r(7)("match"),g=o.RegExp,v=g.prototype,b=/a/g,_=/a/g,w=new g(b)!==b,S=f.UNSUPPORTED_Y;if(n&&i("RegExp",!w||S||p((function(){return _[m]=!1,g(b)!=b||g(_)==_||"/a/i"!=g(b,"i")})))){for(var L=function(e,t){var r,n=this instanceof L,o=c(e),i=void 0===t;if(!n&&o&&e.constructor===L&&i)return e;w?o&&!i&&(e=e.source):e instanceof L&&(i&&(t=u.call(e)),e=e.source),S&&(r=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var s=a(w?new g(e,t):g(e,t),n?this:v,L);return S&&r&&d(s,{sticky:r}),s},x=function(e){e in L||s(L,e,{configurable:!0,get:function(){return g[e]},set:function(t){g[e]=t}})},P=l(g),E=0;P.length>E;)x(P[E++]);v.constructor=L,L.prototype=v,h(o,"RegExp",L)}y("RegExp")},function(e,t,r){var n=r(9),o=r(13),i=r(92),a=r(119).UNSUPPORTED_Y;n&&("g"!=/./g.flags||a)&&o.f(RegExp.prototype,"flags",{configurable:!0,get:i})},function(e,t,r){"use strict";var n=r(22),o=r(6),i=r(3),a=r(92),s=RegExp.prototype,l=s.toString,c=i((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),u="toString"!=l.name;(c||u)&&n(RegExp.prototype,"toString",(function(){var e=o(this),t=String(e.source),r=e.flags;return"/"+t+"/"+String(void 0===r&&e instanceof RegExp&&!("flags"in s)?a.call(e):r)}),{unsafe:!0})},function(e,t,r){"use strict";var n=r(87),o=r(157);e.exports=n("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),o)},function(e,t,r){"use strict";var n=r(0),o=r(94).codeAt;n({target:"String",proto:!0},{codePointAt:function(e){return o(this,e)}})},function(e,t,r){"use strict";var n,o=r(0),i=r(20).f,a=r(10),s=r(120),l=r(24),c=r(121),u=r(40),f="".endsWith,h=Math.min,p=c("endsWith");o({target:"String",proto:!0,forced:!!(u||p||(n=i(String.prototype,"endsWith"),!n||n.writable))&&!p},{endsWith:function(e){var t=String(l(this));s(e);var r=arguments.length>1?arguments[1]:void 0,n=a(t.length),o=void 0===r?n:h(a(r),n),i=String(e);return f?f.call(t,i,o):t.slice(o-i.length,o)===i}})},function(e,t,r){var n=r(0),o=r(47),i=String.fromCharCode,a=String.fromCodePoint;n({target:"String",stat:!0,forced:!!a&&1!=a.length},{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,a=0;n>a;){if(t=+arguments[a++],o(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?i(t):i(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}})},function(e,t,r){"use strict";var n=r(0),o=r(120),i=r(24);n({target:"String",proto:!0,forced:!r(121)("includes")},{includes:function(e){return!!~String(i(this)).indexOf(o(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(95),o=r(6),i=r(10),a=r(24),s=r(122),l=r(96);n("match",1,(function(e,t,r){return[function(t){var r=a(this),n=null==t?void 0:t[e];return void 0!==n?n.call(t,r):new RegExp(t)[e](String(r))},function(e){var n=r(t,e,this);if(n.done)return n.value;var a=o(e),c=String(this);if(!a.global)return l(a,c);var u=a.unicode;a.lastIndex=0;for(var f,h=[],p=0;null!==(f=l(a,c));){var d=String(f[0]);h[p]=d,""===d&&(a.lastIndex=s(c,i(a.lastIndex),u)),p++}return 0===p?null:h}]}))},function(e,t,r){"use strict";var n=r(0),o=r(170).end;n({target:"String",proto:!0,forced:r(171)},{padEnd:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(0),o=r(170).start;n({target:"String",proto:!0,forced:r(171)},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(0),o=r(27),i=r(10);n({target:"String",stat:!0},{raw:function(e){for(var t=o(e.raw),r=i(t.length),n=arguments.length,a=[],s=0;r>s;)a.push(String(t[s++])),s<n&&a.push(String(arguments[s]));return a.join("")}})},function(e,t,r){r(0)({target:"String",proto:!0},{repeat:r(116)})},function(e,t,r){"use strict";var n=r(95),o=r(6),i=r(17),a=r(10),s=r(32),l=r(24),c=r(122),u=r(96),f=Math.max,h=Math.min,p=Math.floor,d=/\$([$&'`]|\d\d?|<[^>]*>)/g,y=/\$([$&'`]|\d\d?)/g;n("replace",2,(function(e,t,r,n){var m=n.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=n.REPLACE_KEEPS_$0,v=m?"$":"$0";return[function(r,n){var o=l(this),i=null==r?void 0:r[e];return void 0!==i?i.call(r,o,n):t.call(String(o),r,n)},function(e,n){if(!m&&g||"string"==typeof n&&-1===n.indexOf(v)){var i=r(t,e,this,n);if(i.done)return i.value}var l=o(e),p=String(this),d="function"==typeof n;d||(n=String(n));var y=l.global;if(y){var _=l.unicode;l.lastIndex=0}for(var w=[];;){var S=u(l,p);if(null===S)break;if(w.push(S),!y)break;""===String(S[0])&&(l.lastIndex=c(p,a(l.lastIndex),_))}for(var L,x="",P=0,E=0;E<w.length;E++){S=w[E];for(var T=String(S[0]),C=f(h(s(S.index),p.length),0),A=[],k=1;k<S.length;k++)A.push(void 0===(L=S[k])?L:String(L));var R=S.groups;if(d){var O=[T].concat(A,C,p);void 0!==R&&O.push(R);var I=String(n.apply(void 0,O))}else I=b(T,p,C,A,R,n);C>=P&&(x+=p.slice(P,C)+I,P=C+T.length)}return x+p.slice(P)}];function b(e,r,n,o,a,s){var l=n+e.length,c=o.length,u=y;return void 0!==a&&(a=i(a),u=d),t.call(s,u,(function(t,i){var s;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,n);case"'":return r.slice(l);case"<":s=a[i.slice(1,-1)];break;default:var u=+i;if(0===u)return t;if(u>c){var f=p(u/10);return 0===f?t:f<=c?void 0===o[f-1]?i.charAt(1):o[f-1]+i.charAt(1):t}s=o[u-1]}return void 0===s?"":s}))}}))},function(e,t,r){"use strict";var n=r(95),o=r(6),i=r(24),a=r(162),s=r(96);n("search",1,(function(e,t,r){return[function(t){var r=i(this),n=null==t?void 0:t[e];return void 0!==n?n.call(t,r):new RegExp(t)[e](String(r))},function(e){var n=r(t,e,this);if(n.done)return n.value;var i=o(e),l=String(this),c=i.lastIndex;a(c,0)||(i.lastIndex=0);var u=s(i,l);return a(i.lastIndex,c)||(i.lastIndex=c),null===u?-1:u.index}]}))},function(e,t,r){"use strict";var n=r(95),o=r(118),i=r(6),a=r(24),s=r(52),l=r(122),c=r(10),u=r(96),f=r(93),h=r(3),p=[].push,d=Math.min,y=!h((function(){return!RegExp(4294967295,"y")}));n("split",2,(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=String(a(this)),i=void 0===r?4294967295:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!o(e))return t.call(n,e,i);for(var s,l,c,u=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,y=new RegExp(e.source,h+"g");(s=f.call(y,n))&&!((l=y.lastIndex)>d&&(u.push(n.slice(d,s.index)),s.length>1&&s.index<n.length&&p.apply(u,s.slice(1)),c=s[0].length,d=l,u.length>=i));)y.lastIndex===s.index&&y.lastIndex++;return d===n.length?!c&&y.test("")||u.push(""):u.push(n.slice(d)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var o=a(this),i=null==t?void 0:t[e];return void 0!==i?i.call(t,o,r):n.call(String(o),t,r)},function(e,o){var a=r(n,e,this,o,n!==t);if(a.done)return a.value;var f=i(e),h=String(this),p=s(f,RegExp),m=f.unicode,g=(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.unicode?"u":"")+(y?"y":"g"),v=new p(y?f:"^(?:"+f.source+")",g),b=void 0===o?4294967295:o>>>0;if(0===b)return[];if(0===h.length)return null===u(v,h)?[h]:[];for(var _=0,w=0,S=[];w<h.length;){v.lastIndex=y?w:0;var L,x=u(v,y?h:h.slice(w));if(null===x||(L=d(c(v.lastIndex+(y?0:w)),h.length))===_)w=l(h,w,m);else{if(S.push(h.slice(_,w)),S.length===b)return S;for(var P=1;P<=x.length-1;P++)if(S.push(x[P]),S.length===b)return S;w=_=L}}return S.push(h.slice(_)),S}]}),!y)},function(e,t,r){"use strict";var n,o=r(0),i=r(20).f,a=r(10),s=r(120),l=r(24),c=r(121),u=r(40),f="".startsWith,h=Math.min,p=c("startsWith");o({target:"String",proto:!0,forced:!!(u||p||(n=i(String.prototype,"startsWith"),!n||n.writable))&&!p},{startsWith:function(e){var t=String(l(this));s(e);var r=a(h(arguments.length>1?arguments[1]:void 0,t.length)),n=String(e);return f?f.call(t,n,r):t.slice(r,r+n.length)===n}})},function(e,t,r){"use strict";var n=r(0),o=r(62).trim;n({target:"String",proto:!0,forced:r(123)("trim")},{trim:function(){return o(this)}})},function(e,t,r){"use strict";var n=r(0),o=r(62).end,i=r(123)("trimEnd"),a=i?function(){return o(this)}:"".trimEnd;n({target:"String",proto:!0,forced:i},{trimEnd:a,trimRight:a})},function(e,t,r){"use strict";var n=r(0),o=r(62).start,i=r(123)("trimStart"),a=i?function(){return o(this)}:"".trimStart;n({target:"String",proto:!0,forced:i},{trimStart:a,trimLeft:a})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("anchor")},{anchor:function(e){return o(this,"a","name",e)}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("big")},{big:function(){return o(this,"big","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("blink")},{blink:function(){return o(this,"blink","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("bold")},{bold:function(){return o(this,"b","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("fixed")},{fixed:function(){return o(this,"tt","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("fontcolor")},{fontcolor:function(e){return o(this,"font","color",e)}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("fontsize")},{fontsize:function(e){return o(this,"font","size",e)}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("italics")},{italics:function(){return o(this,"i","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("link")},{link:function(e){return o(this,"a","href",e)}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("small")},{small:function(){return o(this,"small","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("strike")},{strike:function(){return o(this,"strike","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("sub")},{sub:function(){return o(this,"sub","","")}})},function(e,t,r){"use strict";var n=r(0),o=r(30);n({target:"String",proto:!0,forced:r(31)("sup")},{sup:function(){return o(this,"sup","","")}})},function(e,t,r){r(44)("Float32",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){var n=r(32);e.exports=function(e){var t=n(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},function(e,t,r){r(44)("Float64",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){r(44)("Int8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){r(44)("Int16",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){r(44)("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){r(44)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){r(44)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}),!0)},function(e,t,r){r(44)("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){r(44)("Uint32",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){"use strict";var n=r(8),o=r(146),i=n.aTypedArray;(0,n.exportTypedArrayMethod)("copyWithin",(function(e,t){return o.call(i(this),e,t,arguments.length>2?arguments[2]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=r(19).every,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("every",(function(e){return o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=r(109),i=n.aTypedArray;(0,n.exportTypedArrayMethod)("fill",(function(e){return o.apply(i(this),arguments)}))},function(e,t,r){"use strict";var n=r(8),o=r(19).filter,i=r(52),a=n.aTypedArray,s=n.aTypedArrayConstructor;(0,n.exportTypedArrayMethod)("filter",(function(e){for(var t=o(a(this),e,arguments.length>1?arguments[1]:void 0),r=i(this,this.constructor),n=0,l=t.length,c=new(s(r))(l);l>n;)c[n]=t[n++];return c}))},function(e,t,r){"use strict";var n=r(8),o=r(19).find,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("find",(function(e){return o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=r(19).findIndex,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("findIndex",(function(e){return o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=r(19).forEach,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("forEach",(function(e){o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(124);(0,r(8).exportTypedArrayStaticMethod)("from",r(173),n)},function(e,t,r){"use strict";var n=r(8),o=r(68).includes,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("includes",(function(e){return o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=r(68).indexOf,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("indexOf",(function(e){return o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(4),o=r(8),i=r(85),a=r(7)("iterator"),s=n.Uint8Array,l=i.values,c=i.keys,u=i.entries,f=o.aTypedArray,h=o.exportTypedArrayMethod,p=s&&s.prototype[a],d=!!p&&("values"==p.name||null==p.name),y=function(){return l.call(f(this))};h("entries",(function(){return u.call(f(this))})),h("keys",(function(){return c.call(f(this))})),h("values",y,!d),h(a,y,!d)},function(e,t,r){"use strict";var n=r(8),o=n.aTypedArray,i=n.exportTypedArrayMethod,a=[].join;i("join",(function(e){return a.apply(o(this),arguments)}))},function(e,t,r){"use strict";var n=r(8),o=r(154),i=n.aTypedArray;(0,n.exportTypedArrayMethod)("lastIndexOf",(function(e){return o.apply(i(this),arguments)}))},function(e,t,r){"use strict";var n=r(8),o=r(19).map,i=r(52),a=n.aTypedArray,s=n.aTypedArrayConstructor;(0,n.exportTypedArrayMethod)("map",(function(e){return o(a(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(s(i(e,e.constructor)))(t)}))}))},function(e,t,r){"use strict";var n=r(8),o=r(124),i=n.aTypedArrayConstructor;(0,n.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,r=new(i(this))(t);t>e;)r[e]=arguments[e++];return r}),o)},function(e,t,r){"use strict";var n=r(8),o=r(86).left,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduce",(function(e){return o(i(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=r(86).right,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduceRight",(function(e){return o(i(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=n.aTypedArray,i=n.exportTypedArrayMethod,a=Math.floor;i("reverse",(function(){for(var e,t=o(this).length,r=a(t/2),n=0;n<r;)e=this[n],this[n++]=this[--t],this[t]=e;return this}))},function(e,t,r){"use strict";var n=r(8),o=r(10),i=r(172),a=r(17),s=r(3),l=n.aTypedArray;(0,n.exportTypedArrayMethod)("set",(function(e){l(this);var t=i(arguments.length>1?arguments[1]:void 0,1),r=this.length,n=a(e),s=o(n.length),c=0;if(s+t>r)throw RangeError("Wrong length");for(;c<s;)this[t+c]=n[c++]}),s((function(){new Int8Array(1).set({})})))},function(e,t,r){"use strict";var n=r(8),o=r(52),i=r(3),a=n.aTypedArray,s=n.aTypedArrayConstructor,l=n.exportTypedArrayMethod,c=[].slice;l("slice",(function(e,t){for(var r=c.call(a(this),e,t),n=o(this,this.constructor),i=0,l=r.length,u=new(s(n))(l);l>i;)u[i]=r[i++];return u}),i((function(){new Int8Array(1).slice()})))},function(e,t,r){"use strict";var n=r(8),o=r(19).some,i=n.aTypedArray;(0,n.exportTypedArrayMethod)("some",(function(e){return o(i(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var n=r(8),o=n.aTypedArray,i=n.exportTypedArrayMethod,a=[].sort;i("sort",(function(e){return a.call(o(this),e)}))},function(e,t,r){"use strict";var n=r(8),o=r(10),i=r(47),a=r(52),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("subarray",(function(e,t){var r=s(this),n=r.length,l=i(e,n);return new(a(r,r.constructor))(r.buffer,r.byteOffset+l*r.BYTES_PER_ELEMENT,o((void 0===t?n:i(t,n))-l))}))},function(e,t,r){"use strict";var n=r(4),o=r(8),i=r(3),a=n.Int8Array,s=o.aTypedArray,l=o.exportTypedArrayMethod,c=[].toLocaleString,u=[].slice,f=!!a&&i((function(){c.call(new a(1))}));l("toLocaleString",(function(){return c.apply(f?u.call(s(this)):s(this),arguments)}),i((function(){return[1,2].toLocaleString()!=new a([1,2]).toLocaleString()}))||!i((function(){a.prototype.toLocaleString.call([1,2])})))},function(e,t,r){"use strict";var n=r(8).exportTypedArrayMethod,o=r(3),i=r(4).Uint8Array,a=i&&i.prototype||{},s=[].toString,l=[].join;o((function(){s.call({})}))&&(s=function(){return l.call(this)});var c=a.toString!=s;n("toString",s,c)},function(e,t,r){"use strict";var n,o=r(4),i=r(61),a=r(56),s=r(87),l=r(174),c=r(5),u=r(28).enforce,f=r(137),h=!o.ActiveXObject&&"ActiveXObject"in o,p=Object.isExtensible,d=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},y=e.exports=s("WeakMap",d,l);if(f&&h){n=l.getConstructor(d,"WeakMap",!0),a.REQUIRED=!0;var m=y.prototype,g=m.delete,v=m.has,b=m.get,_=m.set;i(m,{delete:function(e){if(c(e)&&!p(e)){var t=u(this);return t.frozen||(t.frozen=new n),g.call(this,e)||t.frozen.delete(e)}return g.call(this,e)},has:function(e){if(c(e)&&!p(e)){var t=u(this);return t.frozen||(t.frozen=new n),v.call(this,e)||t.frozen.has(e)}return v.call(this,e)},get:function(e){if(c(e)&&!p(e)){var t=u(this);return t.frozen||(t.frozen=new n),v.call(this,e)?b.call(this,e):t.frozen.get(e)}return b.call(this,e)},set:function(e,t){if(c(e)&&!p(e)){var r=u(this);r.frozen||(r.frozen=new n),v.call(this,e)?_.call(this,e,t):r.frozen.set(e,t)}else _.call(this,e,t);return this}})}},function(e,t,r){"use strict";r(87)("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(174))},function(e,t,r){var n=r(4),o=r(175),i=r(148),a=r(25);for(var s in o){var l=n[s],c=l&&l.prototype;if(c&&c.forEach!==i)try{a(c,"forEach",i)}catch(e){c.forEach=i}}},function(e,t,r){var n=r(4),o=r(175),i=r(85),a=r(25),s=r(7),l=s("iterator"),c=s("toStringTag"),u=i.values;for(var f in o){var h=n[f],p=h&&h.prototype;if(p){if(p[l]!==u)try{a(p,l,u)}catch(e){p[l]=u}if(p[c]||a(p,c,f),o[f])for(var d in i)if(p[d]!==i[d])try{a(p,d,i[d])}catch(e){p[d]=i[d]}}}},function(e,t,r){var n=r(0),o=r(4),i=r(117);n({global:!0,bind:!0,enumerable:!0,forced:!o.setImmediate||!o.clearImmediate},{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,r){var n=r(0),o=r(4),i=r(165),a=r(34),s=o.process,l="process"==a(s);n({global:!0,enumerable:!0,noTargetGet:!0},{queueMicrotask:function(e){var t=l&&s.domain;i(t?t.bind(e):e)}})},function(e,t,r){"use strict";r(169);var n,o=r(0),i=r(9),a=r(176),s=r(4),l=r(142),c=r(22),u=r(51),f=r(16),h=r(160),p=r(149),d=r(94).codeAt,y=r(401),m=r(41),g=r(177),v=r(28),b=s.URL,_=g.URLSearchParams,w=g.getState,S=v.set,L=v.getterFor("URL"),x=Math.floor,P=Math.pow,E=/[A-Za-z]/,T=/[\d+\-.A-Za-z]/,C=/\d/,A=/^(0x|0X)/,k=/^[0-7]+$/,R=/^\d+$/,O=/^[\dA-Fa-f]+$/,I=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,M=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,F=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,D=/[\u0009\u000A\u000D]/g,j=function(e,t){var r,n,o;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";if(!(r=N(t.slice(1,-1))))return"Invalid host";e.host=r}else if(H(e)){if(t=y(t),I.test(t))return"Invalid host";if(null===(r=G(t)))return"Invalid host";e.host=r}else{if(M.test(t))return"Invalid host";for(r="",n=p(t),o=0;o<n.length;o++)r+=q(n[o],U);e.host=r}},G=function(e){var t,r,n,o,i,a,s,l=e.split(".");if(l.length&&""==l[l.length-1]&&l.pop(),(t=l.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(o=l[n]))return e;if(i=10,o.length>1&&"0"==o.charAt(0)&&(i=A.test(o)?16:8,o=o.slice(8==i?1:2)),""===o)a=0;else{if(!(10==i?R:8==i?k:O).test(o))return e;a=parseInt(o,i)}r.push(a)}for(n=0;n<t;n++)if(a=r[n],n==t-1){if(a>=P(256,5-t))return null}else if(a>255)return null;for(s=r.pop(),n=0;n<r.length;n++)s+=r[n]*P(256,3-n);return s},N=function(e){var t,r,n,o,i,a,s,l=[0,0,0,0,0,0,0,0],c=0,u=null,f=0,h=function(){return e.charAt(f)};if(":"==h()){if(":"!=e.charAt(1))return;f+=2,u=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=r=0;r<4&&O.test(h());)t=16*t+parseInt(h(),16),f++,r++;if("."==h()){if(0==r)return;if(f-=r,c>6)return;for(n=0;h();){if(o=null,n>0){if(!("."==h()&&n<4))return;f++}if(!C.test(h()))return;for(;C.test(h());){if(i=parseInt(h(),10),null===o)o=i;else{if(0==o)return;o=10*o+i}if(o>255)return;f++}l[c]=256*l[c]+o,2!=++n&&4!=n||c++}if(4!=n)return;break}if(":"==h()){if(f++,!h())return}else if(h())return;l[c++]=t}else{if(null!==u)return;f++,u=++c}}if(null!==u)for(a=c-u,c=7;0!=c&&a>0;)s=l[c],l[c--]=l[u+a-1],l[u+--a]=s;else if(8!=c)return;return l},B=function(e){var t,r,n,o;if("number"==typeof e){for(t=[],r=0;r<4;r++)t.unshift(e%256),e=x(e/256);return t.join(".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,o=0,i=0;i<8;i++)0!==e[i]?(o>r&&(t=n,r=o),n=null,o=0):(null===n&&(n=i),++o);return o>r&&(t=n,r=o),t}(e),r=0;r<8;r++)o&&0===e[r]||(o&&(o=!1),n===r?(t+=r?":":"::",o=!0):(t+=e[r].toString(16),r<7&&(t+=":")));return"["+t+"]"}return e},U={},z=h({},U,{" ":1,'"':1,"<":1,">":1,"`":1}),W=h({},z,{"#":1,"?":1,"{":1,"}":1}),Y=h({},W,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),q=function(e,t){var r=d(e,0);return r>32&&r<127&&!f(t,e)?e:encodeURIComponent(e)},V={ftp:21,file:null,http:80,https:443,ws:80,wss:443},H=function(e){return f(V,e.scheme)},J=function(e){return""!=e.username||""!=e.password},Q=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},Z=function(e,t){var r;return 2==e.length&&E.test(e.charAt(0))&&(":"==(r=e.charAt(1))||!t&&"|"==r)},X=function(e){var t;return e.length>1&&Z(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},K=function(e){var t=e.path,r=t.length;!r||"file"==e.scheme&&1==r&&Z(t[0],!0)||t.pop()},$=function(e){return"."===e||"%2e"===e.toLowerCase()},ee={},te={},re={},ne={},oe={},ie={},ae={},se={},le={},ce={},ue={},fe={},he={},pe={},de={},ye={},me={},ge={},ve={},be={},_e={},we=function(e,t,r,o){var i,a,s,l,c,u=r||ee,h=0,d="",y=!1,m=!1,g=!1;for(r||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(F,"")),t=t.replace(D,""),i=p(t);h<=i.length;){switch(a=i[h],u){case ee:if(!a||!E.test(a)){if(r)return"Invalid scheme";u=re;continue}d+=a.toLowerCase(),u=te;break;case te:if(a&&(T.test(a)||"+"==a||"-"==a||"."==a))d+=a.toLowerCase();else{if(":"!=a){if(r)return"Invalid scheme";d="",u=re,h=0;continue}if(r&&(H(e)!=f(V,d)||"file"==d&&(J(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=d,r)return void(H(e)&&V[e.scheme]==e.port&&(e.port=null));d="","file"==e.scheme?u=pe:H(e)&&o&&o.scheme==e.scheme?u=ne:H(e)?u=se:"/"==i[h+1]?(u=oe,h++):(e.cannotBeABaseURL=!0,e.path.push(""),u=ve)}break;case re:if(!o||o.cannotBeABaseURL&&"#"!=a)return"Invalid scheme";if(o.cannotBeABaseURL&&"#"==a){e.scheme=o.scheme,e.path=o.path.slice(),e.query=o.query,e.fragment="",e.cannotBeABaseURL=!0,u=_e;break}u="file"==o.scheme?pe:ie;continue;case ne:if("/"!=a||"/"!=i[h+1]){u=ie;continue}u=le,h++;break;case oe:if("/"==a){u=ce;break}u=ge;continue;case ie:if(e.scheme=o.scheme,a==n)e.username=o.username,e.password=o.password,e.host=o.host,e.port=o.port,e.path=o.path.slice(),e.query=o.query;else if("/"==a||"\\"==a&&H(e))u=ae;else if("?"==a)e.username=o.username,e.password=o.password,e.host=o.host,e.port=o.port,e.path=o.path.slice(),e.query="",u=be;else{if("#"!=a){e.username=o.username,e.password=o.password,e.host=o.host,e.port=o.port,e.path=o.path.slice(),e.path.pop(),u=ge;continue}e.username=o.username,e.password=o.password,e.host=o.host,e.port=o.port,e.path=o.path.slice(),e.query=o.query,e.fragment="",u=_e}break;case ae:if(!H(e)||"/"!=a&&"\\"!=a){if("/"!=a){e.username=o.username,e.password=o.password,e.host=o.host,e.port=o.port,u=ge;continue}u=ce}else u=le;break;case se:if(u=le,"/"!=a||"/"!=d.charAt(h+1))continue;h++;break;case le:if("/"!=a&&"\\"!=a){u=ce;continue}break;case ce:if("@"==a){y&&(d="%40"+d),y=!0,s=p(d);for(var v=0;v<s.length;v++){var b=s[v];if(":"!=b||g){var _=q(b,Y);g?e.password+=_:e.username+=_}else g=!0}d=""}else if(a==n||"/"==a||"?"==a||"#"==a||"\\"==a&&H(e)){if(y&&""==d)return"Invalid authority";h-=p(d).length+1,d="",u=ue}else d+=a;break;case ue:case fe:if(r&&"file"==e.scheme){u=ye;continue}if(":"!=a||m){if(a==n||"/"==a||"?"==a||"#"==a||"\\"==a&&H(e)){if(H(e)&&""==d)return"Invalid host";if(r&&""==d&&(J(e)||null!==e.port))return;if(l=j(e,d))return l;if(d="",u=me,r)return;continue}"["==a?m=!0:"]"==a&&(m=!1),d+=a}else{if(""==d)return"Invalid host";if(l=j(e,d))return l;if(d="",u=he,r==fe)return}break;case he:if(!C.test(a)){if(a==n||"/"==a||"?"==a||"#"==a||"\\"==a&&H(e)||r){if(""!=d){var w=parseInt(d,10);if(w>65535)return"Invalid port";e.port=H(e)&&w===V[e.scheme]?null:w,d=""}if(r)return;u=me;continue}return"Invalid port"}d+=a;break;case pe:if(e.scheme="file","/"==a||"\\"==a)u=de;else{if(!o||"file"!=o.scheme){u=ge;continue}if(a==n)e.host=o.host,e.path=o.path.slice(),e.query=o.query;else if("?"==a)e.host=o.host,e.path=o.path.slice(),e.query="",u=be;else{if("#"!=a){X(i.slice(h).join(""))||(e.host=o.host,e.path=o.path.slice(),K(e)),u=ge;continue}e.host=o.host,e.path=o.path.slice(),e.query=o.query,e.fragment="",u=_e}}break;case de:if("/"==a||"\\"==a){u=ye;break}o&&"file"==o.scheme&&!X(i.slice(h).join(""))&&(Z(o.path[0],!0)?e.path.push(o.path[0]):e.host=o.host),u=ge;continue;case ye:if(a==n||"/"==a||"\\"==a||"?"==a||"#"==a){if(!r&&Z(d))u=ge;else if(""==d){if(e.host="",r)return;u=me}else{if(l=j(e,d))return l;if("localhost"==e.host&&(e.host=""),r)return;d="",u=me}continue}d+=a;break;case me:if(H(e)){if(u=ge,"/"!=a&&"\\"!=a)continue}else if(r||"?"!=a)if(r||"#"!=a){if(a!=n&&(u=ge,"/"!=a))continue}else e.fragment="",u=_e;else e.query="",u=be;break;case ge:if(a==n||"/"==a||"\\"==a&&H(e)||!r&&("?"==a||"#"==a)){if(".."===(c=(c=d).toLowerCase())||"%2e."===c||".%2e"===c||"%2e%2e"===c?(K(e),"/"==a||"\\"==a&&H(e)||e.path.push("")):$(d)?"/"==a||"\\"==a&&H(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&Z(d)&&(e.host&&(e.host=""),d=d.charAt(0)+":"),e.path.push(d)),d="","file"==e.scheme&&(a==n||"?"==a||"#"==a))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==a?(e.query="",u=be):"#"==a&&(e.fragment="",u=_e)}else d+=q(a,W);break;case ve:"?"==a?(e.query="",u=be):"#"==a?(e.fragment="",u=_e):a!=n&&(e.path[0]+=q(a,U));break;case be:r||"#"!=a?a!=n&&("'"==a&&H(e)?e.query+="%27":e.query+="#"==a?"%23":q(a,U)):(e.fragment="",u=_e);break;case _e:a!=n&&(e.fragment+=q(a,z))}h++}},Se=function(e){var t,r,n=u(this,Se,"URL"),o=arguments.length>1?arguments[1]:void 0,a=String(e),s=S(n,{type:"URL"});if(void 0!==o)if(o instanceof Se)t=L(o);else if(r=we(t={},String(o)))throw TypeError(r);if(r=we(s,a,null,t))throw TypeError(r);var l=s.searchParams=new _,c=w(l);c.updateSearchParams(s.query),c.updateURL=function(){s.query=String(l)||null},i||(n.href=xe.call(n),n.origin=Pe.call(n),n.protocol=Ee.call(n),n.username=Te.call(n),n.password=Ce.call(n),n.host=Ae.call(n),n.hostname=ke.call(n),n.port=Re.call(n),n.pathname=Oe.call(n),n.search=Ie.call(n),n.searchParams=Me.call(n),n.hash=Fe.call(n))},Le=Se.prototype,xe=function(){var e=L(this),t=e.scheme,r=e.username,n=e.password,o=e.host,i=e.port,a=e.path,s=e.query,l=e.fragment,c=t+":";return null!==o?(c+="//",J(e)&&(c+=r+(n?":"+n:"")+"@"),c+=B(o),null!==i&&(c+=":"+i)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(c+="?"+s),null!==l&&(c+="#"+l),c},Pe=function(){var e=L(this),t=e.scheme,r=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&H(e)?t+"://"+B(e.host)+(null!==r?":"+r:""):"null"},Ee=function(){return L(this).scheme+":"},Te=function(){return L(this).username},Ce=function(){return L(this).password},Ae=function(){var e=L(this),t=e.host,r=e.port;return null===t?"":null===r?B(t):B(t)+":"+r},ke=function(){var e=L(this).host;return null===e?"":B(e)},Re=function(){var e=L(this).port;return null===e?"":String(e)},Oe=function(){var e=L(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Ie=function(){var e=L(this).query;return e?"?"+e:""},Me=function(){return L(this).searchParams},Fe=function(){var e=L(this).fragment;return e?"#"+e:""},De=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(i&&l(Le,{href:De(xe,(function(e){var t=L(this),r=String(e),n=we(t,r);if(n)throw TypeError(n);w(t.searchParams).updateSearchParams(t.query)})),origin:De(Pe),protocol:De(Ee,(function(e){var t=L(this);we(t,String(e)+":",ee)})),username:De(Te,(function(e){var t=L(this),r=p(String(e));if(!Q(t)){t.username="";for(var n=0;n<r.length;n++)t.username+=q(r[n],Y)}})),password:De(Ce,(function(e){var t=L(this),r=p(String(e));if(!Q(t)){t.password="";for(var n=0;n<r.length;n++)t.password+=q(r[n],Y)}})),host:De(Ae,(function(e){var t=L(this);t.cannotBeABaseURL||we(t,String(e),ue)})),hostname:De(ke,(function(e){var t=L(this);t.cannotBeABaseURL||we(t,String(e),fe)})),port:De(Re,(function(e){var t=L(this);Q(t)||(""==(e=String(e))?t.port=null:we(t,e,he))})),pathname:De(Oe,(function(e){var t=L(this);t.cannotBeABaseURL||(t.path=[],we(t,e+"",me))})),search:De(Ie,(function(e){var t=L(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",we(t,e,be)),w(t.searchParams).updateSearchParams(t.query)})),searchParams:De(Me),hash:De(Fe,(function(e){var t=L(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",we(t,e,_e)):t.fragment=null}))}),c(Le,"toJSON",(function(){return xe.call(this)}),{enumerable:!0}),c(Le,"toString",(function(){return xe.call(this)}),{enumerable:!0}),b){var je=b.createObjectURL,Ge=b.revokeObjectURL;je&&c(Se,"createObjectURL",(function(e){return je.apply(b,arguments)})),Ge&&c(Se,"revokeObjectURL",(function(e){return Ge.apply(b,arguments)}))}m(Se,"URL"),o({global:!0,forced:!a,sham:!i},{URL:Se})},function(e,t,r){"use strict";var n=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,i="Overflow: input needs wider integers to process",a=Math.floor,s=String.fromCharCode,l=function(e){return e+22+75*(e<26)},c=function(e,t,r){var n=0;for(e=r?a(e/700):e>>1,e+=a(e/t);e>455;n+=36)e=a(e/35);return a(n+36*e/(e+38))},u=function(e){var t,r,n=[],o=(e=function(e){for(var t=[],r=0,n=e.length;r<n;){var o=e.charCodeAt(r++);if(o>=55296&&o<=56319&&r<n){var i=e.charCodeAt(r++);56320==(64512&i)?t.push(((1023&o)<<10)+(1023&i)+65536):(t.push(o),r--)}else t.push(o)}return t}(e)).length,u=128,f=0,h=72;for(t=0;t<e.length;t++)(r=e[t])<128&&n.push(s(r));var p=n.length,d=p;for(p&&n.push("-");d<o;){var y=2147483647;for(t=0;t<e.length;t++)(r=e[t])>=u&&r<y&&(y=r);var m=d+1;if(y-u>a((2147483647-f)/m))throw RangeError(i);for(f+=(y-u)*m,u=y,t=0;t<e.length;t++){if((r=e[t])<u&&++f>2147483647)throw RangeError(i);if(r==u){for(var g=f,v=36;;v+=36){var b=v<=h?1:v>=h+26?26:v-h;if(g<b)break;var _=g-b,w=36-b;n.push(s(l(b+_%w))),g=a(_/w)}n.push(s(l(g))),h=c(f,m,d==p),f=0,++d}}++f,++u}return n.join("")};e.exports=function(e){var t,r,i=[],a=e.toLowerCase().replace(o,".").split(".");for(t=0;t<a.length;t++)r=a[t],i.push(n.test(r)?"xn--"+u(r):r);return i.join(".")}},function(e,t,r){var n=r(6),o=r(74);e.exports=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return n(t.call(e))}},function(e,t,r){"use strict";r(0)({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},function(e,t,r){var n=function(e){"use strict";var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r,n){var o=t&&t.prototype instanceof u?t:u,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=b(a,r);if(s){if(s===c)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function u(){}function f(){}function h(){}var p={};p[o]=function(){return this};var d=Object.getPrototypeOf,y=d&&d(d(L([])));y&&y!==t&&r.call(y,o)&&(p=y);var m=h.prototype=u.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function v(e,t){var n;this._invoke=function(o,i){function a(){return new t((function(n,a){!function n(o,i,a,s){var c=l(e[o],e,i);if("throw"!==c.type){var u=c.arg,f=u.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(f).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return f.prototype=m.constructor=h,h.constructor=f,h[a]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(v.prototype),v.prototype[i]=function(){return this},e.AsyncIterator=v,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new v(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(m),m[a]="Generator",m[o]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;w(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:L(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t){var r=["3.1.0-beta.01","3.1.0-beta.02","3.1.0-beta.03"];e.exports=r[r.length-1]},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2),__webpack_require__(23),__webpack_require__(1)],__WEBPACK_AMD_DEFINE_RESULT__=function(CommonUtil,LoggerUtil,g2){var extend={includeGetSymbol:function includeGetSymbol(component){component.include({_getSymbol_Zoom:function(e){return isNaN(e)&&(e=this.map.getZoomLevel()),e},_getSymbol_DataObj:function(e,t){if(t)return e[this.options.attributeField]},_getDataOrData2:function(e,t){return null==e?t:e},_getSymbol_symKeyLookstr:function(e,t){return e.endsWith(t)&&(e=e.substr(0,e.length-3)),e},_getSymbol_symKeyObj:function(e,t){for(var r,n,o=0,i=e.length,a="",s=0;o<i;o++){var l=e[o];if(l){var c=t[l.field],u=l.values;if(u){for(r=u.length,s=0,n=null;s<r&&(n=u[s],!CommonUtil.assertWithin(c,n));s++);n&&(a+=l.field+"$=$"+u[s]+"$_$")}}}return{symKey:a,rangeStr:n}},_getSymbolObjByKey:function(e){for(var t=0,r=this.allSymbols.length;t<r;t++){var n=this.allSymbols[t];if(n&&n.symbolKey==e)return n}return null},_doGetSymbol:function(e,t,r){var n=t.label,o=t.symbol||r;if(n&&n.enable){var i=n.options||{};i.text=this._getLabelText(e,n.textFormat);var a={textSymbol:this._createSymbol("TextSymbol",i)};return o instanceof g2.sfs.SimpleMarkerSymbol||o instanceof g2.sfs.PictureMarkerSymbol?a.markerSymbol=o:o instanceof g2.sfs.SimpleLineSymbol?a.lineSymbol=o:o instanceof g2.sfs.SimpleFillSymbol&&(a.fillSymbol=o),new g2.sfs.CurrencySymbol(a)}return o},_onSymbolsUpdated:function(){if(this._invokeSymbolUpdateCallback){for(var e,t=0,r=(e=this.layer.elements).length,n=[];t<r;t++){var o=e[t]._symbolKey;if(o){if(this._getSymbolObj(o,n))continue;var i=this._getSymbolObj(o,this.allSymbols);n.push(i)}}this.currentSymbols=null,this.currentSymbols=n,this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:n})}},_onElementChanged:function(){var e=this.elements||this.features,t=[];if(0==e.length)this._currentExtent=[NaN,NaN,NaN,NaN];else{for(var r=0,n=e.length;r<n;r++){var o=e[r];o&&o.geometry&&t.push(o.geometry)}var i=G.utils.GeometryUtil.getGeometryEnvlop(t);this._currentExtent=this._envelopeFromGeom(i)}},_fetchSymbolConfig:function _fetchSymbolConfig(data,renderer){if(!renderer)return null;if("zoomLevel"==renderer.type)return renderer;var valueCfg=renderer.values,key,value=eval("data."+renderer.field);for(key in valueCfg)if(CommonUtil.assertWithin(value,key)){var cfg=valueCfg[key];return cfg.renderer?this._fetchSymbolConfig(data,cfg.renderer):cfg}return null},_getLabelText:function(e,t){if(!t)return"";var r=/([\w\_\-\d]+)/g,n=t.match(/(\$\{[\w\_\-\d]{0,}\})/g),o=t;if(n&&n.length>0)for(var i=0,a=n.length;i<a;i++){var s=n[i],l="",c=s.match(r);c&&1==c.length&&(l=e[c[0]]||""),o=o.replace(s,l)}return o}})},includeFindElementById:function(e){e.include({_getElementLayerById:function(e,t){var r=e.find(t),n=void 0;return null!=r&&(n={element:r,layer:e}),n},_getGroupLayerLayerById:function(e,t){var r=e.groupLayers;for(var n in r){var o=this._getLayerElementById(r[n],t);if(o)return o}return o},_getFeatureLayerById:function(e,t){for(var r=e.features,n=0,o=r.length;n<o;n++){var i=r[n];if(i&&i.objectId==t)return{element:i,layer:e}}},_getLayerElementById:function(e,t){var r=void 0;return e instanceof g2.carto.ElementLayer||e instanceof g2.carto.ClusterLayer?r=this._getElementLayerById(e,t):e instanceof g2.carto.GroupLayer?r=this._getGroupLayerLayerById(e,t):e instanceof g2.carto.FeatureLayer?r=this._getFeatureLayerById(e,t):(LoggerUtil.error("Unkown Type layer!!!"),LoggerUtil.error(e,t)),r}})},includeParseSymbolCfg:function includeParseSymbolCfg(component){component.include({_getSymbolObj:function(e,t){for(var r=t||this.allSymbols,n=0,o=r.length;n<o;n++){var i=r[n];if(i&&i.symbolKey==e)return i}return null},_getSymbolCfg:function(e,t){this.symbolConfig?(this._parseSymbolCfg(this.symbolConfig),CommonUtil.isFunction(e)&&e.call(t||window,this.symbolConfig)):CommonUtil.ajaxGet({url:this.options.symbolConfigUrl,dataType:"json",async:!1},(function(r){this._parseSymbolCfg(r),CommonUtil.isFunction(e)&&e.call(t||window,r)}),this)},_setValid_SymOptsSource:function(e){e&&e.sourceKey&&!e.source&&(e.source="")},_getValidObj:function(e){return null==e?{}:e},_parseSymbolCfg:function _parseSymbolCfg(cfg){var selfObj=this;if(cfg){this.symbolConfig=null,delete this.symbolConfig,this.symbolConfig_=null,delete this.symbolConfig_,this.symbolConfig_=jQuery.extend(!0,{},cfg);var defaultSym=this._getValidObj(cfg.default);defaultSym.type&&defaultSym.options&&(cfg.defaultSymbol=this._createSymbol(defaultSym.type,defaultSym.options));var tmpLabel=this._getValidObj(cfg.label);cfg.label=jQuery.extend(!0,{enable:!1,options:{},textFormat:""},tmpLabel),this.renderFields=[];var allSymbols=[{symbolKey:this.options.defaultSymbolKey,title:cfg.title,symbol:cfg.defaultSymbol,label:cfg.label}];this.allSymbols=allSymbols,_handlerRenderer(cfg,cfg,"",this._createSymbol,this.renderFields,this),this.symbolConfig=cfg}function _handlerRenderer(e,t,r,n,o,i){var a,s=e.renderer;if(!s)return!1;if("zoomLevel"==s.type)t.renderZoom=!0,r+="zoomLevel$=$";else{var l=s.field;ensureFieldUnique(o,s),r+=l+"$=$"}var c=s.values;for(a in c){var u=c[a],f=r;if(f+=a+"$_$",u.renderer)_handlerRenderer(u,t,f,n,o,i);else{var h=jQuery.extend(!0,{},t.default);u.symbol=selfObj._getValidObj(u.symbol);var p=u.symbol.options;if(selfObj._setValid_SymOptsSource(p),h=jQuery.extend(!0,h,u.symbol),u.symbol=n.call(i,h.type,h.options),u.title=u.title||e.title,u.symbolKey=f.substr(0,f.length-3),t.label.enable)if(!1===u.label);else{var d=jQuery.extend(!0,{},t.label);u.label=selfObj._getValidObj(u.label),d=jQuery.extend(!0,d,u.label),u.label=d}else u.label=!1;allSymbols.push({symbolKey:u.symbolKey,title:u.title,symbol:u.symbol,label:u.label})}}return!0}function ensureFieldUnique(fields,cfg){for(var k=0,len=fields.length;k<len;k++){var field=fields[k];if(field&&field.field==cfg.field)return}var values=[],vals=cfg.values||{};for(var k in vals){var regVal=null;try{var reg=eval(k);reg instanceof RegExp&&(regVal=reg)}catch(e){}values.push(regVal||k)}var field={field:cfg.field,values:values};fields.push(field)}}})},includeGenerateNewSymbol:function(e){e.include({_getIconSource:function(e){if(e)return e.indexOf(".")<0?G.icons[e]:G.utils.CommonUtil.getValByVarPath(e)},_generateNewSymbol:function(e,t){var r=null,n={},o=e.$type.split(",")[0],i=this;function a(e,t){var r;return e&&(r=i._generateNewSymbol(e,t)),r}var s=function(e,t){var r=null;if(CommonUtil.isObject(t))e==t.type&&(r=t);else if(CommonUtil.isArray(t))for(var n=0,o=t.length;n<o;n++){var i=t[n];if(i&&i.type==e){r=i;break}}return r||{}}(o,t);jQuery.extend(!0,n,s.options||{});var l={PictureMarkerSymbol:function(){var t=e.sourceKey+"_hl";return n.source=i._getIconSource(t),i._createSymbol(o,n)},SimpleMarkerSymbol:function(){return i._createSymbol(o,n)},SimpleLineSymbol:function(){return i._createSymbol(o,n)},SimpleFillSymbol:function(){return i._createSymbol(o,n)},CurrencySymbol:function(){var r,n,o,i=e.fillSymbol||null,s=e.markerSymbol||null,l=e.textSymbol||null;return r=a(i,t),n=a(s,t),o=a(l,t),new g2.sfs.CurrencySymbol({fillSymbol:r,markerSymbol:n,textSymbol:o})}};return"function"==typeof l[o]&&(r=l[o]()),r}})}};return extend}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,r){"use strict";var n,o;n=[r(78),r(2),r(23),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{symbolConfig:!1,xField:"longitude",yField:"latitude",metaData:{}},initialize:function(t){this.noneSpatialArr=[],this.features=[],e.prototype.initialize.call(this,t),this.metaData=this.options.metaData||{},delete this.options.metaData,this.currentZoom=this.map.getZoomLevel(),this.layer=new n.carto.GroupLayer({id:this.options.layerId,name:this.options.layerName||"",map:this.map,layers:[]}),this.featureLayersHolder={}},_addListeners:function(){e.prototype._addListeners.call(this),this.map.listen("extentchanged",this._getExtentChangeListener())},_removeListeners:function(){this.map.off("extentchanged",this._getExtentChangeListener()),e.prototype._removeListeners.call(this)},_getExtentChangeListener:function(){if(!this._extentChangeListener){var e=this;this._extentChangeListener=function(t){var r=e.map.getZoomLevel();e.updateSymbol(r),e.currentZoom=r}}return this._extentChangeListener},_getMapClickListener:function(){if(!this._mapClickListener){this._mapClickListener=function(){}}return this._mapClickListener},addElements:function(e,t){if(e){t=t||{};var o=this._getFields(this.metaData);this.metaFields=o;var i,a,s,l=0;a=(new Date).getTime();for(var c=e.length,u=o.getCount(),f=this.map.getZoomLevel(),h=this.options.attributeField,p=this.options.spatialReference,d=t.dataSpatialReference||this.options.dataSpatialReference,y=0;y<e.length;y++){var m=e[y],g=this._getGeometry(m,d,p);if(this.validateGeometry(g)){var v,b=[];v=h?m[h]||{}:m;for(var _=0;_<u;_++){var w=o.fields[_],S=new n.sfs.Value;S.setValue(v[w.name]||null),b.push(S)}var L=this._getRecordId(m),x=new n.sfs.Feature({fields:o,values:b,geometry:g,objectId:L});x._data=m,this.features.push(x),i=(new Date).getTime();var P=this._getSymbol(v,f);l+=(new Date).getTime()-i,this._addFeature(x,P)}else this.noneSpatialArr.push(m)}r.info("feature count :"+c),r.info("fetch symbol costs :"+l),this._addFeatures2Layer(),this._updateFeatureLayers({visible:!0}),this._onSymbolsUpdated(),this._onElementChanged(),s=(new Date).getTime(),r.info("total costs :"+(s-a))}},_addFeature:function(e,t){if(t&&t.symbol){var r=t.symbolKey||this.options.defaultSymbolKey,o=this.featureLayersHolder[r]||{},i=o.layer;if(!i)i=new n.carto.FeatureLayer({map:this.map,visible:!1,cache:!0}),this.layer.addLayer(i),o={renderer:new n.render.SimpleRenderer({symbol:t.symbol}),layer:i,zoomRanges:t.zoomRanges},this.featureLayersHolder[r]=o;o.featureSet||(o.featureSet=new n.sfs.FeatureSet({fields:this.metaFields})),o.featureSet.add(e)}},_addFeatures2Layer:function(){for(var e in this.featureLayersHolder){var t=this.featureLayersHolder[e],r=t.featureSet,n=t.layer;t.featureSet=null,r&&n.addFeatures(r)}},_updateFeatureLayers:function(e){var t,r=(e=e||{}).visible||!1;for(t in this.featureLayersHolder){var n=this.featureLayersHolder[t];r?n&&(n.layer.setVisible(!0),n.layer.render(n.renderer)):n.layer.setVisible(!1)}this.layer.setVisible(r)},_getFields:function(e){var t=new n.sfs.Fields;if(e)for(var r=e.model||[],o=r.length,i=0;i<o;i++){var a=r[i];if(a){var s=new n.sfs.Field({name:a.fieldName,alias:a.fieldNote,dataType:a.fieldType,isShape:!1});t.add(s)}}return t},getElementSymbol:function(e){var t,r=this.featureLayersHolder;for(t in r){var n=r[t];if(n){var o=n.layer,i=n.renderer;if(o&&i)for(var a=o.features,s=0,l=a.length;s<l;s++){var c=a[s];if(c&&c.objectId==e)return i.symbol}}}return null},updateSymbol:function(e){var r,o=this.featureLayersHolder,i=0;for(r in o)if(!(r.indexOf("zoomLevel$=$")<0)){for(var a,s=o[r],l=r.split("$_$"),c=l[l.length-1].split("$=$")[1],u=s.zoomRanges,f=l.slice(0,l.length-1),h=0,p=u.length;h<p;h++){var d=u[h];if(t.assertWithin(e,d)){a=d,f.push("zoomLevel$=$"+d);break}}if(a!=c){var y=f.join("$_$"),m=this._getSymbolObjByKey(y),g=new n.render.SimpleRenderer({symbol:m.symbol});s.renderer=g,s.layer.render(s.renderer),delete o[r],o[m.symbolKey]=s,i++}}i>0&&this._onSymbolsUpdated()},_createSymbol:function(t,r){return e.prototype._createSymbol.call(this,t,r)},removeElements:function(e){if(t.isArray(e)){for(var n=e.length-1;n>=0;n--){var o,i=e[n];o="string"==typeof i?i:i.objectId;var a=this._getLayerElementById(this.layer,o);if(a&&a.layer&&a.element)try{a.layer.remove(a.element)}catch(e){r.warn("fail to delete feature with objectId:"+o+"!")}}this._onSymbolsUpdated(),this._onElementChanged()}},_onSymbolsUpdated:function(){var e,t=this.featureLayersHolder,r=[];for(e in t){var n=t[e];if(n){var o=n.layer;if(o&&o.visible&&o.features.length>0){var i=this._getSymbolObj(e);i&&r.push(i)}}}this.currentSymbols=null,this.currentSymbols=r,this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:r})},hitTest:function(e,t){var r=this.getLayer(),o=[];if(r&&r.visible)if(r instanceof n.carto.GroupLayer)for(var i=r.groupLayers,a=i.length-1;a>=0;a--){s(i[a],e,t,o)}else s(r,e,t,o);function s(e,t,r,n){var o=e.hitTest(t,r);o&&n.push(o)}return o[0]||void 0},getElements:function(){return this.features},clear:function(){this.features=[];for(var t=this.layer.groupLayers,r=0,n=t.length;r<n;r++){var o=t[r];o&&o.clear&&o.clear()}e.prototype.clear.call(this)},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(o,"type",{value:12,configurable:!1,writable:!1}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(127),r(2),r(23),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{},initialize:function(t){e.prototype.initialize.call(this,t),this._defaultClusterStyle={textFillColor:{alpha:255,r:255,g:255,b:255},fillColor:{alpha:200,r:0,g:0,b:255},fillStrokeColor:{alpha:100,r:0,g:0,b:255},fillStrokeWidth:10,distance:10,clusterLevel:10};var r=this.symbolConfig.cluster||this._defaultClusterStyle;this._clusterSymbol=jQuery.extend(!0,{$type:"pixelcluster"},r),this._clusterSymbol.fillStrokeColor=this._getColor(this._clusterSymbol.fillStrokeColor),this._clusterSymbol.fillColor=this._getColor(this._clusterSymbol.fillColor),this._clusterSymbol.textFillColor=this._getColor(this._clusterSymbol.textFillColor);var o=["textFillColor","fillColor","fillStrokeColor"];for(var i in o){var a=r[o[i]];a&&(r[o[i]]=this._getColor(a).toArray())}var s={id:this.options.layerId,name:this.options.layerName,map:this.map},l=jQuery.extend(s,r);this.layer=new n.carto.ClusterLayer(l),isNaN(l.clusterLevel)||this.layer.setClusterLevel(l.clusterLevel)},_addListeners:function(){e.prototype._addListeners.call(this)},_removeListeners:function(){e.prototype._removeListeners.call(this)},_zoomChangeListener:function(e){this.updateSymbol(this.map.getZoomLevel())},addElements:function(e,o){if(t.isArray(e)){o=o||{};for(var i=this.map.getZoomLevel(),a=this.options.spatialReference,s=o.dataSpatialReference||this.options.dataSpatialReference,l=0,c=e.length;l<c;l++){var u=e[l],f=this._getGeometry(u,s,a);if(f){var h=this._getSymbol(u,i),p=this._getRecordId(u),d=new n.sfs.Element({id:p,geometry:f,symbol:h.symbol});d._data=u,d._zoomRange=h.zoomRange,d._symbolKey=h.symbolKey,this.elements.push(d)}else this.noneSpatialArr.push(u)}this.layer.addElements(this.elements),this._onSymbolsUpdated(),this._onElementChanged()}else r.error("dataArr is not an array")},removeElements:function(e){if(t.isArray(e)){for(var r=e.length-1;r>=0;r--){var n=e[r];this.layer.remove(n)}this._onSymbolsUpdated(),this._onElementChanged()}},_onSymbolsUpdated:function(){for(var e=this.layer.elements,t=0,r=e.length,n=[];t<r;t++){var o=e[t]._symbolKey;if(o){if(this._getSymbolObj(o,n))continue;var i=this._getSymbolObj(o,this.allSymbols);n.push(i)}}n.length>0&&n.push({symbolKey:"pixel-cluster",symbol:this._clusterSymbol,title:this.options.layerName+"像素聚合"}),this.currentSymbols=null,this.currentSymbols=n,this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:n})},clear:function(){e.prototype.clear.call(this)},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(o,"type",{value:13,configurable:!1,writable:!1}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(127),r(410),r(2),r(12),r(128),r(23),r(1)],void 0===(o=function(e,t,r,n,o,i,a){var s=e.extend({options:{spiderfyDistance:1,spiderfyLevel:10,enableCoincidenceClusterLevel:"[0,10000]",coincidenceClusterHoverThreshold:15,coincidenceClusterWeight:1.2,coincidenceClusterMarkerSym:{borderColor:{alpha:150,r:150,g:120,b:226},fillColor:{alpha:220,r:106,g:63,b:214}},coincidenceClusterTextSym:{fontSize:12,foreground:{alpha:255,r:255,g:255,b:255},borderColor:{alpha:1,r:255,g:255,b:255}},showSpiderLeg:!0,spiderfyThreshold:5,circleRadius:30,spiderfyLegSym:{style:0,width:2,color:{alpha:"150",r:0,g:0,b:255}}},initialize:function(r){e.prototype.initialize.call(this,r),this.options.enalbeSpiderfy=!0,this.options.enableCoincidenceCluster=!0,t.init.call(this)},destroy:function(){this._clearSpiderfy(!0),e.prototype.destroy.call(this)},addElements:function(e,t){if(r.isArray(e)){t=t||{};var n=this.map.getZoomLevel(),o=this.options.spatialReference,s=t.dataSpatialReference||this.options.dataSpatialReference,l=!1;this.options.enalbeSpiderfy&&(n>=this.options.spiderfyLevel?l="spiderfy":this.options.enableCoincidenceCluster&&r.assertWithin(this.map.getZoomLevel(),this.options.enableCoincidenceClusterLevel)&&(l="cluster"));for(var c=0,u=e.length;c<u;c++){var f=e[c],h=this._getGeometry(f,s,o);if(this.validateGeometry(h)){var p=this._getSymbol(f,n),d=this._getRecordId(f),y=new a.sfs.Element({id:d,geometry:h,symbol:p.symbol});y._data=f,y._zoomRange=p.zoomRange,y._symbolKey=p.symbolKey,this.elements.push(y),l||this.layer.add(y)}else this.noneSpatialArr.push(f)}l&&this._updateSpiderfy(l),this._onSymbolsUpdated(),this._onElementChanged()}else i.error("dataArr is not an array")},hitTest:function(e,t){var r,n=[];((r=this.layer.hitTest(e,t))&&n.push(r),this.coincidenceHoverLayer)&&((r=this.coincidenceHoverLayer.hitTest(e,t))&&n.push(r));return n[0]||null},clear:function(){this._clearSpiderfy(),this.elements=[],e.prototype.clear.call(this)},setVisible:function(e){this.layer.setVisible(e||!1),this.options.enalbeSpiderfy&&(this.spiderfyAttachLayer&&this.spiderfyAttachLayer.setVisible(e||!1),this.coincidenceClusterLayer&&this.coincidenceClusterLayer.setVisible(e||!1),this.coincidenceHoverLayer&&this.coincidenceHoverLayer.setVisible(e||!1)),e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})}});return s.include({_extentChangeListener:function(){var e=this.map.getZoomLevel();if(e!==this.currentZoom){if(this.updateSymbol(e),this._applySpiderfy(this.currentZoom,e)){if(null!=this.currentClusterObj){var t=this._getCurrentClusterElementIdOnUpdate();if(null!=t){this.coincidenceHoverLayer.clear();var r=this.coincidenceClusterLayer.find(t);r&&(this._addHoverSpiderfy(r),this.currentClusterObj=this._extractClusterElement(r),this._toggleCurrentClusterElement(!1))}}this.fire("clusterChange",jQuery.extend(!0,{},this.currentClusterObj))}this.currentZoom=e}},_mapClickListener:function(e){var t=this.hitTest(e.screenX,e.screenY),r=!1,n=!0;if(t&&(this.fire("click",{element:t.element,layer:t.layer}),r=!0,n=this._applyToggleCurrentClusterElement(t.element)),n&&(this._toggleCurrentClusterElement(!0),this.coincidenceHoverLayer.clear()),!r&&this.coincidenceClusterLayer){var o=this.coincidenceClusterLayer.hitTest(e.screenX,e.screenY);if(o){var i=o.element;if(i)return void(this._addHoverSpiderfy(i)&&(this.currentClusterObj=this._extractClusterElement(i),this._toggleCurrentClusterElement(!1)))}}},_getLayerElementById:function(e,t){var r=this.elements;for(var n in r){var o=r[n];if(o.id==t)return{element:o,layer:e}}},_getElementsCenter:function(e){for(var t=0,r=0,n=e.length,o=0;o<n;o++){var i=e[o];t+=i.geometry.x,r+=i.geometry.y}return[t/n,r/n]}}),t.include(s),Object.defineProperty(s,"type",{value:14,configurable:!1,writable:!1}),s}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(12),r(128),r(1)],void 0===(o=function(e,t,r,n){var o={init:function(){this.distanceGrid=new r(this.options.spiderfyDistance),this.options.showSpiderLeg&&(this.spiderfyAttachLayer=new n.carto.ElementLayer({id:this.options.layerId+"-spiderfyattach",name:this.options.layerName+"重复点自动排列的辅助图层",map:this.map}),this.map.addLayer(this.spiderfyAttachLayer)),this.options.enableCoincidenceCluster&&(this.coincidenceClusterLayer=new n.carto.ElementLayer({id:this.options.layerId+"-coincidence-cluster",name:this.options.layerName+"重复点聚合图层",map:this.map}),this.map.addLayer(this.coincidenceClusterLayer),this.coincidenceHoverLayer=new n.carto.ElementLayer({id:this.options.layerId+"-coincidence-hover",name:this.options.layerName+"重复点滑过展开",map:this.map}),this.map.addLayer(this.coincidenceHoverLayer)),this.options.spiderfyLegSym&&(this.options.spiderfyLegSym=new n.sfs.SimpleLineSymbol({style:this.options.spiderfyLegSym.style,width:this.options.spiderfyLegSym.width,color:this._getColor(this.options.spiderfyLegSym.color)})),this.currentClusterObj=null},include:function(r){var o=r.prototype,i={_applySpiderfy:function(t,r){if(t===r)return!1;if(!this.options.enalbeSpiderfy)return!1;if(!this.getVisible())return!1;var n=this.options.spiderfyLevel,o=(this.options.spiderfyDistance,!1);return this.options.enableCoincidenceCluster?r>=n?o="spiderfy":e.assertWithin(r,this.options.enableCoincidenceClusterLevel)?o="cluster":this._disableSpiderfy():r>=n?o="spiderfy":t>=n&&r<n&&this._disableSpiderfy(),console.log(o),o&&this._updateSpiderfy(o),!0},_updateSpiderfy:function(e){if("spiderfy"===e||"cluster"===e){this._clearSpiderfy(!1),this.layer.clear();for(var r=this,o=this.options.spatialReference,i=this.options.spiderfyThreshold||5,a=0,s=this.elements.length;a<s;a++){var l=this.elements[a],c=l.geometry,u=this.map.getPixelFromCoordinate([c.x,c.y]);this.distanceGrid.addObject(l,{x:u[0],y:u[1]})}switch(e){case"spiderfy":this.distanceGrid.eachCell((function(e,a,s){if(e.length<2)r.layer.addElements(e);else{var l,c=r._getElementsCenter(e),u=new n.sfs.Point({x:c[0],y:c[1],spatialReference:o}),f=e.length,h=r.options.showSpiderLeg,p=r.map.getPixelFromCoordinate(c);if(f<=i){var d=r.options.circleRadius||20;l=t.getCirclePonits({center:p,radius:d,count:f})}else l=t.getSpiderfy(p,f,11,5,28);for(var y=0;y<f;y++)try{var m=e[y],g=r.map.getCoordinateFromPixel(l[y]),v=new n.sfs.Point({x:g[0],y:g[1],spatialReference:o}),b=new n.sfs.Element({id:m.id,geometry:v,symbol:m.symbol});if(b._data=m._data,r.layer.add(b),h){var _=new n.sfs.Polyline({spatialReference:o}),w=new n.sfs.Path({spatialReference:o});w.addPoint(u),w.addPoint(v),_.addGeometry(w);var S=r.options.spiderfyLegSym,L=new n.sfs.Element({geometry:_,symbol:S});r.spiderfyAttachLayer.add(L)}}catch(e){}}}));break;case"cluster":this.distanceGrid.eachCell((function(e,t,i){if(e.length<2)r.layer.addElements(e);else{var a=r._getElementsCenter(e),s=new n.sfs.Point({x:a[0],y:a[1],spatialReference:o}),l=r.getCoincidenceClusterSym(e),c=t+"_"+i,u=new n.sfs.Element({id:c,geometry:s,symbol:l});u._indexs=[t,i],r.coincidenceClusterLayer.add(u)}}))}}},_addHoverSpiderfy:function(e){var r=e._indexs;if(!r||2!=r.length)return!1;var o=this.distanceGrid.getObjects(r[0],r[1]),i=this.options.spatialReference;if(o.length>this.options.coincidenceClusterHoverThreshold)return!1;var a,s=this._getElementsCenter(o),l=new n.sfs.Point({x:s[0],y:s[1],spatialReference:i}),c=o.length,u=this.options.showSpiderLeg,f=this.options.spiderfyLegSym,h=this.map.getPixelFromCoordinate(s);if(c<=(this.options.spiderfyThreshold||5)){var p=this.options.circleRadius||20;a=t.getCirclePonits({center:h,radius:p,count:c})}else a=t.getSpiderfy(h,c,11,5,28);for(var d=0;d<c;d++){var y=o[d],m=this.map.getCoordinateFromPixel(a[d]),g=new n.sfs.Point({x:m[0],y:m[1],spatialReference:i}),v=new n.sfs.Polyline({spatialReference:i}),b=new n.sfs.Path({spatialReference:i});if(b.addPoint(l),b.addPoint(g),u){v.addGeometry(b);f=this.options.spiderfyLegSym;var _=new n.sfs.Element({geometry:v,symbol:f});this.coincidenceHoverLayer.add(_)}var w=new n.sfs.Element({id:y.id,geometry:g,symbol:y.symbol});this.coincidenceHoverLayer.add(w)}return!0},getCoincidenceClusterSym:function(t){var r=(t=t||[]).length,o=this.options.coincidenceClusterMarkerSym||{},i=this.options.coincidenceClusterTextSym||{},a=r+"";o.borderColor&&(o.borderColor=this._getColor(o.borderColor)),o.fillColor&&(o.fillColor=this._getColor(o.fillColor)),i.foreground&&(i.foreground=this._getColor(i.foreground)),i.borderColor&&(i.borderColor=this._getColor(i.borderColor));var s=i.fontSize||15,l=s*this.options.coincidenceClusterWeight,c=e.getEquivalentNum(a,l,l),u={borderColor:new n.sfs.Color({a:150,r:50,g:175,b:254}),fillColor:new n.sfs.Color({a:220,r:4,g:131,b:232}),borderThickness:c,size:c},f={text:a,fontSize:s,fontWeight:1,offsetX:0,offsetY:0,foreground:new n.sfs.Color({a:255,r:255,g:255,b:255}),borderColor:new n.sfs.Color({a:1,r:255,g:255,b:255}),borderThickness:0};jQuery.extend(!0,u,o),jQuery.extend(!0,f,i);var h=new n.sfs.SimpleMarkerSymbol(u),p=new n.sfs.TextSymbol(f);return new n.sfs.CurrencySymbol({markerSymbol:h,textSymbol:p})},_clearSpiderfy:function(e){if(this.options.enalbeSpiderfy){if(this.spiderfyAttachLayer&&(this.spiderfyAttachLayer.clear(),e&&this.map.removeLayer(this.spiderfyAttachLayer)),this.coincidenceClusterLayer){var t=this.coincidenceClusterLayer.elements;for(var r in t){var n=t[r];n&&(n._indexs=null,delete n._indexs)}this.coincidenceClusterLayer.clear(),e&&this.map.removeLayer(this.coincidenceClusterLayer)}this.coincidenceHoverLayer&&(this.coincidenceHoverLayer.clear(),e&&this.map.removeLayer(this.coincidenceHoverLayer)),this.distanceGrid&&(e?this.distanceGrid.destroy():this.distanceGrid.clear())}},_disableSpiderfy:function(){this.layer.clear(),this.layer.addElements(this.elements),this._clearSpiderfy()},_toggleCurrentClusterElement:function(e){if(null!=this.currentClusterObj){var t=this.coincidenceClusterLayer.find(this.currentClusterObj.id);!0===e?(this.coincidenceClusterLayer.showElement(t,!0),this.currentClusterObj=null):this.coincidenceClusterLayer.showElement(t,!1)}},_applyToggleCurrentClusterElement:function(e){var t=!0;if(null!=this.currentClusterObj)for(var r=this.coincidenceClusterLayer.find(this.currentClusterObj.id)._indexs,n=this.distanceGrid.getObjects(r[0],r[1]),o=0;o<n.length;o++)if(e.id===n[o].id){t=!1;break}return t},_extractClusterElement:function(e){if(e){var t={};t.id=e.id,t.elementSet={};for(var r=e._indexs,n=this.distanceGrid.getObjects(r[0],r[1]),o=0;o<n.length;o++){var i=n[o],a=this.coincidenceHoverLayer.find(i.id);t.elementSet[i.id]=a?{x:a.geometry.x,y:a.geometry.y}:{}}return t}return null},_getCurrentClusterElementIdOnUpdate:function(){var e=null;if(null!=this.currentClusterObj){var t=this.currentClusterObj.elementSet,r=null;this.distanceGrid.eachCell((function(e,n,o){var i=Object.keys(t).length,a=0,s=e.length;for(var l in t)for(var c=0;c<s;c++)if(e[c]&&e[c].id===l){a++;break}a>Math.round(i/2)&&(r=n+"_"+o)})),e=r||null}return e}};for(var a in i)o[a]=i[a]}};return o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(78),r(2),r(23),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{symbolConfig:!1},initialize:function(t){this.noneSpatialArr=[],this.elements=[],e.prototype.initialize.call(this,t)},_addListeners:function(){e.prototype._addListeners.call(this),this.map.listen("resolutionchanged",this._getZoomChangeLisener())},_removeListeners:function(){this.map.off("resolutionchanged",this._getZoomChangeLisener()),e.prototype._removeListeners.call(this)},_getZoomChangeLisener:function(){if(!this._zoomChangeLisener){var e=this;this._zoomChangeLisener=function(t){e.updateSymbol(t.level)}}return this._zoomChangeLisener},addElements:function(e,o){if(t.isArray(e)){o=o||{};for(var i=this.map.getZoomLevel(),a=this.options.spatialReference,s=o.dataSpatialReference||this.options.dataSpatialReference,l=0,c=e.length;l<c;l++){var u=e[l],f=this._getGeometry(u,s,a);if(f){var h=this._getSymbol(u,i),p=this._getRecordId(u),d=new n.sfs.Element({id:p,geometry:f,symbol:h.symbol});d._data=u,d._zoomRange=h.zoomRange,d._symbolKey=h.symbolKey,this.elements.push(d),this.layer.add(d)}else this.noneSpatialArr.push(u)}this._onSymbolsUpdated(),this._onElementChanged()}else r.error("dataArr is not an array")},getGeometry:function(e,t,r){if(!e)return null;var o=e[this.options.geometryField],i=null;try{"string"==typeof o?(o=this.wktReader.read(o).toString(),i=n.sfs.GeometryFactory.createGeometryFromWkt(o,t)):i=n.sfs.GeometryFactory.createGeometryFromGeoJson(o,t)}catch(e){}return t&&r&&t!=r&&(i=this.projService.transform(i,r)),i}});return Object.defineProperty(o,"type",{value:21,configurable:!1,writable:!1}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(78),r(2),r(23),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{symbolConfig:!1},initialize:function(t){this.noneSpatialArr=[],this.elements=[],e.prototype.initialize.call(this,t)},_addListeners:function(){e.prototype._addListeners.call(this),this.map.listen("resolutionchanged",this._getZoomChangeLisener())},_removeListeners:function(){this.map.off("resolutionchanged",this._getZoomChangeLisener()),e.prototype._removeListeners.call(this)},_getZoomChangeLisener:function(){if(!this._zoomChangeLisener){var e=this;this._zoomChangeLisener=function(t){e.updateSymbol(t.level)}}return this._zoomChangeLisener},addElements:function(e,o){if(t.isArray(e)){o=o||{};for(var i=this.map.getZoomLevel(),a=this.options.spatialReference,s=o.dataSpatialReference||this.options.dataSpatialReference,l=0,c=e.length;l<c;l++){var u=e[l],f=this._getGeometry(u,s,a);if(f){var h=this._getSymbol(u,i),p=this._getRecordId(u),d=new n.sfs.Element({id:p,geometry:f,symbol:h.symbol});d._data=u,d._zoomRange=h.zoomRange,d._symbolKey=h.symbolKey,this.elements.push(d),this.layer.add(d)}else this.noneSpatialArr.push(u)}this._onSymbolsUpdated(),this._onElementChanged()}else r.error("dataArr is not an array")},_getGeometry:function(e,t,r){if(!e)return null;var o=e[this.options.geometryField],i=null;try{"string"==typeof o?(o=this.wktReader.read(o).toString(),i=n.sfs.GeometryFactory.createGeometryFromWkt(o,t)):i=n.sfs.GeometryFactory.createGeometryFromGeoJson(o,t)}catch(e){}return t&&r&&t!=r&&(i=this.projService.transform(i,r)),i}});return Object.defineProperty(o,"type",{value:31,configurable:!1,writable:!1}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(129),r(2),r(1)],void 0===(o=function(e,t,r){var n=e.extend({options:{geometryField:""},initialize:function(t){e.prototype.initialize.call(this,t),this.layer=new r.carto.ElementLayer({id:this.options.layerId,name:this.options.layerName,map:this.map}),this._addListeners()},_addListeners:function(){e.prototype._addListeners.call(this),this.map.listen("click",this._getMapClickListener())},_removeListeners:function(){this.map.off("click",this._getMapClickListener()),e.prototype._removeListeners.call(this)},_getMapClickListener:function(){if(!this._mapClickListener){var e=this;this._mapClickListener=function(t){var r=e.layer.hitTest(t.screenX,t.screenY);r&&e.fire("click",{id:r.element.id,element:r.element,layer:r.layer})}}return this._mapClickListener},updateStatistics:function(e){e&&this._updateStatistics(e)},_updateStatistics:function(e){if(e){var t=jQuery.extend(!0,{},e.statisticsData),r=e.symbol;"string"==typeof r&&(r=this.symbolConfig[r]),r=jQuery.extend(!0,{},r),this.statisticsData=t,this.layer.clear(!0),this._updateLayer(r),this._onSymbolsUpdated(e),this._onElementChanged()}},setVisible:function(e){this.layer.setVisible(!!e),this._visible=!!e,e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})},clear:function(t){this.layer.clear(),this.statisticsData=null,e.prototype.clear.call(this),t||(this._onSymbolsUpdated(),this._onElementChanged())},_updateLayer:function(e){var t,n=e.symbol,o=e.label;for(t in this.statisticsData){var i=this.statisticsData[t],a=this._getGeometry(i,this.options),s=this.getRingTextSymbol(i.value,n,o),l=new r.sfs.Element({id:t,geometry:a,symbol:s});l._data=i,this.layer.add(l)}},_onSymbolsUpdated:function(e){if(this.currentSymbols=null,e&&this.layer.elements.length>0){var t=this.layer.elements[0];this.currentSymbols=[{title:e.title,symbol:t.symbol,symbolKey:e.key}]}else this.currentSymbols=[];this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols})},getLayer:function(){return this.layer},getElements:function(){return this.layer.elements},_getGeometry:function(e,t){var n=null;if(this.options.geometryField){var o=e[this.options.geometryField];o&&(o instanceof String?(n=r.sfs.GeometryFactory.createGeometryFromWkt(o)).setSpatialReference(t.spatialReference):(n=r.sfs.GeometryFactory.createGeometryFromGeoJson(o)).setSpatialReference(t.spatialReference))}else n=new r.sfs.Point({x:e[t.xField],y:e[t.yField],spatialReference:t.spatialReference});return t.spatialReference&&t.destSpatialReference&&t.spatialReference!=t.destSpatialReference&&(n=this.projService.transform(n,t.destSpatialReference)),n},getRingTextSymbol:function(e,n,o){e+="",o=o||{},(n=n||{}).borderColor&&(n.borderColor=this._getColor(n.borderColor)),n.fillColor&&(n.fillColor=this._getColor(n.fillColor)),o.foreground&&(o.foreground=this._getColor(o.foreground)),o.borderColor&&(o.borderColor=this._getColor(o.borderColor));var i=o.fontSize||15,a=2*i/3,s=t.getEquivalentNum(e,a,a),l={borderColor:new r.sfs.Color({a:150,r:50,g:175,b:254}),fillColor:new r.sfs.Color({a:220,r:4,g:131,b:232}),borderThickness:s/2,size:s},c={text:e,fontSize:i,fontWeight:1,offsetX:0,offsetY:0,foreground:new r.sfs.Color({a:255,r:255,g:255,b:255}),borderColor:new r.sfs.Color({a:1,r:255,g:255,b:255}),borderThickness:0};jQuery.extend(!0,l,n),jQuery.extend(!0,c,o);var u=new r.sfs.SimpleMarkerSymbol(l),f=new r.sfs.TextSymbol(c);return new r.sfs.CurrencySymbol({markerSymbol:u,textSymbol:f})},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(n,"type",{value:41,configurable:!1,writable:!1}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(129),r(2),r(1)],void 0===(o=function(e,t,r){var n=e.extend({options:{geometryField:"",onPieClick:"",clickContext:window},initialize:function(t){e.prototype.initialize.call(this,t),this.statisticsDataType={},this.layer=new r.carto.FeatureLayer({id:this.options.layerId,map:this.map,visible:!1}),this._addListeners()},_addListeners:function(){e.prototype._addListeners.call(this)},_removeListeners:function(){e.prototype._removeListeners.call(this)},updateStatistics:function(e){e&&this._updateStatistics(e)},_updateStatistics:function(e){if(e){var t=jQuery.extend(!0,{},e.statisticsData),r=e.symbol;"string"==typeof r&&(r=this.symbolConfig[r]),r=jQuery.extend(!0,{},r);var n=0;for(var o in t){var i=t[o];if(i){0!=n||this.statisticsData?this._mergeStatisticsData(this.statisticsData,i):this.statisticsData=i;var a=o.split(",");for(var s in a)this.statisticsDataType[a[s]]=!0;n++}}this._updateLayer(r),this._onElementChanged()}},setVisible:function(e){this.renderer&&this.renderer.show(!!e),this._visible=!!e},clear:function(){this.layer.clear(),this.renderer=null,e.prototype.clear.call(this),this._onElementChanged()},_updateLayer:function(e){for(var n=e,o=this,i=new r.sfs.Fields,a=[],s=[],l=n.fields,c=0,u=l.length;c<u;c++){var f=l[c];if(f&&this.statisticsDataType[f.name]){var h=new r.sfs.Field({name:f.name,alias:f.alias});i.add(h),a.push(h),s.push(f.color)}}var p=new r.sfs.Field({name:"districtCode",alias:"政区编码"});i.add(p),this.layer.clear();var d=i.fields.length;if(!(d<1)){var y=0;for(var m in this.statisticsData){var g=this.statisticsData[m];if(g&&g.items){for(var v=g.items,b=[],_=0;_<d-1;_++){var w=v[(i.getField(_)||{}).name];isNaN(w)&&(w=0);var S=new r.sfs.Value;S.setValue(w),b.push(S)}var L=new r.sfs.Value;L.setValue(m),b.push(L);var x=new r.sfs.Feature({fields:i,values:b,geometry:this._getGeometry(g,this.options),objectId:y++});this.layer.add(x)}}if(!(y<1)){var P=new r.render.PieChart({fields:a,options:{type:1,color:s,name:n.title,labelStyle:n.labelStyle||{color:"#000",fontSize:10}}});this.renderer=new r.render.ChartRenderer({map:this.map,chartTemplate:P}),this.layer.render(this.renderer),this.setVisible(this._visible),P.onClick=function(e){var r=e.feature,n={id:r.values[r.values.length-1].getValue()};o.fire("click",n),t.isFunction(o.options.onPieClick)&&o.options.onPieClick.call(o.options.clickContext||window,n)}}}},getLayer:function(){return this.layer},getElements:function(){return this.layer.features},_getGeometry:function(e,t){var n=null;if(this.options.geometryField){var o=e[this.options.geometryField];o&&(o instanceof String?(n=r.sfs.GeometryFactory.createGeometryFromWkt(o)).setSpatialReference(t.spatialReference):(n=r.sfs.GeometryFactory.createGeometryFromGeoJson(o)).setSpatialReference(t.spatialReference))}else{var i=new r.sfs.Point({x:parseFloat(e[t.xField]),y:parseFloat(e[t.yField]),spatialReference:t.spatialReference}),a=new r.sfs.Envelope({minx:i.x-.1,maxx:i.x+.1,miny:i.y-.1,maxy:i.y+.1,spatialReference:t.spatialReference});n=r.sfs.GeometryFactory.createGeometryFromWkt(a.asWkt())}return t.spatialReference&&t.destSpatialReference&&t.spatialReference!=t.destSpatialReference&&(n=this.projService.transform(n,t.destSpatialReference)),n},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(n,"type",{value:42,configurable:!1,writable:!1}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n;void 0===(n=function(){var e=function(e){this.map=e};return e.prototype.createLayer=function(e,t){var r,n=this._getClazzObj()[e],o=t||{};if(o.hasOwnProperty("map")||(o.map=this.map),!n)throw new Error("未定义的图层类型！"+e);return(r=new n(o)).getLayer().layerGroups=o.layerGroups||"add",r},e.prototype.createLayerByClass=function(e,t){var r,n;if(-1!=e.indexOf("lys")?(r=/^((g2)|(G))\.lys\.(.*)$/,n=e+""):(r=/^((g2)|(G))\.carto\.(.*)$/,n=e+""),!r.test(n))throw new Error("错误的图层类名！");var o,i=n.match(r);o=-1!=e.indexOf("lys")?window[i[1]].lys[i[4]]:window[i[1]].carto[i[4]];var a=t||{};a.hasOwnProperty("map")||(a.map=this.map);var s=new o(a);a.attr&&(s.attr=a.attr);var l={opacity:"setOpacity",visible:"setVisible",zIndex:"setZIndex"},c=s instanceof G.lys.BaseLayer?s.getLayer():s;for(var u in l)t.hasOwnProperty(u)&&c[l[u]]&&c[l[u]](t[u]);return s},e.prototype._getClazzObj=function(){if(!this._classObj){var e={};e[G.lys.TYPES.ELEMENT_POINT_LAYER]=G.lys.PointLayer,e[G.lys.TYPES.FEATURE_POINT_LAYER]=G.lys.FeaturePointLayer,e[G.lys.TYPES.ELEMENT_POINT_PIXEL_CLUSTER]=G.lys.PointClusterLayer,e[G.lys.TYPES.ELEMENT_POINT_DUPLICATE]=G.lys.PointDuplicateLayer,e[G.lys.TYPES.ELEMENT_POLYLINE_LAYER]=G.lys.LineLayer,e[G.lys.TYPES.ELEMENT_POLYGON_LAYER]=G.lys.PolygonLayer,e[G.lys.TYPES.PIE_STATISTICS_LAYER]=G.lys.PieStatisticsLayer,e[G.lys.TYPES.RING_STATISTICS_LAYER]=G.lys.RingStatisticsLayer,this._classObj=e}return this._classObj},e}.apply(t,[]))||(e.exports=n)},function(e,t,r){"use strict";var n,o;n=[r(21),r(37),r(125),r(1)],void 0===(o=function(e,t,r,n){function o(e){n.carto.ElementLayer.call(this,e)}return o.prototype={options:{hasEvent:!1},constructor:o,addTo:function(e){e instanceof r?this.map=this.options.g2map=e.getMap():e instanceof n.carto.Map&&(this.map=this.options.g2map=e),this.options.g2map&&(this.onAdd&&this.onAdd(),this.options.hasEvent&&this.addhitTest&&this.addhitTest(),this.options.g2map.addLayer(this))},remove:function(){this.options.g2map&&(this.onRemove&&this.onRemove(),this.options.hasEvent&&this.removehitTest&&this.removehitTest(),this.options.g2map.removeLayer(this))}},e.defaults(o,e,!0),e.mixin(o,t.prototype),e.mixin(o,n.carto.ElementLayer),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n=[r(21),r(1)],void 0===(o=function(e,t){function r(r,n){e.setOptions(this,n),this.coords=r,this.options.geometry=this.getGeometry(),t.sfs.Element.call(this,this.options)}return r.prototype={options:{},constructor:r,getGeometry:function(){var e=Object.prototype.toString;return this.coords instanceof t.sfs.Point?this.coords:"[object Array]"===e.call(this.coords)?new t.sfs.Point({x:this.coords[0],y:this.coords[1],spatialReference:this.options.spatialReference}):"[object String]"===e.call(this.coords)&&this.coords.indexOf("point")>-1?t.sfs.GeometryFactory.createGeometryFromWkt(this.coords):("function"==typeof this.coords||this.coords&&"object"==i(this.coords))&&"Point"==this.coords.type?t.sfs.GeometryFactory.createGeometryFromGeoJson(this.coords):void console.error("数据类型错误，只支持数组坐标、g2.sfs.Point、geojson、wkt")},envelope:function(){return this.getGeometry().envelope()},toString:function(){return this.getGeometry().asWkt()}},e.inherits(r,t.sfs.Element),r}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n=[r(21),r(1)],void 0===(o=function(e,t){function r(r,n){e.setOptions(this,n),this.coords=r,this.options.geometry=this.getGeometry(),t.sfs.Element.call(this,this.options)}return r.prototype={options:{},constructor:r,getGeometry:function(){var e=Object.prototype.toString;return this.coords instanceof t.sfs.Polygon?this.coords:"[object Array]"===e.call(this.coords)?this._areaPolygon(this.coords):"[object String]"===e.call(this.coords)&&this.coords.indexOf("polygon")>-1?t.sfs.GeometryFactory.createGeometryFromWkt(this.coords):("function"==typeof this.coords||this.coords&&"object"==i(this.coords))&&"Polygon"==this.coords.type?t.sfs.GeometryFactory.createGeometryFromGeoJson(this.coords):void console.error("数据类型错误，只支持数组坐标、g2.sfs.Polygon、geojson、wkt")},_ring:function(e){var r=new t.sfs.Ring;return e.map((function(e){var n=e instanceof t.sfs.Point?e:new t.sfs.Point({x:e[0],y:e[1]});r.addPoint(n)})),r},_areaPolygon:function(e){var r=new t.sfs.Polygon;return e&&e[0]&&e[0][0]&&2==e[0][0].length?e.map($.proxy((function(e){r.addGeometry(this._ring(e))}),this)):r.addGeometry(this._ring(e)),r},envelope:function(){return this.getGeometry().envelope()},toString:function(){return this.getGeometry().asWkt()}},e.inherits(r,t.sfs.Element),r}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n={Class:r(21),ComponentBase:r(11),IHttpRequest:r(178),HttpRequest:r(420),AppEvent:r(37),AppEvents:r(38),UiComponent:r(422),PureComponent:r(15),ControlBase:r(423),ModuleBase:r(424),ServiceBase:r(426),ContainerManager:r(179),subUiComponent:r(427)};e.exports=n},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=r(45),f=r(421).fetch;function h(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(y,e);var t,r,n,p,d=(t=y,function(){var e,r=l(t);if(s()){var n=l(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return a(this,e)});function y(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),d.call(this,e)}return r=y,(n=[{key:"_request",value:function(e,t,r,n,i,a){var s=this;return new Promise(function(){var l,c=(l=regeneratorRuntime.mark((function o(l,c){var p,d,y,m;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,(p={}).method=e,p.headers={},i=i||"application/json",p.headers["Content-Type"]=i,u(p.headers,a||{}),d=i.split(";")[0],"POST"!=e){o.next=20;break}o.t0=d,o.next="application/json"===o.t0?12:"application/x-www-form-urlencoded"===o.t0?14:16;break;case 12:return p.body=JSON.stringify(n),o.abrupt("break",18);case 14:return p.body=s._parseFormParams(n),o.abrupt("break",18);case 16:return p.body=n,o.abrupt("break",18);case 18:o.next=23;break;case 20:t.indexOf("?")<0&&(t+="?"),t+="&",t+=s._parseFormParams(n);case 23:return o.next=25,f(t,p);case 25:y=o.sent,r=r||"json",h(y),m=null,o.t1=r,o.next="json"===o.t1?32:"blob"===o.t1?34:("text"===o.t1||o.t1,36);break;case 32:return m=y.json(),o.abrupt("break",37);case 34:return m=y.blob(),o.abrupt("break",37);case 36:m=y.text();case 37:l(m),o.next=43;break;case 40:o.prev=40,o.t2=o.catch(0),c(o.t2);case 43:case"end":return o.stop()}}),o,null,[[0,40]])})),function(){var e=this,t=arguments;return new Promise((function(r,n){var i=l.apply(e,t);function a(e){o(i,r,n,a,s,"next",e)}function s(e){o(i,r,n,a,s,"throw",e)}a(void 0)}))});return function(e,t){return c.apply(this,arguments)}}())}},{key:"_parseFormParams",value:function(e){var t="";for(var r in e)t+=r,t+="="+e[r],t+="&";return t}},{key:"get",value:function(e,t,r,n,o){return this._request("GET",e,t,r,n,o)}},{key:"post",value:function(e,t,r,n,o){return this._request("POST",e,t,r,n,o)}},{key:"put",value:function(e,t,r,n,o){return this._request("PUT",e,t,r,n,o)}},{key:"delete",value:function(e,t,r,n,o){return this._request("DELETE",e,t,r,n,o)}}])&&i(r.prototype,n),p&&i(r,p),y}(r(178));e.exports=p},function(e,t,r){"use strict";r.r(t),r.d(t,"Headers",(function(){return p})),r.d(t,"Request",(function(){return _})),r.d(t,"Response",(function(){return S})),r.d(t,"DOMException",(function(){return x})),r.d(t,"fetch",(function(){return P}));var n="URLSearchParams"in self,o="Symbol"in self&&"iterator"in Symbol,i="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),a="FormData"in self,s="ArrayBuffer"in self;if(s)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&l.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function y(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function m(e){var t=new FileReader,r=y(t);return t.readAsArrayBuffer(e),r}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:a&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&i&&function(e){return e&&DataView.prototype.isPrototypeOf(e)}(e)?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var e,t,r,n=d(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=y(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(e,t){e=u(e),t=f(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},p.prototype.delete=function(e){delete this.map[u(e)]},p.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},p.prototype.set=function(e,t){this.map[u(e)]=f(t)},p.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},p.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),h(e)},p.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),h(e)},p.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),h(e)},o&&(p.prototype[Symbol.iterator]=p.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(e,t){var r,n,o=(t=t||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),b.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function S(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},v.call(_.prototype),v.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:0,statusText:""});return e.type="error",e};var L=[301,302,303,307,308];S.redirect=function(e,t){if(-1===L.indexOf(t))throw new RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})};var x=self.DOMException;try{new x}catch(e){(x=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),x.prototype.constructor=x}function P(e,t){return new Promise((function(r,n){var o=new _(e,t);if(o.signal&&o.signal.aborted)return n(new x("Aborted","AbortError"));var a=new XMLHttpRequest;function s(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;r(new S(o,n))},a.onerror=function(){n(new TypeError("Network request failed"))},a.ontimeout=function(){n(new TypeError("Network request failed"))},a.onabort=function(){n(new x("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&i&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",s),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",s)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}P.polyfill=!0,self.fetch||(self.fetch=P,self.Headers=p,self.Request=_,self.Response=S)},function(e,t,r){"use strict";var n,o;n=[r(11),r(2),r(79),r(179)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{map:null,htmlPath:"",cssPath:"",cssName:""},includes:n.prototype,initialize:function(n){e.prototype.initialize.call(this,n),this._cssPath=n.cssPath,this._htmlPath=n.htmlPath;var o=this.options.cssName;if(o){var i=[];if(t.isArray(o))for(var a=0,s=o.length;a<s;a++)i.push(this._cssPath+o[a]);else t.isString(o)&&i.push(this._cssPath+this.options.cssName);r.loadCss(i)}},destroy:function(){try{this.remove()}catch(e){}e.prototype.destroy.call(this)}});return o.include({loadHtml:function(e,r,n){var o=this;jQuery(e).load(r,(function(){t.isFunction(n)&&n.call(o)}))}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(11),r(180),r(2),r(79)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{style:{},dragable:!1,staticPath:"",cssPath:"",configPath:"",imgPath:"",htmlPath:"",resourcePath:""},TYPE:"Control",initialize:function(t){e.prototype.initialize.call(this,t)},onAdd:function(){try{this.onRemove()}catch(e){}},onRemove:function(){},destroy:function(){this.onRemove(),e.prototype.destroy.call(this)}});return o.include({getResourcePath:function(){if(!this._resourcePath){var e=this.options.name||"Anonymous";e.endsWith("Ctrl")||(e+="Ctrl"),this._resourcePath=n.getControlPath(e)}return this._resourcePath},setResourcePath:function(e){e?(this._resourcePath=(e+"").replace(/([\/\\]+)/g,"/"),this._resourcePath.endsWith("/")||(this._resourcePath=this._resourcePath+"/")):this._resourcePath=null}}),t.enable(o),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";(function(e){var n,o;n=[r(11),r(180),r(79),r(2)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{staticPath:"",cssPath:"",configPath:"",imgPath:"",htmlPath:"",resourcePath:""},TYPE:"Module",initialize:function(t){e.prototype.initialize.call(this,t)},onOpen:function(){},onClose:function(){},destroy:function(){this.onClose()},getResourcePath:function(){if(!this._resourcePath){var e=this.options.name||"Anonymous";e.endsWith("Module")||(e+="Module"),this._resourcePath=r.getModulePath(e)}return this._resourcePath},setResourcePath:function(e){e?(this._resourcePath=(e+"").replace(/([\/\\]+)/g,"/"),this._resourcePath.endsWith("/")||(this._resourcePath=this._resourcePath+"/")):this._resourcePath=null}});return t.enable(o),o}.apply(t,n))||(e.exports=o)}).call(this,r(425)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";var n,o;n=[r(21),r(2)],void 0===(o=function(e,t){return e.extend({options:{url:"",params:void 0,dataType:"jsonp"},initialize:function(t){e.setOptions(this,t)},execute:function(e){var t=$.Deferred(),r=$.extend(!0,{},this.options,e);return r.success=this._getResult(t,r),r.error=this._getError(t,r),$.ajax(r),t},_getResult:function(e,r){var n=this;return function(o){var i=r.context?r.context:n;if(t.isFunction(r.callback)){var a=r.stripData?r.stripData(o):n.stripData(o);r.callback.call(i,a)}else{null==(a=r.stripData?r.stripData(o):n.stripData(o))&&e.reject(a),e.resolveWith(i,[a])}}},_getError:function(e,t){return function(r,n,o){var i=t.context?t.context:this;e.rejectWith(i,[r]),t.error&&t.error()}},stripData:function(e){return e||[]},destroy:function(){for(var e in this)this[e]=null,delete this[e]}})}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(21)],void 0===(o=function(e){return e.extend({options:{el:void 0},addTo:function(e){this.options.el=e,this._container1=this.onAdd(map),$(this.options.el).append($(this._container1))},remove:function(){this.onRemove(),$(this._container1).remove()}})}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(429),r(437),r(57),r(80),r(442),r(446),r(450),r(451)],void 0===(o=function(e,t,r,n,o,i,a,s){var l={PlotComponent:e,PlotComponent3D:t,PlotSchema:r,PlotSyncComponent:o,PlotSyncComponent3D:i,CollaborativePlotComponent:a,CollaborativePlotComponent3D:s};return Object.defineProperty(l,"TYPES",{value:n.TYPES_KEYS,configurable:!1,writable:!1}),l}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(14),r(23),r(18),r(430),r(431),r(432),r(80),r(57),r(15),r(433),r(38),r(1)],void 0===(o=function(e,t,r,n,o,i,a,s,l,c,u,f,h){var p=s.PATTERNS,d=(s.TYPES,s.TYPES_KEYS),y=c.extend({options:{layerId:"plot-layer",symbols:{text:{type:"TextSymbol",options:{fontFamilyName:"宋体",fontSize:12,foreground:{a:255,r:0,g:0,b:255},borderColor:{a:1,r:255,g:255,b:255},borderThickness:0}},point:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{a:153,r:0,g:0,b:0},fillColor:{a:153,r:65,g:105,b:225},borderThickness:2,size:4}},line:{type:"SimpleLineSymbol",options:{color:{a:153,r:0,g:0,b:255},width:2,style:5}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{a:153,r:0,g:0,b:255},fillColor:{a:150,r:19,g:181,b:177},borderThickness:0,opacity:1}},tailedtext:{type:"SimpleMarkerSymbol",options:{borderColor:{a:255,r:205,g:85,b:85},fillColor:{a:255,r:205,g:85,b:85},borderThickness:0,size:0}},overlay:{}}},initialize:function(e){var t=this;c.prototype.initialize.call(this,e),this._plotLayer=this.getLayer(),this._tailedLayer=this.getTailedLayer(),this._highlightLayer=this.getHighlightLayer(),this._tailedOnMouseUpHandler=function(e,r,n,o,i){t._tailedLabelUpdatePlot()},this._tailedLayer&&this._tailedLayer.on("mouseup",this._tailedOnMouseUpHandler),this._initTools(),this._currentTool=null,this.map.listen("click",this._mapClickHandler,this),this._freedrawtoolpolygon=new o,this._freedrawtoolpolyline=new i,this._plotOverlayTool=new a({map:this.map}),this._plotOverlayTool.on("overlayClick",this._overlayClick,this),this._plotOverlayTool.on("updateOverlayPlot",this._updateOverlayPlot,this)},destroy:function(){this.map.off("click",this._mapClickHandler,this),this._tailedLayer&&this._tailedLayer.un("mouseup",this._tailedOnMouseUpHandler),c.prototype.destroy.call(this)}});return y.include({plotText:function(e){e=e||{};var t=this._getAlgorithm(d.Point);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map.getMap(),n={};n.businessId=e.businessId,n.name=e.name,n.pattern=p.TEXT,n.type=d.Point,n.algorithm=t,n.symbol=e.symbol,n.text=e.text||"";var o=new h.sfs.Point({spatialReference:r.spatialReference});n.geometry=o,n.callback=e.callback,n.context=e.context,this._constructPlotTool(n).onClick()},plotTailedText:function(e){e=e||{};var t=this._getAlgorithm(d.TAILEDTEXT);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map.getMap(),n={};n.name=e.name,n.businessId=e.businessId,n.pattern=p.TAILEDTEXT,n.type=d.Point,n.algorithm=t,n.symbol={type:"SimpleMarkerSymbol",options:{size:0}},n.tailedtext_symbol=e.tailedtext_symbol||{},n.text=e.text||"";var o=new h.sfs.Point({spatialReference:r.spatialReference});n.geometry=o,n.callback=this.addTailedEle,n.context=e.context,this._constructPlotTool(n).onClick()},addTailedEle:function(e,t,r){var n=e.id,o={},i=e.elements[0].geometry;o.geometry=i,o.label="自定义文本内容",o.id=n;var a=t.foregroundColor||{r:255,b:255,g:255,a:255},s=t.backgroundColor||{r:205,b:85,g:85,a:255},l=t.textBackgroundBorderColor||{r:220,b:0,g:0,a:255},c=t.lineColor||{r:205,b:85,g:85,a:255},u={id:n,dimension:2,anchor:i,label:"自定义文本内容",fontSize:t.fontSize||24,fontFamilyName:t.fontFamilyName||"宋体",foregroundColor:new h.sfs.Color(a),backgroundColor:new h.sfs.Color(s),textBorderColor:new h.sfs.Color(a),textBorderThickness:0,textBackgroundBorderColor:new h.sfs.Color(l),textBackgroundBorderThickness:t.textBackgroundBorderThickness||2,leadLength:t.leadLength||100,angle:t.angle||45,lineColor:new h.sfs.Color(c),lineWidth:t.lineWidth||1,size:t.size||6,textAlign:t.textAlign||"center",padding:t.padding||[10,10,10,10]},f=new h.sfs.LeadLabel(u);f.tag=e.tag,r._tailedLayer.add(f),r._tailedLabelUpdatePlot(),setTimeout((function(){r.dragTailedText()}),500)},dragTailedText:function(){this._commandNotify.activeCommand("leadLabelEditTool")},plotMarker:function(e){if("Overlay"===e.type){if(e=e||{},null==(n=this._getAlgorithm(d.Overlay)))throw new Error("参数类型错误！");this._plotEditTool.deactivate();var t=this.map.getMap();(o={}).name=e.name,o.businessId=e.businessId,o.pattern=p.OVERLAY,o.type=d.Point,o.algorithm=n,o.symbol={type:"SimpleMarkerSymbol",options:{size:0}},o.overlayOpt=e.overlayOpt;var r=new h.sfs.Point({spatialReference:t.spatialReference});o.geometry=r,o.callback=this.addOverlay,o.context=e.context,this._constructPlotTool(o).onClick()}else{var n;if(e=e||{},null==(n=this._getAlgorithm(d.Point)))throw new Error("参数类型错误！");this._plotEditTool.deactivate();var o;t=this.map.getMap();(o={}).name=e.name,o.businessId=e.businessId,o.pattern=p.POINT,o.type=d.Point,o.algorithm=n,o.symbol=e.symbol;r=new h.sfs.Point({spatialReference:t.spatialReference});o.geometry=r,o.callback=e.callback,o.context=e.context,this._constructPlotTool(o).onClick()}},addOverlay:function(e,t,r){var n={id:e.id,point:e.elements[0].geometry,options:t,tag:{toolId:e.tag.toolId,name:e.tag.name,businessId:e.tag.businessId}};r._plotOverlayTool.add(n)},plotPolyline:function(e){if((e=e||{}).type!=d.FreePolyline||h.plot.FreePolylineAlgorithm){(i={}).map=this.map.getMap(),i.size=e.size;var t=this._getAlgorithm(e.type||d.Polyline,i);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map.getMap();(i={}).name=e.name,i.businessId=e.businessId,i.pattern=p.POLYLINE,i.type=e.type||d.Polyline,i.algorithm=t,i.symbol=e.symbol;var n=new h.sfs.Path({spatialReference:r.spatialReference}),o=new h.sfs.Polyline({spatialReference:r.spatialReference});o.addGeometry(n),i.geometry=o,i.callback=e.callback,i.context=e.context,this._constructPlotTool(i).onClick()}else{var i;(i={}).symbol=e.symbol,i.callback=e.callback,this.plotFreeDrawPolyline(i)}},plotPolygon:function(e){if((e=e||{}).type!=d.FreePolygon||h.plot.FreePolygonAlgorithm){(i={}).map=this.map.getMap(),i.size=e.size;var t=this._getAlgorithm(e.type||d.Polygon,i);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map.getMap();(i={}).name=e.name,i.businessId=e.businessId,i.pattern=p.POLYGON,i.type=e.type||d.Polygon,i.algorithm=t,i.symbol=e.symbol;var n=new h.sfs.Ring({spatialReference:r.spatialReference}),o=new h.sfs.Polygon({spatialReference:r.spatialReference});o.addGeometry(n),i.geometry=o,i.callback=e.callback,i.context=e.context,this._constructPlotTool(i).onClick()}else{var i;(i={}).name=e.name,i.businessId=e.businessId,i.map=this.map.getMap(),i.drawLayer=this._plotLayer,i.pattern=p.POLYGON,i.appevent=f.PLOT_CREATED,i.type=d.Polygon,i.symbol=e.symbol,i.callback=e.callback,i.context=this,this.plotFreeDrawPolygon(i)}},plotComposite:function(t){t=t||{},(n={}).map=this.map.getMap(),n.size=t.size;var r=this._getAlgorithm(t.type,n);if(null==r)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var n,o=this.map.getMap();(n={}).name=t.name,n.businessId=t.businessId,n.pattern=p.COMPOSITE,n.type=p.POLYGON,n._type=t.type,n.algorithm=r,e.isArray(t.symbol)?n.symbol=t.symbol:e.isObject(t.symbol)&&(n.symbol=[t.symbol,t.symbol]);var i=new h.sfs.Ring({spatialReference:o.spatialReference}),a=new h.sfs.Polygon({spatialReference:o.spatialReference});a.addGeometry(i);var s=new h.sfs.Path({spatialReference:o.spatialReference}),l=new h.sfs.Polyline({spatialReference:o.spatialReference});l.addGeometry(s),n.geometry=[a,l],n.callback=t.callback,n.context=t.context,this._constructPlotTool(n).onClick()},plotFreeDrawPolyline:function(e){var t=this.map.getMap(),r=this._plotLayer,n=e.callback,o=e.symbol||this.options.symbols.line,i=p.POLYLINE,a=d.Polyline,s=f.PLOT_CREATED,l=e.context,c=new h.sfs.Path({spatialReference:t.spatialReference}),u=new h.sfs.Polyline({spatialReference:t.spatialReference});u.addGeometry(c);var y=new h.sfs.Element({geometry:u,symbol:this._getDefaultSymbol(i,o)});this._freedrawtoolpolyline.onCreate({map:t,spatialRef:t.spatialReference,callBack:n,drawLayer:r,templateElement:y,lineSymbol:o,pattern:i,type:a,appevent:s,context:this,contextx:l}),this._currentTool=this._freedrawtoolpolyline,this._freedrawtoolpolyline.onClick()},plotFreeDrawPolygon:function(e){var t=this.map.getMap(),r=this._plotLayer,n=e.callback,o=e.symbol||this.options.symbols.polygon,i=p.POLYGON,a=d.Polygon,s=f.PLOT_CREATED,l=e.context,c=new h.sfs.Path({spatialReference:t.spatialReference}),u=new h.sfs.Polyline({spatialReference:t.spatialReference});u.addGeometry(c);var y=new h.sfs.Element({geometry:u,symbol:this._getDefaultSymbol(i,o)});this._freedrawtoolpolygon.onCreate({map:t,spatialRef:t.spatialReference,callBack:n,drawLayer:r,templateElement:y,fillSymbol:o,pattern:i,type:a,appevent:s,context:this,contextx:l}),this._currentTool=this._freedrawtoolpolygon,this._freedrawtoolpolygon.onClick()},plot:function(t){var r={};r[p.TEXT]=this.plotText,r[p.TAILEDTEXT]=this.plotTailedText,r[p.POINT]=this.plotMarker,r[p.POLYLINE]=this.plotPolyline,r[p.POLYGON]=this.plotPolygon,r[p.COMPOSITE]=this.plotComposite,t=t||{};var n=this._getAlgorithm(t.type);if(null==n)throw new Error("参数类型错误！");var o=r[n._type];if(e.isFunction(o)){var i=jQuery.extend(!0,{},t);o.call(this,i)}}}),y.include({onPlotClick:function(e,t){this._plotClickObj={callback:e,context:t}},getLayer:function(){if(!this._plotLayer){var e=this.options.layerId,r=this.map.getMap(),n=t.getLayerById(this.map,e);n||(n=new h.carto.ElementLayer({map:r,id:e}),r.addLayer(n)),this._plotLayer=n}return this._plotLayer},getTailedLayer:function(){if(!this._tailedLayer){var e=this.options.layerId+"_tailed",r=this.map.getMap(),n=t.getLayerById(this.map,e);n||h.carto.LeadLabelLayer&&(n=new h.carto.LeadLabelLayer({map:r,id:e}),r.addLayer(n)),this._tailedLayer=n}return this._tailedLayer},getHighlightLayer:function(){if(!this._highlightLayer){var e=this.options.layerId+"_highlight",r=this.map.getMap(),n=t.getLayerById(this.map,e),o=this._plotLayer.getZIndex();n||(n=new h.carto.ElementLayer({map:r,id:e,zIndex:o+10}),r.addLayer(n)),this._highlightLayer=n}return this._highlightLayer},addHighlight:function(e){var t=this.getPlotElementById(e);if(t){var r=t.kind;if("overlay"!==r){if("tailedtext"===r){var n=this.getTailedLabelbyId(e);t=this._tailedLayer.leadLabelHash.get(n),this.highlight={element:t,layer:this._tailedLayer}}else this.highlight={element:t,layer:this._plotLayer};this.layerShowElemenet(!1);for(var o=0;o<t.elements.length;o++){var i=t.elements[o],a=i.copy().symbol;(a.borderThickness||0===a.borderThickness)&&(a.borderThickness=parseInt(a.borderThickness)+5),(a.width||0===a.width)&&(a.width=parseInt(a.width)+5),a.source&&(a.scale=1.5*parseInt(a.scale)),a.fontSize&&(a.fontWeight?a.fontWeight=1.2*a.fontWeight:a.fontWeight=100,"tailedtext"!==r?(a.borderColor.a=255,a.borderThickness||0===a.borderThickness?a.borderThickness=parseInt(a.borderThickness)+5:a.borderThickness=5,a.fontSize=1.2*a.fontSize):a.borderThickness=i.symbol.borderThickness);var s=new h.sfs.Element({geometry:i.geometry,symbol:a});s._plotId=e,this._highlightLayer.add(s)}}}},removeHighlight:function(e){this.layerShowElemenet(!0);for(var t=this._highlightLayer.elements.length-1;t>=0;t--){var r=this._highlightLayer.elements[t];r._plotId===e&&this._highlightLayer.remove(r)}},layerShowElemenet:function(e){this.highlight&&this.highlight.layer&&this.highlight.element&&this.highlight.layer.showElement(this.highlight.element,e)},clearHighlights:function(){this._highlightLayer.clear()},getPlotElements:function(){return this._plotLayer.elements},getPlotElementById:function(e){return this._plotLayer.find(e)||null},cancelPlot:function(){this._cancelPlot(),this._fireEvent(f.PLOT_CANCELED)},enableEdit:function(e){!0===e?(this._plotEditTool._enabled_=!0,this._resetToolState()):(this._plotEditTool._enabled_=!1,this._resetToolState())},finishPlot:function(){if(null==this._currentTool||1==this._currentTool.isEndDraw||null==this._lastControlPoint)throw new Error("当前无未完成的标绘！");this._currentTool.endDraw(this._lastControlPoint)},getSelectedElements:function(){return this._plotEditTool.selectionSet.graphiclist},selectPlotElement:function(e){var t=this.getPlotElementById(e);if(t)try{var n=t.elements[0].geometry.asWkt(),o=n.replace(/[^\d^\.^\,^\ ]/g,""),i=this.map.getMap(),a=o.split(",")[0].split(" "),s=parseFloat(a[0]),l=parseFloat(a[1]),c=i.getPixelFromCoordinate([s,l]);this._plotEditTool.onMouseDown(null,null,c[0],c[1])}catch(e){throw new Error(e)}else r.warn("标绘元素不存在！")},updatePlotElement:function(t){t=t||{};var o=[],i=null,a=this._plotLayer.find(t.id);if(a){if("composite"==a.kind){var s=a.elements[1],l=a.elements[0],c=t.symbol,u=t.plotProperty;if(i=new h.sfs.Attribute({name:"data",value:u}),o.push(i),l.attributeSet.attributes=o,e.isObject(c)){var p=n.object2Symbol(c.type,c.options);return l.symbol=p,s.symbol.color=p.borderColor,s.symbol.width=p.borderThickness,this._plotLayer.update(a,!0),this._fireEvent(f.PLOT_UPDATED,{element:a}),!0}return!1}if("tailedtext"==a.kind){var d=a.elements[a.elements.length-1];c=t.symbol,u=t.plotProperty;if(i=new h.sfs.Attribute({name:"data",value:u}),o.push(i),e.isObject(c)){var y=t.symbol.options,m=a.id,g=this._getTailedLabelById(m);g.attributeSet.attributes=o;var v=y.opacity;return g.label=y.label,g.fontSize=y.fontSize,g.fontFamilyName=y.fontFamilyName,g.foregroundColor=y.foregroundColor,g.foregroundColor.a=v,g.backgroundColor=y.backgroundColor,g.backgroundColor.a=v,g.lineColor=y.lineColor,g.lineColor.a=v,g.lineWidth=y.lineWidth,g.textBackgroundBorderColor=y.textBackgroundBorderColor,g.textBackgroundBorderColor.a=v,g.textBackgroundBorderThickness=y.textBackgroundBorderThickness,g.textBorderColor=y.foregroundColor,this._tailedLayer.update(g),this._tailedLabelUpdatePlot(),this._fireEvent(f.PLOT_UPDATED,{element:a}),!0}return!1}d=a.elements[a.elements.length-1],c=t.symbol,u=t.plotProperty;if(i=new h.sfs.Attribute({name:"data",value:u}),o.push(i),d.attributeSet.attributes=o,e.isObject(c)){p=n.object2Symbol(c.type,c.options);return d.symbol=p,this._plotLayer.update(a,!0),this._fireEvent(f.PLOT_UPDATED,{element:a}),!0}return!1}r.warn("元素不存在，id="+t.id)},removeByBusinessId:function(e){for(var t=this._plotLayer.elements,r=t.length-1;r>=0;r--){var n=t[r];n&&n.tag&&n.tag.businessId&&n.tag.businessId===e&&(this._removePlotElement(n.id),this._removeTailedTextById(n.id),this._removeOverlayById(n.id))}},getPlotElementsByBusinessId:function(e){for(var t=this._plotLayer.elements,r=[],n=t.length-1;n>=0;n--){var o=t[n];o&&o.tag&&o.tag.businessId&&o.tag.businessId===e&&r.push(o)}return r},removePlotElement:function(e){var t=this._removePlotElement(e);return this._removeTailedTextById(e),this._removeOverlayById(e),null!=t&&this._fireEvent(f.PLOT_DELETE,{elements:[t]}),t},removePlotElements:function(e){for(var t=(e=e||"").split(","),r=[],n=0,o=t.length;n<o;n++){var i=t[n],a=this.removePlotElement(i);null!=a&&r.push(a)}return this._fireEvent(f.PLOT_DELETE,{elements:r}),r},clearPlotElements:function(){var e=this._plotLayer.elements;return this._plotLayer.clear(),this._tailedLayer.clear(),this._plotOverlayTool.clear(),this._fireEvent(f.PLOT_DELETE,{elements:e}),e},getPlotSchema:function(t){for(var r=(t=t||{}).id||e.newUUID32(),n=new l({id:r,name:t.name||"",userId:t.groupId}),o=[],i=0,a=(o=e.isArray(t.elements)?t.elements:this._plotLayer.elements).length;i<a;i++){var s=o[i];if(s){var c=s.copy();if(c.unReset(),!0===t.reserveId&&(c.id=s.id),c._belong_schema=r,"tailedtext"==c.kind){var u=self.PlotComponent.getTailedLabelbyId(s.id);c.tailedLabelAttr=self.PlotComponent.serializeTailedLabel(u)}n.addElement(c)}}return JSON.stringify(n)},parseSchema:function(t){var r=null;if(e.isString(t.schema))try{r=l.fromJson(t.schema)}catch(e){throw new Error("参数类型错误！")}return r},loadPlotSchema:function(t){var r;if(t=t||{},e.isString(t.schema))try{r=l.fromJson(t.schema)}catch(e){throw new Error("参数类型错误！")}else r=t.schema;t.id&&(r.id=t.id);for(var n=r.getCount(),o=0;o<n;++o){var i=r.getElement(o);i.reset(),this._plotLayer.contains(i.id)||(t.flag||(i.schemaId=r.id),"tailedtext"==i.kind?this._loadTailedlabel(i):"overlay"==i.kind&&this._loadOverlay(i),this._plotLayer.add(i),i._schemaId=r.id)}},toggleElement:function(e,t){var r=this.getTailedLabelbyId(e),n=this._tailedLayer.leadLabelHash.get(r);this._tailedLayer.showElement(n,t)},getTailedLabelbyId:function(e){return this._getTailedLabelById(e)},serializeTailedLabel:function(e){var t=jQuery.extend(!0,{},e);return JSON.stringify(t)},getPlotBusinessId:function(e){var t="";return e&&e.tag&&void 0!==e.tag.businessId&&(t=e.tag.businessId),t}}),u.extend(y),y}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(1)],void 0===(o=function(e,t){var r="NoopTool",n=function(e){var r=e||{};r.cursor=r.cursor||"crosshair",t.interact.Tool.call(this,r),this.drawElement=null,this.geoBuilder=new t.draw.GeometryBuilder,this.isEndDraw=!0,this.geoLinePolygon=null};return t.core.ClassUtil.extend2(n,t.interact.Tool),n.prototype.onClick=function(e){n.prototype.uber.onClick.call(this,e),this.pushNum=0},n.prototype.onCreate=function(e){n.prototype.uber.onCreate(e),this.map=e.map,this.srid=e.spatialRef,this.callBack=e.callBack,this.templateElement=e.templateElement,this.drawLayer=e.drawLayer,this.fillSymbol=e.fillSymbol,this.pattern=e.pattern,this.type=e.type,this.appevent=e.appevent,this.context=e.context,this.contextx=e.contextx},n.prototype.onMouseClick=function(e,r,n,o,i,a,s){if(this.templateElement&&this.isEndDraw){this.map.stopDbClick(),this.isEndDraw=!1;var l=new t.sfs.Point({x:i,y:a,spatialReference:this.srid});this.drawElement=this.templateElement.copy();var c=this.drawElement.geometry;this.geoBuilder.build(c,l,1,this.pushNum),this.drawLayer.add(this.drawElement)}},n.prototype.onMouseMove=function(e,r,n,o,i,a,s){if(!this.isEndDraw){var l=new t.sfs.Point({x:i,y:a});this.context._lastControlPoint=l;var c=this.drawElement.geometry;this.geoBuilder.build(c,l,2,this.pushNum),this.drawLayer.update(this.drawElement)}},n.prototype.onDblclick=function(n){if(!this.isEndDraw){this.isEndDraw=!0;var o=this.drawElement.geometry;this.geoBuilder.build(o,null,4,this.pushNum),this.geoLinePolygon=null,this.lintToPolygon(this,o);var i={};i.geometry=this.geoLinePolygon,i.symbol=this.fillSymbol,i.name="freePlot";var a=this.context._constructPlotElement(this.pattern,i);this.drawLayer.remove(this.drawElement),this.drawLayer.add(a),this.pushNum=0,this.map.resumeDbClick(),this.drawElement=null;var s=new t.gdm.CommandManager,l=new t.gdm.CommandNotify({manager:s}),c=new t.interact.NoopTool({id:r,cursor:"pointer"});s.add(c);var u=new t.carto.GraphicSelectionSet;s.onCreate({map:this.map,commandNotify:l,graphicSelectionSet:u,spatialRef:{srid:this.srid}});var f=(new jsts.io.GeoJSONReader).read(this.geoLinePolygon.asGeoJson());if(e.isFunction(this.callBack)){if(!f.isValid()){var h=f.buffer(0);if(h.isValid()){var p=(new jsts.io.GeoJSONWriter).write(h);this.callBack.call(this.contextx,p)}else console.debug("此图形有拓扑错误")}this.callBack.call(this.contextx,this.geoLinePolygon.asGeoJson())}l.activeCommand(r),this.context._fireEvent(this.appevent,{type:this.type,element:a}),this.context._cancelPlot(),this.context._resetToolState()}},n.prototype.endDraw=function(){this.onDblclick()},n.prototype.lintToPolygon=function(e,r){var n="POLYGON((";if(1==r.paths.length){var o=r.paths[0].points;o.push(o[0]);var i=o.length,a=[];if(i>200){var s=i-200;if(i<=400)for(var l=Math.floor(i/s),c=1,u=0;u<i;u++)u==c*l?(c++,0!=u&&1!=u&&u!=i-1&&u!=i-2||a.push(o[u])):a.push(o[u]);else for(l=Math.ceil(i/200),c=1,u=0;u<i;u++)u==c*l?(c++,a.push(o[u])):0!=u&&1!=u&&u!=i-1&&u!=i-2||a.push(o[u]);i=(o=a).length}for(var f=0;f<o.length-1;f++)n=n+o[f].x.toFixed(5)+" "+o[f].y.toFixed(5)+",";n=n+o[i-1].x.toFixed(5)+" "+o[i-1].y.toFixed(5)}n+="))",e.geoLinePolygon=new t.sfs.GeometryFormatter.fromWKT(n,e.srid)},n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(1)],void 0===(o=function(e,t){var r="NoopTool",n=function(e){var r=e||{};r.cursor=r.cursor||"crosshair",t.interact.Tool.call(this,r),this.drawElement=null,this.geoBuilder=new t.draw.GeometryBuilder,this.isEndDraw=!0,this.geoLinePolyline=null};return t.core.ClassUtil.extend2(n,t.interact.Tool),n.prototype.onClick=function(e){n.prototype.uber.onClick.call(this,e),this.pushNum=0},n.prototype.onCreate=function(e){n.prototype.uber.onCreate(e),this.map=e.map,this.srid=e.spatialRef,this.callBack=e.callBack,this.templateElement=e.templateElement,this.drawLayer=e.drawLayer,this.lineSymbol=e.lineSymbol,this.pattern=e.pattern,this.type=e.type,this.appevent=e.appevent,this.context=e.context,this.contextx=e.contextx},n.prototype.onMouseClick=function(e,r,n,o,i,a,s){if(this.templateElement&&this.isEndDraw){this.map.stopDbClick(),this.isEndDraw=!1;var l=new t.sfs.Point({x:i,y:a,spatialReference:this.srid});this.drawElement=this.templateElement.copy();var c=this.drawElement.geometry;this.geoBuilder.build(c,l,1,this.pushNum),this.drawLayer.add(this.drawElement)}},n.prototype.onMouseMove=function(e,r,n,o,i,a,s){if(!this.isEndDraw){var l=new t.sfs.Point({x:i,y:a});this.context._lastControlPoint=l;var c=this.drawElement.geometry;this.geoBuilder.build(c,l,2,this.pushNum),this.drawLayer.update(this.drawElement)}},n.prototype.onDblclick=function(n){if(!this.isEndDraw){this.isEndDraw=!0;var o=this.drawElement.geometry;this.geoBuilder.build(o,null,4,this.pushNum),this.geoLinePolyline=null,this.lintToPolyline(this,o);var i={};i.geometry=this.geoLinePolyline,i.symbol=this.lineSymbol,i.name="freePlot";var a=this.context._constructPlotElement(this.pattern,i);this.drawLayer.remove(this.drawElement),this.drawLayer.add(a),this.pushNum=0,this.map.resumeDbClick(),this.drawElement=null;var s=new t.gdm.CommandManager,l=new t.gdm.CommandNotify({manager:s}),c=new t.interact.NoopTool({id:r,cursor:"pointer"});s.add(c);var u=new t.carto.GraphicSelectionSet;s.onCreate({map:this.map,commandNotify:l,graphicSelectionSet:u,spatialRef:{srid:this.srid}});var f=(new jsts.io.GeoJSONReader).read(this.geoLinePolyline.asGeoJson());e.isFunction(this.callBack)&&(f.isValid()||(console.debug("此图形有拓扑错误"),this.callBack.call(this.contextx,null)),this.callBack.call(this.contextx,this.geoLinePolyline.asGeoJson())),l.activeCommand(r),this.context._fireEvent(this.appevent,{type:this.type,element:a}),this.context._cancelPlot(),this.context._resetToolState()}},n.prototype.endDraw=function(){this.onDblclick()},n.prototype.lintToPolyline=function(e,r){var n="linestring(";if(1==r.paths.length){var o=r.paths[0].points,i=o.length,a=[];if(i>200){var s=i-200;if(i<=400)for(var l=Math.floor(i/s),c=1,u=0;u<i;u++)u==c*l?(c++,0!=u&&u!=i-1||a.push(o[u])):a.push(o[u]);else for(l=Math.ceil(i/200),c=1,u=0;u<i;u++)u==c*l?(c++,a.push(o[u])):0!=u&&u!=i-1||a.push(o[u]);i=(o=a).length}for(var f=0;f<o.length-1;f++)n=n+o[f].x.toFixed(5)+" "+o[f].y.toFixed(5)+",";n=n+o[i-1].x.toFixed(5)+" "+o[i-1].y.toFixed(5)}n+=")",e.geoLinePolyline=new t.sfs.GeometryFormatter.fromWKT(n,e.srid)},n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(2),r(1)],void 0===(o=function(e,t,r){var n=e.extend({options:{collision:"visibility",symbol:{type:"SimpleLineSymbol",options:{color:{a:250,r:0,g:0,b:0},style:5,width:2}}},domMoveList:[],_domMoveStart:{},initialize:function(t){e.prototype.initialize.call(this,t);try{this.overlayWare=new r.widget.OverlayWare({map:this.map})}catch(e){}window.test=this},clear:function(){this.removeAll()},destroy:function(){try{this.removeListeners()}catch(e){}e.prototype.destroy.call(this)}});return n.include({_parseDom:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},addListeners:function(){var e=this;this.onmousemove=function(t,r,n,o,i,a,s){var l={screenX:n,screenY:o,mapX:i,mapY:a};e._domMoveMapMove(l)},this.onmouseup=function(t,r,n,o,i,a,s){e._domMove=!1},this.map.on("mousemove",this.onmousemove),this.map.on("mouseup",this.onmouseup)},removeListeners:function(){this.map.un("mousemove",this.onmousemove),this.map.un("mouseup",this.onmouseup)},_bindDomEvent:function(e,t){var r=this,n=document.getElementById(e.id);n.onmousedown=function(e){e.currentTarget&&(this.addListeners(),console.debug("开始 > 地图停止拖拽"),r._domMove=!0,e.preventDefault(),r.map.stopDragPan(),r.domMoveObj=o,r.mousedownTime=(new Date).getTime())}.bind(this),n.onmouseup=function(e){this.removeListeners(),r._domMove&&(console.debug("停止>地图恢复拖拽"),r._domMove=!1,r.mouseUpTime=(new Date).getTime(),r.map.resumeDragPan(),r.fire("updateOverlayPlot",o))}.bind(this),n.onclick=function(){this.fire("overlayClick",this.domMoveObj)}.bind(this);var o={id:e.id,kind:"overlay",opts:e,container:n,overlay:t,tag:e.tag};this.domMoveList.push(o),r.fire("updateOverlayPlot",o)},_domMoveMapMove:function(e){if(this._domMove){console.debug("移动");var t=new r.sfs.Point({x:e.mapX,y:e.mapY,spatialReference:this.map.spatialReference});this.domMoveObj.overlay.position=t,this.overlayWare.update(this.domMoveObj.overlay)}},_moveDomEnd:function(){console.debug("停止"),this._domMove&&(this._domMove=!1,this.mouseUpTime=(new Date).getTime(),self.fire("updateOverlayPlot",this.domMoveObj))},_clickDom:function(){this.mouseUpTime-this.mousedownTime<200&&this.fire("overlayClick")}}),n.include({add:function(e){var n='<div id="'+e.id+'" ';switch(e.options.width&&e.options.height?n+='style="width:'+e.options.width+"px;height:"+e.options.height+'px;"':n+='style="width:60px;height:60px;"',n+=' class="plot-overlay-div">',e.options.type){case"iframe":n+='<iframe src="'+e.options.source+'" style="border: 0px; width: 100%; height: 100%; pointer-events: none;"></iframe>';break;case"image":n+='<img src="'+e.options.source+'" style="pointer-events: none;"/>',n+="</div>";break;case"html":n+=e.options.source,n+="</div>"}var o=new r.widget.OverLay({id:e.id||t.newUUID32(),element:this._parseDom(n),offset:[0,0],position:e.point,positioning:"center-center",stopEvent:!0});this.overlayWare.add(o),this._bindDomEvent(e,o)},getOverlayObjById:function(e){for(var t=null,r=0;r<this.domMoveList.length;r++)this.domMoveList[r].opts.id===e&&(t=this.domMoveList[r]);return t},showElement:function(e,t){var r=this.getOverlayObjById(e);r&&r.container&&r.container.style&&(r.container.style.display=t?"block":"none")},serialize:function(e){var t=e.overlay.position;return e.opts.point=t,JSON.stringify(e.opts)},remove:function(e){var t=document.getElementById(e);t&&(t.onmousedown=null,t.onmouseup=null,t.onclick=null),this.overlayWare.remove(e);for(var r=this.domMoveList.length-1;r>=0;r--)this.domMoveList[r].id===e&&this.domMoveList.splice(r,1)},removeAll:function(){for(var e=this.domMoveList.length-1;e>=0;e--){var t=document.getElementById(this.domMoveList[e].id);t.onmousedown=null,t.onmouseup=null,t.onclick=null}this.domMoveList=[],this.overlayWare.clear()}}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(14),r(23),r(18),r(80),r(38),r(181),r(1)],void 0===(o=function(e,t,r,n,o,i,a,s){return{extend:function(a){var l=o.PATTERNS,c=o.TYPES,u=o.TYPES_KEYS;a.include({drawMarker:function(e){if(!(e&&e.geometry instanceof s.sfs.Point))throw new Error("参数错误！");var r=this._constructPlotElement(l.POINT,e),n=t.getLayerById(this.map,e.layerId);(n=n||this._plotLayer).add(r),this._fireEvent(i.PLOT_CREATED,{type:u.Point,element:r}),this._resetToolState()},drawLine:function(e){if(!e)throw new Error("参数错误！");var r=this._constructPlotElement(l.POLYLINE,e),n=t.getLayerById(this.map,e.layerId);(n=n||this._plotLayer).add(r),this._fireEvent(i.PLOT_CREATED,{type:u.Polyline,element:r}),this._resetToolState()},drawPolygon:function(e){if(!e||!(e.geometry instanceof s.sfs.Polygon||e.geometry instanceof s.sfs.MultiPolygon))throw new Error("参数错误！");var r=this._constructPlotElement(l.POLYGON,e),n=t.getLayerById(this.map,e.layerId);(n=n||this._plotLayer).add(r),this._fireEvent(i.PLOT_CREATED,{type:u.Polygon,element:r}),this._resetToolState()},_constructPlotElement:function(t,n){var o=this._getDefaultSymbol(t,n.symbol),i="",a={};a[l.POINT]=u.Point,a[l.POLYLINE]=u.Polyline,a[l.POLYGON]=u.Polygon;var c=this._getAlgorithm(a[t]),f=new s.sfs.AttributeSet,h=e.newUUID();n.hasOwnProperty("name")&&(i=n.name+"_"+h.split("-")[0]);var p=new s.sfs.PlotElement({id:n.id||h,kind:t,name:i,algorithm:c,attributeSet:f}),d=new s.sfs.Element({id:n.id||h,kind:t,geometry:n.geometry,symbol:o,name:i,attributeSet:f});p.add(d);try{this._handleControlPoint(p)}catch(e){r.error(e)}return p.reset(),p},_handleControlPoint:function(e){var t=e.elements[0].geometry,r=e.plot,n={point:{regex:/^(.*Point),http\:\/\/www.Gs.com$/,handler:function(e,t){t.controlPoints=[e],t.update([e])}},polyline:{regex:/^(.*Polyline)|(.*LineString),http\:\/\/www.Gs.com$/,handler:function(e,t){var r=e.paths||[];e instanceof s.sfs.LineString&&(r=[e]);if(1==r.length){var n=r[0];t.controlPoints=t.controlPoints.concat(n.points),t.update([e])}}},polygon:{regex:/^(.*Polygon),http\:\/\/www.Gs.com$/,handler:function(e,t){var r=e.rings||[];0===r.length&&e.shell&&(r=[e.shell]);if(1==r.length){var n=r[0];t.controlPoints=t.controlPoints.concat(n.points),t.update([e])}}}};for(var o in n){if(n[o].regex.test(t.$type)){n[o].handler(t,r);break}}for(var i=e.elements,a=e.algorithm.createGeometries(e.plot.copy()),l=0,c=i.length;l<c;++l){var u=i[l],f=a[l];f.setSpatialReference(t.spatialReference),u.geometry=f}this._plotLayer.update(e)}}),a.include({_initTools:function(){var e=this.map.getMap(),t=new s.gdm.CommandManager,r=new s.gdm.CommandNotify({manager:t});this._commandMgr=t,this._commandNotify=r;var n=new s.interact.NoopTool({id:"NoopTool",cursor:this.options.cursor}),o=new s.plot.PlotEditTool({id:"PlotEdit",layer:this._plotLayer});t.add(n),t.add(o);var a=this;if(s.basic.LeadLabelEditTool){var l=new s.basic.LeadLabelEditTool({id:"leadLabelEditTool",layer:this._tailedLayer});t.add(l),this._tailedEditTool=l}this._plotEditTool=o,this._plotEditTool.endEdit=this._plotEditTool.endEdit.before((function(){var e=a.getSelectedElements();e.length>0&&a._fireEvent(i.PLOT_UPDATED,{element:e[0].element})})),this._plotEditTool.onMouseUp=this._plotEditTool.onMouseUp.before((function(){var e=a.getSelectedElements();e.length>0&&a._fireEvent(i.PLOT_MOUSEUP,{element:e[0].element})})),this._nooptool=n;var c=new s.carto.GraphicSelectionSet;this._commandHook={map:e,commandNotify:r,graphicSelectionSet:c,spatialRef:{srid:e.spatialReference}},t.onCreate(this._commandHook)},_removePlotElement:function(e){var t=this._plotLayer.find(e);return t?(this._plotLayer.remove(t),t):(r.warn("移除的元素不存在，id="+e),null)},_getAlgorithm:function(t,r){if(e.isString(t)){t=t.replace("Algorithm","");var n=c[t]||null,o=null,i=s.plot[n.algorithm]||s.plot[n.algorithm.replace("Free","")];return n&&e.isFunction(i)&&((o=new i(r?{size:r.size,map:r.map}:{}))._type=n.type),o}return null},_getDefaultSymbol:function(t,r){return e.isObject(r)||(r=this.options.symbols[t]),n.object2Symbol(r.type,r.options)},_constructPlotTool:function(t){if(!t)throw new Error("参数类型错误！");var r=this,n=t.algorithm||this._getAlgorithm(t.pattern),o="";t.pattern==l.TEXT?o="text":t.pattern==l.POINT?o="point":t.pattern==l.POLYLINE?o="polyline":t.pattern==l.POLYGON?o="polygon":t.pattern==l.COMPOSITE?o="composite":t.pattern==l.TAILEDTEXT?o="tailedtext":t.pattern==l.OVERLAY&&(o="overlay");var a=t.name||o,c=t.businessId,u=t.geometry,f=null,h=[];if(e.isArray(u)){var p=t.symbol||[];f=new s.sfs.Element({geometry:u[1],symbol:this._getDefaultSymbol(l.POLYLINE,p[1])}),h=[new s.sfs.Element({geometry:u[0],symbol:this._getDefaultSymbol(l.POLYGON,p[0])}),f]}else{var d=this._getDefaultSymbol(t.pattern,t.symbol);t.text&&(d.text=t.text),h=[f=new s.sfs.Element({geometry:u,symbol:d})]}var y=new s.plot.PlotTool({id:e.newUUID32(),drawTemplate:f,algorithm:n,elements:h,name:a,plotLayer:this._plotLayer});return y.onCreate(this._commandHook),y._onMouseUp=y.onMouseUp,y.onMouseUp=function(){try{y._onMouseUp.apply(y,arguments)}catch(e){}m.apply(r,arguments)},y.onEndDraw=function(e){g.call(r,e,t)},this._currentTool=y,y;function m(e,t,r,n,o,i,a){this._lastControlPoint=new s.sfs.Point({x:o,y:i})}function g(t,r){var n=this;this._cancelPlot(),t.kind=o,t.tag.businessId=c,e.isFunction(r.callback)&&("overlay"===o?setTimeout((function(){r.callback.call(r.context,t,r.overlayOpt,n)}),300):"tailedtext"===o?r.callback.call(r.context,t,r.tailedtext_symbol,this):r.callback.call(r.context,t,this)),Promise.resolve().then((function(){n._resetToolState()})),this._fireEvent(i.PLOT_CREATED,{type:r.type,element:t})}},_loadTailedlabel:function(e){var t=JSON.parse(e.tailedLabelAttr),r=this.getTailedLayer(),n={},o=t.size;if((!o||o<6)&&(o=6),t.domClassName||t.domHtml){var i=this._hex2ColorObj(t.domStyle.background),a=this._hex2ColorObj(t.domStyle.color),l=255*t.domStyle.opacity,c=this._hex2ColorObj("#"+t.domStyle.border.split("#")[1]),u=450-t.tailAngle;u>=360&&(u-=360),n={id:t.id,dimension:2,anchor:new s.sfs.Point({x:e.elements[0].geometry.x,y:e.elements[0].geometry.y,spatialReference:e.elements[0].geometry.spatialReference}),label:t.domHtml,fontSize:parseInt(t.domStyle["font-size"].split("px")[0],10),foregroundColor:new s.sfs.Color({r:a.r,b:a.b,g:a.g,a:l}),backgroundColor:new s.sfs.Color({r:i.r,b:i.b,g:i.g,a:l}),textBorderColor:new s.sfs.Color({r:a.r,b:a.b,g:a.g,a:l}),textBorderThickness:0,fontFamilyName:t.domStyle["font-family"]||"",textBackgroundBorderColor:new s.sfs.Color({r:c.r,b:c.b,g:c.g,a:l}),textBackgroundBorderThickness:parseInt(t.domStyle.border.split("px")[0],10),leadLength:t.tailLength,angle:u,lineColor:new s.sfs.Color(t.symbol.options.color),lineWidth:t.symbol.options.width,size:o,padding:t.domMinGap}}else n={id:t.id,dimension:2,anchor:new s.sfs.Point({x:t.anchor.x,y:t.anchor.y,spatialReference:t.anchor.spatialReference}),label:t.label,fontSize:t.fontSize,fontFamilyName:t.fontFamilyName||"",foregroundColor:new s.sfs.Color({r:t.foregroundColor.r,b:t.foregroundColor.b,g:t.foregroundColor.g,a:t.foregroundColor.a}),backgroundColor:new s.sfs.Color({r:t.backgroundColor.r,b:t.backgroundColor.b,g:t.backgroundColor.g,a:t.backgroundColor.a}),textBorderColor:new s.sfs.Color({r:t.textBorderColor.r,b:t.textBorderColor.b,g:t.textBorderColor.g,a:t.textBorderColor.a}),textBorderThickness:t.textBorderThickness,textBackgroundBorderColor:new s.sfs.Color({r:t.textBackgroundBorderColor.r,b:t.textBackgroundBorderColor.b,g:t.textBackgroundBorderColor.g,a:t.textBackgroundBorderColor.a}),textBackgroundBorderThickness:t.textBackgroundBorderThickness,leadLength:t.leadLength,angle:t.angle,lineColor:new s.sfs.Color({r:t.lineColor.r,b:t.lineColor.b,g:t.lineColor.g,a:t.lineColor.a}),lineWidth:t.lineWidth,size:o,padding:t.padding,textAlign:t.textAlign||"center"};n.textAlign=t.textAlign||"center";var f=new s.sfs.LeadLabel(n);f.tag={businessId:e.tag.businessId},f.schemaId=e.schemaId,f.attributeSet.attributes=t.attributeSet.attributes,r.add(f)},_hex2ColorObj:function(e){var t=e.substr(1),r={a:255,r:0,g:0,b:0};return 3===t.length?(r.r=parseInt(t[0]+t[0],16),r.g=parseInt(t[1]+t[1],16),r.b=parseInt(t[2]+t[2],16)):(r.r=parseInt(t[0]+t[1],16),r.g=parseInt(t[2]+t[3],16),r.b=parseInt(t[4]+t[5],16)),new s.sfs.Color(r)},_loadOverlay:function(e){var t=JSON.parse(e.overlayAttr);this._plotOverlayTool.add(t)},_cancelPlot:function(){this.map.getMap();try{this._resetToolState(),this._currentTool.deactivate(),this._currentTool=null}catch(e){}this._lastControlPoint=null},_mapClickHandler:function(t){if(!this._currentTool){var r=t.screenX,n=t.screenY,o=[];this._tailedLayer&&(o=this._tailedLayer.hitTestList(r,n).graphiclist);var a=this._plotLayer.hitTestList(r,n).graphiclist,s=null;if(o.length>0){var l=o[o.length-1];s=this._getTailedLabelByElement(l.element.parent),this.dragTailedText()}else if(a.length>0){s=(l=this._sortGraphics(a)).element.parent,this.enableEdit(!0)}if(this._plotClickObj){var c=this._plotClickObj.callback;e.isFunction(c)&&c.call(this._plotLayer.context,s)}this.fire(i.PLOT_CLICKED,{element:s})}},_tailedLabelUpdatePlot:function(){for(var e=this._tailedLayer.leadLabels,t=0;t<e.length;t++){var r=this.getPlotElementById(e[t].id);r&&(r.geometry=e[t].anchor,r.elements[0].geometry=e[t].anchor,this._plotLayer.update(r,!1))}},_getTailedLabelByElement:function(e){return this._tailedLayer.hashMap.get(e)},_getTailedLabelById:function(e){for(var t=null,r=this._tailedLayer.leadLabels,n=r.length-1;n>=0;n--)if(r[n].id===e){t=r[n];break}return t},_removeTailedTextById:function(e){for(var t=this._tailedLayer.leadLabels,r=t.length-1;r>=0;r--)t[r].id===e&&this._tailedLayer.remove(t[r])},_removeOverlayById:function(e){this._plotOverlayTool.remove(e)},_sortGraphics:function(e){for(var t=[],r=[],n=[],o=[],i=[],a=[],s=e.length-1;s>=0;s--){var l=e[s];switch(l.element.kind){case"point":t.push(l);break;case"text":r.push(l);break;case"polyline":n.push(l);break;case"polygon":l.element.name.indexOf("freePlot")>-1?i.push(l):o.push(l);default:a.push(l)}}return r.concat(t,n,o,a,i)[0]},_resetToolState:function(){!1===this._plotEditTool._enabled_?(this._plotEditTool.deactivate(),this._nooptool.onClick()):this._plotEditTool.onClick()},_fireEvent:function(e,t){this.fire(e,t),this.map.fire(e,t)},_overlayClick:function(t){if(this._plotClickObj){var r=this._plotClickObj.callback;e.isFunction(r)&&r.call(this._plotLayer.context,plotElement)}this.fire(i.PLOT_CLICKED,{element:t})},_updateOverlayPlot:function(e){var t=this.getPlotElementById(e.id);if(t){t.overlayAttr=this._plotOverlayTool.serialize(e);var r=e.overlay.position;r&&r.$type.indexOf("Point")>-1&&(t.elements[0].geometry=r),this._plotLayer.update(t)}}})}}}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(435),r(2),r(18),r(63),r(12),r(1)],void 0===(o=function(e,t,r,n,o,i){var a=e.extend({options:{domContainer:"emap-tailedlabel-container",tailLength:100,tailAlign:"auto",tailAngle:45,minHeight:15,minWidth:50,domTag:"span"},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)}});return a.include({_getDomAnchorPos:function(){var e=this.options.tailAngle,r={"[0,90)":{xVar:0,yVar:-1},"[90,180)":{xVar:0,yVar:0},"[180,270)":{xVar:-1,yVar:0},"[270,360)":{xVar:-1,yVar:-1}},n={};for(var o in r)if(t.assertWithin(e,o)){n=r[o];break}return"center"===this.options.tailAlign&&(n.xVar=-.5),n}}),a.include({}),a}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(21),r(2),r(436),r(18),r(63),r(12),r(23),r(37),r(1)],void 0===(o=function(e,t,r,n,o,i,a,s,l){var c=e.extend({options:{domContainer:"emap-taileddiv-container",tailLength:100,tailAngle:45,showArrow:!1,arrowAngle:30,arrowScale:.3,arrowLength:NaN,arrowSymbol:!1,arrowShape:"triangle",minHeight:15,minWidth:50,symbol:{type:"SimpleLineSymbol",options:{color:{a:200,r:0,g:0,b:255},style:"5",width:1}},domTag:"div",domMinGap:[5,5,5,5],domHtml:"新建引线文本",mousedownTime:null,mouseUpTime:null},includes:s.prototype,initialize:function(r){e.setOptions(this,r),this._id=r.id||t.newUUID32(),this.options.domId=this.options.domId||this._id,this.options.domHtml=r.label,this._visible=!1,this._tail=null,this._tailArrow=null,this._dom=null,this._domContainer=null,this._tailAnchor=null,this._domAnchor=null,this._domBounds=[],this.options.geometry=i.toJstsGeometry(this.options.geometry);var n={position:"absolute",display:"block","white-space":"nowrap","min-width":this.options.minWidth+"px","min-height":this.options.minHeight+"px","font-family":"SimSun"};this.options.domStyle=jQuery.extend(!0,n,this.options.domStyle||{}),this._domMove=!1,this._domMoveStart={},this._update()},update:function(e){var t=JSON.stringify(this.options.domStyle);if(e&&jQuery.extend(!0,this.options,e),t!=JSON.stringify(this.options.domStyle))for(var r in this.options.domStyle)this._dom.css(r,this.options.domStyle[r]);this._update()},destroy:function(){this._unbindDomEvent(),this._clearTail(),this._clearDom()}});return c.include({getId:function(){return this._id},updateTail:function(){this._clearTail(),this._updateTailAnchor(),this._updateDomAnchor(),this._updateTail(),!0===this.options.showArrow&&this._updateArrow()},updateDom:function(){this._updateTailAnchor(),this._updateDomAnchor(),this._updateDomPosition()},setContent:function(e){this._dom.html(e),this.options.domHtml=e},getBounds:function(){var e=this.options.domMinGap,t=[];return t.push(this._domBounds[0]-e[0]),t.push(this._domBounds[1]-e[1]),t.push(this._domBounds[2]+e[2]),t.push(this._domBounds[3]+e[3]),t},intersects:function(e){var t=e.getBounds(),r=this.getBounds(),n=new jsts.geom.Envelope(t[0],t[2],t[1],t[3]);return new jsts.geom.Envelope(r[0],r[2],r[1],r[3]).intersects(n)},toggleVisible:function(e){e=!!e;var t=this._getDom();e?t.css("display","block"):t.css("display","none");var r=this.options.layer;null!=this._tail&&r.showElement(this._tail,e),null!=this._tailArrow&&r.showElement(this._tailArrow,e),this._visible=e},visible:function(){return this._visible},serialize:function(){var e=jQuery.extend(!0,{},this.options);return delete e.layer,delete e.map,console.log(e),JSON.stringify(e)}}),c.include({_getDomContainer:function(){if(null==this._domContainer){var e=this.options.domContainer;if(0==jQuery("#"+e).length){var t='<div id="'+e+'"';t+='style="top:0px;left:0px;position:absolute;pointer-events:auto;cursor:pointer"',t+="></div>",jQuery("#"+this.options.map.options.targetId).find(".ol-overlaycontainer-stopevent").append(t)}this._domContainer=jQuery("#"+e)}return this._domContainer},_getDom:function(){var e=this._getDomContainer(),t=this.options.domId,r=this.options.domTag;if(null==this._dom){var n="<"+r+' id="'+t+'"';if(this.options.domClassName&&(n+=' class="'+this.options.domClassName+'" '),this.options.domStyle){var o="";for(var i in this.options.domStyle)o+=i+":"+this.options.domStyle[i]+";";n+=' style="'+o+'" '}n+="></"+r+">",e.append(n),this._dom=jQuery("#"+t),this._bindDomEvent()}return this._dom},_update:function(){this.updateTail(),this.updateDom()},_updateDomPosition:function(){var e=this._getDom(),t=this._getDomAnchorPos(),r=e.outerWidth(),n=e.outerHeight(),o=this._domAnchor[2]+t.xVar*r,i=this._domAnchor[3]+t.yVar*n;e.css("marginLeft",o+"px"),e.css("marginTop",i+"px"),this._domBounds=[o,i,o+r,i+n]},_drawBounds:function(){this._bounds&&this.options.layer.remove(this._bounds);var e=[],r=this.options.map;function o(e,t,r){var n=r.getCoordinateFromPixel(t);e.push(n)}var i=this.getBounds();o(e,[i[0],i[1]],r),o(e,[i[0],i[3]],r),o(e,[i[2],i[3]],r),o(e,[i[2],i[1]],r),o(e,[i[0],i[1]],r);var a={type:"Polygon",coordinates:[e]};this._bounds=n.geoinfoToElement(a,{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},fillColor:{a:50,r:200,g:0,b:0},borderThickness:2,opacity:1}},{id:t.newUUID32(),layer:this.options.layer})},_getDomAnchorPos:function(){return{xVar:0,yVar:-1}},_updateTailAnchor:function(){var e=this.options.map,t=this.options.geometry.getCentroid().coordinate,r=[t.x,t.y],n=e.getPixelFromCoordinate(r);this._tailAnchor=r.concat(n)},_updateDomAnchor:function(){var e=this._tailAnchor,t=this.options.tailLength,r=this.options.tailAngle,n=this.options.map,o=(270+r)*Math.PI/180,i=[e[2]+Math.cos(o)*t,e[3]+Math.sin(o)*t],a=n.getCoordinateFromPixel(i);this._domAnchor=a.concat(i)},_updateTail:function(){var e=this._tailAnchor,t=this._domAnchor,r={type:"LineString",coordinates:[[e[0],e[1]],[t[0],t[1]]]};this._tail=n.geoinfoToElement(r,this.options.symbol,{id:this._id,layer:this.options.layer})},_updateArrow:function(){var e={},t=this.options.map;e.startPt=this._domAnchor.slice(2),e.endPt=this._tailAnchor.slice(2),e.arrowScale=this.options.arrowScale,e.arrowAngle=this.options.arrowAngle,e.arrowLength=this.options.arrowLength;for(var o=r.getSimpleArrow(e),i=[],a=0,s=o.length;a<s;a++){var l=o[a],c=t.getCoordinateFromPixel(l);i.push(c)}var u=((t={line:function(e){return{geometry:{type:"LineString",coordinates:e},symbol:this.options.arrowSymbol||this.options.symbol}},triangle:function(e){e.push(e[0]);var t,r={type:"Polygon",coordinates:[e]};if(this.options.arrowSymbol)t=this.options.arrowSymbol;else{t={type:"SimpleFillSymbol",options:{borderColor:{a:1,r:0,g:0,b:0},fillColor:{},opacity:1}};var n=this.options.symbol.options;t.options.fillColor=n.fillColor||n.color}return{geometry:r,symbol:t}}})[this.options.arrowShape]||t.triangle).call(this,i);this._tailArrow=n.geoinfoToElement(u.geometry,u.symbol,{id:this._id+"_arrow",layer:this.options.layer})},_moveDomStart:function(e){this._domMove=!0,e.preventDefault(),e.stopPropagation(),this._domMoveStart.disX=e.pageX-this._dom.offset().left,this._domMoveStart.disY=e.pageY-this._dom.offset().top},_moveDomMove:function(e){if(this._domMove){var t=e.pageX-this._domMoveStart.disX,r=e.pageY-this._domMoveStart.disY;this._dom.css({marginLeft:t,marginTop:r});var n=this._getDom(),o=this._getDomAnchorPos(),i=n.outerWidth(),a=n.outerHeight(),s=t-o.xVar*i,l=r-o.yVar*a,c=[s,l],u=this.options.map.getCoordinateFromPixel(c);this._domAnchor=u.concat(c),this._domBounds=[t,r,t+i,r+a];var f,h=this._tailAnchor,p=h[3]-l,d=h[2]-s,y=Math.atan(Math.abs(p/d)),m=180/Math.PI*y;p<0&&d<0?f=m+90:p>0&&d<0?f=90-m:p<0&&d>0?f=270-m:p>0&&d>0?f=270+m:0==p&&x<0?f=90:0==p&&x>0?f=270:p<0&&0==x?f=180:p>0&&0==x&&(f=0);var g=Math.sqrt(d*d+p*p);this.options.tailLength=g,this.options.tailAngle=f,this._clearTail(),this._updateTail()}},_moveDomEnd:function(){this._domMove=!1,this.fire("updateTailedLabelAttr")},_domMoveMapMove:function(e,t){if(this._domMove){var r=e-this._domMoveStart.disX,n=t-this._domMoveStart.disY;this._dom.css({marginLeft:r,marginTop:n});var o=this._getDom(),i=this._getDomAnchorPos(),a=o.outerWidth(),s=o.outerHeight(),l=r-i.xVar*a,c=n-i.yVar*s,u=[l,c],f=this.options.map.getCoordinateFromPixel(u);this._domAnchor=f.concat(u),this._domBounds=[r,n,r+a,n+s];var h,p=this._tailAnchor,d=p[3]-c,y=p[2]-l,m=Math.atan(Math.abs(d/y)),g=180/Math.PI*m;d<0&&y<0?h=g+90:d>0&&y<0?h=90-g:d<0&&y>0?h=270-g:d>0&&y>0?h=270+g:0==d&&x<0?h=90:0==d&&x>0?h=270:d<0&&0==x?h=180:d>0&&0==x&&(h=0);var v=Math.sqrt(y*y+d*d);this.options.tailLength=v,this.options.tailAngle=h,this._clearTail(),this._updateTail()}},_changeDomLabel:function(){},_clearTail:function(){null!=this._tail&&(this.options.layer.remove(this._tail),this._tail=null),null!=this._tailArrow&&(this.options.layer.remove(this._tailArrow),this._tailArrow=null)},_clearDom:function(){null!=this._dom&&this._dom.remove()},_bindDomEvent:function(){var e=this;this._dom.on("mousedown",(function(t){e.mousedownTime=(new Date).getTime(),e._moveDomStart(t),e.options.map.listen("mousemove",(function(t){e._domMoveMapMove(t.screenX,t.screenY)})),e.options.map.listen("mouseup",(function(t){e._moveDomEnd(t)}))})),this._dom.on("mouseup",(function(t){e.mouseUpTime=(new Date).getTime(),e._moveDomEnd(),e.options.map.off("mousemove"),e.options.map.off("mouseup")})),this._dom.on("click",(function(t){e.mouseUpTime-e.mousedownTime<200&&e.fire("tailedLabelClick")}))},_unbindDomEvent:function(){this._dom.off("mousedown"),this._dom.off("mousemove"),this._dom.off("mouseup"),this._dom.off("click")}}),c}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n;void 0===(n=function(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}var t={angle:function(e,t){var r;return(r=t[0]===e[0]?t[1]>=e[1]?-Math.PI/2:Math.PI/2:Math.atan2(e[1]-t[1],t[0]-e[0]))<0&&(r+=2*Math.PI),180*r/Math.PI},getSimpleArrow:function(r){if(!e((r=r||{}).startPt)||2!=r.startPt.length||!e(r.endPt)||2!=r.endPt.length)throw new Error("参数错误！");var n=r.startPt,o=r.endPt,i=r.arrowLength,a=isNaN(r.arrowScale)?.2:r.arrowScale,s=isNaN(r.arrowAngle)?30:r.arrowAngle,l=!1!==r.forScreen,c=Math.PI,u=t.angle(o,n),f=Math.sqrt(Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2));isNaN(i)&&(i=f*a);var h=l?-1:1,p=(u+s)*c/180,d=(u-s)*c/180,y=o[0]+Math.cos(p)*i,m=o[1]+h*Math.sin(p)*i,g=o[0]+Math.cos(d)*i,v=o[1]+h*Math.sin(d)*i,b=[];return b.push([y,m]),b.push([o[0],o[1]]),b.push([g,v]),b}};return t}.apply(t,[]))||(e.exports=n)},function(e,t,r){"use strict";var n,o;n=[r(2),r(14),r(23),r(18),r(438),r(439),r(440),r(80),r(57),r(15),r(441),r(38),r(1)],void 0===(o=function(e,t,r,n,o,i,a,s,l,c,u,f,h){var p=s.PATTERNS,d=(s.TYPES,s.TYPES_KEYS),y=c.extend({options:{layerId:"plot-layer",symbols:{text:{type:"TextSymbol",options:{fontFamilyName:"宋体",fontSize:12,foreground:{a:255,r:0,g:0,b:255},borderColor:{a:1,r:255,g:255,b:255},borderThickness:0,offsetX:0,offsetY:0}},point:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{a:153,r:0,g:0,b:0},fillColor:{a:153,r:65,g:105,b:225},borderThickness:2,size:4}},line:{type:"SimpleLineSymbol",options:{color:{a:153,r:0,g:0,b:255},width:2,style:5}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{a:153,r:0,g:0,b:255},fillColor:{a:150,r:19,g:181,b:177},borderThickness:0,opacity:1}},tailedtext:{type:"SimpleMarkerSymbol",options:{borderColor:{a:255,r:205,g:85,b:85},fillColor:{a:255,r:205,g:85,b:85},borderThickness:0,size:0}}}},initialize:function(e){var t=this,r=this;c.prototype.initialize.call(this,e),this._plotLayer=this.getLayer(),this._tailedLayer=this.getTailedLayer(),this._highlightLayer=this.getHighlightLayer(),this._tailedOnMouseUpHandler=function(e,t,n,o,i){r._tailedLabelUpdatePlot()},this._tailedLayer&&this._tailedLayer.on("mouseup",this._tailedOnMouseUpHandler),this._initTools(),this._currentTool=null,this.onMapClick=function(e,r,n,o,i,a){t._mapClickHandler(n,o)},this.map.on("click",this.onMapClick,this),this._freedrawtoolpolygon=new o,this._freedrawtoolpolyline=new i,this._plotOverlayTool=new a({map:this.map}),this._plotOverlayTool.on("overlayClick",this._overlayClick,this)},destroy:function(){this.map.off("click",this._mapClickHandler,this),c.prototype.destroy.call(this)}});return y.include({plotText:function(e){e=e||{};var t=this._getAlgorithm(d.Point);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map,n={};n.businessId=e.businessId,n.name=e.name,n.pattern=p.TEXT,n.type=d.Point,n.algorithm=t,n.symbol=e.symbol,n.text=e.text||"";var o=new h.sfs.Point({spatialReference:r.getSrid()});n.geometry=o,n.callback=e.callback,n.context=e.context,this._constructPlotTool(n).onClick()},plotTailedText:function(e){e=e||{};var t=this._getAlgorithm(d.TAILEDTEXT);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map,n={};n.businessId=e.businessId,n.name=e.name,n.pattern=p.TAILEDTEXT,n.type=d.Point,n.algorithm=t,n.symbol={type:"SimpleMarkerSymbol",options:{size:0}},n.text=e.text||"";var o=new h.sfs.Point({spatialReference:r.getSrid()});n.geometry=o,n.tailedtext_symbol=e.tailedtext_symbol,n.callback=this.addTailedEle,n.context=e.context,this._constructPlotTool(n).onClick()},addTailedEle:function(e,t,r){var n=e.id,o={},i=e.elements[0].geometry;o.geometry=i,o.label="自定义文本内容",o.id=n;var a=t.foregroundColor||{r:255,b:255,g:255,a:255},s=t.backgroundColor||{r:205,b:85,g:85,a:255},l=t.textBackgroundBorderColor||{r:220,b:0,g:0,a:255},c=t.lineColor||{r:205,b:85,g:85,a:255},u={id:n,dimension:3,anchor:i,label:"自定义文本内容",fontSize:t.fontSize||24,fontFamilyName:t.fontFamilyName||"宋体",foregroundColor:new h.sfs.Color(a),backgroundColor:new h.sfs.Color(s),textBorderColor:new h.sfs.Color(a),textBorderThickness:0,textBackgroundBorderColor:new h.sfs.Color(l),textBackgroundBorderThickness:t.textBackgroundBorderThickness||2,leadLength:t.leadLength||100,angle:t.angle||45,lineColor:new h.sfs.Color(c),lineWidth:t.lineWidth||1,size:t.size||6,textAlign:t.textAlign||"center",padding:t.padding||[10,10,10,10]},f=new h.sfs.LeadLabel(u);f.tag={tooId:e.tag.toolId,businessId:e.tag.businessId,name:e.tag.name},r._tailedLayer.add(f),r._tailedLabelUpdatePlot(),setTimeout((function(){r.dragTailedText()}),500)},dragTailedText:function(){this.map.currentTool(this._tailedEditTool)},plotMarker:function(e){if("Overlay"===e.type){if(e=e||{},null==(n=this._getAlgorithm(d.Overlay)))throw new Error("参数类型错误！");this._plotEditTool.deactivate();var t=this.map;(o={}).businessId=e.businessId,o.name=e.name,o.pattern=p.OVERLAY,o.type=d.Point,o.algorithm=n,o.symbol={type:"SimpleMarkerSymbol",options:{size:0}},o.overlayOpt=e.overlayOpt;var r=new h.sfs.Point({spatialReference:t.getSrid()});o.geometry=r,o.callback=this.addOverlay,o.context=e.context,this._constructPlotTool(o).onClick()}else{var n;if(e=e||{},null==(n=this._getAlgorithm(d.Point)))throw new Error("参数类型错误！");this._plotEditTool.deactivate();var o;t=this.map;(o={}).businessId=e.businessId,o.name=e.name,o.pattern=p.POINT,o.type=d.Point,o.algorithm=n,o.symbol=e.symbol;r=new h.sfs.Point({spatialReference:t.getSrid()});o.geometry=r,o.callback=e.callback,o.context=e.context,this._constructPlotTool(o).onClick()}},addOverlay:function(e,t,r){var n={id:e.id,point:e.elements[0].geometry,options:t,tag:{toolId:e.tag.toolId,name:e.tag.name,businessId:e.tag.businessId}};r._plotOverlayTool.add(n)},plotPolyline:function(e){if((e=e||{}).type!=d.FreePolyline||h.plot.FreePolylineAlgorithm){(i={}).map=this.map,i.size=e.size;var t=this._getAlgorithm(e.type||d.Polyline,i);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map;(i={}).businessId=e.businessId,i.name=e.name,i.pattern=p.POLYLINE,i.type=e.type||d.Polyline,i.algorithm=t,i.symbol=e.symbol;var n=new h.sfs.Path({spatialReference:r.getSrid()});n.addPoint(new h.sfs.Point({spatialReference:r.getSrid()})),n.addPoint(new h.sfs.Point({spatialReference:r.getSrid()}));var o=new h.sfs.Polyline({spatialReference:r.getSrid()});o.addGeometry(n),i.geometry=o,i.callback=e.callback,i.context=e.context,this._constructPlotTool(i).onClick()}else{var i;(i={}).businessId=e.businessId,i.name=e.name,i.name=e.name,i.symbol=e.symbol,i.callback=e.callback,this.plotFreeDrawPolyline(i)}},plotPolygon:function(e){if((e=e||{}).type!=d.FreePolygon||h.plot.FreePolygonAlgorithm){(i={}).map=this.map,i.size=e.size;var t=this._getAlgorithm(e.type||d.Polygon,i);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r=this.map;(i={}).businessId=e.businessId,i.name=e.name,i.pattern=p.POLYGON,i.type=e.type||d.Polygon,i.algorithm=t,i.symbol=e.symbol;var n=new h.sfs.Polygon({spatialReference:r.getSrid()}),o=new h.sfs.Ring({spatialReference:r.getSrid()});o.addPoint(new h.sfs.Point),o.addPoint(new h.sfs.Point),o.addPoint(new h.sfs.Point),o.addPoint(new h.sfs.Point),n.addGeometry(o),i.geometry=n,i.callback=e.callback,i.context=e.context,this._constructPlotTool(i).onClick()}else{var i;(i={}).businessId=e.businessId,i.name=e.name,i.map=this.map,i.drawLayer=this._plotLayer,i.pattern=p.POLYGON,i.appevent=f.PLOT_CREATED,i.type=d.Polygon,i.symbol=e.symbol,i.callback=e.callback,i.context=this,this.plotFreeDrawPolygon(i)}},plotComposite:function(t){t=t||{},(n={}).map=this.map,n.size=t.size;var r=this._getAlgorithm(t.type,n);if(null==r)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var n,o=this.map;(n={}).businessId=t.businessId,n.name=t.name,n.pattern=p.COMPOSITE,n.type=p.POLYGON,n._type=t.type,n.algorithm=r,e.isArray(t.symbol)?n.symbol=t.symbol:e.isObject(t.symbol)&&(n.symbol=[t.symbol,t.symbol]);var i=new h.sfs.Polygon({spatialReference:o.getSrid()}),a=new h.sfs.Ring({spatialReference:h.sfs.EnumSpatialReference.EPSG4326});a.addPoint(new h.sfs.Point),a.addPoint(new h.sfs.Point),a.addPoint(new h.sfs.Point),a.addPoint(new h.sfs.Point),i.addGeometry(a);var s=new h.sfs.Path({spatialReference:o.getSrid()});s.addPoint(new h.sfs.Point),s.addPoint(new h.sfs.Point);var l=new h.sfs.Polyline({spatialReference:o.getSrid()});l.addGeometry(s),n.geometry=[i,l],n.callback=t.callback,n.context=t.context,this._constructPlotTool(n).onClick()},plotFreeDrawPolyline:function(e){var t=this.map,r=this._plotLayer,n=e.callback,o=e.symbol||this.options.symbols.line,i=p.POLYLINE,a=d.Polyline,s=f.PLOT_CREATED,l=e.context,c=t.getSrid(),u=new h.sfs.Path({spatialReference:c});u.addPoint(new h.sfs.Point({spatialReference:c})),u.addPoint(new h.sfs.Point({spatialReference:c}));var y=new h.sfs.Polyline({spatialReference:c});y.addGeometry(u);var m=new h.sfs.Element({geometry:y,symbol:this._getDefaultSymbol(i,o)});this._freedrawtoolpolyline.onCreate({map:t,spatialRef:t.getSrid(),callBack:n,drawLayer:r,templateElement:m,lineSymbol:o,pattern:i,type:a,appevent:s,context:this,contextx:l}),this._currentTool=this._freedrawtoolpolyline,this._freedrawtoolpolyline.onClick()},plotFreeDrawPolygon:function(e){var t=this.map,r=this._plotLayer,n=e.callback,o=e.symbol||this.options.symbols.polygon,i=p.POLYGON,a=d.Polygon,s=f.PLOT_CREATED,l=e.context,c=t.getSrid(),u=new h.sfs.Path({spatialReference:c});u.addPoint(new h.sfs.Point({spatialReference:c})),u.addPoint(new h.sfs.Point({spatialReference:c}));var y=new h.sfs.Polyline({spatialReference:c});y.addGeometry(u);var m=new h.sfs.Element({geometry:y,symbol:this._getDefaultSymbol(i,o)});this._freedrawtoolpolygon.onCreate({map:t,spatialRef:t.getSrid(),callBack:n,drawLayer:r,templateElement:m,fillSymbol:o,pattern:i,type:a,appevent:s,context:this,contextx:l}),this._currentTool=this._freedrawtoolpolygon,this._freedrawtoolpolygon.onClick()},plot:function(t){var r={};r[p.TEXT]=this.plotText,r[p.TAILEDTEXT]=this.plotTailedText,r[p.POINT]=this.plotMarker,r[p.POLYLINE]=this.plotPolyline,r[p.POLYGON]=this.plotPolygon,r[p.COMPOSITE]=this.plotComposite,t=t||{};var n=this._getAlgorithm(t.type);if(null==n)throw new Error("参数类型错误！");var o=r[n._type];if(e.isFunction(o)){var i=jQuery.extend(!0,{},t);o.call(this,i)}}}),y.include({onPlotClick:function(e,t){this._plotClickObj={callback:e,context:t}},getLayer:function(){if(!this._plotLayer){var e=this.options.layerId,r=this.map,n=t.getLayerById(this.map,e);n||(n=new h.carto.CanvasLayer3D({map:r,id:e,zIndex:20}),r.addLayer(n)),this._plotLayer=n}return this._plotLayer},getTailedLayer:function(){if(!this._tailedLayer){var e=this.options.layerId+"_tailed",r=this.map,n=t.getLayerById(this.map,e);n||(n=new h.carto.LeadLabelLayer3D({map:r,id:e}),r.addLayer(n)),this._tailedLayer=n}return this._tailedLayer},getHighlightLayer:function(){if(!this._highlightLayer){var e=this.options.layerId+"_highlight",r=this.map,n=t.getLayerById(this.map,e),o=this._plotLayer.getZIndex();n||(n=new h.carto.ElementLayer3D({map:r,id:e,zIndex:o+10}),r.addLayer(n)),this._highlightLayer=n}return this._highlightLayer},addHighlight:function(e){var t=this.getPlotElementById(e);if(t){var r=t.kind;if("overlay"!==r){if("tailedtext"===r){var n=this.getTailedLabelbyId(e);t=this._tailedLayer.leadLabelHash.get(n),this.highlight={element:t,layer:this._tailedLayer}}else this.highlight={element:t,layer:this._plotLayer};this.layerShowElemenet(!1);for(var o=0;o<t.elements.length;o++){var i=t.elements[o],a=i.copy().symbol;(a.borderThickness||0===a.borderThickness)&&(a.borderThickness=parseInt(a.borderThickness)+5),(a.width||0===a.width)&&(a.width=parseInt(a.width)+5),a.source&&(a.scale=1.5*parseInt(a.scale)),a.fontSize&&(a.fontWeight?a.fontWeight=1.2*a.fontWeight:a.fontWeight=100,"tailedtext"!==r?(a.borderColor.a=255,a.borderThickness||0===a.borderThickness?a.borderThickness=parseInt(a.borderThickness)+5:a.borderThickness=5,a.fontSize=1.2*a.fontSize):a.borderThickness=i.symbol.borderThickness);var s=new h.sfs.Element({geometry:i.geometry,symbol:a});s._plotId=e,this._highlightLayer.add(s)}}}},removeHighlight:function(e){this.layerShowElemenet(!0);for(var t=this._highlightLayer._elements.length-1;t>=0;t--){var r=this._highlightLayer._elements[t];r._plotId===e&&this._highlightLayer.remove(r)}},layerShowElemenet:function(e){this.highlight&&this.highlight.layer&&this.highlight.element&&this.highlight.layer.showElement(this.highlight.element,e)},clearHighlights:function(){this._highlightLayer.clear()},getPlotElements:function(){return this._plotLayer.elements},getPlotElementById:function(e){return this._plotLayer.find(e)||null},cancelPlot:function(){this._cancelPlot(),this._fireEvent(f.PLOT_CANCELED)},enableEdit:function(e){!0===e?(this._plotEditTool._enabled_=!0,this._resetToolState()):(this._plotEditTool._enabled_=!1,this._resetToolState())},finishPlot:function(){if(null==this._currentTool||1==this._currentTool.isEndDraw||null==this._lastControlPoint)throw new Error("当前无未完成的标绘！");this._currentTool.endDraw(this._lastControlPoint)},getSelectedElements:function(){return this._plotEditTool.selectionSet.graphiclist},selectPlotElement:function(e){var t=this.getPlotElementById(e);if(t)try{var n=t.elements[0].geometry.asWkt(),o=n.replace(/[^\d^\.^\,^\ ]/g,""),i=this.map,a=o.split(",")[0].split(" "),s=parseFloat(a[0]),l=parseFloat(a[1]),c=i.getPixelFromCoordinate([s,l]);this._plotEditTool.onMouseDown(null,null,c[0],c[1])}catch(e){throw new Error(e)}else r.warn("标绘元素不存在！")},updatePlotElement:function(t){t=t||{};var o=[],i=null,a=this._plotLayer.find(t.id);if(a){if("composite"==a.kind){var s=a.elements[1],l=a.elements[0],c=t.symbol,u=t.plotProperty;if(i=new h.sfs.Attribute({name:"data",value:u}),o.push(i),l.attributeSet.attributes=o,e.isObject(c)){var p=n.object2Symbol(c.type,c.options);return l.symbol=p,s.symbol.color=p.borderColor,s.symbol.width=p.borderThickness,this._plotLayer.update(a,!0),this._fireEvent(f.PLOT_UPDATED,{element:a}),!0}return!1}if("tailedtext"==a.kind){var d=a.elements[a.elements.length-1];c=t.symbol,u=t.plotProperty;if(i=new h.sfs.Attribute({name:"data",value:u}),o.push(i),e.isObject(c)){var y=t.symbol.options,m=a.id,g=this._getTailedLabelById(m);g.attributeSet.attributes=o;var v=y.opacity;return g.label=y.label,g.fontSize=y.fontSize,g.fontFamilyName=y.fontFamilyName,g.foregroundColor=y.foregroundColor,g.foregroundColor.a=v,g.backgroundColor=y.backgroundColor,g.backgroundColor.a=v,g.lineColor=y.lineColor,g.lineColor.a=v,g.lineWidth=y.lineWidth,g.textBackgroundBorderColor=y.textBackgroundBorderColor,g.textBackgroundBorderColor.a=v,g.textBackgroundBorderThickness=y.textBackgroundBorderThickness,g.textBorderColor=y.foregroundColor,this._tailedLayer.update(g),this._tailedLabelUpdatePlot(),this._fireEvent(f.PLOT_UPDATED,{element:a}),!0}return!1}d=a.elements[a.elements.length-1],c=t.symbol,u=t.plotProperty;if(i=new h.sfs.Attribute({name:"data",value:u}),o.push(i),d.attributeSet.attributes=o,e.isObject(c)){p=n.object2Symbol(c.type,c.options);return d.symbol=p,this._plotLayer.update(a,!0),this._fireEvent(f.PLOT_UPDATED,{element:a}),!0}return!1}r.warn("元素不存在，id="+t.id)},removeByBusinessId:function(e){for(var t=this._plotLayer.elements,r=t.length-1;r>=0;r--){var n=t[r],o=n.tag.businessId;o&&o===e&&(this._removePlotElement(n.id),this._removeTailedTextById(n.id),this._removeOverlayById(n.id))}},removePlotElement:function(e){var t=this._removePlotElement(e);return this._removeTailedTextById(e),this._removeOverlayById(e),null!=t&&this._fireEvent(f.PLOT_DELETE,{elements:[t]}),t},removePlotElements:function(e){for(var t=(e=e||"").split(","),r=[],n=0,o=t.length;n<o;n++){var i=t[n],a=this.removePlotElement(i);null!=a&&r.push(a)}return this._fireEvent(f.PLOT_DELETE,{elements:r}),r},clearPlotElements:function(){var e=this._plotLayer.elements;return this._plotLayer.clear(),this._tailedLayer.clear(),this._plotOverlayTool.clear(),this._fireEvent(f.PLOT_DELETE,{elements:e}),e},getPlotSchema:function(t){for(var r=(t=t||{}).id||e.newUUID32(),n=new l({id:r,name:t.name||"",userId:t.groupId}),o=[],i=0,a=(o=e.isArray(t.elements)?t.elements:this._plotLayer.elements).length;i<a;i++){var s=o[i];if(s){var c=s.copy();if(c.unReset(),!0===t.reserveId&&(c.id=s.id),c._belong_schema=r,"tailedtext"==c.kind){var u=self.PlotComponent.getTailedLabelbyId(s.id);c.tailedLabelAttr=self.PlotComponent.serializeTailedLabel(u)}n.addElement(c)}}return JSON.stringify(n)},parseSchema:function(t){var r=null;if(e.isString(t.schema))try{r=l.fromJson(t.schema)}catch(e){throw new Error("参数类型错误！")}return r},loadPlotSchema:function(t){var r;if(t=t||{},e.isString(t.schema))try{r=l.fromJson(t.schema)}catch(e){throw new Error("参数类型错误！")}else r=t.schema;t.id&&(r.id=t.id);for(var n=r.getCount(),o=0;o<n;++o){var i=r.getElement(o);if(i.reset(),!this._plotLayer.contains(i.id)){if(t.flag||(i.schemaId=r.id),"tailedtext"==i.kind?this._loadTailedlabel(i):"overlay"==i.kind&&(this._loadOverlay(i),i.elements[0].geometry.spatialReference=this.map.getSrid()),"point"===i.kind&&i.elements[0].symbol.$type.indexOf("VectorMarkerSymbol")>-1){var a=i.elements[0].symbol,s=Object.assign({},a);delete s.$type,s.width=a.width*a.scale,s.height=a.height*a.scale;var c=new h.sfs.PictureMarkerSymbol(s);i.elements[0].symbol=c}"polyline"===i.kind&&i.elements[0].geometry.paths[0].points.length<1?console.log("无效polyline"):this._plotLayer.add(i),i._schemaId=r.id}}},toggleElement:function(e,t){var r=this.getTailedLabelbyId(e),n=this._tailedLayer.leadLabelHash.get(r);this._tailedLayer.showElement(n,t),this._plotOverlayTool.showElement(e,t)},getTailedLabelbyId:function(e){return this._getTailedLabelById(e)},serializeTailedLabel:function(e){var t=jQuery.extend(!0,{},e);return JSON.stringify(t)}}),u.extend(y),y}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(1)],void 0===(o=function(e,t){var r="NoopTool",n=function(e){var r=e||{};r.cursor=r.cursor||"crosshair",t.interact.Tool.call(this,r),this.drawElement=null,this.geoBuilder=new t.draw.GeometryBuilder,this.isEndDraw=!0,this.geoLinePolygon=null};return t.core.ClassUtil.extend2(n,t.interact.Tool),n.prototype.onClick=function(e){n.prototype.uber.onClick.call(this,e),this.pushNum=0},n.prototype.onCreate=function(e){n.prototype.uber.onCreate(e),this.map=e.map,this.srid=e.spatialRef,this.callBack=e.callBack,this.templateElement=e.templateElement,this.drawLayer=e.drawLayer,this.fillSymbol=e.fillSymbol,this.pattern=e.pattern,this.type=e.type,this.appevent=e.appevent,this.context=e.context,this.contextx=e.contextx},n.prototype.onMouseClick=function(e,r,n,o,i,a,s){if(this.templateElement&&this.isEndDraw){this.map.stopDbClick(),this.isEndDraw=!1;var l=new t.sfs.Point({x:i,y:a,spatialReference:this.srid});this.drawElement=this.templateElement.copy();var c=this.drawElement.geometry;0==(c=this.drawElement.geometry).paths[0].points[1].x&&0==c.paths[0].points[1].y&&c.removePoint(c.paths[0].points[1]),0==c.paths[0].points[0].x&&0==c.paths[0].points[0].y&&c.removePoint(c.paths[0].points[0]),this.geoBuilder.build(c,l,1,this.pushNum),this.drawLayer.add(this.drawElement)}},n.prototype.onMouseMove=function(e,r,n,o,i,a,s){if(!this.isEndDraw){var l=new t.sfs.Point({x:i,y:a});this.context._lastControlPoint=l;var c=this.drawElement.geometry;0==c.paths[0].points[1].x&&0==c.paths[0].points[1].y&&c.removePoint(c.paths[0].points[1]),0==c.paths[0].points[0].x&&0==c.paths[0].points[0].y&&c.removePoint(c.paths[0].points[0]),this.geoBuilder.build(c,l,2,this.pushNum),this.drawLayer.update(this.drawElement)}},n.prototype.onDblclick=function(n){if(!this.isEndDraw){this.isEndDraw=!0;var o=this.drawElement.geometry;o.removePoint(o.paths[0].points[1]),o.removePoint(o.paths[0].points[0]),o.paths[0].spatialReference=this.srid,this.geoBuilder.build(o,null,4,this.pushNum),this.geoLinePolygon=null,this.lintToPolygon(this,o);var i={};i.geometry=this.geoLinePolygon,i.symbol=this.fillSymbol,i.name="freePlot";var a=this.context._constructPlotElement(this.pattern,i);this.drawLayer.remove(this.drawElement),this.drawLayer.add(a),this.pushNum=0,this.map.resumeDbClick(),this.drawElement=null;var s=new t.gdm.CommandManager,l=new t.gdm.CommandNotify({manager:s}),c=new t.interact.NoopTool({id:r,cursor:"pointer"});s.add(c);var u=new t.carto.GraphicSelectionSet;s.onCreate({map:this.map,commandNotify:l,graphicSelectionSet:u,spatialRef:{srid:this.srid}});var f=(new jsts.io.GeoJSONReader).read(this.geoLinePolygon.asGeoJson());e.isFunction(this.callBack)&&(f.isValid()?this.callBack.call(this.contextx,this.geoLinePolygon.asGeoJson()):this.callBack.call(this.contextx,null)),l.activeCommand(r),this.context._fireEvent(this.appevent,{type:this.type,element:a}),this.context._cancelPlot(),this.context._resetToolState()}},n.prototype.endDraw=function(){this.onDblclick()},n.prototype.lintToPolygon=function(e,r){var n="POLYGON((";if(1==r.paths.length){var o=r.paths[0].points;o.push(o[0]);var i=o.length,a=[];if(i>200){var s=i-200;if(i<=400)for(var l=Math.floor(i/s),c=1,u=0;u<i;u++)u==c*l?(c++,0!=u&&1!=u&&u!=i-1&&u!=i-2||a.push(o[u])):a.push(o[u]);else for(l=Math.ceil(i/200),c=1,u=0;u<i;u++)u==c*l?(c++,a.push(o[u])):0!=u&&1!=u&&u!=i-1&&u!=i-2||a.push(o[u]);i=(o=a).length}for(var f=0;f<o.length-1;f++)n=n+o[f].x.toFixed(5)+" "+o[f].y.toFixed(5)+",";n=n+o[i-1].x.toFixed(5)+" "+o[i-1].y.toFixed(5)}n+="))",e.geoLinePolygon=new t.sfs.GeometryFormatter.fromWKT(n,e.srid),e.geoLinePolygon.shell.spatialReference=e.srid;for(var h=e.geoLinePolygon.shell.points,p=0;p<h.length;p++)h[p].spatialReference=e.srid},n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(1)],void 0===(o=function(e,t){var r="NoopTool",n=function(e){var r=e||{};r.cursor=r.cursor||"crosshair",t.interact.Tool.call(this,r),this.drawElement=null,this.geoBuilder=new t.draw.GeometryBuilder,this.isEndDraw=!0,this.geoLinePolyline=null};return t.core.ClassUtil.extend2(n,t.interact.Tool),n.prototype.onClick=function(e){n.prototype.uber.onClick.call(this,e),this.pushNum=0},n.prototype.onCreate=function(e){n.prototype.uber.onCreate(e),this.map=e.map,this.srid=e.spatialRef,this.callBack=e.callBack,this.templateElement=e.templateElement,this.drawLayer=e.drawLayer,this.lineSymbol=e.lineSymbol,this.pattern=e.pattern,this.type=e.type,this.appevent=e.appevent,this.context=e.context,this.contextx=e.contextx},n.prototype.onMouseClick=function(e,r,n,o,i,a,s){if(this.templateElement&&this.isEndDraw){this.map.stopDbClick(),this.isEndDraw=!1;var l=new t.sfs.Point({x:i,y:a,spatialReference:this.srid});this.drawElement=this.templateElement.copy();var c=this.drawElement.geometry;0==(c=this.drawElement.geometry).paths[0].points[1].x&&0==c.paths[0].points[1].y&&c.removePoint(c.paths[0].points[1]),0==c.paths[0].points[0].x&&0==c.paths[0].points[0].y&&c.removePoint(c.paths[0].points[0]),this.geoBuilder.build(c,l,1,this.pushNum),this.drawLayer.add(this.drawElement)}},n.prototype.onMouseMove=function(e,r,n,o,i,a,s){if(!this.isEndDraw){var l=new t.sfs.Point({x:i,y:a});this.context._lastControlPoint=l;var c=this.drawElement.geometry;0==c.paths[0].points[1].x&&0==c.paths[0].points[1].y&&c.removePoint(c.paths[0].points[1]),0==c.paths[0].points[0].x&&0==c.paths[0].points[0].y&&c.removePoint(c.paths[0].points[0]),this.geoBuilder.build(c,l,2,this.pushNum),this.drawLayer.update(this.drawElement)}},n.prototype.onDblclick=function(n){if(!this.isEndDraw){this.isEndDraw=!0;var o=this.drawElement.geometry;o.removePoint(o.paths[0].points[1]),o.removePoint(o.paths[0].points[0]),this.geoBuilder.build(o,null,4,this.pushNum),this.geoLinePolyline=null,this.lintToPolyline(this,o);var i={};i.geometry=this.geoLinePolyline,i.symbol=this.lineSymbol,i.name="freePlot";var a=this.context._constructPlotElement(this.pattern,i);this.drawLayer.remove(this.drawElement),this.drawLayer.add(a),this.pushNum=0,this.map.resumeDbClick(),this.drawElement=null;var s=new t.gdm.CommandManager,l=new t.gdm.CommandNotify({manager:s}),c=new t.interact.NoopTool({id:r,cursor:"pointer"});s.add(c);var u=new t.carto.GraphicSelectionSet;s.onCreate({map:this.map,commandNotify:l,graphicSelectionSet:u,spatialRef:{srid:this.srid}});var f=(new jsts.io.GeoJSONReader).read(this.geoLinePolyline.asGeoJson());e.isFunction(this.callBack)&&(f.isValid()?this.callBack.call(this.contextx,this.geoLinePolyline.asGeoJson()):this.callBack.call(this.contextx,null)),l.activeCommand(r),this.context._fireEvent(this.appevent,{type:this.type,element:a}),this.context._cancelPlot(),this.context._resetToolState()}},n.prototype.endDraw=function(){this.onDblclick()},n.prototype.lintToPolyline=function(e,r){var n="linestring(";if(1==r.paths.length){var o=r.paths[0].points,i=o.length,a=[];if(i>200){var s=i-200;if(i<=400)for(var l=Math.floor(i/s),c=1,u=0;u<i;u++)u==c*l?(c++,0!=u&&u!=i-1||a.push(o[u])):a.push(o[u]);else for(l=Math.ceil(i/200),c=1,u=0;u<i;u++)u==c*l?(c++,a.push(o[u])):0!=u&&u!=i-1||a.push(o[u]);i=(o=a).length}for(var f=0;f<o.length-1;f++)n=n+o[f].x.toFixed(5)+" "+o[f].y.toFixed(5)+",";n=n+o[i-1].x.toFixed(5)+" "+o[i-1].y.toFixed(5)}n+=")",e.geoLinePolyline=new t.sfs.GeometryFormatter.fromWKT(n,e.srid),e.geoLinePolyline.spatialReference=e.srid;for(var h=e.geoLinePolyline.points,p=0;p<h.length;p++)h[p].spatialReference=e.srid},n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;function i(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}n=[r(15),r(2),r(1)],void 0===(o=function(e,t,r){var n,o,a=e.extend({options:{collision:"visibility",symbol:{type:"SimpleLineSymbol",options:{color:{a:250,r:0,g:0,b:0},style:5,width:2}}},domMoveList:[],_domMoveStart:{},initialize:function(t){e.prototype.initialize.call(this,t);try{this.overlayWare=new r.widget.OverlayWare3D({map:{map:this.map}})}catch(e){}window.test=this},clear:function(){this.removeAll()},destroy:function(){try{this.removeListeners()}catch(e){}e.prototype.destroy.call(this)}});return a.include({_parseDom:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},addListeners:function(){var e=this;this.onmousemove=function(t,r,n,o,i,a,s){var l={screenX:n,screenY:o,mapX:i,mapY:a};e._domMoveMapMove(l)},this.onmouseup=function(t,r,n,o,i,a,s){e._domMove=!1},this.map.on("mousemove",this.onmousemove),this.map.on("mouseup",this.onmouseup)},removeListeners:function(){this.map.un("mousemove",this.onmousemove),this.map.un("mouseup",this.onmouseup)},_bindDomEvent:function(e,t){var r=this,n=document.getElementById(e.id);n.onmousedown=function(e){e.currentTarget&&(this.addListeners(),console.debug("开始 > 地图停止拖拽"),r._domMove=!0,e.preventDefault(),r.map.stopDragPan(),r.domMoveObj=o,r.mousedownTime=(new Date).getTime())}.bind(this),n.onmouseup=function(e){this.removeListeners(),r._domMove&&(console.debug("停止>地图恢复拖拽"),r._domMove=!1,r.mouseUpTime=(new Date).getTime(),r.map.resumeDragPan(),r.fire("updateOverlayPlot",o))}.bind(this),n.onclick=function(){this.fire("overlayClick",this.domMoveObj)}.bind(this);var o={id:e.id,kind:"overlay",opts:e,container:n,overlay:t,tag:e.tag};this.domMoveList.push(o),r.fire("updateOverlayPlot",o)},_domMoveMapMove:function(e){if(this._domMove){var t=this.map.pickSurfacePosition({x:e.screenX,y:e.screenY});this.domMoveObj.overlay.position=t,this.overlayWare.update(this.domMoveObj.overlay)}},_moveDomEnd:function(){console.debug("停止"),this.removeListeners(),this._domMove&&(this._domMove=!1,this.mouseUpTime=(new Date).getTime(),this.map.resumeDragPan(),this.fire("updateOverlayPlot",this.domMoveObj))},_clickDom:function(){this.mouseUpTime-this.mousedownTime<200&&this.fire("overlayClick")}}),a.include({add:(n=regeneratorRuntime.mark((function e(n){var o,i,a,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o='<div id="'+n.id+'" ',i=0,n.options.width&&n.options.height?(o+='style="width:'+n.options.width+"px;height:"+n.options.height+'px;"',i=n.options.height/2):(o+='style="width:60px;height:60px;"',i=30),o+=' class="plot-overlay-div">',e.t0=n.options.type,e.next="iframe"===e.t0?7:"image"===e.t0?9:"html"===e.t0?12:15;break;case 7:return o+='<iframe src="'+n.options.source+'" style="border: 0px; width: 100%; height: 100%; pointer-events: none;"></iframe>',e.abrupt("break",15);case 9:return o+='<img src="'+n.options.source+'" style="pointer-events: none;"/>',o+="</div>",e.abrupt("break",15);case 12:return o+=n.options.source,o+="</div>",e.abrupt("break",15);case 15:if(a=n.point.z){e.next=20;break}return e.next=19,this.getAltitude([n.point.x,n.point.y]);case 19:a=e.sent;case 20:s=new r.sfs.Point({x:n.point.x,y:n.point.y,z:a,spatialReference:this.map.getSrid()||4326}),l=new r.widget.OverLay({id:n.id||t.newUUID32(),element:this._parseDom(o),offset:[0,-i],position:s,positioning:"center-center",stopEvent:!0}),this.overlayWare.add(l),this._bindDomEvent(n,l);case 24:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function s(e){i(a,r,o,s,l,"next",e)}function l(e){i(a,r,o,s,l,"throw",e)}s(void 0)}))},function(e){return o.apply(this,arguments)}),getOverlayObjById:function(e){for(var t=null,r=0;r<this.domMoveList.length;r++)this.domMoveList[r].opts.id===e&&(t=this.domMoveList[r]);return t},showElement:function(e,t){var r=this.getOverlayObjById(e);r&&r.container&&r.container.style&&(r.container.style.display=t?"block":"none")},serialize:function(e){var t=e.overlay.position;return e.opts.point=t,JSON.stringify(e.opts)},getAltitude:function(e){var t=this;return new Promise((function(n,o){var i=new r.sfs.Point({x:e[0],y:e[1],z:0,spatialReference:t.map.getSrid()});t.map.getAltitude([i]).then((function(e){var t=e[0];n(parseFloat(t.z.toFixed(2)))}))}))},remove:function(e){var t=document.getElementById(e);t&&(t.onmousedown=null,t.onmouseup=null,t.onclick=null),this.overlayWare.remove(e);for(var r=this.domMoveList.length-1;r>=0;r--)this.domMoveList[r].id===e&&this.domMoveList.splice(r,1)},removeAll:function(){for(var e=this.domMoveList.length-1;e>=0;e--){var t=document.getElementById(this.domMoveList[e].id);t.onmousedown=null,t.onmouseup=null,t.onclick=null}this.domMoveList=[],this.overlayWare.clear()}}),a}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(2),r(14),r(23),r(18),r(80),r(38),r(1)],void 0===(o=function(e,t,r,n,o,i,a){return{extend:function(s){var l=o.PATTERNS,c=o.TYPES,u=o.TYPES_KEYS;s.include({drawMarker:function(e){if(!(e&&e.geometry instanceof a.sfs.Point))throw new Error("参数错误！");var r=this._constructPlotElement(l.POINT,e),n=t.getLayerById(this.map,e.layerId);(n=n||this._plotLayer).add(r),this._fireEvent(i.PLOT_CREATED,{type:u.Point,element:r}),this._resetToolState()},drawLine:function(e){if(!e)throw new Error("参数错误！");var r=this._constructPlotElement(l.POLYLINE,e),n=t.getLayerById(this.map,e.layerId);(n=n||this._plotLayer).add(r),this._fireEvent(i.PLOT_CREATED,{type:u.Polyline,element:r}),this._resetToolState()},drawPolygon:function(e){if(!e||!(e.geometry instanceof a.sfs.Polygon||e.geometry instanceof a.sfs.MultiPolygon))throw new Error("参数错误！");var r=this._constructPlotElement(l.POLYGON,e),n=t.getLayerById(this.map,e.layerId);(n=n||this._plotLayer).add(r),this._fireEvent(i.PLOT_CREATED,{type:u.Polygon,element:r}),this._resetToolState()},_constructPlotElement:function(t,n){var o=this._getDefaultSymbol(t,n.symbol),i="",s={};s[l.POINT]=u.Point,s[l.POLYLINE]=u.Polyline,s[l.POLYGON]=u.Polygon;var c=this._getAlgorithm(s[t]),f=new a.sfs.AttributeSet,h=e.newUUID();n.hasOwnProperty("name")&&(i=n.name+"_"+h.split("-")[0]);var p=new a.sfs.PlotElement({id:n.id||h,kind:t,name:i,algorithm:c,attributeSet:f}),d=new a.sfs.Element({id:n.id||h,kind:t,geometry:n.geometry,symbol:o,name:i,attributeSet:f});p.add(d);try{this._handleControlPoint(p)}catch(e){r.error(e)}return p.reset(),p},_handleControlPoint:function(e){var t=e.elements[0].geometry,r=e.plot,n={point:{regex:/^(.*Point),http\:\/\/www.Gs.com$/,handler:function(e,t){t.controlPoints=[e],t.update([e])}},polyline:{regex:/^(.*Polyline)|(.*LineString),http\:\/\/www.Gs.com$/,handler:function(e,t){var r=e.paths||[];e instanceof a.sfs.LineString&&(r=[e]);if(1==r.length){var n=r[0];t.controlPoints=t.controlPoints.concat(n.points),t.update([e])}}},polygon:{regex:/^(.*Polygon),http\:\/\/www.Gs.com$/,handler:function(e,t){var r=e.rings||[];0===r.length&&e.shell&&(r=[e.shell]);if(1==r.length){var n=r[0];t.controlPoints=t.controlPoints.concat(n.points),t.update([e])}}}};for(var o in n){if(n[o].regex.test(t.$type)){n[o].handler(t,r);break}}for(var i=e.elements,s=e.algorithm.createGeometries(e.plot.copy()),l=0,c=i.length;l<c;++l){var u=i[l],f=s[l];f.setSpatialReference(t.spatialReference),u.geometry=f}this._plotLayer.update(e)}}),s.include({_initTools:function(){var e=this.map,t=new a.gdm.CommandManager,r=new a.gdm.CommandNotify({manager:t});this._commandMgr=t,this._commandNotify=r;var n=new a.interact.NoopTool({id:"NoopTool",cursor:this.options.cursor}),o=new a.plot.PlotEditTool({id:"PlotEdit",layer:this._plotLayer}),s=new a.basic.LeadLabelEditTool3D({id:"leadLabelEditTool",layer:this._tailedLayer});t.add(n),t.add(o),t.add(s),this._plotEditTool=o,this._tailedEditTool=s;var l=this;this._plotEditTool.endEdit=this._plotEditTool.endEdit.before((function(){var e=l.getSelectedElements();e.length>0&&l._fireEvent(i.PLOT_UPDATED,{element:e[0].element})})),this._nooptool=n;var c=new a.carto.GraphicSelectionSet;this._commandHook={map:e,commandNotify:r,graphicSelectionSet:c,spatialRef:{srid:e.getSrid()}},t.onCreate(this._commandHook)},_removePlotElement:function(e){var t=this._plotLayer.find(e);return t?(this._plotLayer.remove(t),t):(r.warn("移除的元素不存在，id="+e),null)},_getAlgorithm:function(t,r){if(e.isString(t)){t=t.replace("Algorithm","");var n=c[t]||null,o=null,i=a.plot[n.algorithm];return n&&e.isFunction(i)&&((o=new i(r?{size:r.size,map:r.map}:{}))._type=n.type),o}return null},_getDefaultSymbol:function(t,r){return e.isObject(r)||(r=this.options.symbols[t]),n.object2Symbol(r.type,r.options)},_constructPlotTool:function(t){if(!t)throw new Error("参数类型错误！");var r=this,n=t.algorithm||this._getAlgorithm(t.pattern),o="";t.pattern==l.TEXT?o="text":t.pattern==l.POINT?o="point":t.pattern==l.POLYLINE?o="polyline":t.pattern==l.POLYGON?o="polygon":t.pattern==l.COMPOSITE?o="composite":t.pattern==l.TAILEDTEXT?o="tailedtext":t.pattern==l.OVERLAY&&(o="overlay");var s=t.name||o,c=t.businessId,u=t.geometry,f=null,h=[];if(e.isArray(u)){var p=t.symbol||[];f=new a.sfs.Element({geometry:u[1],symbol:this._getDefaultSymbol(l.POLYLINE,p[1])}),h=[new a.sfs.Element({geometry:u[0],symbol:this._getDefaultSymbol(l.POLYGON,p[0])}),f]}else{var d=this._getDefaultSymbol(t.pattern,t.symbol);t.text&&(d.text=t.text),h=[f=new a.sfs.Element({geometry:u,symbol:d})]}var y=new a.plot.PlotTool({id:e.newUUID32(),drawTemplate:f,algorithm:n,elements:h,name:s,pickZ:!0,plotLayer:this._plotLayer});return y.onCreate(this._commandHook),y._onMouseUp=y.onMouseUp,y.onMouseUp=function(){try{y._onMouseUp.apply(y,arguments)}catch(e){}m.apply(r,arguments)},y.onEndDraw=function(e){g.call(r,e,t)},y.onPosition3d=function(e,t,r){this.pickZ&&(this.mapz=r)},this._currentTool=y,y;function m(e,t,r,n,o,i,s){this._lastControlPoint=new a.sfs.Point({x:o,y:i,spatialReference:this.map.getSrid()})}function g(t,r){var n=this;this._cancelPlot(),t.kind=o,t.tag.businessId=c,e.isFunction(r.callback)&&("overlay"===o?setTimeout((function(){r.callback.call(r.context,t,r.overlayOpt,n)}),300):"tailedtext"===o?r.callback.call(r.context,t,r.tailedtext_symbol,this):r.callback.call(r.context,t,this)),Promise.resolve().then((function(){n._resetToolState()})),this._fireEvent(i.PLOT_CREATED,{type:r.type,element:t})}},_loadTailedlabel:function(e){var t=JSON.parse(e.tailedLabelAttr),r=this.getTailedLayer(),n={},o=e.elements[0].geometry.z||0,i=t.size;if((!i||i<6)&&(i=6),t.domClassName||t.domHtml){var s=this._hex2ColorObj(t.domStyle.background),l=this._hex2ColorObj(t.domStyle.color),c=255*t.domStyle.opacity,u=this._hex2ColorObj("#"+t.domStyle.border.split("#")[1]),f=450-t.tailAngle;f>=360&&(f-=360),n={id:t.id,dimension:3,anchor:new a.sfs.Point({x:e.elements[0].geometry.x,y:e.elements[0].geometry.y,z:o,spatialReference:e.elements[0].geometry.spatialReference}),label:t.domHtml,fontSize:parseInt(t.domStyle["font-size"].split("px")[0],10),foregroundColor:new a.sfs.Color({r:l.r,b:l.b,g:l.g,a:c}),backgroundColor:new a.sfs.Color({r:s.r,b:s.b,g:s.g,a:c}),textBorderColor:new a.sfs.Color({r:l.r,b:l.b,g:l.g,a:c}),textBorderThickness:0,fontFamilyName:t.domStyle["font-family"]||"",textBackgroundBorderColor:new a.sfs.Color({r:u.r,b:u.b,g:u.g,a:c}),textBackgroundBorderThickness:parseInt(t.domStyle.border.split("px")[0],10),leadLength:t.tailLength,angle:f,lineColor:new a.sfs.Color(t.symbol.options.color),lineWidth:t.symbol.options.width,size:i,padding:t.domMinGap}}else n={id:t.id,dimension:3,anchor:new a.sfs.Point({x:t.anchor.x,y:t.anchor.y,z:o,spatialReference:t.anchor.spatialReference}),label:t.label,fontSize:t.fontSize,fontFamilyName:t.fontFamilyName||"",foregroundColor:new a.sfs.Color({r:t.foregroundColor.r,b:t.foregroundColor.b,g:t.foregroundColor.g,a:t.foregroundColor.a}),backgroundColor:new a.sfs.Color({r:t.backgroundColor.r,b:t.backgroundColor.b,g:t.backgroundColor.g,a:t.backgroundColor.a}),textBorderColor:new a.sfs.Color({r:t.textBorderColor.r,b:t.textBorderColor.b,g:t.textBorderColor.g,a:t.textBorderColor.a}),textBorderThickness:t.textBorderThickness,textBackgroundBorderColor:new a.sfs.Color({r:t.textBackgroundBorderColor.r,b:t.textBackgroundBorderColor.b,g:t.textBackgroundBorderColor.g,a:t.textBackgroundBorderColor.a}),textBackgroundBorderThickness:t.textBackgroundBorderThickness,leadLength:t.leadLength,angle:t.angle,lineColor:new a.sfs.Color({r:t.lineColor.r,b:t.lineColor.b,g:t.lineColor.g,a:t.lineColor.a}),lineWidth:t.lineWidth,size:i,padding:t.padding};n.textAlign=t.textAlign||"center";var h=new a.sfs.LeadLabel(n);h.tag={businessId:e.tag.businessId},h.schemaId=e.schemaId,h.attributeSet.attributes=t.attributeSet.attributes,r.add(h)},_hex2ColorObj:function(e){var t=e.substr(1),r={a:255,r:0,g:0,b:0};return 3===t.length?(r.r=parseInt(t[0]+t[0],16),r.g=parseInt(t[1]+t[1],16),r.b=parseInt(t[2]+t[2],16)):(r.r=parseInt(t[0]+t[1],16),r.g=parseInt(t[2]+t[3],16),r.b=parseInt(t[4]+t[5],16)),new a.sfs.Color(r)},_loadOverlay:function(e){var t=JSON.parse(e.overlayAttr);this._plotOverlayTool.add(t)},_cancelPlot:function(){this.map;try{this._resetToolState(),this._currentTool.deactivate(),this._currentTool=null}catch(e){}this._lastControlPoint=null},_mapClickHandler:function(t,r){if(!this._currentTool){t=t,r=r;var n=this._tailedLayer.hitTest(t,r),o=this._plotLayer.hitTest(t,r),a=null;if(n&&n.element?(a=n.element.parent?this._getTailedLabelByElement(n.element.parent):this._getTailedLabelByElement(n.element),this.dragTailedText()):o&&o.element&&(a=o.element.parent,this.enableEdit(!0)),this._plotClickObj){var s=this._plotClickObj.callback;e.isFunction(s)&&s.call(this._plotLayer.context,a)}this.fire(i.PLOT_CLICKED,{element:a})}},_tailedLabelUpdatePlot:function(){for(var e=this._tailedLayer.leadLabels,t=0;t<e.length;t++){var r=this.getPlotElementById(e[t].id);r&&(r.geometry=e[t].anchor,r.elements[0].geometry=e[t].anchor,this._plotLayer.update(r,!1))}},_getTailedLabelByElement:function(e){if(this._tailedLayer)return this._tailedLayer.hashMap.get(e)},_getTailedLabelById:function(e){if(this._tailedLayer){for(var t=null,r=this._tailedLayer.leadLabels,n=r.length-1;n>=0;n--)if(r[n].id===e){t=r[n];break}return t}},_removeTailedTextById:function(e){if(this._tailedLayer)for(var t=this._tailedLayer.leadLabels,r=t.length-1;r>=0;r--)t[r].id===e&&this._tailedLayer.remove(t[r])},_removeOverlayById:function(e){this._plotOverlayTool.remove(e)},_sortGraphics:function(e){for(var t=[],r=[],n=[],o=[],i=[],a=[],s=e.length-1;s>=0;s--){var l=e[s];switch(l.element.kind){case"point":t.push(l);break;case"text":r.push(l);break;case"polyline":n.push(l);break;case"polygon":l.element.name.indexOf("freePlot")>-1?i.push(l):o.push(l);default:a.push(l)}}return r.concat(t,n,o,a,i)[0]},_resetToolState:function(){this._tailedEditTool.deactivate(),!1===this._plotEditTool._enabled_?(this._plotEditTool.deactivate(),this._nooptool.onClick()):this._plotEditTool.onClick()},_fireEvent:function(e,t){this.fire(e,t)},_overlayClick:function(t){if(this._plotClickObj){var r=this._plotClickObj.callback;e.isFunction(r)&&r.call(this._plotLayer.context,plotElement)}this.fire(i.PLOT_CLICKED,{element:t})},_updateOverlayPlot:function(e){var t=this.getPlotElementById(e.id);if(t){t.overlayAttr=this._plotOverlayTool.serialize(e);var r=e.overlay.position;r&&r.$type.indexOf("Point")>-1&&(t.elements[0].geometry=r),this._plotLayer.update(t)}}})}}}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(443),r(444),r(15)],void 0===(o=function(e,t,r){var n=r.extend({options:{title:"标绘同步接口类"},initialize:function(n){r.prototype.initialize.call(this,n),this._getDifferentData=new e(n),this._analysisDifferentData=new t(n)},destroy:function(){try{this._getDifferentData.destroy()}catch(e){}try{this._analysisDifferentData.destroy()}catch(e){}r.prototype.destroy.call(this)}});return n.include({viewSyncGetData:function(){return this._getDifferentData.getMapView()},plotSyncGetData:function(){return this._getDifferentData.getPlotData()},dataSyncGetData:function(){return this._getDifferentData.getSyncData()}}),n.include({viewSyncShowData:function(e){var t=!1;if(e&&e.data){try{this._analysisDifferentData.analysisMapView(e.data),t=!0}catch(e){e.message,t=!1}}return t}}),n.include({dataSyncShowData:function(e){var t={};if(e)try{t=this._analysisDifferentData.analysisSyncData(e)}catch(e){t.msg=e.message}return t},dataSyncClearData:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId;this._analysisDifferentData.clearSpecifyOrAllData(r)}else this._analysisDifferentData.clearSpecifyOrAllData();t=!0}catch(e){e.message,t=!1}return t},dataSyncSetVisiblity:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId,n=e.visible||!0;this._analysisDifferentData.visibleSpecifyOrAllData(r,n),t=!0}}catch(e){e.message,t=!1}return t},querySyncDataById:function(e){var t=!1;try{e&&(this._analysisDifferentData.querySyncDataById(e),t=!0)}catch(e){t=!1}return t}}),n.include({plotSyncShowData:function(e){var t={};if(e)try{t=this._analysisDifferentData.analysisSyncPlot(e)}catch(e){t.msg=e.message}return t},plotSyncClearData:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId;this._analysisDifferentData.clearSpecifyOrAllPlot(r)}else this._analysisDifferentData.clearSpecifyOrAllPlot();t=!0}catch(e){e.message,t=!1}return t},plotSyncSetVisiblity:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId,n=e.visible||!0;this._analysisDifferentData.visibleSpecifyOrAllPlot(r,n),t=!0}}catch(e){e.message,t=!1}return t},queryPlotDataById:function(e){var t=!1;try{e&&(this._analysisDifferentData.queryPlotDataById(e),t=!0)}catch(e){t=!1}return t}}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(14),r(1),r(57)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{title:"获取不同数据的类"},initialize:function(t){e.prototype.initialize.call(this,t),this.layreIds={dataLayer:[],plotLayer:[]},this._matchingLayer=t.matchingLayer},destroy:function(){e.prototype.destroy.call(this)},_initLayerId:function(e){var t=this.map.getMap().getLayers();if(t.length>0)for(var r=0;r<t.length;r++){for(var n=0;n<e.dataLayer.length;n++)e.dataLayer[n].test(t[r].id)&&this.layreIds.dataLayer.push(t[r].id);for(n=0;n<e.plotLayer.length;n++)e.plotLayer[n].test(t[r].id)&&this.layreIds.plotLayer.push(t[r].id)}}});return o.include({getMapView:function(){var e={};return e.center=this.map._getMapCenter(),e.zoomLevel=this.map.getZoomLevel(),e}}),o.include({getSyncData:function(){return this._initLayerId(this._matchingLayer),this._getAllLayerData()},_getAllLayerData:function(){var e=[];this.layreIds.dataLayer&&(e=this.layreIds.dataLayer);var r={};if(e&&e.length>0)for(var n=0;n<e.length;n++){var o=t.getLayerById(this.map.getMap(),e[n]);if(o){var i=[],a=this._getLayerElements(o);this._serializeElement(a,i),r[e[n]]=i}}return r}}),o.include({getPlotData:function(){return this._initLayerId(this._matchingLayer),this._getPoltData()},_getPoltData:function(){var e={},t=[];if(this.layreIds.plotLayer&&(t=this.layreIds.plotLayer),t&&t.length>0)for(var r=new n({id:(new Date).toString(),name:"标绘数据"}),o=0;o<t.length;o++){var i=this.map.getMap().layers;if(i.length>0)for(var a=0;a<i.length;a++)if(t[o]==i[a].id){var s=this._getLayerElements(i[a]);this._serializeElement(s,r),e[t[o]]=r}}return e}}),o.include({_getLayerElements:function(e){var t=[];if(e instanceof r.carto.GroupLayer)for(var n=e.groupLayers,o=0,i=n.length;o<i;o++){var a=n[o];util._getLayerElements(a,arr)}else e instanceof r.carto.FeatureLayer||(e instanceof r.carto.ElementLayer||e instanceof r.carto.ClusterLayer)&&(t=e.elements);return t},_serializeElement:function(e,t){for(var n=0;n<e.length;n++)if(e[n]instanceof r.sfs.Element){var o={},i=e[n].geometry;o.geom=i.asWkt(),o.srid=i.spatialReference,o.symbol=e[n].symbol,o.$type=e[n].$type,t.push(o)}else if(e[n]instanceof r.sfs.PlotElement){var a=e[n];if(a){var s=a.copy();s.unReset();for(var l=0;l<s.elements.length;l++){var c=s.elements[l];for(var u in c)"parent"==u&&(c[u]={});s.elements[l]=c,console.log(s.elements[l])}s.id=a.id,t.addElement(s)}}return t},_unRest:function(e){console.log(e);for(var t=0;t<e.elements.length;t++)e.elements[t].parent=null,e.elements[t].elements&&this._unRest(e.elements[t]);return e}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(445),r(15),r(1)],void 0===(o=function(e,t,r){var n=t.extend({options:{title:"解析不同数据的类"},initialize:function(n){t.prototype.initialize.call(this,n),this._dataDisplayOnMap=new e(n),this._deserializer=new r.core.Deserializer,this.layreIds={dataLayer:[],plotLayer:[]},n.matchingLayer&&this._initLayerId(n.matchingLayer)},destroy:function(){this._dataDisplayOnMap.destroy(),t.prototype.destroy.call(this)},_initLayerId:function(e){var t=this.map.getMap().getLayers();if(t.length>0)for(var r=0;r<t.length;r++){for(var n=0;n<e.dataLayer.length;n++)e.dataLayer[n].test(t[r].id)&&this.layreIds.dataLayer.push(t[r].id);for(n=0;n<e.plotLayer.length;n++)e.plotLayer[n].test(t[r].id)&&this.layreIds.plotLayer.push(t[r].id)}}});return n.include({analysisMapView:function(e){var t="";if(e.center&&e.zoomLevel){var n=new r.sfs.Point({x:e.center[0],y:e.center[1],spatialReference:this.map.spatialReference});this.map.getMap().setCenter(n),this.map.getMap().zoomTo(e.zoomLevel),t="视野同步成功!"}else t="视野同步失败!center="+e.center+",zoomLevel="+e.zoomLevel;return t}}),n.include({analysisSyncData:function(e){var t="",r="",n=e.data,o=e.memberId||e.userId,i=[],a={};if(o&&n){var s=[];for(var l in n)for(var c=0;c<n[l].length;c++){var u=this._deserializeElement(n[l][c]);s.push(u)}a={memberId:o,data:i=i.concat(s)};try{r=this._dataDisplayOnMap.showSyncData(a)}catch(e){}t="数据解析成功!"}else t="数据解析失败!成员标识或者数据不全";return{msg:t,dataId:r}},clearSpecifyOrAllData:function(e){return this._dataDisplayOnMap.clearSpecifyOrAllData(e),e?e+"清除数据成功":"全部数据清除成功"},visibleSpecifyOrAllData:function(e,t){return this._dataDisplayOnMap.visibleSpecifyOrAllData(e,t),e?e+"显隐成功":"全部显隐成功"},querySyncDataById:function(e){this._dataDisplayOnMap.querySyncDataById(e)}}),n.include({analysisSyncPlot:function(e){var t="",r="",n=[],o=e.memberId||e.userId,i=e.data,a={};if(o&&i){var s=[];for(var l in i){s=this._deserializePlotElement(i[l]);n=n.concat(s)}a={memberId:o,data:n};try{r=this._dataDisplayOnMap.showSyncPlot(a)}catch(e){}t="标绘数据解析成功!"}else t="标绘数据解析失败!+成员标识或者数据不全";return{msg:t,dataId:r}},clearSpecifyOrAllPlot:function(e){return this._dataDisplayOnMap.clearSpecifyOrAllPlot(e),e?e+"清除标绘成功":"全部标绘清除成功"},visibleSpecifyOrAllPlot:function(e,t){return this._dataDisplayOnMap.visibleSpecifyOrAllPlot(e,t),e?e+"显隐成功":"全部显隐成功"},queryPlotDataById:function(e){this._dataDisplayOnMap.queryPlotDataById(e)}}),n.include({_deserializePlotElement:function(e){var t=[],r=this._deserializer.createJsInstance(e);if(r)for(var n=0;n<r.getCount();n++){var o=r.getElement(n);o.reset(),t.push(o)}return t},_deserializeElement:function(e){var t=null;if(e){var n=e.geom;if(n){var o=r.sfs.GeometryFactory.createGeometryFromWkt(n);o.spatialReference=e.srid;var i=this._deserializeSymbol(e.symbol);t=new r.sfs.Element({geometry:o,symbol:i})}}return t},_deserializeSymbol:function(e){var t=this;if(!e)return null;var n=null;switch(/(.*),.*/.exec(e.$type)[1]){case"PictureMarkerSymbol":a("width,height,opacity,offsetX,offsetY,rotation",e,o={}),s("source",e,o),n=new r.sfs.PictureMarkerSymbol(o);break;case"SimpleMarkerSymbol":l("fillColor,borderColor",e,o={}),a("size,offsetX,offsetY",e,o),s("style",e,o),n=new r.sfs.SimpleMarkerSymbol(o);break;case"TextSymbol":a("fontSize,rotation,borderThickness,offsetX,offsetY",e,o={}),l("foreground,borderColor",e,o),s("text,fontFamilyName,fontWeight,textAlign",e,o),n=new r.sfs.TextSymbol(o);break;case"SimpleLineSymbol":l("color",e,o={}),a("width,style",e,o),n=new r.sfs.SimpleLineSymbol(o);break;case"SimpleFillSymbol":l("fillColor,borderColor",e,o={}),a("borderThickness,opacity",e,o),n=new r.sfs.SimpleFillSymbol(o);break;case"CurrencySymbol":var o={},i={};i.fillSymbol=this.deserializeSymbol(e.fillSymbol),i.textSymbol=this.deserializeSymbol(e.textSymbol),i.markerSymbol=this.deserializeSymbol(e.markerSymbol),s("fillSymbol,textSymbol,markerSymbol",i,o),n=new r.sfs.CurrencySymbol(o)}return n;function a(e,t,r){for(var n=e.split(","),o=0,i=n.length;o<i;o++){var a=n[o];a&&(isNaN(t[a])||(r[a]=parseFloat(t[a])))}}function s(e,t,r){for(var n=e.split(","),o=0,i=n.length;o<i;o++){var a=n[o];a&&t[a]&&(r[a]=t[a])}}function l(e,r,n){for(var o=e.split(","),i=0,a=o.length;i<a;i++){var s=o[i];if(s){var l=t._deserializeColor(r[s]);l&&(n[s]=l)}}}},_deserializeColor:function(e){var t=new r.sfs.Color;return e&&(t.a=e.a,t.r=e.r,t.g=e.g,t.b=e.b),t}}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(2),r(12),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{title:"把数据展示到地图上"},initialize:function(t){e.prototype.initialize.call(this,t),this._initLayersGroup(),this._plotAndDataObj={plotObj:{},dataObj:{}},this.commandManager=new n.gdm.CommandManager,this.commandNotify=new n.gdm.CommandNotify({manager:this.commandManager})},destroy:function(){this._plotAndDataObj.plotObj={},this._plotAndDataObj.dataObj={},this._syncPlotLayerGroup.clear(),this._syncPlotLayerGroup.removeAllLayers(),this._syncVisualizeLayerGroup.clear(),this._syncVisualizeLayerGroup.removeAllLayers(),this._groupLayer&&(this._groupLayer.clear(),this._groupLayer.removeAllLayers(),this.map.getMap().removeLayer(this._groupLayer)),e.prototype.destroy.call(this)}});return o.include({_initLayersGroup:function(){var e=new n.carto.GroupLayer({id:"syncLayerGroup",name:"同步数据的图层组",layers:[]});this.map.getMap().addLayer(e),this._groupLayer=e,this._layers={};var t=new n.carto.GroupLayer({layers:[]});e.addLayer(t),this._syncPlotLayerGroup=t;var r=new n.carto.GroupLayer({layers:[]});e.addLayer(r),this._syncVisualizeLayerGroup=r},_getPlotSyncLayer:function(e){return e.type="_syncPlotLayerGroup",this._getSyncLayer(e)},_getVisualizeSyncLayer:function(e){return e.type="_syncVisualizeLayerGroup",this._getSyncLayer(e)},_getSyncLayer:function(e){var t=e.type,r=e.memberId||e.userId,o=t.toLowerCase()+"-"+r,i=null;return(i=this._layers[o])||(i=new n.carto.ElementLayer({id:o,map:this.map.getMap()}),this[t].addLayer(i),this._layers[o]=i),i}}),o.include({showSyncData:function(e){var r="",n=e.memberId||e.userId,o=e.data;if(o&&o.length>0){for(var i=this._getVisualizeSyncLayer({memberId:n}),a=0;a<o.length;a++)i.add(o[a]);r=t.newUUID(),this._plotAndDataObj.dataObj[n]||(this._plotAndDataObj.dataObj[n]={}),this._plotAndDataObj.dataObj[n][r]=o}return r},clearSpecifyOrAllData:function(e){if(e){var t=e.split(",");if(t.length>0)for(var r=0;r<t.length;r++){this._getVisualizeSyncLayer({memberId:t[r]}).clear()}}else{for(var n in this._layers)n.indexOf("_syncvisualizelayergroup")>=0&&this._layers[n].clear();this._syncVisualizeLayerGroup.clear()}},visibleSpecifyOrAllData:function(e,t){if(null!=t)if(e){var r=e.split(",");if(r.length>0)for(var n=0;n<r.length;n++){this._getVisualizeSyncLayer({memberId:r[n]}).setVisible(t)}}else this._syncVisualizeLayerGroup.setVisible(t)},querySyncDataById:function(e){var t=e.dataId,r=e.memberId||e.userId;if(t&&r){var n=this._plotAndDataObj.dataObj[r][t];if(n){var o=this._getVisualizeSyncLayer({memberId:r});o.clear(),o.addElements(n)}}}}),o.include({showSyncPlot:function(e){var r,n=e.memberId||e.userId,o=e.data,i=this._getPlotSyncLayer({memberId:n});i.clear();for(var a=0;a<o.length;a++)i.add(o[a]);return this._fitBounds(o[o.length-1]),r=t.newUUID(),this._plotAndDataObj.plotObj[n]||(this._plotAndDataObj.plotObj[n]={}),this._plotAndDataObj.plotObj[n][r]=o,r},_fitBounds:function(e){var t=r.getPlotEnvlop([e],this.map.getMap().spatialReference);if(t)if(t.$type.indexOf("Point")>=0)this.map.getMap().setCenter(t);else{this.map.getMap().pan(t,[100,100,100,100])}},clearSpecifyOrAllPlot:function(e){if(e){var t=e.split(",");if(t.length>0)for(var r=0;r<t.length;r++){this._getPlotSyncLayer({memberId:t[r]}).clear()}}else{for(var n in this._layers)n.indexOf("_syncplotlayergroup")>=0&&this._layers[n].clear();this._syncPlotLayerGroup.clear()}},visibleSpecifyOrAllPlot:function(e,t){if(null!=t)if(e){var r=e.split(",");if(r.length>0)for(var n=0;n<r.length;n++){this._getPlotSyncLayer({memberId:r[n]}).setVisible(t)}}else this._syncPlotLayerGroup.setVisible(t)},queryPlotDataById:function(e){var t=e.dataId,r=e.memberId||e.userId;if(t&&r){var n=this._plotAndDataObj.plotObj[r][t];if(n){var o=this._getPlotSyncLayer({memberId:r});o.clear(),o.addElements(n)}}}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(447),r(448),r(15)],void 0===(o=function(e,t,r){var n=r.extend({options:{title:"标绘同步接口类"},initialize:function(n){r.prototype.initialize.call(this,n),this._getDifferentData=new e(n),this._analysisDifferentData=new t(n)},destroy:function(){try{this._getDifferentData.destroy()}catch(e){}try{this._analysisDifferentData.destroy()}catch(e){}r.prototype.destroy.call(this)}});return n.include({viewSyncGetData:function(){return this._getDifferentData.getMapView()},plotSyncGetData:function(){return this._getDifferentData.getPlotData()},dataSyncGetData:function(){return this._getDifferentData.getSyncData()}}),n.include({viewSyncShowData:function(e){var t=!1;if(e&&e.data){try{this._analysisDifferentData.analysisMapView(e.data),t=!0}catch(e){e.message,t=!1}}return t}}),n.include({dataSyncShowData:function(e){var t={};if(e)try{t=this._analysisDifferentData.analysisSyncData(e)}catch(e){t.msg=e.message}return t},dataSyncClearData:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId;this._analysisDifferentData.clearSpecifyOrAllData(r)}else this._analysisDifferentData.clearSpecifyOrAllData();t=!0}catch(e){e.message,t=!1}return t},dataSyncSetVisiblity:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId,n=e.visible||!0;this._analysisDifferentData.visibleSpecifyOrAllData(r,n),t=!0}}catch(e){e.message,t=!1}return t},querySyncDataById:function(e){var t=!1;try{e&&(this._analysisDifferentData.querySyncDataById(e),t=!0)}catch(e){t=!1}return t}}),n.include({plotSyncShowData:function(e){var t={};if(e)try{t=this._analysisDifferentData.analysisSyncPlot(e)}catch(e){t.msg=e.message}return t},plotSyncClearData:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId;this._analysisDifferentData.clearSpecifyOrAllPlot(r)}else this._analysisDifferentData.clearSpecifyOrAllPlot();t=!0}catch(e){e.message,t=!1}return t},plotSyncSetVisiblity:function(e){var t=!1;try{if(e){var r=e.memberId||e.userId,n=e.visible||!0;this._analysisDifferentData.visibleSpecifyOrAllPlot(r,n),t=!0}}catch(e){e.message,t=!1}return t},queryPlotDataById:function(e){var t=!1;try{e&&(this._analysisDifferentData.queryPlotDataById(e),t=!0)}catch(e){t=!1}return t}}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(14),r(1),r(57)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{title:"获取不同数据的类"},initialize:function(t){e.prototype.initialize.call(this,t),this.layreIds={dataLayer:[],plotLayer:[]},this._matchingLayer=t.matchingLayer},destroy:function(){e.prototype.destroy.call(this)},_initLayerId:function(e){var t=this.map.getMap().getLayers();if(t.length>0)for(var r=0;r<t.length;r++){for(var n=0;n<e.dataLayer.length;n++)e.dataLayer[n].test(t[r].id)&&this.layreIds.dataLayer.push(t[r].id);for(n=0;n<e.plotLayer.length;n++)e.plotLayer[n].test(t[r].id)&&this.layreIds.plotLayer.push(t[r].id)}}});return o.include({getMapView:function(){var e={};return e.center=this.map._getMapCenter(),e.zoomLevel=this.map.getZoomLevel(),e}}),o.include({getSyncData:function(){return this._initLayerId(this._matchingLayer),this._getAllLayerData()},_getAllLayerData:function(){var e=[];this.layreIds.dataLayer&&(e=this.layreIds.dataLayer);var r={};if(e&&e.length>0)for(var n=0;n<e.length;n++){var o=t.getLayerById(this.map.getMap(),e[n]);if(o){var i=[],a=this._getLayerElements(o);this._serializeElement(a,i),r[e[n]]=i}}return r}}),o.include({getPlotData:function(){return this._initLayerId(this._matchingLayer),this._getPoltData()},_getPoltData:function(){var e={},t=[];if(this.layreIds.plotLayer&&(t=this.layreIds.plotLayer),t&&t.length>0)for(var r=new n({id:(new Date).toString(),name:"标绘数据"}),o=0;o<t.length;o++){var i=this.map.getMap().layers;if(i.length>0)for(var a=0;a<i.length;a++)if(t[o]==i[a].id){var s=this._getLayerElements(i[a]);this._serializeElement(s,r),e[t[o]]=r}}return e}}),o.include({_getLayerElements:function(e){var t=[];if(e instanceof r.carto.GroupLayer)for(var n=e.groupLayers,o=0,i=n.length;o<i;o++){var a=n[o];util._getLayerElements(a,arr)}else e instanceof r.carto.FeatureLayer||(e instanceof r.carto.ElementLayer||e instanceof r.carto.ClusterLayer)&&(t=e.elements);return t},_serializeElement:function(e,t){for(var n=0;n<e.length;n++)if(e[n]instanceof r.sfs.Element){var o={},i=e[n].geometry;o.geom=i.asWkt(),o.srid=i.spatialReference,o.symbol=e[n].symbol,o.$type=e[n].$type,t.push(o)}else if(e[n]instanceof r.sfs.PlotElement){var a=e[n];if(a){var s=a.copy();s.unReset();for(var l=0;l<s.elements.length;l++){var c=s.elements[l];for(var u in c)"parent"==u&&(c[u]={});s.elements[l]=c,console.log(s.elements[l])}s.id=a.id,t.addElement(s)}}return t},_unRest:function(e){console.log(e);for(var t=0;t<e.elements.length;t++)e.elements[t].parent=null,e.elements[t].elements&&this._unRest(e.elements[t]);return e}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(449),r(15),r(1)],void 0===(o=function(e,t,r){var n=t.extend({options:{title:"解析不同数据的类"},initialize:function(n){t.prototype.initialize.call(this,n),this._dataDisplayOnMap=new e(n),this._deserializer=new r.core.Deserializer,this.layreIds={dataLayer:[],plotLayer:[]},n.matchingLayer&&this._initLayerId(n.matchingLayer)},destroy:function(){this._dataDisplayOnMap.destroy(),t.prototype.destroy.call(this)},_initLayerId:function(e){var t=this.map.getMap().getLayers();if(t.length>0)for(var r=0;r<t.length;r++){for(var n=0;n<e.dataLayer.length;n++)e.dataLayer[n].test(t[r].id)&&this.layreIds.dataLayer.push(t[r].id);for(n=0;n<e.plotLayer.length;n++)e.plotLayer[n].test(t[r].id)&&this.layreIds.plotLayer.push(t[r].id)}}});return n.include({analysisMapView:function(e){var t="";if(e.center&&e.zoomLevel){var n=new r.sfs.Point({x:e.center[0],y:e.center[1],spatialReference:this.map.spatialReference});this.map.getMap().setCenter(n),this.map.getMap().zoomTo(e.zoomLevel),t="视野同步成功!"}else t="视野同步失败!center="+e.center+",zoomLevel="+e.zoomLevel;return t}}),n.include({analysisSyncData:function(e){var t="",r="",n=e.data,o=e.memberId||e.userId,i=[],a={};if(o&&n){var s=[];for(var l in n)for(var c=0;c<n[l].length;c++){var u=this._deserializeElement(n[l][c]);s.push(u)}a={memberId:o,data:i=i.concat(s)};try{r=this._dataDisplayOnMap.showSyncData(a)}catch(e){}t="数据解析成功!"}else t="数据解析失败!成员标识或者数据不全";return{msg:t,dataId:r}},clearSpecifyOrAllData:function(e){return this._dataDisplayOnMap.clearSpecifyOrAllData(e),e?e+"清除数据成功":"全部数据清除成功"},visibleSpecifyOrAllData:function(e,t){return this._dataDisplayOnMap.visibleSpecifyOrAllData(e,t),e?e+"显隐成功":"全部显隐成功"},querySyncDataById:function(e){this._dataDisplayOnMap.querySyncDataById(e)}}),n.include({analysisSyncPlot:function(e){var t="",r="",n=[],o=e.memberId||e.userId,i=e.data,a={};if(o&&i){var s=[];for(var l in i){s=this._deserializePlotElement(i[l]);n=n.concat(s)}a={memberId:o,data:n};try{r=this._dataDisplayOnMap.showSyncPlot(a)}catch(e){}t="标绘数据解析成功!"}else t="标绘数据解析失败!+成员标识或者数据不全";return{msg:t,dataId:r}},clearSpecifyOrAllPlot:function(e){return this._dataDisplayOnMap.clearSpecifyOrAllPlot(e),e?e+"清除标绘成功":"全部标绘清除成功"},visibleSpecifyOrAllPlot:function(e,t){return this._dataDisplayOnMap.visibleSpecifyOrAllPlot(e,t),e?e+"显隐成功":"全部显隐成功"},queryPlotDataById:function(e){this._dataDisplayOnMap.queryPlotDataById(e)}}),n.include({_deserializePlotElement:function(e){var t=[],r=this._deserializer.createJsInstance(e);if(r)for(var n=0;n<r.getCount();n++){var o=r.getElement(n);o.reset(),t.push(o)}return t},_deserializeElement:function(e){var t=null;if(e){var n=e.geom;if(n){var o=r.sfs.GeometryFactory.createGeometryFromWkt(n);o.spatialReference=e.srid;var i=this._deserializeSymbol(e.symbol);t=new r.sfs.Element({geometry:o,symbol:i})}}return t},_deserializeSymbol:function(e){var t=this;if(!e)return null;var n=null;switch(/(.*),.*/.exec(e.$type)[1]){case"PictureMarkerSymbol":a("width,height,opacity,offsetX,offsetY,rotation",e,o={}),s("source",e,o),n=new r.sfs.PictureMarkerSymbol(o);break;case"SimpleMarkerSymbol":l("fillColor,borderColor",e,o={}),a("size,offsetX,offsetY",e,o),s("style",e,o),n=new r.sfs.SimpleMarkerSymbol(o);break;case"TextSymbol":a("fontSize,rotation,borderThickness,offsetX,offsetY",e,o={}),l("foreground,borderColor",e,o),s("text,fontFamilyName,fontWeight,textAlign",e,o),n=new r.sfs.TextSymbol(o);break;case"SimpleLineSymbol":l("color",e,o={}),a("width,style",e,o),n=new r.sfs.SimpleLineSymbol(o);break;case"SimpleFillSymbol":l("fillColor,borderColor",e,o={}),a("borderThickness,opacity",e,o),n=new r.sfs.SimpleFillSymbol(o);break;case"CurrencySymbol":var o={},i={};i.fillSymbol=this.deserializeSymbol(e.fillSymbol),i.textSymbol=this.deserializeSymbol(e.textSymbol),i.markerSymbol=this.deserializeSymbol(e.markerSymbol),s("fillSymbol,textSymbol,markerSymbol",i,o),n=new r.sfs.CurrencySymbol(o)}return n;function a(e,t,r){for(var n=e.split(","),o=0,i=n.length;o<i;o++){var a=n[o];a&&(isNaN(t[a])||(r[a]=parseFloat(t[a])))}}function s(e,t,r){for(var n=e.split(","),o=0,i=n.length;o<i;o++){var a=n[o];a&&t[a]&&(r[a]=t[a])}}function l(e,r,n){for(var o=e.split(","),i=0,a=o.length;i<a;i++){var s=o[i];if(s){var l=t._deserializeColor(r[s]);l&&(n[s]=l)}}}},_deserializeColor:function(e){var t=new r.sfs.Color;return e&&(t.a=e.a,t.r=e.r,t.g=e.g,t.b=e.b),t}}),n}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(2),r(12),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{title:"把数据展示到地图上"},initialize:function(t){e.prototype.initialize.call(this,t),this._initLayersGroup(),this._plotAndDataObj={plotObj:{},dataObj:{}},this.commandManager=new n.gdm.CommandManager,this.commandNotify=new n.gdm.CommandNotify({manager:this.commandManager})},destroy:function(){this._plotAndDataObj.plotObj={},this._plotAndDataObj.dataObj={},this._syncPlotLayerGroup.clear(),this._syncPlotLayerGroup.removeAllLayers(),this._syncVisualizeLayerGroup.clear(),this._syncVisualizeLayerGroup.removeAllLayers(),this._groupLayer&&(this._groupLayer.clear(),this._groupLayer.removeAllLayers(),this.map.getMap().removeLayer(this._groupLayer)),e.prototype.destroy.call(this)}});return o.include({_initLayersGroup:function(){var e=new n.carto.GroupLayer({id:"syncLayerGroup",name:"同步数据的图层组",layers:[]});this.map.getMap().addLayer(e),this._groupLayer=e,this._layers={};var t=new n.carto.GroupLayer({layers:[]});e.addLayer(t),this._syncPlotLayerGroup=t;var r=new n.carto.GroupLayer({layers:[]});e.addLayer(r),this._syncVisualizeLayerGroup=r},_getPlotSyncLayer:function(e){return e.type="_syncPlotLayerGroup",this._getSyncLayer(e)},_getVisualizeSyncLayer:function(e){return e.type="_syncVisualizeLayerGroup",this._getSyncLayer(e)},_getSyncLayer:function(e){var t=e.type,r=e.memberId||e.userId,o=t.toLowerCase()+"-"+r,i=null;return(i=this._layers[o])||(i=new n.carto.ElementLayer({id:o,map:this.map.getMap()}),this[t].addLayer(i),this._layers[o]=i),i}}),o.include({showSyncData:function(e){var r="",n=e.memberId||e.userId,o=e.data;if(o&&o.length>0){for(var i=this._getVisualizeSyncLayer({memberId:n}),a=0;a<o.length;a++)i.add(o[a]);r=t.newUUID(),this._plotAndDataObj.dataObj[n]||(this._plotAndDataObj.dataObj[n]={}),this._plotAndDataObj.dataObj[n][r]=o}return r},clearSpecifyOrAllData:function(e){if(e){var t=e.split(",");if(t.length>0)for(var r=0;r<t.length;r++){this._getVisualizeSyncLayer({memberId:t[r]}).clear()}}else{for(var n in this._layers)n.indexOf("_syncvisualizelayergroup")>=0&&this._layers[n].clear();this._syncVisualizeLayerGroup.clear()}},visibleSpecifyOrAllData:function(e,t){if(null!=t)if(e){var r=e.split(",");if(r.length>0)for(var n=0;n<r.length;n++){this._getVisualizeSyncLayer({memberId:r[n]}).setVisible(t)}}else this._syncVisualizeLayerGroup.setVisible(t)},querySyncDataById:function(e){var t=e.dataId,r=e.memberId||e.userId;if(t&&r){var n=this._plotAndDataObj.dataObj[r][t];if(n){var o=this._getVisualizeSyncLayer({memberId:r});o.clear(),o.addElements(n)}}}}),o.include({showSyncPlot:function(e){var r,n=e.memberId||e.userId,o=e.data,i=this._getPlotSyncLayer({memberId:n});i.clear();for(var a=0;a<o.length;a++)i.add(o[a]);return this._fitBounds(o[o.length-1]),r=t.newUUID(),this._plotAndDataObj.plotObj[n]||(this._plotAndDataObj.plotObj[n]={}),this._plotAndDataObj.plotObj[n][r]=o,r},_fitBounds:function(e){var t=r.getPlotEnvlop([e],this.map.getMap().spatialReference);if(t)if(t.$type.indexOf("Point")>=0)this.map.getMap().setCenter(t);else{this.map.getMap().pan(t,[100,100,100,100])}},clearSpecifyOrAllPlot:function(e){if(e){var t=e.split(",");if(t.length>0)for(var r=0;r<t.length;r++){this._getPlotSyncLayer({memberId:t[r]}).clear()}}else{for(var n in this._layers)n.indexOf("_syncplotlayergroup")>=0&&this._layers[n].clear();this._syncPlotLayerGroup.clear()}},visibleSpecifyOrAllPlot:function(e,t){if(null!=t)if(e){var r=e.split(",");if(r.length>0)for(var n=0;n<r.length;n++){this._getPlotSyncLayer({memberId:r[n]}).setVisible(t)}}else this._syncPlotLayerGroup.setVisible(t)},queryPlotDataById:function(e){var t=e.dataId,r=e.memberId||e.userId;if(t&&r){var n=this._plotAndDataObj.plotObj[r][t];if(n){var o=this._getPlotSyncLayer({memberId:r});o.clear(),o.addElements(n)}}}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(38),r(37),r(1),r(57)],void 0===(o=function(e,t,r,n,o){var i=e.extend({options:{title:"协同标绘组件"},includes:r.prototype,initialize:function(t){e.prototype.initialize.call(this,t),this._initLayersGroup(),this._deserializer=new n.core.Deserializer},destroy:function(){e.prototype.destroy.call(this)}});return i.include({_initLayersGroup:function(){var e=new n.carto.GroupLayer({id:"syncLayerGroup",name:"同步数据的图层组",layers:[]});this.map.getMap().addLayer(e),this._groupLayer=e,this._layers={};var t=new n.carto.GroupLayer({layers:[]});e.addLayer(t),this._collaborativePlotLayerGroup=t},_getPlotSyncLayer:function(e){return e.type="_collaborativePlotLayerGroup",this._getSyncLayer(e)},_getSyncLayer:function(e){var t=e.type,r=t.toLowerCase()+"-"+e.memberId,o=null;return(o=this._layers[r])||(o=new n.carto.ElementLayer({id:r,map:this.map.getMap()}),this[t].addLayer(o),this._layers[r]=o),o}}),i.include({startCollaborativePlot:function(){console.log("开始协同标绘");var e=this;this.plotCreatedCallback=function(t){var r=t.element;t.type;e._addPlot(r)},this.plotUpdateCallback=function(t){var r=t.element;e._updatePlot(r)},this.plotDeleteCallback=function(t){var r=t.elements;e._deletePlot(r)},this.map.listen(t.PLOT_CREATED,this.plotCreatedCallback),this.map.listen(t.PLOT_UPDATED,this.plotUpdateCallback),this.map.listen(t.PLOT_DELETE,this.plotDeleteCallback)},endCollaborativePlot:function(){console.log("结束协同标绘");this.map.off(t.PLOT_CREATED,this.plotCreatedCallback),this.map.off(t.PLOT_UPDATED,this.plotUpdateCallback),this.map.off(t.PLOT_DELETE,this.plotDeleteCallback)},analysisSyncPlot:function(e){var t="",r=e.data,n=e.memberId;if(n&&r){var o=this._getPlotSyncLayer({memberId:n}),i=this._deserializePlotElement(r);i&&this["_"+r.name+"OnLayer"](i,o),t="数据解析成功!"}else t="数据解析失败!成员标识或者数据不全";return{msg:t,dataId:""}},clearSpecifyOrAllPlot:function(e){if(e){var t=e.split(",");if(t.length>0)for(var r=0;r<t.length;r++){this._getPlotSyncLayer({memberId:t[r]}).clear()}}else{for(var n in this._layers)n.indexOf("_collaborativePlotLayerGroup")>=0&&this._layers[n].clear();this._syncPlotLayerGroup.clear()}},visibleSpecifyOrAllPlot:function(e,t){if(null!=t)if(e){var r=e.split(",");if(r.length>0)for(var n=0;n<r.length;n++){this._getPlotSyncLayer({memberId:r[n]}).setVisible(t)}}else this._syncPlotLayerGroup.setVisible(t)}}),i.include({_addPlot:function(e){var r=new o({id:(new Date).toString(),name:"addPlot"}),n=e.copy();n.unReset(),n.id=e.id,r.addElement(n),this.fire(t.COLLABORATIVE_PLOT_CREATED,{data:r})},_updatePlot:function(e){var r=new o({id:(new Date).toString(),name:"updatePlot"}),n=e.copy();n.unReset(),n.id=e.id,r.addElement(n),this.fire(t.COLLABORATIVE_PLOT_UPDTAED,{data:r})},_deletePlot:function(e){for(var r=new o({id:(new Date).toString(),name:"deletePlot"}),n=0;n<e.length;n++){var i=e[n].copy();i.unReset(),i.id=e[n].id,r.addElement(i)}this.fire(t.COLLABORATIVE_PLOT_DELETE,{data:r})}}),i.include({_addPlotOnLayer:function(e,t){t&&e[0]&&t.add(e[0])},_updatePlotOnLayer:function(e,t){if(t&&e[0]&&t.contains(e[0].id)){var r=t.find(e[0].id);t.remove(r),t.add(e[0])}},_deletePlotOnLayer:function(e,t){if(e.length>0&&t)for(var r=0;r<e.length;r++)if(t.contains(e[r].id)){var n=t.find(e[r].id);t.remove(n)}},_deserializePlotElement:function(e){var t=[],r=this._deserializer.createJsInstance(e);if(r)for(var n=0;n<r.getCount();n++){var o=r.getElement(n);o.reset(),t.push(o)}return t}}),i}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(38),r(37),r(1),r(57)],void 0===(o=function(e,t,r,n,o){var i=e.extend({options:{title:"协同标绘组件"},includes:r.prototype,initialize:function(t){e.prototype.initialize.call(this,t),this._initLayersGroup(),this._deserializer=new n.core.Deserializer},destroy:function(){e.prototype.destroy.call(this)}});return i.include({_initLayersGroup:function(){var e=new n.carto.GroupLayer({id:"syncLayerGroup",name:"同步数据的图层组",layers:[]});this.map.getMap().addLayer(e),this._groupLayer=e,this._layers={};var t=new n.carto.GroupLayer({layers:[]});e.addLayer(t),this._collaborativePlotLayerGroup=t},_getPlotSyncLayer:function(e){return e.type="_collaborativePlotLayerGroup",this._getSyncLayer(e)},_getSyncLayer:function(e){var t=e.type,r=t.toLowerCase()+"-"+e.memberId,o=null;return(o=this._layers[r])||(o=new n.carto.ElementLayer({id:r,map:this.map.getMap()}),this[t].addLayer(o),this._layers[r]=o),o}}),i.include({startCollaborativePlot:function(){console.log("开始协同标绘");var e=this;this.plotCreatedCallback=function(t){var r=t.element;t.type;e._addPlot(r)},this.plotUpdateCallback=function(t){var r=t.element;e._updatePlot(r)},this.plotDeleteCallback=function(t){var r=t.elements;e._deletePlot(r)},this.map.listen(t.PLOT_CREATED,this.plotCreatedCallback),this.map.listen(t.PLOT_UPDATED,this.plotUpdateCallback),this.map.listen(t.PLOT_DELETE,this.plotDeleteCallback)},endCollaborativePlot:function(){console.log("结束协同标绘");this.map.off(t.PLOT_CREATED,this.plotCreatedCallback),this.map.off(t.PLOT_UPDATED,this.plotUpdateCallback),this.map.off(t.PLOT_DELETE,this.plotDeleteCallback)},analysisSyncPlot:function(e){var t="",r=e.data,n=e.memberId;if(n&&r){var o=this._getPlotSyncLayer({memberId:n}),i=this._deserializePlotElement(r);i&&this["_"+r.name+"OnLayer"](i,o),t="数据解析成功!"}else t="数据解析失败!成员标识或者数据不全";return{msg:t,dataId:""}},clearSpecifyOrAllPlot:function(e){if(e){var t=e.split(",");if(t.length>0)for(var r=0;r<t.length;r++){this._getPlotSyncLayer({memberId:t[r]}).clear()}}else{for(var n in this._layers)n.indexOf("_collaborativePlotLayerGroup")>=0&&this._layers[n].clear();this._syncPlotLayerGroup.clear()}},visibleSpecifyOrAllPlot:function(e,t){if(null!=t)if(e){var r=e.split(",");if(r.length>0)for(var n=0;n<r.length;n++){this._getPlotSyncLayer({memberId:r[n]}).setVisible(t)}}else this._syncPlotLayerGroup.setVisible(t)}}),i.include({_addPlot:function(e){var r=new o({id:(new Date).toString(),name:"addPlot"}),n=e.copy();n.unReset(),n.id=e.id,r.addElement(n),this.fire(t.COLLABORATIVE_PLOT_CREATED,{data:r})},_updatePlot:function(e){var r=new o({id:(new Date).toString(),name:"updatePlot"}),n=e.copy();n.unReset(),n.id=e.id,r.addElement(n),this.fire(t.COLLABORATIVE_PLOT_UPDTAED,{data:r})},_deletePlot:function(e){for(var r=new o({id:(new Date).toString(),name:"deletePlot"}),n=0;n<e.length;n++){var i=e[n].copy();i.unReset(),i.id=e[n].id,r.addElement(i)}this.fire(t.COLLABORATIVE_PLOT_DELETE,{data:r})}}),i.include({_addPlotOnLayer:function(e,t){t&&e[0]&&t.add(e[0])},_updatePlotOnLayer:function(e,t){if(t&&e[0]&&t.contains(e[0].id)){var r=t.find(e[0].id);t.remove(r),t.add(e[0])}},_deletePlotOnLayer:function(e,t){if(e.length>0&&t)for(var r=0;r<e.length;r++)if(t.contains(e[r].id)){var n=t.find(e[r].id);t.remove(n)}},_deserializePlotElement:function(e){var t=[],r=this._deserializer.createJsInstance(e);if(r)for(var n=0;n<r.getCount();n++){var o=r.getElement(n);o.reset(),t.push(o)}return t}}),i}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n={LoggerUtil:r(23),CommonUtil:r(2),CRSTransformUtil:r(130),GeometryUtil:r(12),CoordUtil:r(182),GeoJSONUtil:r(183),LayerUtil:r(14),ResourceUtil:r(79),SpatialOPUtil:r(63),RenderUtil:r(18),SymbolBuilder:r(184),GeometryBuilder:r(185),FeatureBuilder:r(131)};e.exports=n},function(e,t,r){var n,o,i,a;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=function(e){"use strict";function t(e){return function(e,t){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(e[0],e[e.length-1])||e.push(e[0]),e}function r(e){for(var t,r=0,n=0,o=e.length,i=e[n];n<o-1;n++)r+=((t=e[n+1])[0]-i[0])*(t[1]+i[1]),i=t;return r>=0}function n(e,t,r,n){var o=(n[0]-r[0])*(e[1]-r[1])-(n[1]-r[1])*(e[0]-r[0]),i=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]),a=(n[1]-r[1])*(t[0]-e[0])-(n[0]-r[0])*(t[1]-e[1]);if(0!==a){var s=o/a,l=i/a;if(s>=0&&s<=1&&l>=0&&l<=1)return!0}return!1}function o(e,t){for(var r=0;r<e.length-1;r++)for(var o=0;o<t.length-1;o++)if(n(e[r],e[r+1],t[o],t[o+1]))return!0;return!1}function i(e,t){var r=o(e,t),n=function(e,t){for(var r=!1,n=-1,o=e.length,i=o-1;++n<o;i=n)(e[n][1]<=t[1]&&t[1]<e[i][1]||e[i][1]<=t[1]&&t[1]<e[n][1])&&t[0]<(e[i][0]-e[n][0])*(t[1]-e[n][1])/(e[i][1]-e[n][1])+e[n][0]&&(r=!r);return r}(e,t[0]);return!(r||!n)}function a(e){var n=[],o=e.slice(0),i=t(o.shift().slice(0));if(i.length>=4){r(i)||i.reverse(),n.push(i);for(var a=0;a<o.length;a++){var s=t(o[a].slice(0));s.length>=4&&(r(s)&&s.reverse(),n.push(s))}}return n}function s(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function l(e,n){var a={};if(e.features){a.type="FeatureCollection",a.features=[];for(var c=0;c<e.features.length;c++)a.features.push(l(e.features[c],n))}if("number"==typeof e.x&&"number"==typeof e.y&&(a.type="Point",a.coordinates=[e.x,e.y],"number"==typeof e.z&&a.coordinates.push(e.z)),e.points&&(a.type="MultiPoint",a.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(a.type="LineString",a.coordinates=e.paths[0].slice(0)):(a.type="MultiLineString",a.coordinates=e.paths.slice(0))),e.rings&&(a=function(e){for(var n,a,s=[],l=[],c=0;c<e.length;c++){var u=t(e[c].slice(0));if(!(u.length<4))if(r(u)){var f=[u.slice().reverse()];s.push(f)}else l.push(u.slice().reverse())}for(var h=[];l.length;){a=l.pop();var p=!1;for(n=s.length-1;n>=0;n--)if(i(s[n][0],a)){s[n].push(a),p=!0;break}p||h.push(a)}for(;h.length;){a=h.pop();var d=!1;for(n=s.length-1;n>=0;n--)if(o(s[n][0],a)){s[n].push(a),d=!0;break}d||s.push([a.reverse()])}return 1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}}(e.rings.slice(0))),"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax&&(a.type="Polygon",a.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(a.type="Feature",a.geometry=e.geometry?l(e.geometry):null,a.properties=e.attributes?s(e.attributes):null,e.attributes))try{a.id=function(e,t){for(var r=t?[t,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<r.length;n++){var o=r[n];if(o in e&&("string"==typeof e[o]||"number"==typeof e[o]))return e[o]}throw Error("No valid id attribute found")}(e.attributes,n)}catch(e){}return JSON.stringify(a.geometry)===JSON.stringify({})&&(a.geometry=null),e.spatialReference&&e.spatialReference.wkid&&4326!==e.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),a}function c(e,t){t=t||"OBJECTID";var r,n={wkid:4326},o={};switch(e.type){case"Point":o.x=e.coordinates[0],o.y=e.coordinates[1],o.spatialReference=n;break;case"MultiPoint":o.points=e.coordinates.slice(0),o.spatialReference=n;break;case"LineString":o.paths=[e.coordinates.slice(0)],o.spatialReference=n;break;case"MultiLineString":o.paths=e.coordinates.slice(0),o.spatialReference=n;break;case"Polygon":o.rings=a(e.coordinates.slice(0)),o.spatialReference=n;break;case"MultiPolygon":o.rings=function(e){for(var t=[],r=0;r<e.length;r++)for(var n=a(e[r]),o=n.length-1;o>=0;o--){var i=n[o].slice(0);t.push(i)}return t}(e.coordinates.slice(0)),o.spatialReference=n;break;case"Feature":e.geometry&&(o.geometry=c(e.geometry,t)),o.attributes=e.properties?s(e.properties):{},e.id&&(o.attributes[t]=e.id);break;case"FeatureCollection":for(o=[],r=0;r<e.features.length;r++)o.push(c(e.features[r],t));break;case"GeometryCollection":for(o=[],r=0;r<e.geometries.length;r++)o.push(c(e.geometries[r],t))}return o}var u={arcgisToGeoJSON:l,geojsonToArcGIS:c};e.arcgisToGeoJSON=l,e.geojsonToArcGIS=c,e.default=u},"object"===s(t)&&void 0!==e?a(t):(o=[t],void 0===(i="function"==typeof(n=a)?n.apply(t,o):n)||(e.exports=i))},function(e,t,r){(function(r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=function(){"use strict";var e,o=/\s*/g,i=/^\s*|\s*$/g,a=/\s+/;function s(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function l(e,t){return e.getElementsByTagName(t)}function c(e,t){return e.getAttribute(t)}function u(e,t){return parseFloat(c(e,t))}function f(e,t){var r=l(e,t);return r.length?r[0]:null}function h(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function p(e){var t;return e&&(t=e).normalize&&t.normalize(),e&&e.textContent||""}function d(e,t){var r,n,o={};for(n=0;n<t.length;n++)(r=f(e,t[n]))&&(o[t[n]]=p(r));return o}function y(e,t){for(var r in t)e[r]=t[r]}function m(e){return h(e.replace(o,"").split(","))}function g(e){for(var t=e.replace(i,"").split(a),r=[],n=0;n<t.length;n++)r.push(m(t[n]));return r}function v(e){var t,r=[u(e,"lon"),u(e,"lat")],n=f(e,"ele"),o=f(e,"gpxtpx:hr")||f(e,"hr"),i=f(e,"time");return n&&(t=parseFloat(p(n)),isNaN(t)||r.push(t)),{coordinates:r,time:i?p(i):null,heartRate:o?parseFloat(p(o)):null}}if("undefined"!=typeof XMLSerializer)e=new XMLSerializer;else{var b="object"===(void 0===r?"undefined":n(r))&&!r.browser,_="object"===("undefined"==typeof Titanium?"undefined":n(Titanium));if("object"!==n(t)||!b&&!_)throw new Error("Unable to initialize serializer");e=new XMLSerializer}function w(t){return void 0!==t.xml?t.xml:e.serializeToString(t)}return{kml:function(e){for(var t={type:"FeatureCollection",features:[]},r={},n={},o={},i=["Polygon","LineString","Point","Track","gx:Track"],a=l(e,"Placemark"),u=l(e,"Style"),d=l(e,"StyleMap"),y=0;y<u.length;y++){var v=s(w(u[y])).toString(16);r["#"+c(u[y],"id")]=v,n[v]=u[y]}for(var b=0;b<d.length;b++){r["#"+c(d[b],"id")]=s(w(d[b])).toString(16);for(var _=l(d[b],"Pair"),S={},L=0;L<_.length;L++)S[p(f(_[L],"key"))]=p(f(_[L],"styleUrl"));o["#"+c(d[b],"id")]=S}for(var x=0;x<a.length;x++)t.features=t.features.concat(T(a[x]));function P(e){var t,r;return"#"===(e=e||"").substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function E(e){var t=l(e,"coord"),r=[],n=[];0===t.length&&(t=l(e,"gx:coord"));for(var o=0;o<t.length;o++)r.push(h(p(t[o]).split(" ")));for(var i=l(e,"when"),a=0;a<i.length;a++)n.push(p(i[a]));return{coords:r,times:n}}function T(e){var t,a=function e(t){var r,n,o,a,s,c=[],u=[];if(f(t,"MultiGeometry"))return e(f(t,"MultiGeometry"));if(f(t,"MultiTrack"))return e(f(t,"MultiTrack"));if(f(t,"gx:MultiTrack"))return e(f(t,"gx:MultiTrack"));for(o=0;o<i.length;o++)if(n=l(t,i[o]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===i[o])c.push({type:"Point",coordinates:m(p(f(r,"coordinates")))});else if("LineString"===i[o])c.push({type:"LineString",coordinates:g(p(f(r,"coordinates")))});else if("Polygon"===i[o]){var h=l(r,"LinearRing"),d=[];for(s=0;s<h.length;s++)d.push(g(p(f(h[s],"coordinates"))));c.push({type:"Polygon",coordinates:d})}else if("Track"===i[o]||"gx:Track"===i[o]){var y=E(r);c.push({type:"LineString",coordinates:y.coords}),y.times.length&&u.push(y.times)}return{geoms:c,coordTimes:u}}(e),s={},u=p(f(e,"name")),h=p(f(e,"address")),d=p(f(e,"styleUrl")),y=p(f(e,"description")),v=f(e,"TimeSpan"),b=f(e,"TimeStamp"),_=f(e,"ExtendedData"),w=f(e,"LineStyle"),S=f(e,"PolyStyle"),L=f(e,"visibility");if(!a.geoms.length)return[];if(u&&(s.name=u),h&&(s.address=h),d){"#"!==d[0]&&(d="#"+d),s.styleUrl=d,r[d]&&(s.styleHash=r[d]),o[d]&&(s.styleMapHash=o[d],s.styleHash=r[o[d].normal]);var x=n[s.styleHash];if(x){w||(w=f(x,"LineStyle")),S||(S=f(x,"PolyStyle"));var T=f(x,"IconStyle");if(T){var C=f(T,"Icon");if(C){var A=p(f(C,"href"));A&&(s.icon=A)}}}}if(y&&(s.description=y),v){var k=p(f(v,"begin")),R=p(f(v,"end"));s.timespan={begin:k,end:R}}if(b&&(s.timestamp=p(f(b,"when"))),w){var O=P(p(f(w,"color"))),I=O[0],M=O[1],F=parseFloat(p(f(w,"width")));I&&(s.stroke=I),isNaN(M)||(s["stroke-opacity"]=M),isNaN(F)||(s["stroke-width"]=F)}if(S){var D=P(p(f(S,"color"))),j=D[0],G=D[1],N=p(f(S,"fill")),B=p(f(S,"outline"));j&&(s.fill=j),isNaN(G)||(s["fill-opacity"]=G),N&&(s["fill-opacity"]="1"===N?s["fill-opacity"]||1:0),B&&(s["stroke-opacity"]="1"===B?s["stroke-opacity"]||1:0)}if(_){var U=l(_,"Data"),z=l(_,"SimpleData");for(t=0;t<U.length;t++)s[U[t].getAttribute("name")]=p(f(U[t],"value"));for(t=0;t<z.length;t++)s[z[t].getAttribute("name")]=p(z[t])}L&&(s.visibility=p(L)),a.coordTimes.length&&(s.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var W={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:s};return c(e,"id")&&(W.id=c(e,"id")),[W]}return t},gpx:function(e){var t,r,n=l(e,"trk"),o=l(e,"rte"),i=l(e,"wpt"),a={type:"FeatureCollection",features:[]};for(t=0;t<n.length;t++)(r=h(n[t]))&&a.features.push(r);for(t=0;t<o.length;t++)(r=m(o[t]))&&a.features.push(r);for(t=0;t<i.length;t++)a.features.push(g(i[t]));function s(e,t){for(var r=0;r<t;r++)e.push(null);return e}function u(e,t){var r=l(e,t),n=[],o=[],i=[],a=r.length;if(a<2)return{};for(var c=0;c<a;c++){var u=v(r[c]);n.push(u.coordinates),u.time&&o.push(u.time),(u.heartRate||i.length)&&(i.length||s(i,c),i.push(u.heartRate||null))}return{line:n,times:o,heartRates:i}}function h(e){for(var t,r=l(e,"trkseg"),n=[],o=[],i=[],a=0;a<r.length;a++)if((t=u(r[a],"trkpt"))&&(t.line&&n.push(t.line),t.times&&t.times.length&&o.push(t.times),i.length||t.heartRates&&t.heartRates.length)){if(!i.length)for(var c=0;c<a;c++)i.push(s([],n[c].length));t.heartRates&&t.heartRates.length?i.push(t.heartRates):i.push(s([],t.line.length||0))}if(0!==n.length){var h=_(e);return y(h,b(f(e,"extensions"))),o.length&&(h.coordTimes=1===n.length?o[0]:o),i.length&&(h.heartRates=1===n.length?i[0]:i),{type:"Feature",properties:h,geometry:{type:1===n.length?"LineString":"MultiLineString",coordinates:1===n.length?n[0]:n}}}}function m(e){var t=u(e,"rtept");if(t.line){var r=_(e);return y(r,b(f(e,"extensions"))),{type:"Feature",properties:r,geometry:{type:"LineString",coordinates:t.line}}}}function g(e){var t=_(e);return y(t,d(e,["sym"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:v(e).coordinates}}}function b(e){var t={};if(e){var r=f(e,"line");if(r){var n=p(f(r,"color")),o=parseFloat(p(f(r,"opacity"))),i=parseFloat(p(f(r,"width")));n&&(t.stroke=n),isNaN(o)||(t["stroke-opacity"]=o),isNaN(i)||(t["stroke-width"]=96*i/25.4)}}return t}function _(e){var t=d(e,["name","cmt","desc","type","time","keywords"]),r=l(e,"link");r.length&&(t.links=[]);for(var n,o=0;o<r.length;o++)y(n={href:c(r[o],"href")},d(r[o],["text","type"])),t.links.push(n);return t}return a}}}();e.exports=o}).call(this,r(455))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,c=[],u=!1,f=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):f=-1,c.length&&p())}function p(){if(!u){var e=s(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++f<t;)l&&l[f].run();f=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new d(e,t)),1!==c.length||u||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){var n=r(42),o=r(186),i={IEMapService:n,IDistrictService:r(187),IResourceCatalogService:r(188),IResourceQueryService:o,IResourceMetaService:r(457),IResourceCurdService:r(458),IResourceDispatchService:r(189),ITyphoonService:r(190),TyphoonServiceImpl:r(459),ITyphoonForecastService:r(191),TyphoonForecastServiceImpl:r(460),IGeocodeService:r(132),GeocodeGaodeServiceImpl:r(461),GeocodeEgisServiceImpl:r(462)};e.exports=i},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"getTable",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(n,e);var t,r=(t=n,function(){var e,r=a(t);if(i()){var n=a(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return o(this,e)});function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),r.call(this,e)}return n}(r(42));e.exports=l},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(h,e);var t,r,n,o,f=(t=h,function(){var e,r=c(t);if(l()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function h(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),f.call(this,e)}return r=h,(n=[{key:"getCurrent",value:function(e){var t=this,r=this.opts.crossOrigin;return new Promise(function(){var n=i(regeneratorRuntime.mark((function n(o,i){var a,s,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(l in n.prev=0,a=t.opts.currentUrl,s=null,a||o(s),e)a=a.replace("{"+l+"}",e[l]);if(!r){n.next=10;break}t._jsonp({url:a,callback:function(e){o(s=e)}}),n.next=14;break;case 10:return n.next=12,t.opts.httpRequest.get(a);case 12:s=n.sent,o(s);case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(0),i(n.t0);case 19:case"end":return n.stop()}}),n,null,[[0,16]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getTyphoonsByYear",value:function(e){var t=this,r=this.opts.source,n=this.opts.crossOrigin;return new Promise(function(){var o=i(regeneratorRuntime.mark((function o(i,a){var s,l,c,u;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:for(l in o.prev=0,s=t.opts.yearUrl,e)s=s.replace("{"+l+"}",e[l]);if(c=null,u=t,!n){o.next=9;break}t._jsonp({url:s,callback:function(e){c=e,r&&"zjwater"==r.toLowerCase()&&(c=u._parseZjwaterTyphoonYearList(c)),i(c)}}),o.next=14;break;case 9:return o.next=11,t.opts.httpRequest.get(s);case 11:c=o.sent,r&&"zjwater"==r.toLowerCase()&&(c=t._parseZjwaterTyphoonYearList(c)),i(c);case 14:o.next=19;break;case 16:o.prev=16,o.t0=o.catch(0),a(o.t0);case 19:case"end":return o.stop()}}),o,null,[[0,16]])})));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getTyphoonInfo",value:function(e){var t=this,r=this.opts.source,n=this.opts.crossOrigin;return new Promise(function(){var o=i(regeneratorRuntime.mark((function o(i,a){var s,l,c,u;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:for(l in o.prev=0,s=t.opts.infoUrl,e)s=s.replace("{"+l+"}",e[l]);if(c=null,u=t,!n){o.next=9;break}t._jsonp({url:s,callback:function(e){c=e,r&&"zjwater"==r.toLowerCase()&&(c=u._parseZjwaterTyphoon(c)),i(c)}}),o.next=14;break;case 9:return o.next=11,t.opts.httpRequest.get(s);case 11:c=o.sent,r&&"zjwater"==r.toLowerCase()&&(c=t._parseZjwaterTyphoon(c)),i(c);case 14:o.next=19;break;case 16:o.prev=16,o.t0=o.catch(0),a(o.t0);case 19:case"end":return o.stop()}}),o,null,[[0,16]])})));return function(e,t){return o.apply(this,arguments)}}())}},{key:"_parseZjwaterTyphoonYearList",value:function(e){var t=[];return e&&e.forEach((function(e){var r={};r.content=e.name?e.name:null,r.ename=e.enname?e.enname:null,r.start=e.starttime?e.starttime.replace(/\//g,"-").replace(" ","T"):null,r.end=e.endtime?e.endtime.replace(/\//g,"-").replace(" ","T"):null,r.id=e.tfid?parseInt(e.tfid):null,r.is_current=e.isactive?parseInt(e.isactive):null,t.push(r)})),t}},{key:"_parseZjwaterTyphoon",value:function(e){var t=[],r=this;return e&&e.forEach((function(e){var n={};n.begin_time=(e.starttime||"").replace(/\//g,"-").replace(" ","T"),n.ename=e.enname,n.end_time=(e.endtime||"").replace(/\//g,"-").replace(" ","T"),n.is_current=parseInt(e.isactive),n.land=e.land,n.name=e.name,n.tfbh=e.tfid,n.type="FeatureCollection",n.features=r._parseZjwaterFeature(e.points),t.push(n)})),t}},{key:"_parseRadisuQuad",value:function(e){var t={ne:0,se:0,nw:0,sw:0};if(e){var r=e.split("|");4==r.length&&(t.ne=r[0],t.se=r[1],t.nw=r[2],t.sw=r[3])}return t}},{key:"_parseForecast",value:function(e){var t=[],r=this;return e&&e.forEach((function(e){var n={};n.features=r._parseZjwaterFeature(e.forecastpoints),n.region=e.tm,n.type="FeatureCollection",t.push(n)})),t}},{key:"_parseZjwaterFeature",value:function(e){var t=[],r=this;return e&&e.forEach((function(e){var n={},o={type:"Point",coordinates:[]};o.coordinates.push(parseFloat(e.lng)),o.coordinates.push(parseFloat(e.lat)),n.geometry=o;var i={};i.move_dir=e.movedirection,i.move_speed=parseInt(e.movespeed),i.power=parseInt(e.power),i.pressure=parseInt(e.pressure),i.radius7_quad=r._parseRadisuQuad(e.radius7),i.radius10_quad=r._parseRadisuQuad(e.radius10),i.radius12_quad=r._parseRadisuQuad(e.radius12),i.speed=parseInt(e.speed),i.strong=e.strong,i.time=(e.time||"").replace(/\//g,"-").replace(" ","T"),i.forecast=r._parseForecast(e.forecast),n.properties=i,n.type="Feature",t.push(n)})),t}},{key:"_jsonp",value:function(e){var t="typhoonCallback"+Math.random().toString().replace(".","");window[t]=function(t){e.callback(t),document.getElementsByTagName("body")[0].removeChild(r)};var r=document.createElement("script");e.url.indexOf("?")>=0?r.src=e.url+"&callback="+t:r.src=e.url+"?callback="+t,document.getElementsByTagName("body")[0].appendChild(r)}}])&&a(r.prototype,n),o&&a(r,o),h}(r(190));e.exports=f},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(h,e);var t,r,n,o,f=(t=h,function(){var e,r=c(t);if(l()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function h(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),f.call(this,e)}return r=h,(n=[{key:"getForecastRealtime",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(s in r.prev=0,i=t.opts.realtimeUrl,a=null,i||n(a),e)i=i.replace("{"+s+"}",e[s]);return r.next=8,t.opts.httpRequest.get(i);case 8:a=r.sent,n(a),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),o(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getForecastTimeline",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(s in r.prev=0,i=t.opts.historyUrl,a=null,i||n(a),e)i=i.replace("{"+s+"}",e[s]);return r.next=8,t.opts.httpRequest.get(i);case 8:a=r.sent,n(a),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),o(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getForecastByTime",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(s in r.prev=0,i=t.opts.detailUrl,a=null,i||n(a),e)i=i.replace("{"+s+"}",e[s]);return r.next=8,t.opts.httpRequest.get(i);case 8:a=r.sent,n(a),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),o(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})));return function(e,t){return r.apply(this,arguments)}}())}}])&&a(r.prototype,n),o&&a(r,o),h}(r(191));e.exports=f},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(132),u=r(130),f=r(1),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(p,e);var t,r,n,c,h=(t=p,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function p(e){var t;for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=h.call(this,e)).options={},e)t.options[r]=e[r];return t.coordUtil=G.utils.CoordUtil,t.projectService=new f.sfs.CoordinateTransform,t}return r=p,(n=[{key:"getAddressByKeyword",value:function(e){var t=this,r=e.pageSize||10,n=e.pageIndex||1,o=e.keyWord;return new Promise((function(e,i){try{var a="".concat(t.options.url,"/place/text?key=")+t.options.token+"&keywords="+o+"&offset="+r+"&page="+n;t.options.httpRequest.get(a,"json",null,"application/x-www-form-urlencoded",{}).then((function(t){e(t)})).catch((function(e){i(e)}))}catch(e){i(e)}}))}},{key:"getAddressByLocation",value:function(e){var t=this,r=e.radius||1e3,n=e.spatialReference||4326;return new Promise((function(o,i){try{var a=e.location;a=t._getTransformedCoordiante(a,n);var s="".concat(t.options.url,"/geocode/regeo?key=")+t.options.token+"&location="+a.join(",")+"&radius="+r+"&extensions=base";t.options.httpRequest.get(s,"json",null,"application/x-www-form-urlencoded",{}).then((function(e){e.result=e.regeocode,e.msg=e.info,o(e)})).catch((function(e){i(e)}))}catch(e){i(e)}}))}},{key:"_getTransformedCoordiante",value:function(e,t){var r=[];switch(t){case 4326:var n=u.wgs84togcj02([e[1],e[0]].join(","));r[0]=parseFloat(n.split(",")[0]).toFixed(6),r[1]=parseFloat(n.split(",")[1]).toFixed(6);break;case 3857:var o=new f.sfs.Point({x:pint[0],y:e[1],spatialReference:3857}),i=this.projectService.transform(o,4326);r=this._getTransformedCoordiante([i.x,i.y],4326)}return r}}])&&o(r.prototype,n),c&&o(r,c),p}(c);e.exports=h},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){var t;for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=u.call(this,e)).options={},e)t.options[r]=e[r];return t}return r=f,(n=[{key:"getAddressByKeyword",value:function(e){}},{key:"getAddressByLocation",value:function(e){var t=e.radius||1e3,r=this;return new Promise((function(n,o){try{var i=r.options.authUrl+"?client_id="+r.options.clientId+"&client_secret="+r.options.clientSecret;r.options.httpRequest.get(i,"json",null,"application/x-www-form-urlencoded",{}).then((function(i){if(i.access_token){var a=i.access_token,s=e.location,l="".concat(r.options.url,"/wrgs/regeocode?radius=").concat(t,"&location=")+s.join(",")+"&ext_poi=true&ext_road=true&format=json&client_id=".concat(r.options.clientId,"&access_token=").concat(a);r.options.httpRequest.get(l,"json",null,"application/x-www-form-urlencoded",{}).then((function(e){n(e)})).catch((function(e){o(e)}))}})).catch((function(e){o(e)}))}catch(e){o(e)}}))}}])&&o(r.prototype,n),c&&o(r,c),f}(r(132));e.exports=c},function(e,t,r){var n={DistrictServiceImpl:r(464),ResourceCatalogServiceImpl:r(466),ResourceQueryServiceImpl:r(468),ResourceAnalysisServiceImpl:r(471),ResourceDispatchServiceImpl:r(474)};e.exports=n},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=r(187),h=r(465),p=r(58),d=r(1),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(y,e);var t,r,n,o,f=(t=y,function(){var e,r=c(t);if(l()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function y(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),f.call(this,e)}return r=y,(n=[{key:"getDistrict",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=e.code,a=i[0],(l={}).query=s={},l.limit=1e4,"000000"!==a&&(s["tag.adcode"]={$in:i}),!1===e.returnGeom&&(l.select="-geom"),c=t._getDistrictLevel(a),u=t._getDistrictTableName(c.level),r.next=11,p.query({url:t.opts.url,httpRequest:t.opts.httpRequest,table:u,data:l,eId:"siptea",dataParser:t._dataParser});case 11:f=r.sent,n(f);case 13:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_getDistrictLevel",value:function(e){var t={parent:null,level:null,child:null};return"000000"==e?(t.level="country",t.child="province",query=""):e.endsWith("0000")?(t.parent="country",t.level="province",t.child="city"):e.endsWith("00")?(t.parent="province",t.level="city",t.child="county"):(t.parent="city",t.level="county"),t}},{key:"_getDistrictTableName",value:function(e,t,r){var n,o=h.DISTRICTTABLES[e];return o&&(n=r?o.fullName:o.shortName,o.evacuationParams&&o.evacuationParams.length>0&&(t=isNaN(t)?0:t,n+=o.evacuationParams[t])),n}},{key:"_dataParser",value:function(e){for(var t=e.list,r=[],n=0;n<t.length;n++){var o=t[n],i={};if(i.name=o.name,i.code=o.adcode,o.gov){var a=o.gov.split(",");i.lng=parseFloat(a[0]),i.lat=parseFloat(a[1])}i.geom=o.geom,r.push(i)}return r}},{key:"getSubDistrict",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.code,a=t._getDistrictLevel(i),s=a.child,l="",!h.DIRECTCITYS.hasOwnProperty(i)){r.next=9;break}s="county",l="^"+i.substr(0,2)+".*$",r.next=18;break;case 9:r.t0=s,r.next="province"===r.t0?12:"city"===r.t0?14:"county"===r.t0?16:18;break;case 12:return l="^.*$",r.abrupt("break",18);case 14:return l="^"+i.substr(0,2)+".*$",r.abrupt("break",18);case 16:return l="^"+i.substr(0,4)+".*$",r.abrupt("break",18);case 18:return c=t._getDistrictTableName(s),(u={})["tag.adcode"]={$regex:l},r.next=23,p.query({url:t.opts.url,httpRequest:t.opts.httpRequest,table:c,data:{query:u,limit:1e4},eId:"siptea",dataParser:t._dataParser});case 23:f=r.sent,n(f);case 25:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getDistrictByPoint",value:function(e){return this.getDistrictByLngLat(e)}},{key:"getDistrictByLngLat",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={type:"Point",coordinates:e.point},e.spatialReference&&4326!=e.spatialReference&&(a=new d.sfs.CoordinateTransform,s=new d.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:e.spatialReference}),l=a.transform(s,4326),s=l.asGeoJson()),(c={}).query={geom:{$geoIntersects:{$geometry:i}}},c.searchId="districtbylnglat",c.dataSetId=t._getDistrictTableName("county"),c.queryIndex=0,(u=[]).push({$project:{tag:"$tag",city:{$concat:[{$substr:["$tag.adcode",0,4]},"00"]},province:{$concat:[{$substr:["$tag.adcode",0,2]},"0000"]}}}),u.push({$lookup:{from:t._getDistrictTableName("city",0,!0),localField:"city",foreignField:"tag.adcode",as:"city"}}),u.push({$lookup:{from:t._getDistrictTableName("province",0,!0),localField:"province",foreignField:"tag.adcode",as:"province"}}),u.push({$project:{tag:"$tag",city:"$city.tag",province:"$province.tag"}}),c.aggregate=u,r.next=15,p.aggregateMulti({eId:"siptea",httpRequest:t.opts.httpRequest,url:t.opts.url,aggregateList:[c],dataParser:function(e){var t=null,r=e[c.searchId][c.dataSetId];if(1==r.length){var n=r[0];(t={}).county={name:n.tag.name,code:n.tag.adcode},n.city&&1==n.city.length&&(t.city={name:n.city[0].name,code:n.city[0].adcode}),n.province&&1==n.province.length&&(t.province={name:n.province[0].name,code:n.province[0].adcode})}return t}});case 15:f=r.sent,n(f);case 17:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}}])&&a(r.prototype,n),o&&a(r,o),y}(f);e.exports=y},function(e,t){e.exports={DISTRICTTABLES:{country:{shortName:"country",fullName:"user_siptea_country"},province:{shortName:"province",fullName:"user_siptea_province",evacuationParams:["0.01"]},city:{shortName:"city",fullName:"user_siptea_city",evacuationParams:["0.03"]},county:{shortName:"county",fullName:"user_siptea_county",evacuationParams:["0.12"]}},DIRECTCITYS:{11e4:{},12e4:{},31e4:{},5e5:{}}}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=r(188),f=r(467),h=(r(58),r(45),function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(p,e);var t,r,n,u,h=(t=p,function(){var e,r=l(t);if(s()){var n=l(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return a(this,e)});function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=h.call(this,e)).treeSet={},t}return r=p,(n=[{key:"registCustomTree",value:function(e,t){this.treeSet[e]=t}},{key:"unregistCustomTree",value:function(e){this.treeSet[e]=null,delete this.treeSet[e]}},{key:"stat",value:function(e){var t=this;return new Promise(function(){var r,n=(r=regeneratorRuntime.mark((function r(n,o){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,f.statTree({treeId:e.treeId,nodeId:e.nodeId,treeSet:t.treeSet,url:t.opts.url,httpRequest:t.opts.httpRequest});case 2:i=r.sent,n(i);case 4:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())}}])&&i(r.prototype,n),u&&i(r,u),p}(u));e.exports=h},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}var i=r(58),a={statTree:function(e){var t=this;return new Promise(function(){var r=o(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={},a={},s=null,e.treeSet.hasOwnProperty(e.treeId)&&(s=e.treeSet[e.treeId]),r.next=6,t._statTableNodes(s,e.url,e.httpRequest);case 6:for(l=r.sent,c=function e(t,r){if(r.children)for(var n=0;n<r.children.length;n++)e(t,r.children[n]);else r.ext&&(a[t.id].dataCount+=l[r.id].total,a[t.id].resourceCount++)},u=function e(t){if(a[t.id]=a[t.id]||{dataCount:0,resourceCount:0},c(t,t),t.children)for(var r=0;r<t.children.length;r++)e(t.children[r])},f=0;f<s.length;f++)u(s[f]);i.statistics=a,n(i);case 12:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())},_statTableNodes:function(e,t,r){return new Promise(function(){var n=o(regeneratorRuntime.mark((function n(o,a){var s,l,c,u,f,h,p,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(s={},l=[],c=function e(t){if(t.children)for(var r=0;r<t.children.length;r++)e(t.children[r]);else if(t.ext&&t.ext.table){var n={query:{}};n.searchId=t.id,n.dataSetId=t.ext.table,n.queryIndex=0;var o=[];o.push({$group:{_id:"_id",v:{$sum:1}}}),n.aggregate=o,l.push(n)}else t.ext&&(s[t.id]={total:0})},u=0;u<e.length;u++)c(e[u]);if(!(l.length>0)){n.next=9;break}return n.next=7,i.aggregateMulti({url:t,httpRequest:r,aggregateList:l});case 7:for(h in f=n.sent)p=f[h],d=p[Object.keys(p)[0]],s[h]={total:d[0].v};case 9:o(s);case 10:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}};e.exports=a},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=r(186),h=r(98),p=r(58),d=r(45),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(y,e);var t,r,n,o,f=(t=y,function(){var e,r=c(t);if(l()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function y(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),f.call(this,e)}return r=y,(n=[{key:"getPageList",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f,h,y,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((i=d(!0,{},e)).pageNo=i.pageNo||1,i.pageSize=i.pageSize||10,a=[i],!t._useAggregate(a)){r.next=29;break}return r.next=8,t._parseAggregateCol(a);case 8:return s=r.sent,r.next=11,p.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:s,dataParser:function(e){return t._dataParser(e,a)}});case 11:return l=r.sent,(c=l[0]).pageSize=i.pageSize,c.pageNo=i.pageNo,r.next=17,t._parseQueryCol([i]);case 17:return u=r.sent,(f=u[i.table]).select="_id",f.limit=1,f.page=1,delete f.populate,r.next=25,p.query({url:t.opts.url,httpRequest:t.opts.httpRequest,table:i.table,data:f,dataParser:function(e){return e.total}});case 25:c.total=r.sent,n(c),r.next=37;break;case 29:return r.next=31,t._parseQueryCol(a);case 31:return h=r.sent,y=h[i.table],r.next=35,p.query({url:t.opts.url,httpRequest:t.opts.httpRequest,table:e.table,data:y,dataParser:function(e){return e}});case 35:m=r.sent,n(m);case 37:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getList",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=[e],!t._useAggregate(i)){r.next=12;break}return r.next=5,t._parseAggregateCol(i);case 5:return a=r.sent,r.next=8,p.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:a,dataParser:function(e){return t._dataParser(e,i)}});case 8:s=r.sent,n(s[0]),r.next=22;break;case 12:return r.next=14,t._parseQueryCol(i);case 14:return l=r.sent,r.next=17,p.queryMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,data:l,dataParser:function(e){return e}});case 17:c=r.sent,(u={}).list=c[e.table],u.table=e.table,n(u);case 22:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_dataParser",value:function(e,t){for(var r=[],n=0;n<t.length;n++){var o=t[n],i={},a=e[n][o.table];i.list=a,i.table=o.table,r.push(i);for(var s={},l=0;l<o.relation.length;l++)s[o.relation[l].alias]=o.relation[l];for(var c=0,u=a.length;c<u;c++){var f=a[c];for(var h in f.tag)f[h]=f.tag[h];for(var p in f.id=f._id,delete f._id,delete f.tag,s){var d=f[p];if("many"==s[p].type)for(var y=0,m=d.length;y<m;y++)d[y]=d[y].tag;else f[p]=d.tag}}}return r}},{key:"getListBatch",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.tables,!t._useAggregate(i)){r.next=12;break}return r.next=5,t._parseAggregateCol(i);case 5:return a=r.sent,r.next=8,p.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:a,dataParser:function(e){return t._dataParser(e,i)}});case 8:s=r.sent,n(s),r.next=19;break;case 12:return r.next=14,t._parseQueryCol(i);case 14:return l=r.sent,r.next=17,p.queryMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,data:l,dataParser:function(t){for(var r=[],n=0;n<e.tables.length;n++)r.push({table:e.tables[n].table,list:t[e.tables[n].table]});return r}});case 17:c=r.sent,n(c);case 19:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_useAggregate",value:function(e){for(var t=!1,r=0;r<e.length;r++){var n=e[r];if(n&&n.relation&&n.relation.length>0){t=!0;break}}return t}},{key:"_parseQueryCol",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f,d,y,m,g,v,b,_,w,S,L,x,P,E,T,C,A,k,R;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(i={pageNo:"page",pageSize:"limit"},a={},s={},l=0;l<e.length;l++){for(d in(c=e[l]).returnRelation&&(s[c.table]=l),u={},f=[],a[c.table]=u,i)u[i[d]]=c[d];c.select&&(y=h.parseSqlFragment("select",c.select),m=h.translateSelect(y),u.select=m),c.where&&(g=h.parseSqlFragment("where",c.where),v=h.translateWhere(g),f.push(v)),c.geometry&&(b=h.parseGeometryFilter({geometry:c.geometry,inputSr:c.inputSr||4326,dataSr:4326,spatialRel:c.spatialRel||"intersects"}),f.push(b)),c.sort&&(_=h.parseSqlFragment("sort",c.sort),w=h.translateSort(_),u.sort=w),f.length>0&&(u.query={$and:f})}if(!((S=Object.keys(s)).length>0)){r.next=10;break}return r.next=8,p.getMetas({url:t.opts.url,httpRequest:t.opts.httpRequest,tables:S});case 8:for(L=r.sent,x=0;x<S.length;x++){for(P=a[S[x]],E=L[x],T=[],C=[],A=0;A<E.model.length;A++)(k=E.model[A])&&k.fieldRef&&(R="tag."+k.fieldName,T.push([R]),C.push(R));T.length>0&&(P.populate=T,P.select&&(P.select+=" "+C.join(" ")))}case 10:n(a);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_parseAggregateCol",value:function(e){return new Promise(function(){var t=i(regeneratorRuntime.mark((function t(r,n){var o,i,a,s,l,c,u,f,p,d,y,m,g,v,b,_,w,S,L,x,P,E;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o=[],i=0;i<e.length;i++){for(a=e[i],l=[],(s={}).query={},s.searchId=i,s.dataSetId=a.table,s.queryIndex=0,c=[],a.where&&(u=h.parseSqlFragment("where",a.where),f=h.translateWhere(u),c.push(f)),a.geometry&&(p=h.parseGeometryFilter({geometry:a.geometry,inputSr:a.inputSr||4326,dataSr:4326,spatialRel:a.spatialRel||"intersects"}),c.push(p)),c.length>0&&(s.query={$and:c}),d={},a.relation=a.relation||[],y=0;y<a.relation.length;y++)m=a.relation[y],(g={}).from="user_safety_"+m.table,g.localField="tag."+m.localField,g.foreignField="tag."+m.foreignField,g.as=m.alias,d[g.as]=m,l.push({$lookup:g}),"many"!=m.type&&l.push({$unwind:{path:"$"+m.alias,preserveNullAndEmptyArrays:!0}});if(a.sort&&(v=h.parseSqlFragment("sort",a.sort),b=h.translateSortAggregate(v),l.push({$sort:b})),isNaN(a.pageNo)||(_=a.pageSize||10,l.push({$skip:(a.pageNo-1)*_}),l.push({$limit:_})),w={},a.select)for(S=h.parseSqlFragment("select",a.select),L=h.translateSelect(S),x=L.split(" "),P=0;P<x.length;P++)w[x[P]]="$"+x[P];else w.tag="$tag";for(E in d)w[E]="$"+E;l.push({$project:w}),s.aggregate=l,o.push(s)}r(o);case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}}])&&a(r.prototype,n),o&&a(r,o),y}(f);e.exports=y},function(e,t,r){t.AST=r(470),t.parse=r(192).parse,t.stringify=r(193)},function(e,t,r){var n=r(192).parse,o=r(193);function i(e){this.ast=e}i.prototype={parse:function(e){this.ast=n(e)},stringify:function(){return o(this.ast)},getTables:function(){},getSelectedColumns:function(){}},e.exports=i},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=r(472),h=(r(98),r(58)),p=r(473),d=r(45),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(y,e);var t,r,n,o,f=(t=y,function(){var e,r=c(t);if(l()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function y(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),f.call(this,e)}return r=y,(n=[{key:"getResourceCatalog",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p.getResourceCatalog(t.opts.httpRequest,t.opts.configUrl,t.opts.url,e.eventType);case 2:i=r.sent,n(i);case 4:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"bufferQuery",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(i=d(!0,{},e)).resources=i.resources||[],i.spatialReference=i.spatialReference||4326,"[object Number]"==Object.prototype.toString.call(i.radius)&&(i.radius=[e.radius]),r.next=6,t._ensureResourceTree(e.eventType);case 6:return a=p.makeBufferAggregates(i),r.next=9,h.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:a});case 9:s=r.sent,l=p.parseBufferQueryResult(s,i.radius,i.resources),n(l);case 12:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"polygonQuery",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(i=d(!0,{},e)).resources=i.resources||[],i.spatialReference=i.spatialReference||4326,r.next=5,t._ensureResourceTree(e.eventType);case 5:return a=p.makeAggregates(i,"polygon"),r.next=8,h.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:a});case 8:s=r.sent,l=p.parseQueryResult(s,i.resources),n(l);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"keywordQuery",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(i=d(!0,{},e)).resources=i.resources||[],i.spatialReference=i.spatialReference||4326,r.next=5,t._ensureResourceTree(e.eventType);case 5:return a=p.makeAggregates(i,"keyword"),r.next=8,h.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:a});case 8:s=r.sent,l=p.parseQueryResult(s,i.resources),n(l);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"districtQuery",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(i=d(!0,{},e)).resources=i.resources||[],i.spatialReference=i.spatialReference||4326,r.next=5,t._ensureResourceTree(e.eventType);case 5:return a=p.makeAggregates(i,"district"),r.next=8,h.aggregateMulti({url:t.opts.url,httpRequest:t.opts.httpRequest,aggregateList:a});case 8:s=r.sent,l=p.parseQueryResult(s,i.resources),n(l);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_ensureResourceTree",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null==e||null==e){r.next=3;break}return r.next=3,p.getResourceCatalog(t.opts.httpRequest,t.opts.configUrl,t.opts.url,e);case 3:n();case 4:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"bufferStatistics",value:function(e){console.warn("敬请期待……")}},{key:"polygonStatistics",value:function(e){console.warn("敬请期待……")}},{key:"keywordStatistics",value:function(e){console.warn("敬请期待……")}},{key:"districtStatistics",value:function(e){console.warn("敬请期待……")}},{key:"getResourceConfig",value:function(e){return p.getResourceConfigById(e)}},{key:"destroy",value:function(){p.clear()}}])&&a(r.prototype,n),o&&a(r,o),y}(f);e.exports=y},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),u.call(this,e)}return r=f,(n=[{key:"getResourceCatalog",value:function(e){}},{key:"bufferQuery",value:function(e){}},{key:"polygonQuery",value:function(e){}},{key:"keywordQuery",value:function(e){}},{key:"districtQuery",value:function(e){}},{key:"bufferStatistics",value:function(e){}},{key:"polygonStatistics",value:function(e){}},{key:"keywordStatistics",value:function(e){}},{key:"districtStatistics",value:function(e){}}])&&o(r.prototype,n),c&&o(r,c),f}(r(42));e.exports=c},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}var i=r(98),a=r(58),s=r(45),l=r(63),c={},u={},f={};c.clear=function(){u={},f={}};var h=function(e,t,r){return new Promise(function(){var n=o(regeneratorRuntime.mark((function n(o,i){var s,l,c,u,f,h,p,d,y,m,g,v,b,_;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(c in s=e.resources,l={},s)if(!(u=s[c]).table||u.selectField&&Object.keys(u.selectField).length>0||(l[u.table]=l[u.table]||[],l[u.table].push(u)),u.children&&Object.keys(u.children).length>0)for(f in u.children)!(h=u.children[f]).table||h.selectField&&Object.keys(h.selectField).length>0||(l[h.table]=l[h.table]||[],l[h.table].push(h));if(!(Object.keys(l).length>0)){n.next=8;break}return n.next=6,a.getMetas({url:r,httpRequest:t,tables:Object.keys(l)});case 6:for(p=n.sent,d=0;d<p.length;d++){for(y=p[d],m=y.model,g={},v=0;v<m.length;v++)g[m[v].fieldName]=m[v].fieldName;for(b=l[y.dataSetId]||[],_=0;_<b.length;_++)b[_].selectField=g}case 8:o(e);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())};c.getResourceConfig=function(e,t,r,n){return new Promise(function(){var i=o(regeneratorRuntime.mark((function o(i,a){var s,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!u.hasOwnProperty(n)){o.next=4;break}i(u[n]),o.next=13;break;case 4:return t=t.replace(/\{eventType\}/g,n),o.next=7,e.get(t,"json");case 7:return s=o.sent,o.next=10,h(s,e,r);case 10:l=o.sent,u[n]=l,i(s);case 13:case"end":return o.stop()}}),o)})));return function(e,t){return i.apply(this,arguments)}}())},c.getResourceCatalog=function(e,t,r,n){var i=this;return new Promise(function(){var a=o(regeneratorRuntime.mark((function o(a,l){var c,u,h,p,d,y,m,g,v,b,_;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=[],o.next=3,i.getResourceConfig(e,t,r,n);case 3:for(p in u=o.sent,h=u.resources)if(d=h[p],(y={}).id=p,y.name=d.title,y.parentId=null,c.push(y),d.children&&Object.keys(d.children).length>0)for(m in y.isLeaf=!1,d.children){for(_ in g=d.children[m],(v={}).id=[p,m].join("~"),v.name=g.title,v.parentId=p,v.isLeaf=!0,c.push(v),delete(b=s(!0,{},d)).children,g)b[_]=g[_];f[v.id]=b}else f[y.id]=d,y.isLeaf=!0;a(c);case 7:case"end":return o.stop()}}),o)})));return function(e,t){return a.apply(this,arguments)}}())},c.getResourceConfigById=function(e){return f[e]},c.makeBufferAggregates=function(e){for(var t=[],r=e.radius.length,n=0;n<e.resources.length;n++){var o=e.resources[n],i=f[o],a={type:"buffer"};a.resourceId=o,a.resourceConfig=i,a.keyword=e.keyword||null,a.radius=e.radius[0],a.geometry=e.geometry||null,a.spatialReference=e.spatialReference||4326;for(var l=this.makeAggregate(a),c=0;c<r;c++){var u=s(!0,{},l);u.searchId=u.searchId+"___"+c;var h=u.aggregate[0].$geoNear;h.maxDistance=e.radius[c],c>0&&(h.minDistance=e.radius[c-1]),t.push(u)}}return t},c.makeAggregates=function(e,t){for(var r=[],n=0;n<e.resources.length;n++){var o=e.resources[n],i=c.getResourceConfigById(o);if(i){var a={};a.type=t,a.resourceId=o,a.resourceConfig=i,a.keyword=e.keyword||null,a.districtCode=e.districtCode||null,a.geometry=e.geometry||null,a.geometryFilter=e.geometryFilter||null,a.spatialReference=e.spatialReference||4326;var s=this.makeAggregate(a);r.push(s)}}return r},c.parseBufferQueryResult=function(e,t,r){for(var n=[],o=0;o<t.length;o++){for(var i={total:0,radius:t[o],collection:[]},a=0;a<r.length;a++){var s=r[a],l=c.getResourceConfigById(s);if(l){var u=e[s+"___"+o],f={};f.id=s,f.name=l.title,f.list=u[l.table],i.total+=f.list.length,i.collection.push(f)}}n.push(i)}return n},c.parseQueryResult=function(e,t){for(var r={total:0,collection:[]},n=0;n<t.length;n++){var o=t[n],i=c.getResourceConfigById(o),a=e[o],s={};s.id=o,s.name=i.title,s.list=a[i.table],r.total+=s.list.length,r.collection.push(s)}return r},c.makeAggregate=function(e){var t={},r=[],n=e.resourceConfig.table;t.query={},t.searchId=e.resourceId,t.dataSetId=n,t.queryIndex=0;var o={},i=this.queryBuilders.buildMatch(e,o),a=c.queryBuilders.buildGeoNear(e);if(a)i.inGeoNear.$and.length>0&&(a.$geoNear.query=i.inGeoNear),r.push(a),t.queryIndex=1,i.postGeoNear&&i.postGeoNear.$and.length>0&&(t.query=i.postGeoNear);else{var u=[];i.inGeoNear&&i.inGeoNear.$and.length>0&&(u=u.concat(i.inGeoNear.$and)),i.postGeoNear&&i.postGeoNear.$and.length>0&&(u=u.concat(i.postGeoNear.$and)),u.length>0&&(t.query={$and:u}),e.geometry&&e.radius&&(e.geometryFilter=e.geometryFilter||l.getBuffer({geometry:e.geometry,radius:e.radius,spatialReference:e.spatialReference}))}var f=c.queryBuilders.buildSelect(e,o),h=c.queryBuilders.buildSort(e,o);if(Object.keys(o).length>0){var p=c.queryBuilders.buildRelation(e,o),d=s(!0,{},f.preLookup);s(!0,d,p.project||{}),s(!0,d,i.preLookupSelect||{}),r.push({$project:d}),r=r.concat(p.aggregate),i.postLookup.$and.length>0&&r.push({$match:{$and:i.postLookup.$and}}),Object.keys(f.postLookup).length>0&&r.push({$project:f.postLookup})}else r.push({$project:f.preLookup});return Object.keys(h.preLookup).length>0&&r.push({$sort:h.preLookup}),e.limit&&r.push({$limit:e.limit}),t.aggregate=r,console.debug(t),t},c.queryBuilders={buildGeoNear:function(e){if(!e.geometry||"Point"!=e.geometry.type)return null;var t={limit:1e6};return t.maxDistance=e.radius?parseFloat(e.radius):5e6,t.minDistance=0,t.spherical=!0,t.near=e.geometry,t.includeLocs="geom",t.distanceField="distance",{$geoNear:t}},buildMatch:function(e,t){var r={inGeoNear:{$and:[]},postGeoNear:{$and:[]},postLookup:{$and:[]},preLookupSelect:{}};if(e.resourceConfig.filter){var n=i.parseSqlFragment("where",e.resourceConfig.filter),o=i.translateWhere(n);r.inGeoNear.$and.push(o)}if(e.districtCode&&e.districtCode.length>0){var a={};a["tag."+e.resourceConfig.districtField]={$in:e.districtCode},r.inGeoNear.$and.push(a)}if(e.keyword){var s=e.resourceConfig.keywordFields;if(s&&s.length>0){for(var l={$regex:"^.*"+e.keyword+".*$"},c=[[],[],[]],u=0;u<s.length;u++){var f=s[u],h=f.split(".");if(2==h.length){var p={};p[[h[0],"tag",h[1]].join(".")]=l,c[1].push(p),t[h[0]]=!0}else{var d={};d["tag."+f]=l,c[0].push(d);var y=!1;for(var m in e.resourceConfig.selectField)if(e.resourceConfig.selectField[m]==f){var g={};g[m]=l,c[2].push(g),y=!0;break}y||(r.preLookupSelect[f]="$tag."+f)}}c[1].length>0?r.postLookup.$and.push({$or:c[2].concat(c[1])}):r.inGeoNear.$and.push({$or:c[0]})}}return e.geometryFilter&&r.postGeoNear.$and.push({geom:{$geoIntersects:{$geometry:e.geometryFilter}}}),r},buildSelect:function(e,t){var r={preLookup:{id:"$_id",geometry:"$geom",distance:{$floor:"$distance"},_id:!1},postLookup:{}},n=e.resourceConfig.selectField;for(var o in n)if(0!=o.indexOf("//")){var i=n[o].split(".");2==i.length?(r.postLookup[o]="$"+[i[0],"tag",i[1]].join("."),t[i[0]]=!0):"geom"==n[o]?r.preLookup[o]="$"+n[o]:r.preLookup[o]="$tag."+n[o]}for(var a in r.preLookup)r.postLookup[a]="$"+a;return r},buildSort:function(e,t){for(var r={preLookup:{},postLookup:{}},n=i.parseSqlFragment("sort",e.resourceConfig.sort),o=0;o<n.length;o++){var a=n[o];r.preLookup[a.expr.column]="ASC"==a.type?1:-1}return r},buildRelation:function(e,t){for(var r={aggregate:[],project:{}},n=0;n<e.resourceConfig.relateTables.length;n++){var o=e.resourceConfig.relateTables[n];if(t.hasOwnProperty(o.alias)){var i={};i.from="user_safety_"+o.table,i.localField="tag."+o.localField,i.foreignField="tag."+o.foreignField,i.as=o.alias,r.aggregate.push({$lookup:i}),r.aggregate.push({$unwind:{path:"$"+o.alias,preserveNullAndEmptyArrays:!0}}),r.project[i.localField]="$"+i.localField}}return r}},e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=r(189),h=r(475),p=r(58),d=r(477),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(y,e);var t,r,n,o,f=(t=y,function(){var e,r=c(t);if(l()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function y(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),(t=f.call(this,e)).routeService=new h({httpRequest:t.opts.httpRequest,url:t.opts.routServer.url,token:t.opts.routServer.key}),t.config={rescue:{},material:{}},t}return r=y,(n=[{key:"setConfig",value:function(e){this.config=e}},{key:"rescueDispatch",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={dispatchList:[]},e.tableInfo=t.config.rescue,a=d.makeRescueAggregates(e),r.next=5,p.aggregateMulti({httpRequest:t.opts.httpRequest,url:t.opts.url,aggregateList:a,dataParser:function(t){return d.extractRescueFulfillCol(e,t)}});case 5:if(s=r.sent,!e.routePlan){r.next=9;break}return r.next=9,d.planRoutes({service:t.routeService,destination:e.destination,dispatchCol:s,routeParams:e.routeParams,spatialReference:e.spatialReference});case 9:i.dispatchList=s,n(i);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"materialDispatch",value:function(e){var t=this;return new Promise(function(){var r=i(regeneratorRuntime.mark((function r(n,o){var i,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={dispatchList:[]},e.tableInfo=t.config.material,a=d.makeMaterialAggregates(e),r.next=5,p.aggregateMulti({httpRequest:t.opts.httpRequest,url:t.opts.url,aggregateList:a,dataParser:function(t){return d.extractMaterialFulfillCol(e,t)}});case 5:if(s=r.sent,!e.routePlan){r.next=9;break}return r.next=9,d.planRoutes({service:t.routeService,destination:e.destination,dispatchCol:s,routeParams:e.routeParams,spatialReference:e.spatialReference});case 9:i.dispatchList=s,n(i);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}}])&&a(r.prototype,n),o&&a(r,o),y}(f);e.exports=y},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=r(476),f=(r(45),r(130)),h=r(1),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(d,e);var t,r,n,u,p=(t=d,function(){var e,r=l(t);if(s()){var n=l(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return a(this,e)});function d(e){var t;for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(t=p.call(this,e)).opts={},e)t.opts[r]=e[r];return t.projectService=new h.sfs.CoordinateTransform,t}return r=d,(n=[{key:"driving",value:function(e){var t=this;return new Promise(function(){var r,n=(r=regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,h,p,d,y,m,g,v,b,_,w,S,L,x,P,E,T,C,A,k,R,O,I;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=t._getUrl(t.opts.url,"driving"),i+="&key=".concat(t.opts.token),e.spatialReference=e.spatialReference||4326,a=t._getTransformedCoordiante(e.origin,e.spatialReference),i+="&origin=".concat(a[0],",").concat(a[1]),s=t._getTransformedCoordiante(e.destination,e.spatialReference),i+="&destination=".concat(s[0],",").concat(s[1]),e.custom)for(l in e.custom)i+="&".concat(l,"=").concat(e.custom[l]);return r.next=10,t.opts.httpRequest.get(i,"json",null,"application/x-www-form-urlencoded",{});case 10:if("OK"==(c=r.sent).info){for(u=c.route.paths[0],h=u.steps,p=[],d=0;d<h.length;d++){if(y=[],(m=h[d]).geometry={type:"LineString",coordinates:y},m.polyline)for(g=m.polyline.split(";"),v=0;v<g.length;v++)b=g[v],_=f.gcj02towgs84(b),w=_.split(","),S=[parseFloat(w[0]),parseFloat(w[1])],y.push(S),p.push(S);if(m.tmcs)for(L=0,x=m.tmcs.length;L<x;L++){for(P=m.tmcs[L],E=P.polyline,T=E.split(";"),C=[],A=0,k=T.length;A<k;A++)R=T[A],O=f.gcj02towgs84(R),I=O.split(","),C.push(I);P.polyline=C.join(";")}}u.geometry={type:"LineString",coordinates:p},n(u)}else o(new Error("路径规划失败："+c.infocode));case 12:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())}},{key:"_getTransformedCoordiante",value:function(e,t){var r=[];switch(t){case 4326:var n=f.wgs84togcj02([e[0],e[1]].join(","));r[0]=parseFloat(n.split(",")[0]).toFixed(6),r[1]=parseFloat(n.split(",")[1]).toFixed(6);break;case 3857:var o=new h.sfs.Point({x:pint[0],y:e[1],spatialReference:3857}),i=this.projectService.transform(o,4326);r=this._getTransformedCoordiante([i.x,i.y],4326)}return r}},{key:"_getUrl",value:function(e,t){var r=e;return r.indexOf("/"+t)>=0&&(r=r.replace("/"+t,"")),"/"!==r[r.length-1]&&(r+="/"),r+=t,r+="?"}}])&&i(r.prototype,n),u&&i(r,u),d}(u);e.exports=p},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"driving",value:function(e){}},{key:"transit",value:function(e){}},{key:"walking",value:function(e){}},{key:"riding",value:function(e){}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}var a=r(98),s={makeRescueAggregates:function(e){for(var t=[],r={type:"Point",coordinates:e.destination},n=e.tableInfo.table,o=e.tableInfo.typeField,i=0;i<e.requiredList.length;i++){var s=e.requiredList[i],l={},c=[];l.query={},l.searchId=i,l.dataSetId=n,l.queryIndex=1,l.aggregate=c;var u=[];if(s.filter){var f=a.parseSqlFragment("where",s.filter),h=a.translateWhere(f);u.push(h)}var p={};p["tag."+o]=s.type,u.push(p);var d={limit:1e6};d.maxDistance=s.maxDistance||5e6,d.minDistance=s.minDistance||0,d.spherical=!0,d.near=r,d.includeLocs="geom",d.distanceField="distance",u.length>0&&(d.query={$and:u}),c.push({$geoNear:d}),c.push({$project:{tag:"$tag",id:"$_id",geometry:"$geom",_d:"$distance"}}),t.push(l)}return t},extractRescueFulfillCol:function(e,t){for(var r=[],n=0;n<e.requiredList.length;n++){var o=e.requiredList[n],i=this.extractRescueFulfill(o,t[n][e.tableInfo.table],e.tableInfo);r.push({type:o.type,list:i.list,num:i.num})}return r},extractRescueFulfill:function(e,t,r){var n={},o=[];e.numType=e.numType||1;var i=this.makeRescuePriorityGroup(e.priority,t),a=0,s=r.numField;if(1==e.numType)for(var l=0;l<i.length;l++){var c=i[l];c.length>e.num?(o=c.slice(0,e.num),a+=e.num):(o=o.concat(c),a+=c.length)}else if(2==e.numType)for(var u=0;u<i.length;u++){for(var f=i[u],h=0;h<f.length;h++){var p=f[h];if(a>=e.num)break;var d=parseFloat(p[s]),y=d;a+d>e.num&&(y=e.num-a),a+=y,p.dispatch_num=y,o.push(p)}if(a>=e.num)break}return n.num=a,n.list=o,n},makeRescuePriorityGroup:function(e,t){var r=[];if(e)for(var n=0;n<e.values.length;n++){for(var o=e.values[n],i=[],a=t.length-1;a>=0;a--){var s=t[a];if(s.tag&&s.tag[e.field]==o){var l={id:s.id,geometry:s.geometry,distance:s._d};for(var c in l.geom=s.geometry,s.tag)l[c]=s.tag[c];i.push(l),t.splice(a,1)}}r.push(i)}else r.push(t);return r},planRoutes:function(e){return new Promise(function(){var t=o(regeneratorRuntime.mark((function t(r,n){var o,i,a,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.routeParams=e.routeParams||{},o=0;case 2:if(!(o<e.dispatchCol.length)){t.next=17;break}i=e.dispatchCol[o].list,a=0;case 5:if(!(a<i.length)){t.next=14;break}return l=i[a],t.next=9,s.planRouteEach({service:e.service,startPos:[l.geometry.coordinates[0],l.geometry.coordinates[1]],endPos:e.destination,routeParams:e.routeParams,spatialReference:e.spatialReference});case 9:c=t.sent,l.route=c;case 11:a++,t.next=5;break;case 14:o++,t.next=2;break;case 17:r();case 18:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},planRouteEach:function(e){return new Promise(function(){var t=o(regeneratorRuntime.mark((function t(r,n){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.service.driving({origin:e.startPos,destination:e.endPos,spatialReference:e.spatialReference,custom:e.routeParams.custom||{}});case 2:o=t.sent,r(o);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},makeMaterialAggregates:function(e){var t=[],r={type:"Point",coordinates:e.destination},n=e.tableInfo.reposity,o=e.tableInfo.material,a={},s=[];a.query={},a.searchId=i,a.dataSetId=n.table,a.queryIndex=1,a.aggregate=s;var l={limit:1e6};l.maxDistance=e.maxDistance||5e6,l.minDistance=e.minDistance||0,l.spherical=!0,l.near=r,l.includeLocs="geom",l.distanceField="distance",s.push({$geoNear:l});var c={};return c.from="user_safety_"+o.table,c.localField="_id",c.foreignField="tag."+o.reposityField,c.as="materials",s.push({$lookup:c}),t.push(a),t},extractMaterialFulfillCol:function(e,t){for(var r=[],n=t[0][e.tableInfo.reposity.table],o=e.tableInfo.material.typeField,i=0;i<e.requiredList.length;i++){for(var a=e.requiredList[i],s={},l=a.type.split(","),c=(l.length,0);c<l.length;c++)s[l[c]]=[];for(var u=[],f=0,h=n.length;f<h;f++){var p=n[f],d={};for(var y in d.id=p._id,d.geometry=p.geom,d.geom=p.geom,d.distance=p.distance,d.materials=p.materials,p.tag)d[y]=p.tag[y];for(var m=p.materials||[],g=0,v=0,b=m.length;v<b;v++){var _=m[v];for(var w in _.id=_._id,_.tag)_[w]=_.tag[w];delete _._id,delete _.tag;var S=s[_[o]];S&&(d._index=S.length,S.push(d),g++)}g>0&&u.push(d)}e.limit&&(u.sort((function(e,t){return e._index-t._index})),(u=u.slice(0,e.limit)).sort((function(e,t){return e.distance-t.distance}))),r.push({type:a.type,list:u})}return r}};e.exports=s},function(e,t,r){"use strict";var n,o;n=[r(479)],void 0===(o=function(e){return{AnalysisFile:e}}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o;n=[r(15),r(480),r(12),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)}});return o.include({analysisDifferenceTypeFile:function(e){if(!e.fileUrl||!e.fileType)throw new Error("参数不完整");var t="_analysis"+e.fileType;"function"==typeof this[t]&&(e.layer=layer,this[t](e))},_analysisCsv:function(e){window.papaparse.parse(e.fileUrl,{download:!0,complete:function(t){if(t){for(var n,o,i,a=t.data,s={type:"FeatureCollection",features:[]},l=0;l<a[0].length;l++)"x"!=a[0][l]&&"X"!=a[0][l]&&"longitude"!=a[0][l]&&"LONGITUDE"!=a[0][l]||(n=l),"y"!=a[0][l]&&"Y"!=a[0][l]&&"latitude"!=a[0][l]&&"LATITUDE"!=a[0][l]||(o=l),"wkt"!=a[0][l]&&"SDE.ST_ASTEXT(SHAPE)"!=a[0][l]||(i=l);for(var c in a)if("0"!=c){var u={type:"Feature",properties:{},geometry:{},symbol:{}},f={};if(null!=n||null!=o){var h={type:"Point",coordinates:[a[c][n],a[c][o]]};f.type="SimpleMarkerSymbol",u.geometry=h,u.symbol=f,s.features.push(u)}if(null!=i){if(!a[c][i])break;"LineString"==(h=r.getGeoJSONWriter().write(r.getWktReader().read(a[c][i]))).type?f.type="SimpleLineSymbol":f.type="SimpleFillSymbol",u.geometry=h,u.symbol=f,s.features.push(u)}}}e.callback&&e.context&&e.callback.call(e.context,s)}})},_analysisShape:function(e){window.shp.load(e.fileUrl,(function(t){var r=[],n={type:"FeatureCollection",features:[]};if(t.records.length>0&&(r=t.records),1==t.shapeType||2==t.shapeType)for(var o=0;o<r.length;o++){var i={type:"Feature",properties:{},geometry:{},symbol:{}},a={},s={type:"Point",coordinates:[r[o].shape.content.x,r[o].shape.content.y]};a.type="SimpleMarkerSymbol",i.geometry=s,i.symbol=a,n.features.push(i)}else if(3==t.shapeType||4==t.shapeType)for(o=0;o<r.length;o++){i={type:"Feature",properties:{},geometry:{},symbol:{}},a={},s={type:"LineString",coordinates:[]};if((c=r[o].shape.content.points).length>0)for(var l=0;l<c.length/2;l++)s.coordinates.push([c[2*l],c[2*l+1]]);a.type="SimpleLineSymbol",i.geometry=s,i.symbol=a,n.features.push(i)}else if(5==t.shapeType||6==t.shapeType)for(o=0;o<r.length;o++){var c;i={type:"Feature",properties:{},geometry:{},symbol:{}},a={},s={type:"Polygon",coordinates:[[]]};if((c=r[o].shape.content.points).length>0)for(l=0;l<c.length/2;l++)s.coordinates[0].push([c[2*l],c[2*l+1]]);a.type="SimpleFillSymbol",i.geometry=s,i.symbol=a,n.features.push(i)}e.callback&&e.context&&e.callback.call(e.context,n)}),(function(e){throw new Error(e)}))},_analysisGml:function(e){$.ajax({type:"get",url:e.fileUrl,dataType:"XML",async:!0,success:function(t){var r=$(t).find("featureMember"),n={type:"FeatureCollection",features:[]};r.each((function(){var e={type:"Feature",properties:{},geometry:{},symbol:{}},t={};if($(this).find("Point").length>0){var r=$(this).find("Point").find("pos").text().split(" "),o={type:"Point",coordinates:[r[1],r[0]]};t.type="SimpleMarkerSymbol",e.geometry=o,e.symbol=t,n.features.push(e)}if($(this).find("LineString").length>0){for(var i=$(this).find("LineString").find("posList").text().split(" "),a=(o={type:"LineString",coordinates:[]},0);a<i.length/2;a++)o.coordinates.push([i[2*a+1],i[2*a]]);t.type="SimpleLineSymbol",e.geometry=o,e.symbol=t,n.features.push(e)}if($(this).find("LinearRing").length>0){for(var s=$(this).find("LinearRing").find("posList").text().split(" "),l=(o={type:"Polygon",coordinates:[[]]},0);l<s.length/2;l++)o.coordinates[0].push([s[2*l+1],s[2*l]]);t.type="SimpleFillSymbol",e.geometry=o,e.symbol=t,n.features.push(e)}})),e.callback&&e.context&&e.callback.call(e.context,n)},error:function(e){throw new Error(e.message)}})},_analysisKml:function(e){var t=this;$.ajax({type:"get",url:e.fileUrl,dataType:"XML",async:!0,success:function(r){var n=$(r).find("Placemark"),o=$(r).find("Style"),i=($(r).find("featureMember"),{type:"FeatureCollection",features:[]});n.each((function(){var e={type:"Feature",properties:{},geometry:{},symbol:{}},r={};if($(this).find("Point").length>0){$(this).find("styleUrl").length>0&&(r=t._getSymbolObj(o,$(this).find("styleUrl").text(),"IconStyle"));var n={type:"Point",coordinates:[(l=$(this).find("Point").find("coordinates").text().split(","))[0],l[1]]};e.geometry=n,e.symbol=r,i.features.push(e)}if($(this).find("LineString").length>0){$(this).find("styleUrl").length>0&&(r=t._getSymbolObj(o,$(this).find("styleUrl").text(),"LineStyle"));for(var a=$(this).find("LineString").find("coordinates").text().split(" "),s=(n={type:"LineString",coordinates:[]},0);s<a.length;s++){var l=a[s].split(",");n.coordinates.push([l[0],l[1]])}e.geometry=n,e.symbol=r,i.features.push(e)}if($(this).find("LinearRing").length>0){$(this).find("styleUrl").length>0&&(r=t._getSymbolObj(o,$(this).find("styleUrl").text(),"PolyStyle"));var c=$(this).find("LinearRing").find("coordinates").text().split(" ");for(n={type:"LineString",coordinates:[[]]},s=0;s<c.length;s++){var u=c[s].split(",");n.coordinates[0].push([u[0],u[1]])}e.geometry=n,e.symbol=r,i.features.push(e)}})),e.callback&&e.context&&e.callback.call(e.context,i)},error:function(e){throw new Error(e.message)}})},analysisWfsData:function(e){if(!e.wfsData)throw new Error("传入参数错误！");return t.wfsXmlToJsonDataArray(e.wfsData)}}),o.include({_getSymbolObj:function(e,t,r){var o={};return e.length>0&&e.each((function(){if("#"+$(this)[0].id==t){if("IconStyle"==r){var e=$(this).find("scale").text()||.2,i=$(this).find("href").text()||void 0,a=$(this).find("rotation").text()||0,s=$(this).find("width").text()||void 0,l=$(this).find("height").text()||void 0;o={type:"PictureMarkerSymbol",scale:e,sourceKey:i,width:s,height:l,rotation:a}}if("LineStyle"==r){var c=$(this).find("style").text()||5,u=$(this).find("width").text()||2,f=$(this).find("color").text()||"#ff0000",h=n.sfs.Color.fromHex(f);o={type:"SimpleLineSymbol",color:h,style:c,width:u}}if("PolyStyle"==r){f=$(this).find("color").text()||"#ff0000";var p=$(this).find("borderThickness").text()||0,d=$(this).find("opacity").text()||1;h=n.sfs.Color.fromHex(f);o={type:"SimpleFillSymbol",borderColor:h,fillColor:h,borderThickness:p,opacity:d}}}})),o}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){var n;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}void 0===(n=function(){var e={};function t(e){var t={};for(var r in e)0==r.indexOf("esri:")&&(t[r.substr(5)]=e[r]);var n=e["gml:envelope"].split(","),o=parseFloat(n[0]),i=parseFloat(n[1]),a=parseFloat(n[2]),s=parseFloat(n[3]);t.longitude=(o+a)/2,t.latitude=(i+s)/2;var l=e["gml:multiPointProperty"],c=e["gml:multiLineStringProperty"],u=e["gml:multiPolygonProperty"];if(l){var f=l["gml:MultiPoint"]["gml:pointMember"],h="";if(f.length){h="MULTIPOINT(",t.wkttype="MULTIPOINT";for(var p=0;p<f.length;p++){var d=f[p]["gml:Point"]["gml:coordinates"];p==f.length-1?h+=d:h+=d+","}h+=")"}else h+="POINT(",t.wkttype="POINT",h+=f["gml:Point"]["gml:coordinates"],h+=")";t.wktdata=h}if(c){var y=c["gml:MultiLineString"]["gml:lineStringMember"],m="";if(y.length){t.wkttype="MULTILINESTRING",m+="MULTILINESTRING(";for(p=0;p<y.length;p++){var g=y[p]["gml:LineString"]["gml:coordinates"];p==y.length-1?m+="("+g.replace(new RegExp(";","gm"),",")+")":m+="("+g.replace(new RegExp(";","gm"),",")+"),"}m+=")"}else{t.wkttype="LINESTRING",m+="LINESTRING(",m+=(g=y["gml:LineString"]["gml:coordinates"]).replace(new RegExp(";","gm"),","),m+=")"}t.wktdata=m}if(u){var v=u["gml:MultiPolygon"]["gml:polygonMember"],b="";if(v.length){t.wkttype="MULTIPOLYGON",b+="MULTIPOLYGON(";for(p=0;p<v.length;p++){var _=v[p]["gml:Polygon"]["gml:outerBoundaryIs"]["gml:LinearRing"]["gml:coordinates"];p==v.length-1?b+="(("+_.replace(new RegExp(";","gm"),",")+"))":b+="(("+_.replace(new RegExp(";","gm"),",")+")),"}b+=")"}else{t.wkttype="POLYGON",b+="POLYGON(",b+="("+(_=v["gml:Polygon"]["gml:outerBoundaryIs"]["gml:LinearRing"]["gml:coordinates"]).replace(new RegExp(";","gm"),",")+")",b+=")"}t.wktdata=b}return l||u||c||(t.wkttype="未知类型"),t}return e.xml2json=function(e,t){var r={toObj:function(e){var t={};if(1==e.nodeType){if(e.attributes.length)for(var n=0;n<e.attributes.length;n++)t["@"+e.attributes[n].nodeName]=(e.attributes[n].nodeValue||"").toString();if(e.firstChild){for(var o=0,i=0,a=!1,s=e.firstChild;s;s=s.nextSibling)1==s.nodeType?a=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?o++:4==s.nodeType&&i++;if(a)if(o<2&&i<2){r.removeWhite(e);for(s=e.firstChild;s;s=s.nextSibling)3==s.nodeType?t["#text"]=r.escape(s.nodeValue):4==s.nodeType?t["#cdata"]=r.escape(s.nodeValue):t[s.nodeName]?t[s.nodeName]instanceof Array?t[s.nodeName][t[s.nodeName].length]=r.toObj(s):t[s.nodeName]=[t[s.nodeName],r.toObj(s)]:t[s.nodeName]=r.toObj(s)}else e.attributes.length?t["#text"]=r.escape(r.innerXml(e)):t=r.escape(r.innerXml(e));else if(o)e.attributes.length?t["#text"]=r.escape(r.innerXml(e)):t=r.escape(r.innerXml(e));else if(i)if(i>1)t=r.escape(r.innerXml(e));else for(s=e.firstChild;s;s=s.nextSibling)t["#cdata"]=r.escape(s.nodeValue)}e.attributes.length||e.firstChild||(t=null)}else 9==e.nodeType?t=r.toObj(e.documentElement):console.log("unhandled node type: "+e.nodeType);return t},toJson:function(e,t,n){var i=t?'"'+t+'"':"";if(e instanceof Array){for(var a=0,s=e.length;a<s;a++)e[a]=r.toJson(e[a],"",n+"\t");i+=(t?":[":"[")+(e.length>1?"\n"+n+"\t"+e.join(",\n"+n+"\t")+"\n"+n:e.join(""))+"]"}else if(null==e)i+=(t&&":")+"null";else if("object"==o(e)){var l=[];for(var c in e)l[l.length]=r.toJson(e[c],c,n+"\t");i+=(t?":{":"{")+(l.length>1?"\n"+n+"\t"+l.join(",\n"+n+"\t")+"\n"+n:l.join(""))+"}"}else i+="string"==typeof e?(t&&":")+'"'+e.toString()+'"':(t&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var r=function e(t){var r="";if(1==t.nodeType){r+="<"+t.nodeName;for(var n=0;n<t.attributes.length;n++)r+=" "+t.attributes[n].nodeName+'="'+(t.attributes[n].nodeValue||"").toString()+'"';if(t.firstChild){r+=">";for(var o=t.firstChild;o;o=o.nextSibling)r+=e(o);r+="</"+t.nodeName+">"}else r+="/>"}else 3==t.nodeType?r+=t.nodeValue:4==t.nodeType&&(r+="<![CDATA["+t.nodeValue+"]]>");return r},n=e.firstChild;n;n=n.nextSibling)t+=r(n);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var t=e.firstChild;t;)if(3==t.nodeType)if(t.nodeValue.match(/[^ \f\n\r\t\v]/))t=t.nextSibling;else{var n=t.nextSibling;e.removeChild(t),t=n}else 1==t.nodeType?(r.removeWhite(t),t=t.nextSibling):t=t.nextSibling;return e}};9==e.nodeType&&(e=e.documentElement);var n=r.toJson(r.toObj(r.removeWhite(e)),e.nodeName,"\t");return"{\n"+t+(t?n.replace(/\t/g,t):n.replace(/\t|\n/g,""))+"\n}"},e.json2xml=function(e,t){var r=function e(t,r,n){var i="";if(t instanceof Array)for(var a=0,s=t.length;a<s;a++)i+=n+e(t[a],r,n+"\t")+"\n";else if("object"==o(t)){var l=!1;for(var c in i+=n+"<"+r,t)"@"==c.charAt(0)?i+=" "+c.substr(1)+'="'+t[c].toString()+'"':l=!0;if(i+=l?">":"/>",l){for(var c in t)"#text"==c?i+=t[c]:"#cdata"==c?i+="<![CDATA["+t[c]+"]]>":"@"!=c.charAt(0)&&(i+=e(t[c],c,n+"\t"));i+=("\n"==i.charAt(i.length-1)?n:"")+"</"+r+">"}}else i+=n+"<"+r+">"+t.toString()+"</"+r+">";return i},n="";for(var i in e)n+=r(e[i],i,"");return t?n.replace(/\t/g,t):n.replace(/\t|\n/g,"")},e.wfsXmlToJsonDataArray=function(e,r){return function(e,r){var n,o=JSON.parse(e),i=[];if(!o||!o["wfs:FeatureCollection"])return;n=o["wfs:FeatureCollection"]["gml:featureMember"];if(!n)return;if(n&&null==n.length){for(var a in n)break;i.push(t(n[a]))}else for(var s=0;s<n.length;s++){for(var a in n[s])break;var l=t(n[s][a]);i.push(l)}return i}(this.xml2json(e,""))},e}.apply(t,[]))||(e.exports=n)},function(e,t,r){"use strict";var n,o;n=[r(37),r(38),r(482),r(483)],void 0===(o=function(e,t,r,n){return{AppEvent:e,AppEvents:t,Draggable:n}}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";!function(e){function t(e){return"[object Function]"==Object.prototype.toString.call(e)}function r(e){return e instanceof Promise}e.prototype.before=function(e){var r=this;return function(){return(!t(e)||!1!==e.apply(this,arguments))&&r.apply(this,arguments)}},e.prototype.after=function(e){var n=this;return function(){var o=n.apply(this,arguments);if(!1===o)return!1;if(t(e))if(r(o)){var i=this,a=arguments;o.then((function(){var t=[];for(var r in arguments)t.push(arguments[r]);t.push(a),e.apply(i,t)}))}else e.apply(this,arguments);return o}},e.prototype.around=function(e,n){var o=this;return function(){if(t(e)&&!1===e.apply(this,arguments))return!1;var i=o.apply(this,arguments);if(!1===i)return!1;if(t(n))if(r(i)){var a=this,s=arguments;i.then((function(){var e=[];for(var t in arguments)e.push(arguments[t]);e.push(s),n.apply(a,e)}))}else n.apply(this,arguments);return i}}}(Function)},function(e,t,r){"use strict";var n,o;n=[r(21),r(2)],void 0===(o=function(e,t){var r={TRANSFORM:function(){return this.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"])},testProp:function(e){for(var t=document.documentElement.style,r=0;r<e.length;r++)if(e[r]in t)return e[r];return!1},setPosition:function(e,r){e._pos=r,t.Browser().any3d?this.setTransform(e,r):(e.style.left=r[0]+"px",e.style.top=r[1]+"px")},getPosition:function(e){return e._pos||[0,0]},setTransform:function(e,r,n){var o=r||new Point(0,0);e.style[this.TRANSFORM()]=(t.Browser().ie3d?"translate("+o[0]+"px,"+o[1]+"px)":"translate3d("+o[0]+"px,"+o[1]+"px,0)")+(n?" scale("+n+")":"")}},n={extend:function(e){var t,r,n,o;for(r=1,n=arguments.length;r<n;r++)for(t in o=arguments[r])e[t]=o[t];return e},create:Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}()};!function(){function e(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var t=0;function r(e){var r=+new Date,n=Math.max(0,16-(r-t));return t=r+n,window.setTimeout(e,n)}var o=window.requestAnimationFrame||e("RequestAnimationFrame")||r,i=window.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};n.requestAnimFrame=function(e,t,n){if(!n||o!==r)return o.call(window,function(e,t){var r=Array.prototype.slice;if(e.bind)return e.bind.apply(e,r.call(arguments,1));var n=r.call(arguments,2);return function(){return e.apply(t,n.length?n.concat(r.call(arguments)):arguments)}}(e,t));e.call(t)},n.cancelAnimFrame=function(e){e&&i.call(window,e)}}();var o=e.extend({option:{clickTolerance:3},draggableStyle:{dragging:{cursor:"move"},defaults:{cursor:"default"}},initialize:function(r,n,o,i){e.setOptions(this,i),this._element=r,this._dragStartTarget=n||r,this.START=t.Browser().touch?"touchstart mousedown":"mousedown",this.END={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},this.MOVE={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},enable:function(){this._enabled||($(this._dragStartTarget).bind(this.START,{self:this},this._onDown),this._enabled=!0)},disable:function(){this._enabled&&(o._dragging===this&&this.finishDrag(),$(this._dragStartTarget).unbind(this.START,this._onDown),this._enabled=!1,this._moved=!1)},_onDown:function(e){var t=e.originalEvent,r=e.data.self;if(!t._simulated&&r._enabled&&(r._moved=!1,!(o._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o._dragging=r,r._moving)))){var n=t.touches?t.touches[0]:t;r._startPoint=[n.clientX,n.clientY],$(document).bind(r.MOVE[t.type],{self:r},r._onMove),$(document).bind(r.END[t.type],{self:r},r._onUp),r._dragStartTarget&&r._dragStartTarget.style&&(r._dragStartTarget.style.cursor=r.draggableStyle.dragging.cursor)}},_onMove:function(e){var t=e.originalEvent,o=e.data.self;if(!t._simulated&&o._enabled)if(t.touches&&t.touches.length>1)o._moved=!0;else{var i=t.touches&&1===t.touches.length?t.touches[0]:t,a=[i.clientX,i.clientY],s=o._startPoint,l=[a[0]-s[0],a[1]-s[1]];if((l[0]||l[1])&&!(Math.abs(l[0])+Math.abs(l[1])<o.options.clickTolerance)){if(t.preventDefault&&t.preventDefault(),!o._moved){o._moved=!0;var c=r.getPosition(o._element);o._startPos=[c[0]-l[0],c[1]-l[1]],o._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&o._lastTarget instanceof SVGElementInstance&&(o._lastTarget=o._lastTarget.correspondingUseElement)}o._newPos=[o._startPos[0]+l[0],o._startPos[1]+l[1]],o._moving=!0,n.cancelAnimFrame(o._animRequest),o._lastEvent=t,o._updatePosition()}}},_onUp:function(e){var t=e.originalEvent,r=e.data.self;console.log("up"),!t._simulated&&r._enabled&&(r.finishDrag(),r._dragStartTarget.style.cursor=r.draggableStyle.defaults.cursor)},_updatePosition:function(){r.setPosition(this._element,this._newPos)},setDragTarget:function(e){e&&(this._dragStartTarget=e)},getDragTarget:function(){return this._dragStartTarget},finishDrag:function(){for(var e in console.log("finishDrag"),this._lastTarget&&(this._lastTarget=null),this.MOVE)$(document).unbind(this.MOVE[e],this._onMove),$(document).unbind(this.END[e],this._onUp);this._moved&&this._moving&&n.cancelAnimFrame(this._animRequest),this._moving=!1,o._dragging=!1}});return o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(485),r(486),r(487),r(488),r(489),r(181),r(491)],void 0===(o=function(e,t,r,n,o,i,a){var s={};return s.ScreenShotComponent=e,s.SelectionComponent=n,s.AnimateComponent=r,s.MeasureComponent=o,s.TailedLabelComponent=i,s.BufferDrawComponent=a,s}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o;n=[r(15),r(2)],void 0===(o=function(e,t){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},shotMap:function(e){var r=document.getElementById(this.map.id);html2canvas(r,{onrendered:function(r){t.isFunction(e)&&e(r.toDataURL())},useCORS:!0})},screen:function(e){html2canvas.download(document.getElementById(this.map.options.targetId))},destroy:function(){e.prototype.destroy.call(this)}})}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(97),r(1)],void 0===(o=function(e,t,r){var n={PointNaturalDistribution:"PointNaturalDistribution",PointClusterDistribution:"PointClusterDistribution",PointClusterDistributionReduplicative:"PointClusterDistributionReduplicative",Statistics_Ratio_Ring:"Statistics_Ratio_Ring",Statistics_Total_Circle:"Statistics_Total_Circle",PointQuantityNaturalDistribution:"PointQuantityNaturalDistribution"},o=e.extend({options:{},initialize:function(t){e.prototype.initialize.call(this,t),this.changeVisualStyle(t)},addDispalyElements:function(e){this._layer.addElements(e)},updateData:function(e){this._layer.clear(),this._layer.addElements(e)},updateStatistics:function(e){n.Statistics_Ratio_Ring!=this.options.displayMode&&n.Statistics_Total_Circle!=this.options.displayMode||this._layer.updateStatistics(e)},setVisible:function(e){this._layer.setVisible(e)},getVisible:function(){return this._layer.getVisible()},changeVisualStyle:function(e){null!=this._layer&&(this.map.getMap().removeLayer(this._layer),this._layer.destroy()),this.options.displayMode=e.displayMode;var r=this,n={PointNaturalDistribution:function(e){var n=(new t.LayerFactory).createLayer(t.TYPES.ELEMENT_POINT_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:r.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig)});r.map.getMap().addLayer(n),r._layer=n},PointClusterDistribution:function(e){var n=(new t.LayerFactory).createLayer(t.TYPES.ELEMENT_POINT_PIXEL_CLUSTER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:r.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig)});r.map.getMap().addLayer(n),r._layer=n},PointClusterDistributionReduplicative:function(e){var n=new t.LayerFactory,o=jQuery.extend(!0,{},e.reduplicativeParam),i=n.createLayer(t.TYPES.ELEMENT_POINT_DUPLICATE,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:r.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig),spiderfyDistance:o.spiderfyDistance,spiderfyLevel:o.spiderfyLevel,coincidenceClusterHoverThreshold:o.coincidenceClusterHoverThreshold,coincidenceClusterWeight:o.coincidenceClusterWeight,coincidenceClusterMarkerSym:o.coincidenceClusterMarkerSym,coincidenceClusterTextSym:o.coincidenceClusterTextSym,showSpiderLeg:o.showSpiderLeg,spiderfyThreshold:o.spiderfyThreshold,circleRadius:o.circleRadius,spiderfyLegSym:o.spiderfyLegSym});r.map.getMap().addLayer(i),r._layer=i},Statistics_Ratio_Ring:function(e){var n=(new t.LayerFactory).createLayer(t.TYPES.RING_STATISTICS_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:r.map.getMap(),xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,showZero:e.showZero});r.map.getMap().addLayer(n),r._layer=n},Statistics_Total_Circle:function(e){var n=(new t.LayerFactory).createLayer(t.TYPES.PIE_STATISTICS_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:r.map.getMap(),xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,showZero:e.showZero});r.map.getMap().addLayer(n),r._layer=n},PointQuantityNaturalDistribution:function(e){var n=(new t.LayerFactory).createLayer(t.TYPES.FEATURE_POINT_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:r.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig)});r.map.getMap().addLayer(n),r._layer=n}};null!=n[e.displayMode]?n[e.displayMode](e):console.error(e.displayMode+"没有对应的处理方法！")},getLayer:function(){return this._layer},clear:function(){this._layer.clear()},hitTest:function(e,t){return this._layer.hitTest(e,t)},adjustExtent:function(){var e=this._layer.getLayerExtent(),t=new r.sfs.Envelope({minx:e[0],miny:e[1],maxx:e[2],maxy:e[3],spatialReference:this.map.spatialReference});this.map.getMap().pan(t,[5,5,5,5])},fullExtent:function(){this.adjustExtent()},destroy:function(){this._layer.clear(),this._layer.destroy(),e.prototype.destroy.call(this)}});return o.DisplayMode=n,o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(2),r(14),r(18),r(63),r(12),r(1)],void 0===(o=function(e,t,r,n,o,i,a){var s={timers:{},timerMethod:{},getTimer:function(e){var t=this;return this.timers[e]||(this.timerMethod[e]={},this.timers[e]=setInterval((function(){t.play(e)}),e)),this.timers.addTimerMothed=function(e,r,n,o,i){if(!t.timerMethod[e])throw new Error("指定的定时器方法不存在！");t.timerMethod[e][r]={fn:n,ctx:i,param:o}},this.timers.deleteTimerMethod=function(e,r){var n=!1;if(!t.timerMethod[e])throw new Error("指定的定时器方法不存在！");return t.timerMethod[e][r]&&(delete t.timerMethod[e][r],n=!0),n},this.timers.timerMethodsIsEmpty=function(e){return!!t.timerMethod&&(!!t.timerMethod[e]&&0==Object.keys(t.timerMethod[e]).length)},this.timers},clearTimer:function(e,t){if(!e[t])throw new Error("指定的定时器不存在！");window.clearInterval(e[t]),delete e[t]},play:function(e){if(Object.keys(this.timerMethod[e]).length>0){var t=this.timerMethod[e];for(var r in t)t[r].fn.call(t[r].ctx,t[r].param,t[r].fn)}}},l=e.extend({options:{},initialize:function(n){e.prototype.initialize.call(this,n);var o=this.map.getMap();this.options.layerId=this.options.layerId||t.newUUID32();var i=r.getLayerById(this.map,this.options.layerId);i||(i=new a.carto.ElementLayer({id:this.options.layerId,map:o}),o.addLayer(i)),this._layer=i,this._timerMap={},this._toolTipWare=new a.widget.TooltipWare({map:o}),this._differenceTimer={}},destroy:function(){for(var t in this._timerMap)this.clear(t);var r=this.map.getMap();this._layer.clear(),r.removeLayer(this._layer),e.prototype.destroy.call(this)}});return l.include({blinkIconMaker:function(e){if(e=e||{},!t.isArray(e.point)||2!=e.point.length)throw new Error("point参数错误！");if(e.process.length<1)throw new Error("process参数错误！");for(var r=this.map.getMap(),n=new a.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:r.spatialReference}),o=e.process,i=isNaN(e.interval)?200:parseFloat(e.interval),s=isNaN(e.cost)?3e3:parseFloat(e.cost),l=[],c=0,u=o.length;c<u;c++){var f=o[c],h=new a.sfs.PictureMarkerSymbol({source:f.source,width:f.width,height:f.height,offsetX:f.width/2,offsetY:f.height/2,opacity:1});l.push(h)}var p=0,d=t.newUUID(),y=new a.sfs.Element({id:d,geometry:n,symbol:l[p]});if(this._layer.add(y),e.tooltip){var m=jQuery.extend(!0,{},e.tooltip),g=m.html||"<div>test</div>";m.id=d,m.offset=m.offset||[10,-10],m.className=m.className||"g2-tooltip",m.layerId=this._layer.getLayerId();var v=new a.widget.Tooltip({id:m.id,anchor:n,content:g,layerId:m.layerId,offset:m.offset,className:m.className});this._toolTipWare.add(v)}var b=this,_=0,w=setInterval((function(){++p>=l.length&&(p%=l.length),y.symbol=l[p],b._layer.update(y,!0),(_+=i)>=s&&b.clear(d)}),i);return this._timerMap[d]=w,d},blinkVectorMarker:function(e){if(e=e||{},!t.isArray(e.point)||2!=e.point.length)throw new Error("参数错误！");var r=this.map.getMap(),o=new a.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:r.spatialReference}),i=e.style||"circle",s=isNaN(e.startSize)?3:parseFloat(e.startSize),l=isNaN(e.endSize)?20:parseFloat(e.endSize),c=isNaN(e.interval)?80:parseFloat(e.interval),u=isNaN(e.cost)?3e3:parseFloat(e.cost),f=l>s?1:-1,h=e.borderColor||{a:100,r:0,g:0,b:250},p=isNaN(e.borderWidth)?1:parseFloat(e.borderWidth),d=e.fillColor||{a:200,r:0,g:0,b:250},y=n.object2Color(h),m=n.object2Color(d),g=new a.sfs.SimpleMarkerSymbol({style:i,fillColor:m,borderColor:y,size:s,borderThickness:p}),v=t.newUUID(),b=new a.sfs.Element({id:v,geometry:o,symbol:g});if(this._layer.add(b),e.tooltip){var _=jQuery.extend(!0,{},e.tooltip),w=_.html||"<div>test</div>";_.id=v,_.offset=_.offset||[10,-10],_.className=_.className||"g2-tooltip",_.layerId=this._layer.getLayerId();var S=new a.widget.Tooltip({id:_.id,anchor:o,content:w,layerId:_.layerId,offset:_.offset,className:_.className});this._toolTipWare.add(S)}var L=this,x=0,P=setInterval((function(){b.symbol;var e=b.symbol.size;e+=f,b.symbol.size=e,L._layer.update(b,!0),(e-s)*(e-l)>=0&&(f*=-1),(x+=c)>=u&&L.clear(v)}),c);return this._timerMap[v]=P,v},rotationIconMaker:function(e){if(e){if(!t.isArray(e.point)||2!=e.point.length||!e.source)throw new Error("参数错误！");isNaN(e.width)||parseFloat(e.width),isNaN(e.height)||parseFloat(e.height);var r=isNaN(e.speed)?200:parseFloat(e.speed),n=360,o=this.map.getMap(),i=new a.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:o.spatialReference}),s=new a.sfs.PictureMarkerSymbol({source:e.source,rotation:n,width:e.width,height:e.height,opacity:1,offsetX:e.width/2,offsetY:e.height/2}),l=t.newUUID(),c=new a.sfs.Element({id:l,geometry:i,symbol:s});if(this._layer.add(c),e.tooltip){var u=jQuery.extend(!0,{},e.tooltip),f=u.html||"<div>test</div>";u.id=l,u.offset=u.offset||[10,-10],u.className=u.className||"g2-tooltip",u.layerId=this._layer.getLayerId();var h=new a.widget.Tooltip({id:u.id,anchor:i,content:f,layerId:u.layerId,offset:u.offset,className:u.className});this._toolTipWare.add(h)}var p=this,d=setInterval((function(){var e=p._layer.find(l);n-=20,e.symbol.rotation=n,p._layer.update(e,!0),0==n&&(n=360)}),r);return this._timerMap[l]=d,l}},iconMoveOnLine:function(e,r,n){if(!(e.pathGeojson&&e.source&&e.width&&e.height))throw new Error("参数错误！");var l=isNaN(e.speed)?2:parseFloat(e.speed),c=isNaN(e.lineStyle)?5:parseFloat(e.lineStyle),u=isNaN(e.lineWidth)?3:parseFloat(e.lineWidth),f=e.lineColor||{a:153,r:0,g:0,b:255},h=isNaN(e.interval)?80:parseFloat(e.interval),p=e.isRotate||!1,d=e.textIsRotate||!1,y=e.isShowLine,m={},g=e.tooltip||!1;null==y&&(y=!0),m="string"==typeof e.pathGeojson?i.getWktReader().read(e.pathGeojson):i.getGeoJSONReader().read(e.pathGeojson);for(var v=i.getGeoJSONWriter().write(m),b=new a.sfs.SimpleLineSymbol({style:c,width:u,color:new a.sfs.Color(f)}),_=new a.sfs.Polyline({spatialReference:this.map.getMap().spatialReference}),w=new a.sfs.Path({spatialReference:this.map.getMap().spatialReference}),S=0;S<v.coordinates.length;S++){var L=new a.sfs.Point({x:v.coordinates[S][0],y:v.coordinates[S][1],spatialReference:this.map.getMap().spatialReference});w.addPoint(L)}if(_.addGeometry(w),0==i.measureLength(_))throw new Error("线起点终点不能重合！");var x=t.newUUID(),P=new a.sfs.Element({id:x,geometry:_,symbol:b});y&&this._layer.add(P);var E=o.getPointOnPath({pathGeometry:v,pathSrid:this.map.getMap().spatialReference,distance:0}),T=t.newUUID(),C=new a.sfs.Point({x:E.point[0],y:E.point[1],spatialReference:this.map.getMap().spatialReference}),A=new a.sfs.PictureMarkerSymbol({source:e.source,width:e.width,height:e.height,offsetX:e.width/2,offsetY:e.height/2,opacity:1}),k=new a.sfs.TextSymbol({text:e.text||"",fontSize:e.size||15,offsetX:e.offsetX||0,offsetY:e.offsetY||-21,foreground:new a.sfs.Color(e.foreground)||new a.sfs.Color({a:255,r:255,g:0,b:0}),borderColor:new a.sfs.Color(e.borderColor)||new a.sfs.Color({a:255,r:255,g:0,b:0}),borderThickness:e.borderThickness||.1,fontFamilyName:e.fontFamilyName,fontWeight:e.fontWeight||1,textAlign:e.textAlign}),R=new a.sfs.CurrencySymbol({markerSymbol:A,textSymbol:k}),O=new a.sfs.Element({id:T,geometry:C,symbol:R});if(p&&(R.markerSymbol.rotation=E.point[2]),d&&(R.textSymbol.rotation=E.point[2]),this._layer.add(O),g){var I=(g=jQuery.extend(!0,{},g)).html||"<div>test</div>";g.id=T,g.offset=g.offset||[10,-10],g.className=g.className||"g2-tooltip",g.layerId=this._layer.getLayerId();var M=new a.widget.Tooltip({id:g.id,anchor:C,content:I,layerId:g.layerId,offset:g.offset,className:g.className});this._toolTipWare.add(M);var F=jQuery("[animateId="+T+"]").eq(0).parent().parent().parent();g.container=F,g.startPoint=C}var D=this,j={geomtry:v,pointId:T,lineId:x,interval:h,step:1,speed:l,rotation:0,tooltip:g,callback:r,context:n},G=s.getTimer(h);return this[x+"draw"]=function(e){var r=o.getPointOnPath({pathGeometry:e.geomtry,pathSrid:D.map.getMap().spatialReference,distance:e.interval*e.step/1e3*e.speed});function n(n){var o,i=D._layer.find(e.pointId);if(t.isEmptyObject(i)){console.log("地图点已被清除");var l=s.getTimer(e.interval);l.deleteTimerMethod(e.interval,e.lineId+"draw");l.timerMethodsIsEmpty(e.interval)&&s.clearTimer(l,h)}else{if(n)o=new a.sfs.Point({x:r.point[0],y:r.point[1],spatialReference:D.map.getMap().spatialReference});else{var c=e.geomtry.coordinates;o=new a.sfs.Point({x:c[c.length-1][0],y:c[c.length-1][1],spatialReference:D.map.getMap().spatialReference})}if(i.geometry=o,r.point&&(e.rotation=r.point[2]),p&&(i.symbol.markerSymbol.rotation=e.rotation),d&&(i.symbol.textSymbol.rotation=e.rotation),D._layer.remove(i),D._layer.add(i),e.tooltip)if(t.isFunction(D._toolTipWare.update)){var u={};u.id=e.tooltip.id,u.anchor=o,D._toolTipWare.update(u)}else{var f=D._toolTipWare.IdContainer[e.tooltip.id];f&&f.setPosition([o.x,o.y])}e.step+=1}}r.arrival?(n(!1),t.isFunction(e.callback)&&e.callback.call(e.context,e.lineId+","+e.pointId,h)):n(!0)},G.addTimerMothed(h,x+"draw",this[x+"draw"],j),x+","+T},lineGradient:function(e){if(!e.pathGeojson)throw new Error("参数错误！");var r=isNaN(e.lineStyle)?5:parseFloat(e.lineStyle),n=isNaN(e.lineWidth)?3:parseFloat(e.lineWidth),l=e.lineColor||{a:153,r:0,g:0,b:255},c=isNaN(e.interval)?50:parseFloat(e.interval),u=isNaN(e.coverPointNum)?4:e.coverPointNum,f={};f="string"==typeof e.pathGeojson?i.getWktReader().read(e.pathGeojson):i.getGeoJSONReader().read(e.pathGeojson);for(var h=i.getGeoJSONWriter().write(f),p=new a.sfs.SimpleLineSymbol({style:r,width:n,color:new a.sfs.Color(l)}),d=new a.sfs.Polyline({spatialReference:this.map.getMap().spatialReference}),y=new a.sfs.Path({spatialReference:this.map.getMap().spatialReference}),m=0;m<h.coordinates.length;m++){var g=new a.sfs.Point({x:h.coordinates[m][0],y:h.coordinates[m][1],spatialReference:this.map.getMap().spatialReference});y.addPoint(g)}d.addGeometry(y);var v=t.newUUID(),b=new a.sfs.Element({id:v,geometry:d,symbol:p});this._layer.add(b);var _=this,w=new a.carto.ElementLayer({id:v,map:this.map.getMap()});this.map.getMap().addLayer(w);var S=s.getTimer(c),L={lineArr:[],step:1,layer:w,geomtry:h,interval:c,coverPointNum:u,speed:1e5,lineId:v,polylineElement:b,_layer:this._layer,lineStyle:r,lineWidth:n};function x(){return"#ff"+Math.floor(180*Math.random()+10)+Math.floor(100*Math.random()+10)}return this[v+"draw"]=function(e){if(e.lineArr.length>0){for(var r=0;r<e.lineArr.length;r++)w.remove(e.lineArr[r]);e.lineArr.length=0}var n=e.interval/1e3*e.step;e.step=e.step+1;for(var i=[],s=!1,l=e.geomtry.coordinates,c=1;c<e.coverPointNum;c++){if(n-(f=e.interval*c/1e3)>=0){var u=o.getPointOnPath({pathGeometry:e.geomtry,pathSrid:_.map.getMap().spatialReference,distance:n*e.speed-f*e.speed});if(u.arrival&&!s){e._layer.find(e.lineId)&&e._layer.remove(e.polylineElement),u.point=[l[l.length-1][0],l[l.length-1][1],0],u.color=a.sfs.Color.fromHex(x()),u.point&&i.push(u),s=!0;continue}u.color=a.sfs.Color.fromHex(x()),u.point&&i.push(u)}}for(var f=i.length-1;f>0;f--)if(i[f-1]){var h=new a.sfs.Polyline({spatialReference:_.map.getMap().spatialReference}),p=new a.sfs.Path({spatialReference:_.map.getMap().spatialReference}),d=new a.sfs.SimpleLineSymbol({style:e.lineStyle,width:e.lineWidth,color:i[f].color}),y=new a.sfs.Point({x:i[f].point[0],y:i[f].point[1],spatialReference:_.map.getMap().spatialReference});if(!i[f-1].point)break;var m=new a.sfs.Point({x:i[f-1].point[0],y:i[f-1].point[1],spatialReference:_.map.getMap().spatialReference});p.addPoint(y),p.addPoint(m),h.addGeometry(p);var g=new a.sfs.Element({id:t.newUUID(),geometry:h,symbol:d});e.lineArr.push(g),e.layer.add(g)}try{i[i.length-1].point[0]==l[l.length-1][0]&&i[i.length-1].point[1]==l[l.length-1][1]&&(e.step=0)}catch(e){}},S.addTimerMothed(c,v+"draw",this[v+"draw"],L),v},loadGifPicture:function(e){if(!e.source||!e.point)throw new Error("参数错误！");var r=t.newUUID(),n=e.offset||[-32,-32],o='<img id="'+r+'" src="'+e.source+'"/>',i=new a.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:this.map.getMap().spatialReference}),s=new a.widget.Tooltip({id:r,anchor:i,content:o,layerId:this._layer.id,offset:n});return this._toolTipWare.add(s),r},updateGifPicture:function(e){if(!e.id||!e.source)throw new Error("参数错误！");$("#"+e.id).attr("src",e.source)},clear:function(e,t){if((e=e.split(",")||[]).length<1)throw new Error("参数错误！");for(var n=0;n<e.length;n++){var o=r.getLayerById(this.map,e[n]);if(o&&this.map.removeLayer(o),t){var i=s.getTimer(t);i.deleteTimerMethod(t,e[n]+"draw");i.timerMethodsIsEmpty(t)&&s.clearTimer(i,t)}try{clearInterval(this._timerMap[e[n]])&&delete this._timerMap[e[n]]}catch(e){}var a=this._layer.find(e[n]);a&&(this._layer.remove(a),this._toolTipWare.remove(e[n]))}}}),l.include({pointFlowOnLine:function(e){if(!e.data)throw new Error("传入参数错误");this.allCanvas||(this.allCanvas={});var t=this._initParam(e,this.map.getMap()),r=this._createBaseCanvas()+","+this._createAnimationCanvas();return this.allCanvas[r]=t,this._drawCanvas(r),this._initMapEvents(r),r},_initParam:function(e,t){var r={};return r.markerRadius=isNaN(e.markerRadius)?2:parseFloat(e.markerRadius),r.markerColor=e.markerColor,r.lineType=e.lineType||"solid",r.lineWidth=isNaN(e.lineWidth)?2:parseFloat(e.lineWidth),r.colors=e.colors||["red","popup","#EDCC72","#E2F194","#94E08A","#4ECDA5","#F8AB60","green"],r.moveRadius=isNaN(e.moveRadius)?3:parseFloat(e.moveRadius),r.fillColor=e.fillColor||["red"],r.shadowBlur=isNaN(e.shadowBlur)?10:parseFloat(e.shadowBlur),r.data=e.data,r.deltaAngle=isNaN(e.deltaAngle)?0:parseFloat(e.deltaAngle),r.interval=isNaN(e.interval)?50:parseFloat(e.interval),this.canvasMap=t,this.mapViewWidth=t.getViewSize()[0],this.mapViewHeight=t.getViewSize()[1],r},_createBaseCanvas:function(){var e=document.createElement("canvas");e.id="canvas-"+t.newUUID(),this[e.id]=e,$(".ol-overlaycontainer-stopevent").prepend(e);var r=e.getContext("2d");return e.style.cssText="pointer-events:none;position:absolute;left:0;top:0;z-index:0;",e.width=this.mapViewWidth,e.height=this.mapViewHeight,e.style.width=e.width+"px",e.style.height=e.height+"px",this._adjustRatio(r),e.id},_createAnimationCanvas:function(){var e=document.createElement("canvas");e.id="canvas-"+t.newUUID(),this[e.id]=e,$(".ol-overlaycontainer-stopevent").prepend(e);var r=e.getContext("2d");return e.style.cssText="pointer-events:none;position:absolute;left:0;top:0;z-index:1;",e.width=this.mapViewWidth,e.height=this.mapViewHeight,e.style.width=e.width+"px",e.style.height=e.height+"px",this._adjustRatio(r),e.id},_adjustRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,r=(window.devicePixelRatio||1)/t,n=e.canvas.width,o=e.canvas.height;e.canvas.width=n*r,e.canvas.height=o*r,e.canvas.style.width=n+"px",e.canvas.style.height=o+"px",e.scale(r,r)},_drawCanvas:function(e){var t=this;this._clearCanvasContent(e),setTimeout((function(){t._drawBaseLine(e)}),1),this.allCanvas[e].canvasInterval=setInterval((function(){t._drawAnimationLine(e)}),t.allCanvas[e].interval)},_drawAnimationLine:function(e){var t=this[e.split(",")[1]].getContext("2d");if(t){t.fillStyle="rgba(0,0,0,0.9)";var r=t.globalCompositeOperation;t.globalCompositeOperation="destination-in",t.fillRect(0,0,this.mapViewWidth,this.mapViewHeight),t.globalCompositeOperation=r;for(var n=0;n<this.allCanvas[e].markLines.length;n++){this.allCanvas[e].markLines[n].drawMoveCircle(t,e,n)}}},_drawBaseLine:function(e){var t=this[e.split(",")[0]].getContext("2d");t&&(this._addMarkLine(e),t.clearRect(0,0,this.mapViewWidth,this.mapViewHeight),this.allCanvas[e].markLines.forEach((function(r){r.drawMarker(t,e),r.drawLinePath(t,e)})))},_initMapEvents:function(e){var t=this,r=function(r,n,o,i,a,s,l){t.allCanvas[e].canvasInterval&&t._drawCanvas(e)};t.map.listen("mousedown",(function(e,n,o,i,a,s,l){t.map.listen("mousemove",r)}));t.map.listen("mouseup",(function(e,n,o,i,a,s,l){t.map.off("mousemove",r)}));t.map.listen("resolutionchanged",(function(r,n,o){t.allCanvas[e].canvasInterval&&t._drawCanvas(e)}));t.map.listen("extentchanged",(function(r,n,o,i){t.allCanvas[e].canvasInterval&&t._drawCanvas(e)}))},_addMarkLine:function(e){var t=this;function r(e){this.city=e.city,this.location=e.location,this.color=e.color}function n(e){this.from=e.from,this.to=e.to,this.id=e.id}this.allCanvas[e].markLines=[],this.allCanvas[e].data.forEach((function(o,i){t.allCanvas[e].markLines.push(new n({id:i,from:new r({city:o.from.city,location:new a.sfs.Point({x:o.from.lnglat[0],y:o.from.lnglat[1],spatialReference:t.map.getMap().spatialReference}),color:t.allCanvas[e].colors[i]}),to:new r({city:o.to.city,location:new a.sfs.Point({x:o.to.lnglat[0],y:o.to.lnglat[1],spatialReference:t.map.getMap().spatialReference}),color:t.allCanvas[e].colors[i]})}))})),r.prototype.draw=function(e,r){var n=t.canvasMap.getPixelFromCoordinate([this.location.x,this.location.y]);n&&(e.save(),e.beginPath(),e.fillStyle=this.color||"red",e.arc(n[0],n[1],t.allCanvas[r].markerRadius,0,2*Math.PI,!0),e.closePath(),e.fill(),e.textAlign="center",e.textBaseline="middle",e.font="12px Microsoft YaHei",e.fillStyle=this.color||"red",e.fillText(this.city,n[0],n[1]-10),e.restore())},n.prototype.getPointList=function(e,t,r){var n=[[e[0],e[1]],[t[0],t[1]]],o=n[1][0],i=n[1][1];return n[3]=[o,i],n[1]=this.getOffsetPoint(n[0],n[3],r),n[2]=this.getOffsetPoint(n[3],n[0],r),(n=this.smoothSpline(n,!1))[n.length-1]=[o,i],n},n.prototype.getOffsetPoint=function(e,r,n){var o,i,a,s=this.getDistance(e,r)/3,l=[e[0],e[1]],c=t.allCanvas[n].deltaAngle;if(e[0]!=r[0]&&e[1]!=r[1]){var u=(r[1]-e[1])/(r[0]-e[0]);o=Math.atan(u)}else o=e[0]==r[0]?(e[1]<=r[1]?1:-1)*Math.PI/2:0;return e[0]<=r[0]?(o-=c,i=Math.round(Math.cos(o)*s),a=Math.round(Math.sin(o)*s),l[0]+=i,l[1]+=a):(o+=c,i=Math.round(Math.cos(o)*s),a=Math.round(Math.sin(o)*s),l[0]-=i,l[1]-=a),l},n.prototype.smoothSpline=function(e,t){for(var r=e.length,n=[],o=0,i=1;i<r;i++)o+=this.getDistance(e[i-1],e[i]);var a=o/2;a=a<r?r:a;for(i=0;i<a;i++){var s,l,c,u=i/(a-1)*(t?r:r-1),f=Math.floor(u),h=u-f,p=e[f%r];t?(s=e[(f-1+r)%r],l=e[(f+1)%r],c=e[(f+2)%r]):(s=e[0===f?f:f-1],l=e[f>r-2?r-1:f+1],c=e[f>r-3?r-1:f+2]);var d=h*h,y=h*d;n.push([this.interpolate(s[0],p[0],l[0],c[0],h,d,y),this.interpolate(s[1],p[1],l[1],c[1],h,d,y)])}return n},n.prototype.interpolate=function(e,t,r,n,o,i,a){var s=.5*(r-e),l=.5*(n-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*i+s*o+t},n.prototype.getDistance=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},n.prototype.drawMarker=function(e,t){this.from.draw(e,t),this.to.draw(e,t)},n.prototype.drawLinePath=function(e,r){var n=t.canvasMap.getPixelFromCoordinate([this.from.location.x,this.from.location.y]),o=t.canvasMap.getPixelFromCoordinate([this.to.location.x,this.to.location.y]);if(n&&o){var i=this.path=this.getPointList(n,o,r),a=i.length;if(e.save(),e.beginPath(),e.lineWidth=t.allCanvas[r].lineWidth,e.strokeStyle=t.allCanvas[r].markerColor||t.allCanvas[r].colors[this.id],e.shadowBlur=t.allCanvas[r].shadowBlur,t.allCanvas[r].lineType&&"solid"!=t.allCanvas[r].lineType){if("dashed"==t.allCanvas[r].lineType||"dotted"==t.allCanvas[r].lineType)for(s=1;s<a;s+=2)e.moveTo(i[s-1][0],i[s-1][1]),e.lineTo(i[s][0],i[s][1])}else{e.moveTo(i[0][0],i[0][1]);for(var s=0;s<a;s++)e.lineTo(i[s][0],i[s][1])}e.stroke(),e.restore(),this.step=0}},n.prototype.drawMoveCircle=function(e,r,n){var o=t.canvasMap.getPixelFromCoordinate([this.from.location.x,this.from.location.y]),i=t.canvasMap.getPixelFromCoordinate([this.to.location.x,this.to.location.y]);if(o&&i){var a=this.path||this.getPointList(o,i,r);e.save(),e.fillStyle=t.allCanvas[r].fillColor[n]||"red",e.shadowColor=t.allCanvas[r].fillColor[n]||"red",e.shadowBlur=t.allCanvas[r].shadowBlur,e.beginPath(),this.step+=1,a[this.step]||(this.step=0),e.arc(a[this.step][0],a[this.step][1],t.allCanvas[r].moveRadius,0,2*Math.PI,!0),e.fill(),e.closePath(),e.restore(),this.step+=1}}},_clearCanvasContent:function(e){clearInterval(this.allCanvas[e].canvasInterval),this.allCanvas[e].canvasInterval=null;var t=e.split(",");this[t[0]].getContext("2d").clearRect(0,0,this.mapViewWidth,this.mapViewHeight),this[t[1]].getContext("2d").clearRect(0,0,this.mapViewWidth,this.mapViewHeight)},clearFlowAnimation:function(e){var r=this;if(e)o(e);else if(!t.isEmptyObject(this.allCanvas))for(var n in this.allCanvas)o(n);function o(e){clearInterval(r.allCanvas[e].canvasInterval),r.allCanvas[e].canvasInterval=null;var t=e.split(",");r[t[0]].remove(),r[t[1]].remove(),delete r.allCanvas[e]}}}),l}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(14),r(2),r(1)],void 0===(o=function(e,t,r,n){var o=e.extend({options:{},initialize:function(o){e.prototype.initialize.call(this,o);var i=this.map.getMap();this.options.selectionLayer=this.options.selectionLayer||r.newUUID32();var a=t.getLayerById(this.map,this.options.selectionLayer);a||(a=new n.carto.ElementLayer({id:this.options.selectionLayer,map:i}),i.addLayer(a)),this._layer=a,this._matchingLayer=this.options.matchingLayer},destroy:function(){this.map.getMap().removeLayer(this._layer),e.prototype.destroy.call(this)}});return o.include({pointMatchingElement:function(){var e=this,t=this._matchingLayer;t.length>0&&this.map.listen("click",(function(r){for(var n=0;n<t.length;n++){var o=t[n].hitTest(r.screenX,r.screenY);if(o){o.layer=t[n];var i=o.element;e.fire("pointMatchingElement",i)}}}))},squareMatchingElement:function(e){var r,n,o,i,a,s=this;this.map.getMap().stopDragPan(),this.map.getMap().stopMouseWheelZoom(),this._mapMousemove=function(e){o=e.mapX,i=e.mapY;e={startX:r,startY:n,endX:o,endY:i};a=s._drawSquare(e)},this._mapMousedown=function(e){r=e.mapX,n=e.mapY,s.map.listen("mousemove",s._mapMousemove)},this._mapMouseup=function(r){s.map.off("mousedown",s._mapMousedown),s.map.off("mousemove",s._mapMousemove),s.map.off("mouseup",s._mapMouseup),s.map.resumeDragPan(),s.map.resumeMouseWheelZoom();var n=t.selectElementOnMap(a.geometry,s._matchingLayer,e);s.fire("squareMatchingElement",n)},this.map.listen("mouseup",this._mapMouseup),this.map.listen("mousedown",this._mapMousedown)},cancelSelection:function(){this.map.off("mousedown",self._mapMousedown),this.map.off("mousemove",self._mapMousemove),this.map.off("mouseup",self._mapMouseup),this.map.resumeDragpan(),this.map.resumeMouseWheelZoom()},clearSelection:function(){this._layer.clear()}}),o.include({_drawSquare:function(e){var t,r=new n.sfs.Point({x:e.startX,y:e.startY,spatialReference:this.map.spatialReference}),o=new n.sfs.Point({x:e.endX,y:e.startY,spatialReference:this.map.spatialReference}),i=new n.sfs.Point({x:e.endX,y:e.endY,spatialReference:this.map.spatialReference}),a=new n.sfs.Point({x:e.startX,y:e.endY,spatialReference:this.map.spatialReference}),s=new n.sfs.SimpleFillSymbol({fillColor:n.sfs.Color.fromHex("#44ffffff"),borderColor:n.sfs.Color.fromHex("#000"),borderThickness:1,style:5}),l=new n.sfs.Ring({spatialReference:this.map.spatialReference}),c=new n.sfs.Polygon({spatialReference:this.map.spatialReference});return l.addPoint(r),l.addPoint(o),l.addPoint(i),l.addPoint(a),l.addPoint(r),c.addGeometry(l),this._layer.find("selectSquare")?((t=this._layer.find("selectSquare")).geometry=c,this._layer.remove(t),this._layer.add(t)):(t=new n.sfs.Element({id:"selectSquare",geometry:c,symbol:s}),this._layer.add(t)),t}}),o}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(11),r(490),r(2),r(18),r(12),r(1)],void 0===(o=function(e,t,r,n,o,i){var a=e.extend({options:{layerId:"measure-layer",showTipLink:!0,symbols:{line:{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},borderThickness:2,opacity:1}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},fillColor:{a:50,r:200,g:0,b:0},borderThickness:2,opacity:1}},node:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{a:200,r:200,g:0,b:0},fillColor:{a:250,r:255,g:255,b:255},borderThickness:2,size:4}},delete:{type:"PictureMarkerSymbol",options:{source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAIAAACQKrqGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAb0lEQVR42mNYfuABHB28sxOIjtzds+bwQ2RxCGKAUP8ZGPAghFIQHz8Aq0ZSCjEDVQVcCptSuGpkLrpSZGkMbdjciqmOYqXEOoAEbxEMLGBMEhMFQGUMkHjHH7EQNQxfP38AojMPjx6+uxsihAsBAMBJhSJg1b4KAAAAAElFTkSuQmCC",width:14,height:14,opacity:1}}},styleName:["emap-measure-node-tooltip","emap-measure-tooltip"],lengthTipFn:function(e,t){isNaN(t)||(t=(t/1e3).toFixed(2));var r={start:function(){return"起点"},node:function(e){return e+"公里"},end:function(e){return"总长:"+e+"公里"}},n=r[e];if("[object Function]"==Object.prototype.toString.call(n))return r[e](t)},areaTipFn:function(e,t){return"周长:"+(e=(e/1e3).toFixed(2))+"公里 <br/>面积:"+(t=(t/1e6).toFixed(2))+"平方公里"}},initialize:function(t){e.prototype.initialize.call(this,t),this._measuringTool=null,this._measuringObj=null,this._measures={},this._initialize(),this.map.listen("click",this._clickHandler,this)},destroy:function(){this.clear(),this.map.removeLayer(this._drawLayer),this.map.removeLayer(this._measureLayer),this.map.off("click",this._clickHandler),e.prototype.destroy.call(this)}});return a.include({_initialize:function(){var e=this.map.getLayerById(this.options.layerId+"-draw");e||(e=new i.carto.ElementLayer({id:this.options.layerId+"-draw"}),this.map.addLayer(e));var t=this.map.getLayerById(this.options.layerId);t||(t=new i.carto.ElementLayer({id:this.options.layerId}),this.map.addLayer(t)),this._drawLayer=e,this._measureLayer=t,this._toolTipWare=new i.widget.TooltipWare({map:this.map}),this._nodeSymbol=n.object2Symbol(this.options.symbols.node.type,this.options.symbols.node.options),this._deleteSymbol=n.object2Symbol(this.options.symbols.delete.type,this.options.symbols.delete.options),this._createTools()},_clickHandler:function(e){var t=e.screenX,r=e.screenY,n=this._measureLayer.hitTest(t,r);if(n&&"_measure_id"in n.element){var o=this._measures[n.element._measure_id];this._clearMeasure(o)}},_clearMeasuring:function(){this._drawLayer.clear(),this._measuringTool&&delete this._measuringTool._measure_id,this._measuringTool=null,this._measuringObj&&this._clearMeasure(this._measuringObj),this._measuringObj=null,this._ellipseElement=null,delete this._ellipseElement},_clearMeasure:function(e){if(r.isObject(e)){var t=e.element,n=e.nodes,o=e.tooltips,i=e.deleteEle,a=e.linkEle;t&&this._measureLayer.remove(t),i&&this._measureLayer.remove(i),a&&this._measureLayer.remove(a);for(var s=0,l=n.length;s<l;s++)n[s]&&this._measureLayer.remove(n[s]);for(s=0,l=o.length;s<l;s++)this._toolTipWare.remove(o[s].id)}}}),a.include({measureLength:function(){this.cancel(),this._measuringTool=this._lineTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureArea:function(){this.cancel(),this._measuringTool=this._polygonTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureCircle:function(){this.cancel(),this._measuringTool=this._circleTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureEllipse:function(){this.cancel(),this._measuringTool=this._ellipseTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},finish:function(){if(!this._measuringTool)throw new Error("当前无测量！");try{this._measuringTool.onEndDraw()}catch(e){throw new Error("结束异常！error="+e.message)}},cancel:function(){this._noopTool.onClick(),this._clearMeasuring()},clear:function(){this._drawLayer.clear(),this._measureLayer.clear(),this._toolTipWare.clear()}}),t.extend(a,"_measure_id"),a}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(2),r(18),r(12),r(1)],void 0===(o=function(e,t,r,n,o){return{extend:function(e,i){var a="NoopTool";e.include({_createTools:function(){var e=this.options.symbols,t=r.object2Symbol(e.line.type,e.line.options),n=r.object2Symbol(e.polygon.type,e.polygon.options),i={map:this.map,spatialRef:{srid:this.map.spatialReference},tooltipWare:this._toolTipWare},s=new o.sfs.Path({spatialReference:this.map.spatialReference}),l=new o.sfs.Polyline({spatialReference:this.map.spatialReference});l.addGeometry(s),this._polylineTemplate=new o.sfs.Element({geometry:l,symbol:t}),this._lineTool=new o.draw.DrawTool({id:"measureLineTool",cursor:"crosshair",templateElement:this._polylineTemplate.copy(),drawLayer:this._drawLayer}),this._extendLineTool(this._lineTool),this._lineTool.onCreate(i);var c=new o.sfs.Ring({spatialReference:this.map.spatialReference}),u=new o.sfs.Polygon({spatialReference:this.map.spatialReference});u.addGeometry(c),this._polygonTemplate=new o.sfs.Element({geometry:u,symbol:n}),this._polygonTool=new o.draw.DrawTool({id:"measurePolygonTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendPolygonTool(this._polygonTool),this._polygonTool.onCreate(i),this._circleTool=new o.draw.DrawTool({id:"measureCircleTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendCircleTool(this._circleTool),this._circleTool.onCreate(i),this._ellipseTool=new o.draw.DrawTool({id:"measureEllipseTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendEllipseTool(this._ellipseTool),this._ellipseTool.onCreate(i),this._noopTool=new o.interact.NoopTool({id:a,cursor:"pointer"}),this._noopTool.onCreate(i)},_extendLineTool:function(e){var r=this;function n(e,r,n,a,s,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:s,y:l,spatialReference:this.map.spatialReference}),p=this._lineTool.drawElement.geometry.paths[0].points.slice(f.points.length);"ontouchend"in document?0===f.points.length?p=p.slice(0,1).concat(p.slice(2)):1===f.points.length&&(p=p.slice(1)):p=p.slice(0,p.length-1);for(var d=0,y=p.length;d<y;d++){h=p[d];var m=this._addNodeEle(u,h,this._nodeSymbol);f.nodes.push(m),f.points.push(h);var g,v,b=this._getStyleName(0),_=this._measureLayer.id;1==f.points.length?g=this.options.lengthTipFn("start"):(v=this._measurePolyline(f.points),g=this.options.lengthTipFn("node",v));var w=new o.widget.Tooltip({id:t.newUUID32(),anchor:h,content:g,layerId:_,offset:[10,0],className:b});f.tooltips.push(w),this._toolTipWare.add(w)}}function a(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r);if(n.points.length<2)throw new Error("距离测量至少两个点！");e.geometry=this._constructGeometry("polyline",n.points);var a=n.tooltips.splice(n.tooltips.length-1,1)[0];this._toolTipWare.remove(a.id);var l=this._measureLayer.id,c=this._getStyleName(1),u=this._measurePolyline(n.points),f=this.options.lengthTipFn("end",u),h=s.call(this,n),p=new o.widget.Tooltip({id:t.newUUID32(),anchor:a.anchor,content:f,layerId:l,offset:[10,h[1]],className:c});n.tooltips.push(p),this._toolTipWare.add(p),this._deleteSymbol.offsetX=h[0],this._deleteSymbol.offsetY=h[1];var d=new o.sfs.Element({geometry:a.anchor,symbol:this._deleteSymbol});d[i]=r,this._measureLayer.add(d),n.deleteEle=d,this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()}function s(e){var t=this.options.symbols.delete.options,r=t.width,n=t.height,o=t.offsetX,i=t.offsetY,a=e.points;if(isNaN(o)&&a.length>1){var s=a[a.length-1],l=a[a.length-2];o=s.x>=l.x?-5:r+5}return isNaN(i)&&(i=n/2),[o,i]}e.onMouseUp=function(){n.apply(r,arguments)},e.onEndDraw=function(){a.apply(r,arguments)}},_extendPolygonTool:function(e){var r=this;function n(e,t,r,n,a,s,l){var c=this._measuringTool[i],u=this._getMeasuring(c),f=new o.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference}),h=this._polygonTool.drawElement.geometry.shell.points;h.length>2&&(f=h[h.length-3]);var p=this._addNodeEle(c,f,this._nodeSymbol);u.nodes.push(p),u.points.push(f)}function a(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r);if(n.points.length<3)throw new Error("多边形测量至少三个点！");e.geometry=this._constructGeometry("polygon",n.points);var a=this._measurePolygon(n.points),s=this._getStyleName(1),l=this._measureLayer.id,c=[0,0],u=this.options.areaTipFn.apply(window,a),f=e.geometry.getBaryCenter(),h=new o.sfs.Point(f),p=new o.widget.Tooltip({id:t.newUUID32(),anchor:h,content:u,layerId:l,offset:c,className:s});n.tooltips.push(p),this._toolTipWare.add(p);c=this._caculateDeleteMarkerOffset(n);this._deleteSymbol.offsetX=c[0],this._deleteSymbol.offsetY=c[1];var d=n.points[n.points.length-1],y=new o.sfs.Element({geometry:d,symbol:this._deleteSymbol});y[i]=r,this._measureLayer.add(y),n.deleteEle=y,this._addLinkEle(n,h,d),this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()}e.onMouseUp=function(){n.apply(r,arguments)},e.onEndDraw=function(){a.apply(r,arguments)}},_extendCircleTool:function(e){var t=this;function r(e,t,r,n,a,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:a,y:l,spatialReference:this.map.spatialReference});0==f.points.length?f.points.push(h):(s.call(this,f,h),this._onCircleEllipseEndDraw.call(this))}function a(e,t,r,n,a,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:a,y:l,spatialReference:this.map.spatialReference});s.call(this,f,h)}function s(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var r=e.points,i=r[0],a=r[1],s=this.map.getPixelFromCoordinate([i.x,i.y]),l=this.map.getPixelFromCoordinate([a.x,a.y]),c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2));if(0==parseFloat(c).toFixed(6))return;for(var u=n.getCirclePonits({center:s,radius:c,count:128,spatialReference:3857}),f=new o.sfs.Ring,h=0,p=u.length;h<p;h++){var d=u[h],y=this.map.getCoordinateFromPixel(d);f.addPoint(new o.sfs.Point({x:y[0],y:y[1]}))}var m=this._drawLayer.elements[0],g=m.geometry;g.removeAllGeometry(),g.addGeometry(f),this._drawLayer.update(m)}}e.onMouseUp=function(){r.apply(t,arguments)},e.onMouseMove=function(){a.apply(t,arguments)},e.onEndDraw=function(){t._onCircleEllipseEndDraw.apply(t,arguments)}},_extendEllipseTool:function(e){var r=this;function n(e,t,r,n,a,c,u){var f=this._measuringTool[i],h=this._getMeasuring(f),p=new o.sfs.Point({x:a,y:c,spatialReference:this.map.spatialReference});0==h.points.length?(h.points.push(p),this._ellipseElement=s.call(this,{}),this._ellipseElement.plot.addControlPoint(p)):(l.call(this,h,p),this._onCircleEllipseEndDraw.call(this))}function a(e,t,r,n,a,s,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference});l.call(this,f,h)}function s(e){var r=new o.plot.EllipseAlgorithm({}),n=new o.sfs.AttributeSet,i=new o.sfs.PlotElement({id:t.newUUID32(),kind:"ellipseTemplate",algorithm:r,attributeSet:n}),a=new o.sfs.Element({geometry:new o.sfs.Polygon,attributeSet:n});return i.add(a),i.reset(),i}function l(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var r=this._ellipseElement.plot,n=this._ellipseElement.algorithm.createGeometries(r,t)[0],o=this._drawLayer.elements[0];o.geometry=n,this._drawLayer.update(o)}}e.onMouseUp=function(){n.apply(r,arguments)},e.onMouseMove=function(){a.apply(r,arguments)},e.onEndDraw=function(){r._onCircleEllipseEndDraw.apply(r,arguments)}},_constructGeometry:function(e,t){return{polyline:function(e){for(var t=new o.sfs.Path,r=0;r<e.length;r++)t.addPoint(e[r]);var n=new o.sfs.Polyline;return n.addGeometry(t),n},polygon:function(e){for(var t=new o.sfs.Ring,r=0;r<e.length;r++)t.addPoint(e[r]);var n=new o.sfs.Polygon;return n.addGeometry(t),n}}[e](t)},_onCircleEllipseEndDraw:function(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r),a=e.geometry.shell,s=this._measurePolygon(a.points),l=this._getStyleName(1),c=this._measureLayer.id,u=[0,0],f=this.options.areaTipFn.apply(window,s),h=e.geometry.getBaryCenter(),p=new o.sfs.Point(h),d=new o.widget.Tooltip({id:t.newUUID32(),anchor:p,content:f,layerId:c,offset:u,className:l});n.tooltips.push(d),this._toolTipWare.add(d);u=this._caculateDeleteMarkerOffset(n,!0);this._deleteSymbol.offsetX=u[0],this._deleteSymbol.offsetY=u[1];var y=a.points[parseInt(7*(a.points.length-1)/8)],m=new o.sfs.Element({geometry:y,symbol:this._deleteSymbol});m[i]=r,this._measureLayer.add(m),n.deleteEle=m,this._addLinkEle(n,p,y),this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()},_caculateDeleteMarkerOffset:function(e,t){var r=this.options.symbols.delete.options,n=r.width,o=r.height,i=r.offsetX,a=r.offsetY,s=e.points;if(isNaN(i)&&s.length>1){var l=s[s.length-1],c=s[s.length-2];i=!0===t||l.x>=c.x?-5:n+5}return isNaN(a)&&(a=o/2),[i,a]},_addNodeEle:function(e,t,r){var n=new o.sfs.Element({geometry:t,symbol:r});return this._measureLayer.add(n),n},_addLinkEle:function(e,t,n){if(!0===this.options.showTipLink){var i=this.options.symbols,a=new o.sfs.Path;a.addPoint(t),a.addPoint(n);var s=new o.sfs.Polyline;s.addGeometry(a);var l=jQuery.extend(!0,{},i.line);if("SimpleFillSymbol"==l.type)l={type:"SimpleLineSymbol",options:{color:l.options.borderColor}};l.options.style=3,l.options.width=2,l.options.color.a=.7*(l.options.color.a||l.options.color.alpha||0);var c=r.geoinfoToElement(s,l);this._measureLayer.add(c),e.linkEle=c}},_getStyleName:function(e){return t.isArray(this.options.styleName)?this.options.styleName[e]:this.options.styleName},_getMeasuring:function(e){return this._measuringObj||(this._measuringObj={element:null,points:[],tooltips:[],nodes:[],deleteEle:null,linkEle:null}),this._measuringObj.id=e,this._measuringObj},_measurePolyline:function(e){for(var t=new o.sfs.Path({spatialReference:this.map.spatialReference}),r=0,i=e.length;r<i;r++)t.addPoint(e[r]);var a=new o.sfs.Polyline({spatialReference:this.map.spatialReference});return a.addGeometry(t),n.measureLength(a)},_measurePolygon:function(e){for(var t=new o.sfs.Ring({spatialReference:this.map.spatialReference}),r=0,i=e.length;r<i;r++)t.addPoint(e[r]);t.addPoint(e[0]);var a=new o.sfs.Polygon({spatialReference:this.map.spatialReference});return a.addGeometry(t),[i=n.measureLength(a),n.measureArea(a)]}})}}}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(15),r(14),r(2),r(12),r(1)],void 0===(o=function(e,t,r,n,o){var i={NoopTool:"NoopTool"},a=o.interact.Tool.extend({initialize:function(e){var t=e||{};o.interact.Tool.call(this,t),this.parent=t.parent,this.onMove=-1,this.currentElement=null,this.center=t.center,this.map=t.map,this.drawLayer=t.drawLayer,this.circleEle=t.circleEle,this.lineEle=t.lineEle,this.picEle=t.picEle,this.textEle=t.textEle,this.geoSearch=t.geoSearch,this.callback=t.callBack,this.query=t.query,this.context=t.context,this.markerSymbol=t.markerSymbol,this.fillSymbol=t.fillSymbol},onMouseUp:function(e,t,r,n,o,i,a){if(this.map.resumeDragPan(),0==this.onMove)this.onMove=-1;else if(this.onMove>0){var s={x:this.center.x,y:this.center.y,radius:this.radius,count:128},l=this.parent._getCircleGeoJson(s);this.callback.call(this.context,l,this.textlength),this.onMove=-1,this.currentElement=null,this.drawLayer.update(this.picEle,!0)}},onMouseDown:function(e,t,r,n,o,i,a){if(this.onMove<0){var s=this.drawLayer.hitTest(r,n);s&&(this.map.stopDragPan(),s&&this.picEle.id==s.element.id&&(this.currentElement=s.element,this.onMove++,this.drawLayer.update(this.picEle,!0)))}},onMouseMove:function(e,t,r,n,i,a,s){if(this.onMove>=0&&this.currentElement){this.currentElement.geometry.x=i,this.currentElement.geometry.y=this.center.y,this.drawLayer.update(this.currentElement);var l=new o.sfs.Polyline({spatialReference:this.map.spatialReference}),c=new o.sfs.Path({spatialReference:this.map.spatialReference}),u=this.center,f=new o.sfs.Point({x:i,y:this.center.y,spatialReference:this.map.spatialReference});c.addPoint(u),c.addPoint(f),l.addGeometry(c),this.lineEle.geometry=l,this.drawLayer.update(this.lineEle),this.radius=Math.abs(u.x-f.x);var h=new o.sfs.CoordinateTransform,p=new o.sfs.MeasureService({projectService:h});this.textlength=p.length(this.lineEle.geometry),this.textEle.symbol.text=Math.round(this.textlength)/1e3+"km",this.drawLayer.update(this.textEle,!0),this.drawLayer.remove(this.circleEle);this.center.x,this.center.y,this.textlength;var d=new o.sfs.Point({x:this.center.x,y:this.center.y,spatialReference:this.map.spatialReference}),y=this.parent._getBufferGeoJson(d,this.textlength),m=o.sfs.GeometryFactory.createGeometryFromGeoJson(y,this.map.spatialReference),g=new o.sfs.Ring({spatialReference:this.map.spatialReference});m.addGeometry(g);var v=this.fillSymbol,b=new o.sfs.Element({geometry:m,symbol:v});this.circleEle=b,this.drawLayer.add(this.circleEle),this.onMove++}},onMouseClick:function(e,t,r,n,o,i,a){}}),s=o.interact.Tool.extend({initialize:function(e){var t=e||{};o.interact.Tool.call(this,t),this.onMove=-1,this.currentElement=null,this.geometry=t.geometry,this.map=t.map,this.drawLayer=t.drawLayer,this.lineEle=t.lineEle,this.picEle=t.picEle,this.bufferEle=t.bufferEle,this.maxPoint=t.maxPoint,this.bufferMaxPoint=t.bufferMaxPoint,this.callback=t.callBack,this.context=t.context,this.parent=t.parent,this.textEle=t.textEle,this.fillSymbol=t.fillsymbol},onMouseUp:function(e,t,r,n,o,i,a){if(this.map.resumeDragPan(),0==this.onMove)this.onMove=-1;else if(this.onMove>0){this.callback.call(this.context,this.bufferGeoJSON,this.textlength),this.onMove=-1,this.currentElement=null,this.drawLayer.update(this.picEle,!0)}},onMouseDown:function(e,t,r,n,o,i,a){if(this.onMove<0){var s=this.drawLayer.hitTest(r,n);s&&(this.map.stopDragPan(),s&&this.picEle.id==s.element.id&&(this.currentElement=s.element,this.onMove++))}},onMouseMove:function(e,t,r,n,i,a,s){if(this.onMove>=0&&this.currentElement){var l=this.maxPoint,c=new o.sfs.Point({x:i,y:a,spatialReference:this.map.spatialReference}),u=new o.sfs.Polyline({spatialReference:this.map.spatialReference}),f=new o.sfs.Path({spatialReference:this.map.spatialReference});f.addPoint(l),f.addPoint(c),u.addGeometry(f),this.lineEle.geometry=u,this.radius=Math.abs(l.x-c.x);var h=new o.sfs.CoordinateTransform,p=new o.sfs.MeasureService({projectService:h});this.textlength=p.length(this.lineEle.geometry),this.drawLayer.remove(this.bufferEle);var d=(new jsts.io.GeoJSONReader).read(this.geometry);d=d.buffer(this.textlength*(360/(2*Math.PI*6378137))),this.bufferGeoJSON=(new jsts.io.GeoJSONWriter).write(d);var y=this.bufferGeoJSON,m=o.sfs.GeometryFactory.createGeometryFromGeoJson(y,this.map.spatialReference),g=new o.sfs.Ring({spatialReference:this.map.spatialReference});m.addGeometry(g);var v=this.fillSymbol;this.bufferEle=new o.sfs.Element({geometry:m,symbol:v}),this.drawLayer.add(this.bufferEle);var b=y.coordinates,_=this.parent._sortFunction(b,y.type),w=new o.sfs.Point({x:_[0][0],y:_[0][1],spatialReference:this.map.spatialReference});this.currentElement.geometry=w,this.drawLayer.update(this.currentElement);var S=new o.sfs.Polyline({spatialReference:this.map.spatialReference}),L=new o.sfs.Path({spatialReference:this.map.spatialReference});L.addPoint(l),L.addPoint(w),S.addGeometry(L),this.lineEle.geometry=S,this.drawLayer.update(this.lineEle);h=new o.sfs.CoordinateTransform,p=new o.sfs.MeasureService({projectService:h});this.textlength=p.length(this.lineEle.geometry),this.drawLayer.remove(this.textEle);var x=Math.round(this.textlength)/1e3+"km",P=new o.sfs.TextSymbol({text:x,foreground:new o.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0});this.textEle=new o.sfs.Element({geometry:S,symbol:P}),this.drawLayer.add(this.textEle),this.onMove++}},onMouseClick:function(e,t,r,n,o,i,a){}}),l=e.extend({options:{name:"缓冲区查询 ",buffer_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAUCAYAAADskT9PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzdCRTQ5OTYzRkFFMTFFNDk1NTE5ODREMUQwMDhDMzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzdCRTQ5OTczRkFFMTFFNDk1NTE5ODREMUQwMDhDMzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDN0JFNDk5NDNGQUUxMUU0OTU1MTk4NEQxRDAwOEMzMyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDN0JFNDk5NTNGQUUxMUU0OTU1MTk4NEQxRDAwOEMzMyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpA7b9wAAAPDSURBVHjarFZbTxNREJ7d7ba7lbaAgqBUMETEW9OggCYiYIyKJhp+gA/6B4wPhGhMjET9CaivXggxXogkaqLxQXxofCCKFRSjQohRgZa2WLbXXWfWs02tB2ONk3xJe2Z25pvvzDm7Ql9fH3BMQEigaeWQTu8Cw9iB/0sQ1fA3ZhgGCMIs/gojXiGeg8czzwu1cQrbIJWqhETiOOj6YX9LS+X6hga3Q1Gk0rIyB/ylLcZiqaV4PPN5evr7i5GROYhEhpDUFSQS/qVgngJUXIFkcgsWP9dx4IC/pa2t2m63S8bPrqBoEwQzKT5pvHj27Mvj4eGXuHYKSUwWKkBxKmQyjVj8Uld397amnTurdF2HbDYL/8GE5ra2NStcLnloYKAfotFjSOJLPgHZ3F9NO7m3q2uzv7W1KpPJwH81bGaTz1eRTCS2PLx79yKunKBlkaEU9313jdfb3NrevjaLxal7Hvb1BE0U6yNkUE2cqaqtTU17UIUOi4AdUYkE9qCznDon2XkJ9veO5zX0u98yiuOSwLyU37d9+0qcqSMWAdUkoOt1NXV1nmw6bQYW4uDpt7kCDy5s4MbQumUUz4shdau9XjeGNFsEFEQZMnKqTqecpcErwKGz73OJh/vqgRdjgfyW0XOFftoGUZJErFWC2+CysQFUkIAoCoJAAcYfjpxe5KngxRtIRLbbRS2RUMTcMRTFBF4caYPtVT7unfXmHj56foorrQXyW0bPFfpZfiMWiWjgdoeIAFFMIoHw/Oxs3MDLgyft7TNrc4m7L8xwY2jdMornxZC2USouCNMkhmgWx5sTZHn6XTC4INtswFOBcKu36hdpC2EZxfH8lNeG+SffvAkhgadEgGZgCTEHDsfE2Oior76hwbOmtnYVXhjcWRjsqcwdw2J8OF5gk2UIzc1FR548mQRFGbJOASnwDfEVVDVwb2DgYyQcjuKQmHItd6kUA2qEiqeSyaWbV6++B0m6jA2HiIDU2dlJdTLmIEqSDanqrwMBtaa21rGyosJpsARFg3UtoeSKqkIkFIpc6+9/h1t9HUpK7rDGc++CBGLGvBUd+MYVxfjQ4GB8q9+/rtHnK3N7PKq7tFQ1ONIu+/YRRdDi8eRiNKqNjo8vjAYCnzD3DVT5Ptt2I5+Abg4iwAdEClnGaCiDExMbg2Nj61FHD8L9D6/jRWwmhJM3Bi7XI/xN+SPs5P32QUKLMUZiAbEaGU8h3Oy2lIq5f5iq1FTInK+fX0dLzLfsF5HOgpLsASfCweKEIghYc5VCaAzcK/SHAAMA4XIlf6DGCVoAAAAASUVORK5CYII="},initialize:function(n){e.prototype.initialize.call(this,n);var i=this.map.getMap();this.options.layerId=this.options.layerId||r.newUUID32();var a=t.getLayerById(this.map,this.options.layerId);a||(a=new o.carto.ElementLayer({id:this.options.layerId,map:i}),i.addLayer(a)),this._layer=a},destroy:function(){var t=this.map.getMap();this._layer.clear(),t.removeLayer(this._layer),e.prototype.destroy.call(this)}});return l.include({drawBuffer:function(e){if(this.clearBufferLayer(),r.isEmptyObject(e))throw new Error("传入参数错误！");this.param=e;var t=e.type;this._noopTool(),this.map.off("click",this._getMapPolt()),this.map.off("click",this._getMapClickPoint()),"point"==t&&this.map.listen("click",this._getMapClickPoint()),"polyline"==t&&this._drawPolyline(e),"getGeo"==t&&this.map.listen("click",this._getMapPolt())},circleBuffer:function(e){this.clearBufferLayer();var t,r,n=e.mapX,i=e.mapY,s=e.radius,l=e.context,c=e.callback,u=this._layer;t=0!=e.showDrag||e.showDrag,r=0!=e.showLine||e.showLine;var f=this.map,h=e.symbol||new o.sfs.SimpleFillSymbol,p=new o.sfs.Point({x:n,y:i,spatialReference:f.spatialReference}),d={x:n,y:i,radius:s,angle:90,srs:f.spatialReference},y=this._getCirclePointByAngle(d);if(t){var m=this.options.buffer_img,g=new o.sfs.PictureMarkerSymbol({source:m,width:32,height:20,rotation:"0",opacity:"1",offsetX:"2",offsetY:"5"});this.picEle=new o.sfs.Element({id:"moveMarker",geometry:y,symbol:g}),u.add(this.picEle)}var v=new o.sfs.SimpleLineSymbol({color:new o.sfs.Color({a:153,r:255,g:0,b:0})}),b=new o.sfs.Polyline({spatialReference:f.spatialReference}),_=new o.sfs.Path({spatialReference:f.spatialReference}),w=p,S=y;_.addPoint(w),_.addPoint(S),b.addGeometry(_),this.polylineElement=new o.sfs.Element({geometry:b,symbol:v});var L=new o.sfs.CoordinateTransform,x=new o.sfs.MeasureService({projectService:L}).length(this.polylineElement.geometry),P=Math.round(x)/1e3+"km",E=new o.sfs.TextSymbol({text:P,foreground:new o.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0});this.textEle=new o.sfs.Element({geometry:p,symbol:E}),r&&(u.add(this.polylineElement),u.add(this.textEle));f.spatialReference;var T=new o.sfs.Point({x:n,y:i,spatialReference:f.spatialReference}),C=this._getBufferGeoJson(T,s),A=o.sfs.GeometryFactory.createGeometryFromGeoJson(C,f.spatialReference),k=new o.sfs.Polygon({spatialReference:f.spatialReference});if(A.addGeometry(k),this.circleEle=new o.sfs.Element({geometry:A,symbol:h}),u.add(this.circleEle),t){var R=new a({center:p,parent:this,callBack:c,map:f,drawLayer:u,circleEle:this.circleEle,lineEle:this.polylineElement,picEle:this.picEle,textEle:this.textEle,markerSymbol:g,context:l,fillSymbol:h});R.onCreate({map:f}),R.onClick()}c.call(l,C,s)},geojsonBuffer:function(e){this.clearBufferLayer();var t,r,n=e.geojson,i=new jsts.io.GeoJSONReader,a=e.radius,l=e.callback,c=e.symbol,u=this._layer,f=this.map,h=e.context;t=0!=e.showDrag||e.showDrag,r=0!=e.showLine||e.showLine,"LineString"==n.type&&n.coordinates.length<2&&(n.coordinates=n.coordinates[0]);var p=$.extend(!0,{},n),d=i.read(n),y=this._sortFunction(n.coordinates,n.type),m=new o.sfs.Point({x:y[0][0],y:y[0][1],spatialReference:f.spatialReference});d=d.buffer(a*(360/(2*Math.PI*6378137)));var g=(new jsts.io.GeoJSONWriter).write(d),v=g.coordinates,b=this._sortFunction(v,g.type),_=new o.sfs.Point({x:b[0][0],y:b[0][1],spatialReference:f.spatialReference}),w=new o.sfs.SimpleLineSymbol({color:new o.sfs.Color({a:153,r:255,g:0,b:0})}),S=new o.sfs.Polyline({spatialReference:f.spatialReference}),L=new o.sfs.Path({spatialReference:f.spatialReference});L.addPoint(m),L.addPoint(_),S.addGeometry(L),this.polylineElement=new o.sfs.Element({geometry:S,symbol:w}),r&&u.add(this.polylineElement);var x=Math.round(a)/1e3+"km",P=new o.sfs.TextSymbol({text:x,foreground:new o.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0});this.textEle=new o.sfs.Element({geometry:this.polylineElement.geometry,symbol:P}),u.add(this.textEle);var E=this.options.buffer_img,T=new o.sfs.PictureMarkerSymbol({source:E,width:32,height:20,rotation:"0",opacity:"1",offsetX:"2",offsetY:"5"}),C=new o.sfs.Element({id:"moveMarker",geometry:_,symbol:T});t&&u.add(C);var A=o.sfs.GeometryFactory.createGeometryFromGeoJson(g,f.spatialReference),k=c||new o.sfs.SimpleFillSymbol,R=new o.sfs.Ring({spatialReference:f.spatialReference});A.addGeometry(R);var O=new o.sfs.Element({geometry:A,symbol:k});if(u.add(O),t){var I=new s({maxPoint:m,bufferMaxPoint:_,geometry:p,bufferEle:O,parent:this,callBack:l,map:f,drawLayer:u,lineEle:this.polylineElement,picEle:C,textEle:this.textEle,fillsymbol:c,context:h});I.onCreate({map:f}),I.onClick()}l.call(h,g,a)},clearBufferLayer:function(){this._layer&&this._layer.clear()}}),l.include({_noopTool:function(){var e=new o.gdm.CommandManager,t=new o.gmd.CommandNotify({manager:e}),r=new o.gdm.NoopTool({id:i.NoopTooll,cursor:"pointer"});e.add(r);var n=new o.carto.GraphicSelectionSet;e.onCreate({map:this.map,commandNotify:t,graphicSelectionSet:n,spatialRef:{srid:this.map.spatialReference}}),t.activeCommand(i.NoopTool,null)},_drawPolyline:function(e){var t=this._layer,r=e.callback,n=e.context,i=e.symbol||new o.sfs.SimpleLineSymbol,a=new o.sfs.Path({spatialReference:this.map.spatialReference}),s=new o.sfs.Polyline({spatialReference:this.map.spatialReference});s.addGeometry(a);var l=new o.sfs.Element({geometry:s,symbol:i});this.ploylinePlot=new o.draw.DrawTool({id:"ploylinePlot",templateElement:l,layer:t,drawLayer:t});var c=new o.sfs.CoordinateTransform,u=new o.sfs.MeasureService({projectService:c});this.ploylinePlot.onCreate({map:this.map,spatialRef:this.map.spatialReference,measureService:u}),this.ploylinePlot.onEndDraw=function(e){t.add(e),this.map.currentTool(null);var i=u.length(e.geometry),a=e.geometry.asGeoJson(),s=Math.round(i)/1e3+"km",l=new o.sfs.TextSymbol({text:s,foreground:new o.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0}),c=new o.sfs.Element({geometry:e.geometry,symbol:l});t.add(c),r.call(n,a,i)},this.ploylinePlot.onClick()},_getBufferGeoJson:function(e,t){if(!e||isNaN(t))return null;var r=null,i=e.spatialReference;if(4326==i){var a={center:[e.x,e.y],radius:t,count:128,spatialReference:i};return(s=n.getCirclePonits(a)).push(s[0]),(r={}).coordinates=[s],r.type="Polygon",r}if(3857==i){var s,l=new o.sfs.CoordinateTransform,c=new o.sfs.Point({x:e.x,y:e.y,spatialReference:i}),u=l.transform(c,4326),f=(a={center:[u.x,u.y],radius:t,count:128,spatialReference:4326},{type:"Polygon",coordinates:[s=n.getCirclePonits(a)]}),h=o.sfs.GeometryFactory.createGeometryFromGeoJson(f);h.spatialReference=4326,r=l.transform(h,i).asGeoJson()}return r},_getCirclePointByAngle:function(e){var t=e.x,r=e.y,i=e.radius,a=e.angle,s=e.srs;if("3857"==s){var l=new o.sfs.CoordinateTransform,c=new o.sfs.Point({x:e.x,y:e.y,spatialReference:s}),u=l.transform(c,4326),f={center:[u.x,u.y],radius:i,count:360,spatialReference:4326},h=n.getCirclePonits(f),p={type:"Point",coordinates:[h[a][0],h[a][1]]},d=o.sfs.GeometryFactory.createGeometryFromGeoJson(p);d.spatialReference=4326;var y=l.transform(d,s).asGeoJson();return p=new o.sfs.Point({x:y.coordinates[0],y:y.coordinates[1],spatialReference:s})}i/=6378137,a=a*Math.PI/180;var m=r*Math.PI/180,g=t*Math.PI/180,v=Math.asin(Math.sin(m)*Math.cos(i)+Math.cos(m)*Math.sin(i)*Math.cos(a)),b=g+Math.atan2(Math.sin(a)*Math.sin(i)*Math.cos(m),Math.cos(i)-Math.sin(m)*Math.sin(v));if(!isNaN(v)||!isNaN(b)){var _=180*b/Math.PI,w=180*v/Math.PI;return p=new o.sfs.Point({x:_,y:w,spatialReference:s})}},_getCircleGeoJson:function(e){var t=e.x,r=e.y,n=e.radius,o=e.count,i=[],a={};if("3857"==e.srs){var s={type:"Point"};s.coordinates=[t,r],a=this._getGeoBuffer(s,n)}else{for(var l=0;l<o;l++){var c=360/o;i.push(c*l)}a.type="Polygon";var u=[];n/=6378137;for(var f=0;f<i.length;f++){var h=i[f];h=h*Math.PI/180;var p=r*Math.PI/180,d=t*Math.PI/180,y=Math.asin(Math.sin(p)*Math.cos(n)+Math.cos(p)*Math.sin(n)*Math.cos(h)),m=d+Math.atan2(Math.sin(h)*Math.sin(n)*Math.cos(p),Math.cos(n)-Math.sin(p)*Math.sin(y));if(!isNaN(y)||!isNaN(m)){var g=[],v=180*m/Math.PI,b=180*y/Math.PI;g.push(v),g.push(b),u.unshift(g),f==i.length-1&&u.push(u[0])}}a.coordinates=[u]}return a},_getMapPolt:function(){if(!this._getMapPoltListener){var e=this;this._getMapPoltListener=function(t){for(var r,n=e.param.callback,o=e.options.layerId,i=e.param.map.getLayers(),a=0;a<i.length;a++)i[a].id==o&&(r=i[a]);var s=r.hitTest(t.screenX,t.screenY);s&&(n(s.element.geometry.asGeoJson()),e.map.off("click",e._getMapPolt()))}}return this._getMapPoltListener},_getMapClickPoint:function(){if(!this._mapClickListener){var e=this;this._mapClickListener=function(t){var r=e.param.callback,n=e.param.symbol,i=e._layer,a=new o.sfs.Point({x:t.mapX,y:t.mapY,spatialReference:e.map.spatialReference}),s=n||new o.sfs.MarkerSymbol,l=new o.sfs.Element({geometry:a,symbol:s});i.add(l),e.map.off("click",e._getMapClickPoint()),r(a)}}return this._mapClickListener},_sortFunction:function(e,t){var r=[];if("LineString"==t)(r=e).sort((function(e,t){return e[0]<t[0]?1:-1}));else if("Point"==t)r.push(e);else{for(var n=0;n<e.length;n++)for(var o=e[n],i=0;i<o.length;i++)r.push(o[i]);r.sort((function(e,t){return e[0]<t[0]?1:-1}))}return r}}),l}.apply(t,n))||(e.exports=o)},function(e,t,r){var n={SwitchBaseLayer:r(493),BaseLayerProviders:r(194),FeatureHighlight:r(494),FeatureLocate:r(495),PopupManager:r(496),Measure:r(499),Measure3D:r(501),FullScreen:r(503),ScreenShot:r(504),MousePosition:r(505),ThematicMap:r(506),LayerManager:r(508)};e.exports=n},function(e,t,r){var n=r(11),o=(r(194),r(2),r(14)),i=r(45),a=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.list=e.layers||[],this.layers=[]},load:function(){for(var e=0;e<this.list.length;e++){var t=this._createBaseLayer(this.list[e]);t.setVisible(!!this.list[e].visible),this.map.addLayer(t),this.layers.push(t)}},destroy:function(){n.prototype.destroy.call(this)},unload:function(){this.clear()},showLayer:function(e,t){if(t)for(var r=0;r<this.layers.length;r++)this.layers[r].setVisible(this.layers[r].id===e);else for(var n=0;n<this.layers.length;n++)if(this.layers[n].id===e){this.layers[n].setVisible(!0);break}},hideLayer:function(e){for(var t=0;t<this.layers.length;t++)if(this.layers[t].id===e){this.layers[t].setVisible(!1);break}},hideAll:function(){for(var e=0;e<this.layers.length;e++)this.layers[e].setVisible(!1)},getLayerById:function(e){},getCurrentLayers:function(){},getLayers:function(){return this.layers},addLayer:function(e){if(this._checkLayerOpts(e)){this.list.push(e);var t=this._createBaseLayer(e);this.map.addLayer(t),this.layers.push(t),this._updateOnChange()}},removeLayer:function(e){var t=this._removeLayerById(e);return null!=t&&this._updateOnChange(),t},clear:function(){for(var e=0;e<this.layers.length;e++)this.map.removeLayer(this.layers[e]);this.layers=[],this.list=[]},_createBaseLayer:function(e){var t=null;if(e=i(!0,{},e),this._handleToken(e),e.layers.length>1){var r=i(!0,{},e);r.type="group",t=o.createBaseLayer(r)}else{var n=i(!0,{},e.layers[0]);n.id=e.id,n.name=e.name,t=o.createBaseLayer(n)}return t},_removeLayerById:function(e){for(var t=null,r=this.list.length-1;r>=0;r--)if(this.list[r].id===e){t=this.list[r],this.list.splice(r,1);var n=this.layers[r];this.map.removeLayer(n),this.layers.splice(r,1);break}return t},_checkLayerOpts:function(e){return!0},_handleToken:function(e){for(var t=0;t<e.layers.length;t++){var r=e.layers[t];r.token&&(r.url=r.url.replace("{token}",r.token))}},_updateOnChange:function(){}});e.exports=a},function(e,t,r){var n=r(11),o=r(18),i=r(2),a=r(1),s=n.extend({options:{},initialize:function(e){if(n.prototype.initialize.call(this,e),this.options=e,e.layer)this.layer=e.layer;else{var t=new a.carto.ElementLayer({id:e.id||"highlightLayer",name:e.name||"highlightLayer",map:e.map,zIndex:e.zIndex||100});this.layer=t}e.blink&&e.blink.interval&&e.blink.duration?(this.interval=e.blink.interval,this.duration=e.blink.duration,this.keep=e.blink.keep):(this.interval=200,this.duration=1600)},load:function(){this.map.addLayer(this.layer),this._toolTipWare=new a.widget.TooltipWare({map:this.map})},addHighlight:function(e,t){var r=this;this.removeHighlight(e),i.isArray(t)||(t=[t]),t.forEach((function(t){if(t&&t.style&&"GifMarkerSymbol"==t.style.type){var n=r._createGifToolTip(e,t);r._toolTipWare.add(n)}else if(t&&t.style&&"Custom"==t.style.type){var o=r._createCustomToolTip(e,t);r._toolTipWare.add(o)}else{r._elementConstructor(e,t).forEach((function(n){if(r.layer.add(n),t.blink&&!1===t.blink.enable);else if(t.blink&&t.blink.interval&&t.blink.interval+""!="0")r._setElementInterval(e,t.blink,n);else{var o={interval:r.interval,duration:r.duration,keep:r.keep};r._setElementInterval(e,o,n)}}))}}))},removeHighlight:function(e){if(this.layer.elements)for(var t=this.layer.elements.length-1;t>-1;t--){var r=this.layer.elements[t];r.id==e&&this.layer.remove(r)}if(this._intervalObj[e])for(var n=0;n<this._intervalObj[e].length;n++)clearInterval(this._intervalObj[e][n]);this._toolTipWare.remove(e),delete this._intervalObj[e]},clearHighlight:function(){this.layer.clear(),this._toolTipWare.clear();var e=this._intervalObj;for(var t in e)if(e.hasOwnProperty(t))for(var r=e[t],n=0;n<r.length;n++){var o=r[n];clearInterval(o)}this._intervalObj={}},unload:function(){this.clearHighlight(),this.map.removeLayer(this.layer)},destroy:function(){n.prototype.destroy.call(this)},_createTooltip:function(e,t,r,n){return n=n||[-10,-10],new a.widget.Tooltip({id:e,anchor:t,content:r,layerId:this.layer.getLayerId(),offset:n})},_createGifToolTip:function(e,t){var r=t.style;if(r.options){var n=t.data,o=[-10,-10];r.options.offsetx&&(o[0]=r.options.offsetx),r.options.offsety&&(o[1]=r.options.offsety);var i='<img id="'+e+'" src="'+r.options.source+'"/>';return this._createTooltip(e,this._geometryConstructor(n),i,o)}},_createCustomToolTip:function(e,t){var r=t.style;if(r.options){var n=this._geometryConstructor(t.data),o=[-10,-10];return r.options.offsetx&&(o[0]=r.options.offsetx),r.options.offsety&&(o[1]=r.options.offsety),this._createTooltip(e,n,r.options.content,o)}},_setElementInterval:function(e,t,r){var n=null;t.duration&&(n=parseInt(parseFloat(t.duration)/parseFloat(t.interval)));var o=this.layer;this._intervalObj[e]||(this._intervalObj[e]=[]),this._intervalObj[e].push(this._getIntervalFunc(t.interval,n,r,o,t.keep))},_getIntervalFunc:function(e,t,r,n,o){var i=0,a=setInterval((function(){null!=t?i<=t?n.showElement(r,i%2==0):!0===o?n.showElement(r,!0):(n.remove(r),clearInterval(a)):n.showElement(r,i%2==0),i++}),e);return a},_intervalObj:{},_elementConstructor:function(e,t){var r=this,n=[];if(t.data)return i.isArray(t.data)||(t.data=[t.data]),t.data.forEach((function(o){var i=new a.sfs.Element({id:e,geometry:r._geometryConstructor(o),symbol:r._symbolConstructor(t.style)});n.push(i)})),n},_geometryConstructor:function(e){var t=new a.sfs.Geometry;return"wkt"==e.type.toLowerCase()?t=a.sfs.GeometryFactory.createGeometryFromWkt(e.geom,this.map.getSrid()):"geojson"==e.type.toLowerCase()&&(t=a.sfs.GeometryFactory.createGeometryFromGeoJson(e.geom,this.map.getSrid())),t},_symbolConstructor:function(e){return o.object2Symbol(e)}});e.exports=s},function(e,t,r){var n=r(11),o=r(2),i=r(1),a=n.extend({options:{padding:[10,10,10,10],minResolution:0,maxZoom:null,duration:{},nexTickTrigger:function(e,t,r){return t.call(r),null}},initialize:function(e){n.prototype.initialize.call(this,e),this.moveDuration=this.options.duration.move?this.options.duration.move:0,this.zoomDuration=this.options.duration.zoom?this.options.duration.zoom:0,this.queue=[],this.timer=null,this.timeout=0,this.running=!1},fit:function(e,t){this.clear(),this.queue.push({data:e,options:t}),this.running||this._nextTick()},clear:function(){this.queue=[],this._clearTimer(),this.timeout=0,this.running=!1,this._clearAnimation()},_nextTick:function(e){this.timer=this.options.nexTickTrigger({timeout:e},(function(){if(this._clearAnimation(),this.queue.length>0){var e=this.queue[this.queue.length-1];this.timeout=this._fit(e.data,e.options),console.debug("视野定位 timeout = ",this.timeout,"",e),this.queue.splice(this.queue.length-1,1)}else this.running=!1,this.timeout=0;this.queue.length>0&&this._nextTick(this.timeout)}),this)},_fit:function(e,t){var r=this;t=t||{};var n=new i.sfs.Envelope;if(o.isArray(e)){new i.sfs.GeometryCollection;e.forEach((function(e){var t=r._geometryConstructor(e);n.union(t.envelope())}))}else if(o.isObject(e)){var a=this._geometryConstructor(e);n=a.envelope()}var s=this.options.minResolution,l=this.moveDuration,c=this.zoomDuration,u=this.options.maxZoom,f=t.padding||this.options.padding;t&&(u=t.maxZoom?t.maxZoom:this.options.maxZoom,s=t.minResolution?t.minResolution:this.options.minResolution,t.duration&&(l=0===t.duration.move?0:t.duration.move?t.duration.move:this.moveDuration,c=0===t.duration.zoom?0:t.duration.zoom?t.duration.zoom:this.zoomDuration,f=t.padding?t.padding:this.options.padding));var h=this.map.map.getView(),p=this.map.map.getSize(),d=parseFloat(l+c)||0;if(this._isEnvelopePoint(n)){var y=new i.sfs.Point({x:n.minx,y:n.miny});u?d>0?h.animate({center:[y.x,y.y],duration:l},{zoom:u,duration:c}):(this.map.setCenter(y),this.map.zoomTo(u)):s&&(d>0?h.animate({center:[y.x,y.y],duration:l},{resolution:s,duration:c}):(this.map.setCenter(y),this.map.setResolution(s)))}else{var m=n;d>0?h.fit([m.minx,m.miny,m.maxx,m.maxy],{size:p,padding:f||[10,10,10,10],duration:d}):this.map.pan(m,f||[10,10,10,10])}return d},_clearAnimation:function(){var e=this.map.map.getView();e.getAnimating()&&e.cancelAnimations()},_clearTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},_isEnvelopePoint:function(e){return e.maxx==e.minx&&e.maxy==e.miny},_geometryConstructor:function(e){var t=new i.sfs.Geometry;return"wkt"==e.type.toLowerCase()?t=i.sfs.GeometryFactory.createGeometryFromWkt(e.geom,this.map.getSrid()):"geojson"==e.type.toLowerCase()&&(t=i.sfs.GeometryFactory.createGeometryFromGeoJson(e.geom,this.map.getSrid())),t},unload:function(){this.clear(),n.prototype.unload.call(this)},destroy:function(){n.prototype.destroy.call(this)}});e.exports=a},function(e,t,r){r(1);var n=r(11),o=r(2),i=r(497),a=r(498),s=n.extend({options:{autoPanStretegy:0,autoPanMargin:10,autoPanTimeout:300,zIndex:10,offset:[0,0],caculator:{contentEl:function(e){return e.children[0]},offsetFn:function(e){return jQuery(e).offset()},sizeFn:function(e){var t=jQuery(e);return[t.outerWidth(),t.outerHeight()]}},noneSpatialContainerId:"ns-popup-container",noneSpatialContainerClass:"ns-popup-container"},initialize:function(e){n.prototype.initialize.call(this,e),this.timer=null},destroy:function(){n.prototype.destroy.call(this)},load:function(){n.prototype.load.call(this),this.tooltipWare=new i({map:this.map,caculator:this.options.caculator}),this.noneSpatialTipWare=new a({containerId:this.options.noneSpatialContainerId,containerClassName:this.options.noneSpatialContainerClass,map:this.map})},unload:function(){this.clear(),this.tooltipWare=null,n.prototype.unload.call(this)},addSimple:function(e){e.id=e.id||o.newUUID32(),e.type="simple",void 0===e.zIndex&&(e.zIndex=this.options.zIndex),void 0===e.offset&&(e.offset=this.options.offset),void 0===e.autoPanMargin&&(e.autoPanMargin=this.options.autoPanMargin),void 0===e.autoPanStretegy&&(e.autoPanStretegy=this.options.autoPanStretegy);var t=null;return e.anchor?(t=this.tooltipWare.addPopup(e),this._triggerUpdateTimer(e)):t=this.noneSpatialTipWare.addPopup(e),this.fire("add",e),t},addLinePopup:function(e){},update:function(e,t){return this.tooltipWare.updatePopup(e,t)},updateZIndex:function(e,t){return this.tooltipWare.updateZIndex(e,t)},updatePosition:function(e){return this.tooltipWare.updatePosition(e)},remove:function(e){this.tooltipWare.removePopup(e),this._clearUpdatePosTimer(e),this.noneSpatialTipWare.removePopup(e),this.fire("remove",{id:e})},clear:function(){var e=this.getIdList();this.tooltipWare&&this.tooltipWare.clearPopup(),this.noneSpatialTipWare&&this.noneSpatialTipWare.clearPopup(),this._clearUpdatePosTimer(),this.fire("clear",{ids:e})},getIdList:function(){return Object.keys(this.tooltipWare.tooltipSet)},_triggerUpdateTimer:function(e){!1!==e.autoPan&&this._addUpdatePosTimer(e.id,e.autoPanTimeout)},_addUpdatePosTimer:function(e,t){var r=this,n=setTimeout((function(){console.debug("更新位置 ".concat(e)),r.updatePosition(e)}),t||this.options.autoPanTimeout);this.timer={id:e,timer:n}},_clearUpdatePosTimer:function(e){void 0===e?this.timer&&window.clearTimeout(this.timer.timer):this.timer&&this.timer.id===e&&window.clearTimeout(this.timer.timer),this.timer=null}});e.exports=s},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(1),u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(h,e);var t,r,n,u,f=(t=h,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=f.call(this,e)).g2map=e.map,t.caculator=e.caculator,t.tooltipSet={},t}return r=h,(n=[{key:"addPopup",value:function(e){return this["_addPopup_"+e.type].call(this,e)}},{key:"updatePopup",value:function(e,t){var r=this.tooltipSet[e]||null;return r&&(this.update(r),t.zIndex&&this.updateZIndex(e,t.zIndex)),r}},{key:"updateZIndex",value:function(e,t){var r=this.IdContainer[e];r&&t.zIndex&&(r.element.style.zIndex=parseInt(t.zIndex))}},{key:"updatePosition",value:function(e){var t=this.tooltipSet[e]||null;return t&&(0===t.autoPanStretegy?this._updatePositon0(t):this.panIntoView&&this.panIntoView(t)),t}},{key:"removePopup",value:function(e){delete this.tooltipSet[e],this.remove(e)}},{key:"clearPopup",value:function(){this.tooltipSet={},this.clear()}},{key:"_addPopup_simple",value:function(e){var t=this;return new Promise((function(r,n){var o='<div id="'+e.id+'"></div>',i=e.autoPanMargin||10,a=new c.widget.Tooltip({id:e.id,anchor:new c.sfs.Point({x:e.anchor[0],y:e.anchor[1]}),content:o,layerId:e.layerId,offset:e.offset||[0,0],className:e.className,autoPan:e.autoPan||!1,autoPanMargin:i});a.autoPanMargin=i,a.autoPanStretegy=e.autoPanStretegy,t.add(a),t.tooltipSet[e.id]=a;var s=t.IdContainer[a.id];s&&(s.element.style.zIndex=parseInt(e.zIndex)),r({id:e.id,containerId:e.id,tooltip:a})}))}},{key:"_updatePositon0",value:function(e){if(this.IdContainer.hasOwnProperty(e.id)){var t=this.caculator.contentEl(this.IdContainer[e.id].element),r=this.caculator.offsetFn(document.getElementById(this.g2map.options.targetId)),n=this.caculator.offsetFn(t);n.left-=r.left,n.top-=r.top;var o=this.caculator.sizeFn(t),i=this.g2map.getViewSize(),a=e.autoPanMargin||new Array(4).fill(0),s={left:n.left-a[0],top:n.top-a[1],right:i[0]-(n.left+o[0]+a[2]),bottom:i[1]-(n.top+o[1]+a[3])};console.debug("offsetCss",n),console.debug("offsetObj",s);var l=[0,0];if(s.top<0&&(l[1]+=Math.abs(s.top)),s.bottom<0&&(l[1]+=s.bottom),s.left<0&&(l[0]+=Math.abs(s.left)),s.right<0&&(l[0]+=s.right),console.debug("offset",l),0!==l[0]||0!==l[1]){var u=this.g2map.getCenter();u instanceof c.sfs.Point&&(u=[u.x,u.y]);var f=this.g2map.getPixelFromCoordinate(u);f[0]-=l[0],f[1]-=l[1],console.debug("pixelPoint",f);var h=this.g2map.getCoordinateFromPixel(f);console.debug("anchor",h),this.g2map.setCenter(new c.sfs.Point({x:h[0],y:h[1]}))}}}},{key:"_getMapPixelExtent",value:function(){var e=this.g2map.getExtent(),t=this.g2map.getPixelFromCoordinate([e.minx,e.maxy]),r=this.g2map.getPixelFromCoordinate([e.maxx,e.miny]);return[t[0],t[1],r[0],r[1]]}}])&&o(r.prototype,n),u&&o(r,u),h}(c.widget.TooltipWare);e.exports=u},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.container=null,this.idContainer={}}var t,n,o;return t=e,(n=[{key:"addPopup",value:function(e){var t=this;return new Promise((function(r,n){t.removePopup(e.id);var o=document.createElement("div");o.setAttribute("id",e.id+"-container"),o.setAttribute("class",e.className),o.innerHTML='<div id="'.concat(e.id,'"></div>'),t._getContainer().appendChild(o),t.idContainer[e.id]=o,r({id:e.id,containerId:e.id})}))}},{key:"removePopup",value:function(e){var t=this.idContainer[e];t&&this._getContainer().removeChild(t),delete this.idContainer[e]}},{key:"clearPopup",value:function(){for(var e in this.idContainer)this.removePopup(e)}},{key:"_getContainer",value:function(){if(!this.container){var e=document.getElementById(this.options.containerId);e||((e=document.createElement("div")).setAttribute("id",this.options.containerId),e.setAttribute("class",this.options.containerClassName),document.getElementById(this.options.map.options.targetId).appendChild(e)),this.container=e}return this.container}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){"use strict";var n,o;n=[r(11),r(500),r(2),r(18),r(12),r(1)],void 0===(o=function(e,t,r,n,o,i){var a=e.extend({options:{layerId:"measure-layer",showTipLink:!0,symbols:{line:{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},borderThickness:2,opacity:1}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},fillColor:{a:50,r:200,g:0,b:0},borderThickness:2,opacity:1}},node:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{a:200,r:200,g:0,b:0},fillColor:{a:250,r:255,g:255,b:255},borderThickness:2,size:4}},delete:{type:"PictureMarkerSymbol",options:{source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAIAAACQKrqGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAb0lEQVR42mNYfuABHB28sxOIjtzds+bwQ2RxCGKAUP8ZGPAghFIQHz8Aq0ZSCjEDVQVcCptSuGpkLrpSZGkMbdjciqmOYqXEOoAEbxEMLGBMEhMFQGUMkHjHH7EQNQxfP38AojMPjx6+uxsihAsBAMBJhSJg1b4KAAAAAElFTkSuQmCC",width:14,height:14,opacity:1}}},styleName:["emap-measure-node-tooltip","emap-measure-tooltip"],lengthTipFn:function(e,t){isNaN(t)||(t=(t/1e3).toFixed(2));var r={start:function(){return"起点"},node:function(e){return e+"公里"},end:function(e){return"总长:"+e+"公里"}},n=r[e];if("[object Function]"==Object.prototype.toString.call(n))return r[e](t)},areaTipFn:function(e,t){return"周长:"+(e=(e/1e3).toFixed(2))+"公里 <br/>面积:"+(t=(t/1e6).toFixed(2))+"平方公里"}},initialize:function(t){e.prototype.initialize.call(this,t),this._measuringTool=null,this._measuringObj=null,this._measures={},this._initialize(),this.map.listen("click",this._clickHandler,this),this.map.listen(G.misc.AppEvents.CLEAR_MAP,this.clear,this),this.lastTool=null},destroy:function(){this.clear(),this.map.removeLayer(this._drawLayer),this.map.removeLayer(this._measureLayer),this.map.off("click",this._clickHandler),this.map.off(G.misc.AppEvents.CLEAR_MAP,this.clear),e.prototype.destroy.call(this)}});return a.include({_initialize:function(){var e=this.map.getLayerById(this.options.layerId+"-draw");e||(e=new i.carto.ElementLayer({id:this.options.layerId+"-draw"}),this.map.addLayer(e));var t=this.map.getLayerById(this.options.layerId);t||(t=new i.carto.ElementLayer({id:this.options.layerId}),this.map.addLayer(t)),this._drawLayer=e,this._measureLayer=t,this._toolTipWare=new i.widget.TooltipWare({map:this.map}),this._nodeSymbol=n.object2Symbol(this.options.symbols.node.type,this.options.symbols.node.options),this._deleteSymbol=n.object2Symbol(this.options.symbols.delete.type,this.options.symbols.delete.options),this._createTools()},_clickHandler:function(e){var t=e.screenX,r=e.screenY,n=this._measureLayer.hitTest(t,r);if(n&&"_measure_id"in n.element&&"_measure_type"in n.element){var o=this._measures[n.element._measure_id];this._clearMeasure(o)}},_clearMeasuring:function(){this._drawLayer.clear(),this._measuringTool&&delete this._measuringTool._measure_id,this._measuringTool=null,this._measuringObj&&this._clearMeasure(this._measuringObj),this._measuringObj=null,this._ellipseElement=null,delete this._ellipseElement},_clearMeasure:function(e){if(r.isObject(e)){var t=e.element,n=e.nodes,o=e.tooltips,i=e.deleteEle,a=e.linkEle;t&&this._measureLayer.remove(t),i&&this._measureLayer.remove(i),a&&this._measureLayer.remove(a);for(var s=0,l=n.length;s<l;s++)n[s]&&this._measureLayer.remove(n[s]);for(s=0,l=o.length;s<l;s++)this._toolTipWare.remove(o[s].id);this.moveToolTip&&this._toolTipWare.remove(this.moveToolTip.id),delete this._measures[e.id]}},_saveLastTool:function(){this.lastTool=this.map.tool},_resumeLastTool:function(){if(this.lastTool)this.map.currentTool(this.lastTool),this.lastTool=null;else{this.map.tool&&!{measurePolygonTool:!0,measureLineTool:!0,measureCircleTool:!0,measureEllipseTool:!0}.hasOwnProperty(this.map.tool.id)||this._noopTool.onClick()}}}),a.include({measureLength:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._lineTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureArea:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._polygonTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureCircle:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._circleTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureEllipse:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._ellipseTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},finish:function(){if(!this._measuringTool)throw new Error("当前无测量！");try{this._measuringTool.onEndDraw()}catch(e){throw new Error("结束异常！error="+e.message)}},cancel:function(){this._clearMeasuring(),this._resumeLastTool()},clear:function(){console.log(this._measureLayer),this._measures={},this._drawLayer.clear(),this._measureLayer.clear(),this._toolTipWare.clear(),console.log(this._measureLayer)},save:function(){}}),t.extend(a,"_measure_id","_measure_type"),a}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(11),r(2),r(18),r(12),r(1)],void 0===(o=function(e,t,r,n,o){return{extend:function(e,i,a){var s="NoopTool";e.include({_createTools:function(){var e=this.options.symbols,t=r.object2Symbol(e.line.type,e.line.options),n=r.object2Symbol(e.polygon.type,e.polygon.options),i={map:this.map,spatialRef:{srid:this.map.spatialReference},tooltipWare:this._toolTipWare},a=new o.sfs.Path({spatialReference:this.map.spatialReference}),l=new o.sfs.Polyline({spatialReference:this.map.spatialReference});l.addGeometry(a),this._polylineTemplate=new o.sfs.Element({geometry:l,symbol:t}),this._lineTool=new o.draw.DrawTool({id:"measureLineTool",cursor:"crosshair",templateElement:this._polylineTemplate.copy(),drawLayer:this._drawLayer}),this._extendLineTool(this._lineTool),this._lineTool.onCreate(i);var c=new o.sfs.Ring({spatialReference:this.map.spatialReference}),u=new o.sfs.Polygon({spatialReference:this.map.spatialReference});u.addGeometry(c),this._polygonTemplate=new o.sfs.Element({geometry:u,symbol:n}),this._polygonTool=new o.draw.DrawTool({id:"measurePolygonTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendPolygonTool(this._polygonTool),this._polygonTool.onCreate(i),this._circleTool=new o.draw.DrawTool({id:"measureCircleTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendCircleTool(this._circleTool),this._circleTool.onCreate(i),this._ellipseTool=new o.draw.DrawTool({id:"measureEllipseTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendEllipseTool(this._ellipseTool),this._ellipseTool.onCreate(i),this._noopTool=new o.interact.NoopTool({id:s,cursor:"pointer"}),this._noopTool.onCreate(i),this.moveToolTip=null},_extendLineTool:function(e){var r=this;function n(e,r,n,a,s,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:s,y:l,spatialReference:this.map.spatialReference}),p=this._lineTool.drawElement.geometry.paths[0].points.slice(f.points.length);"ontouchend"in document?0===f.points.length?p=p.slice(0,1).concat(p.slice(2)):1===f.points.length&&(p=p.slice(1)):p=p.slice(0,p.length-1);for(var d=0,y=p.length;d<y;d++){h=p[d];var m=this._addNodeEle(u,h,this._nodeSymbol);f.nodes.push(m),f.points.push(h);var g,v,b=this._getStyleName(0),_=this._measureLayer.id;1==f.points.length?g=this.options.lengthTipFn("start"):(v=this._measurePolyline(f.points),g=this.options.lengthTipFn("node",v)),h.spatialReference=this.map.spatialReference;var w=new o.widget.Tooltip({id:t.newUUID32(),anchor:h,content:g,layerId:_,offset:[10,0],className:b});w[i]=u,f.tooltips.push(w),this._toolTipWare.add(w)}}function s(e,r,n,a,s,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:s,y:l,spatialReference:this.map.spatialReference});if(this._lineTool.drawElement){var p=JSON.parse(JSON.stringify(f.points));p.push(h);var d,y,m=this._getStyleName(0),g=this._measureLayer.id;if(p.length>1){y=this._measurePolyline(p),d=this.options.lengthTipFn("node",y),h.spatialReference=this.map.spatialReference;var v=new o.widget.Tooltip({id:t.newUUID32(),anchor:h,content:d,layerId:g,offset:[10,0],className:m});this.moveToolTip&&this._toolTipWare.remove(this.moveToolTip.id),this._toolTipWare.add(v),this.moveToolTip=v}}}function l(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r);if(n.points.length<2)throw new Error("距离测量至少两个点！");e.geometry=this._constructGeometry("polyline",n.points);var s=n.tooltips.splice(n.tooltips.length-1,1)[0];this._toolTipWare.remove(s.id);var l=this._measureLayer.id,u=this._getStyleName(1),f=this._measurePolyline(n.points),h=this.options.lengthTipFn("end",f),p=c.call(this,n);s.anchor.spatialReference=this.map.spatialReference;var d=new o.widget.Tooltip({id:t.newUUID32(),anchor:s.anchor,content:h,layerId:l,offset:[10,p[1]],className:u});d[i]=r,n.tooltips.push(d),this._toolTipWare.add(d),this._deleteSymbol.offsetX=p[0],this._deleteSymbol.offsetY=p[1];var y=new o.sfs.Element({geometry:s.anchor,symbol:this._deleteSymbol});y[i]=r,y[a]="delete",this._measureLayer.add(y),n.deleteEle=y,e[i]=r,this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel(),this.moveToolTip&&this._toolTipWare.remove(this.moveToolTip.id)}function c(e){var t=this.options.symbols.delete.options,r=t.width,n=t.height,o=t.offsetX,i=t.offsetY,a=e.points;if(isNaN(o)&&a.length>1){var s=a[a.length-1],l=a[a.length-2];o=s.x>=l.x?-5:r+5}return isNaN(i)&&(i=n/2),[o,i]}e.onMouseUp=function(){n.apply(r,arguments)},e.onEndDraw=function(){l.apply(r,arguments)},e._onMouseMove=e.onMouseMove,e.onMouseMove=function(){try{e._onMouseMove.apply(e,arguments)}catch(e){}s.apply(r,arguments)}},_extendPolygonTool:function(e){var r=this;function n(e,t,r,n,a,s,l){var c=this._measuringTool[i],u=this._getMeasuring(c),f=new o.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference}),h=this._polygonTool.drawElement.geometry.shell.points;h.length>2&&(f=h[h.length-3]);var p=this._addNodeEle(c,f,this._nodeSymbol);u.nodes.push(p),u.points.push(f)}function s(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r);if(n.points.length<3)throw new Error("多边形测量至少三个点！");e.geometry=this._constructGeometry("polygon",n.points);var s=this._measurePolygon(n.points),l=this._getStyleName(1),c=this._measureLayer.id,u=[0,0],f=this.options.areaTipFn.apply(window,s),h=e.geometry.getBaryCenter(),p=new o.sfs.Point(h);p.spatialReference=this.map.spatialReference;var d=new o.widget.Tooltip({id:t.newUUID32(),anchor:p,content:f,layerId:c,offset:u,className:l});d[i]=r,n.tooltips.push(d),this._toolTipWare.add(d),console.log(this._toolTipWare);u=this._caculateDeleteMarkerOffset(n);this._deleteSymbol.offsetX=u[0],this._deleteSymbol.offsetY=u[1];var y=n.points[n.points.length-1],m=new o.sfs.Element({geometry:y,symbol:this._deleteSymbol});m[i]=r,m[a]="delete",this._measureLayer.add(m),n.deleteEle=m,this._addLinkEle(n,p,y),e[i]=r,this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()}e.onMouseUp=function(){n.apply(r,arguments)},e.onEndDraw=function(){s.apply(r,arguments)}},_extendCircleTool:function(e){var t=this;function r(e,t,r,n,a,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:a,y:l,spatialReference:this.map.spatialReference});0==f.points.length?f.points.push(h):(s.call(this,f,h),this._onCircleEllipseEndDraw.call(this))}function a(e,t,r,n,a,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:a,y:l,spatialReference:this.map.spatialReference});s.call(this,f,h)}function s(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var r=e.points,i=r[0],a=r[1],s=this.map.getPixelFromCoordinate([i.x,i.y]),l=this.map.getPixelFromCoordinate([a.x,a.y]),c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2));if(0==parseFloat(c).toFixed(6))return;for(var u=n.getCirclePonits({center:s,radius:c,count:128,spatialReference:3857}),f=new o.sfs.Ring,h=0,p=u.length;h<p;h++){var d=u[h],y=this.map.getCoordinateFromPixel(d);f.addPoint(new o.sfs.Point({x:y[0],y:y[1],spatialReference:this.map.spatialReference}))}var m=this._drawLayer.elements[0],g=m.geometry;g.removeAllGeometry(),g.addGeometry(f),this._drawLayer.update(m)}}e.onMouseUp=function(){r.apply(t,arguments)},e.onMouseMove=function(){a.apply(t,arguments)},e.onEndDraw=function(){t._onCircleEllipseEndDraw.apply(t,arguments)}},_extendEllipseTool:function(e){var r=this;function n(e,t,r,n,a,c,u){var f=this._measuringTool[i],h=this._getMeasuring(f),p=new o.sfs.Point({x:a,y:c,spatialReference:this.map.spatialReference});0==h.points.length?(h.points.push(p),this._ellipseElement=s.call(this,{}),this._ellipseElement.plot.addControlPoint(p)):(l.call(this,h,p),this._onCircleEllipseEndDraw.call(this))}function a(e,t,r,n,a,s,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=new o.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference});l.call(this,f,h)}function s(e){var r=new o.plot.EllipseAlgorithm({}),n=new o.sfs.AttributeSet,i=new o.sfs.PlotElement({id:t.newUUID32(),kind:"ellipseTemplate",algorithm:r,attributeSet:n}),a=new o.sfs.Element({geometry:new o.sfs.Polygon({spatialReference:this.map.spatialReference}),attributeSet:n});return i.add(a),i.reset(),i}function l(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var r=this._ellipseElement.plot,n=this._ellipseElement.algorithm.createGeometries(r,t)[0],o=this._drawLayer.elements[0];o.geometry=n,this._drawLayer.update(o)}}e.onMouseUp=function(){n.apply(r,arguments)},e.onMouseMove=function(){a.apply(r,arguments)},e.onEndDraw=function(){r._onCircleEllipseEndDraw.apply(r,arguments)}},_constructGeometry:function(e,t){var r=this;return{polyline:function(e){for(var t=new o.sfs.Path({spatialReference:r.map.spatialReference}),n=0;n<e.length;n++)t.addPoint(e[n]);var i=new o.sfs.Polyline({spatialReference:r.map.spatialReference});return i.addGeometry(t),i},polygon:function(e){for(var t=new o.sfs.Ring({spatialReference:r.map.spatialReference}),n=0;n<e.length;n++)t.addPoint(e[n]);var i=new o.sfs.Polygon({spatialReference:r.map.spatialReference});return i.addGeometry(t),i}}[e](t)},_onCircleEllipseEndDraw:function(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r),s=e.geometry.shell,l=this._measurePolygon(s.points),c=this._getStyleName(1),u=this._measureLayer.id,f=[0,0],h=this.options.areaTipFn.apply(window,l),p=e.geometry.getBaryCenter(),d=new o.sfs.Point(p);d.spatialReference=this.map.spatialReference;var y=new o.widget.Tooltip({id:t.newUUID32(),anchor:d,content:h,layerId:u,offset:f,className:c});y[i]=r,n.tooltips.push(y),this._toolTipWare.add(y);f=this._caculateDeleteMarkerOffset(n,!0);this._deleteSymbol.offsetX=f[0],this._deleteSymbol.offsetY=f[1];var m=s.points[parseInt(7*(s.points.length-1)/8)],g=new o.sfs.Element({geometry:m,symbol:this._deleteSymbol});g[i]=r,g[a]="delete",this._measureLayer.add(g),n.deleteEle=g,this._addLinkEle(n,d,m),e[i]=r,this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()},_caculateDeleteMarkerOffset:function(e,t){var r=this.options.symbols.delete.options,n=r.width,o=r.height,i=r.offsetX,a=r.offsetY,s=e.points;if(isNaN(i)&&s.length>1){var l=s[s.length-1],c=s[s.length-2];i=!0===t||l.x>=c.x?-5:n+5}return isNaN(a)&&(a=o/2),[i,a]},_addNodeEle:function(e,t,r){var n=new o.sfs.Element({geometry:t,symbol:r});return n[i]=e,this._measureLayer.add(n),n},_addLinkEle:function(e,t,n){if(!0===this.options.showTipLink){var a=this.options.symbols,s=new o.sfs.Path({spatialReference:this.map.spatialReference});s.addPoint(t),s.addPoint(n);var l=new o.sfs.Polyline({spatialReference:this.map.spatialReference});l.addGeometry(s);var c=jQuery.extend(!0,{},a.line);if("SimpleFillSymbol"==c.type)c={type:"SimpleLineSymbol",options:{color:c.options.borderColor}};c.options.style=3,c.options.width=2,c.options.color.a=.7*(c.options.color.a||c.options.color.alpha||0);var u=r.geoinfoToElement(l,c);u[i]=e.id,this._measureLayer.add(u),e.linkEle=u}},_getStyleName:function(e){return t.isArray(this.options.styleName)?this.options.styleName[e]:this.options.styleName},_getMeasuring:function(e){return this._measuringObj||(this._measuringObj={element:null,points:[],tooltips:[],nodes:[],deleteEle:null,linkEle:null}),this._measuringObj.id=e,this._measuringObj},_measurePolyline:function(e){for(var t=new o.sfs.Path({spatialReference:this.map.spatialReference}),r=0,i=e.length;r<i;r++)t.addPoint(e[r]);var a=new o.sfs.Polyline({spatialReference:this.map.spatialReference});return a.addGeometry(t),n.measureLength(a)},_measurePolygon:function(e){for(var t=[],r=[],i=0,a=e.length;i<a;i++)t.push([e[i].x,e[i].y]),r.push([e[i].x,e[i].y]);t.push([e[0].x,e[0].y]);var s={type:"Polygon",coordinates:[t]},l=o.sfs.GeometryFactory.createGeometryFromGeoJson(s,this.map.spatialReference),c=o.sfs.GeometryFactory.createGeometryFromGeoJson({type:"LineString",coordinates:r},this.map.spatialReference);return[a=n.measureLength(c),n.measureArea(l)]},createSchema:function(){var e={measures:{},extent:this.map.getExtent()};for(var t in this._measures){var r=this._measures[t],n={};if(r){var o=r.element,s=r.nodes,l=r.tooltips,c=r.deleteEle,u=r.linkEle;if(c){var f=c.copy();f.unReset(),f.id=c.id,f[i]=c[i],f[a]=c[a],n.deleteEle=f}if(o){var h=o.copy();h.unReset(),h.id=o.id,h[i]=o[i],n.element=h}if(u){var p=u.copy();p.unReset(),p.id=u.id,p[i]=u[i],n.linkEle=p}n.nodes=[];for(var d=0;d<s.length;++d){var y=s[d];if(y){var m=y.copy();m.unReset(),m.id=y.id,m[i]=y[i],n.nodes.push(m)}}n.points=r.points,n.tooltips=l,n.id=t,r.schemaId&&(n.schemaId=r.schemaId),e.measures[t]=n}}return e},loadSchema:function(e,t,r){var n=e.measures,i={},a=new o.core.Deserializer;for(var s in n){var l=n[s],c={};if(l)if(this._measures[l.id])this._measures[l.id].schemaId=t;else{var u=l.element,f=l.nodes,h=l.tooltips,p=l.deleteEle,d=l.linkEle;p&&((p=a.createJsInstance(p)).reset(),c.deleteEle=p,this._measureLayer.contains(p.id)||this._measureLayer.add(p)),u&&((u=a.createJsInstance(u)).reset(),c.element=u,this._measureLayer.contains(u.id)||this._measureLayer.add(u)),d&&((d=a.createJsInstance(d)).reset(),c.linkEle=d,this._measureLayer.contains(d.id)||this._measureLayer.add(d)),c.nodes=[];for(var y=0;y<f.length;++y){var m=f[y];(m=a.createJsInstance(m)).reset(),c.nodes.push(m),this._measureLayer.contains(m.id)||this._measureLayer.add(m)}c.tooltips=[];for(var g=0;g<h.length;++g){for(var v=h[g],b=this._toolTipWare.tooltips,_=!1,w=0;w<b.length;w++)b[w].id===v.id&&(_=!0);_||(this._toolTipWare.add(v),c.tooltips.push(v))}l.schemaId?c.schemaId=l.schemaId:t&&(c.schemaId=t),c.id=s,i[s]=c}}if(e.extent&&r)if(-180===e.extent.minx&&-90===e.extent.miny&&180===e.extent.maxx&&90===e.extent.maxy);else{var S=a.createJsInstance(e.extent);S.spatialReference=this.map.spatialReference,this.map.pan(S)}this._measures=Object.assign(this._measures,i)},removeSchema:function(e){for(var t in this._measures){var r=this._measures[t];r&&r.schemaId&&r.schemaId===e&&(this._clearMeasure(r),delete this._measures[t])}}})}}}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(11),r(502),r(2),r(18),r(12),r(14),r(1)],void 0===(o=function(e,t,r,n,o,i,a){var s=e.extend({options:{layerId:"measure-layer",showTipLink:!0,symbols:{line:{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},borderThickness:2,opacity:1}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{a:120,r:255,g:0,b:0},fillColor:{a:50,r:200,g:0,b:0},borderThickness:2,opacity:1}},node:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{a:200,r:200,g:0,b:0},fillColor:{a:250,r:255,g:255,b:255},borderThickness:2,size:4}},delete:{type:"PictureMarkerSymbol",options:{source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAIAAACQKrqGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAb0lEQVR42mNYfuABHB28sxOIjtzds+bwQ2RxCGKAUP8ZGPAghFIQHz8Aq0ZSCjEDVQVcCptSuGpkLrpSZGkMbdjciqmOYqXEOoAEbxEMLGBMEhMFQGUMkHjHH7EQNQxfP38AojMPjx6+uxsihAsBAMBJhSJg1b4KAAAAAElFTkSuQmCC",width:14,height:14,opacity:1}}},styleName:["emap-measure-node-tooltip","emap-measure-tooltip"],lengthTipFn:function(e,t){isNaN(t)||(t=(t/1e3).toFixed(2));var r={start:function(){return"起点"},node:function(e){return e+"公里"},end:function(e){return"总长:"+e+"公里"}},n=r[e];if("[object Function]"==Object.prototype.toString.call(n))return r[e](t)},areaTipFn:function(e,t){return"周长:"+(e=(e/1e3).toFixed(2))+"公里 <br/>面积:"+(t=(t/1e6).toFixed(2))+"平方公里"}},initialize:function(t){var r=this;e.prototype.initialize.call(this,t),this._measuringTool=null,this._measuringObj=null,this._measures={},this._initialize(),this.onMapClick=function(e,t,n,o,i,a){r._clickHandler(n,o)},this.map.on("click",this.onMapClick,this),this.lastTool=null},destroy:function(){this.clear(),this.map.removeLayer(this._drawLayer),this.map.removeLayer(this._measureLayer),this.map.off("click",this.onMapClick),e.prototype.destroy.call(this)}});return s.include({_initialize:function(){var e=i.getLayerById(this.options.layerId+"-draw");e||(e=new a.carto.ElementLayer3D({id:this.options.layerId+"-draw"}),this.map.addLayer(e));var t=i.getLayerById(this.options.layerId);t||(t=new a.carto.ElementLayer3D({id:this.options.layerId}),this.map.addLayer(t)),this._drawLayer=e,this._measureLayer=t,this._toolTipWare=new a.widget.TooltipWare3D({map:this.map}),this._toolTipWare.map=this.map,this._nodeSymbol=n.object2Symbol(this.options.symbols.node.type,this.options.symbols.node.options),this._deleteSymbol=n.object2Symbol(this.options.symbols.delete.type,this.options.symbols.delete.options),this._createTools()},_clickHandler:function(e,t){var r=this._measureLayer.hitTest(e,t);if(r&&"_measure_id"in r.element&&"_measure_type"in r.element){var n=this._measures[r.element._measure_id];this._clearMeasure(n)}},_clearMeasuring:function(){this._drawLayer.clear(),this._measuringTool&&delete this._measuringTool._measure_id,this._measuringTool=null,this._measuringObj&&this._clearMeasure(this._measuringObj),this._measuringObj=null,this._ellipseElement=null,delete this._ellipseElement},_clearMeasure:function(e){if(r.isObject(e)){var t=e.element,n=e.nodes,o=e.tooltips,i=e.deleteEle,a=e.linkEle;t&&this._measureLayer.remove(t),i&&this._measureLayer.remove(i),a&&this._measureLayer.remove(a);for(var s=0,l=n.length;s<l;s++)n[s]&&this._measureLayer.remove(n[s]);for(s=0,l=o.length;s<l;s++)this._toolTipWare.remove(o[s].id);delete this._measures[e.id]}},_saveLastTool:function(){this.lastTool=this.map.tool},_resumeLastTool:function(){if(this.lastTool)this.map.currentTool(this.lastTool),this.lastTool=null;else{this.map.tool&&!{measurePolygonTool:!0,measureLineTool:!0,measureCircleTool:!0,measureEllipseTool:!0}.hasOwnProperty(this.map.tool.id)||this._noopTool.onClick()}}}),s.include({measureLength:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._lineTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureArea:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._polygonTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureCircle:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._circleTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},measureEllipse:function(){this._clearMeasuring(),this._saveLastTool(),this._measuringTool=this._ellipseTool,this._measuringTool.onClick(),this._measuringTool._measure_id=r.newUUID32()},finish:function(){if(!this._measuringTool)throw new Error("当前无测量！");try{this._measuringTool.onEndDraw()}catch(e){throw new Error("结束异常！error="+e.message)}},cancel:function(){this._clearMeasuring(),this._resumeLastTool()},clear:function(){this._measures={},this._drawLayer.clear(),this._measureLayer.clear(),this._toolTipWare.clear()}}),t.extend(s,"_measure_id","_measure_type"),s}.apply(t,n))||(e.exports=o)},function(e,t,r){"use strict";var n,o;n=[r(11),r(2),r(18),r(12),r(1)],void 0===(o=function(e,t,r,n,o){return{extend:function(e,i,a){var s="NoopTool";e.include({_createTools:function(){var e=this.options.symbols,t=r.object2Symbol(e.line.type,e.line.options),n=r.object2Symbol(e.polygon.type,e.polygon.options),i={map:this.map,spatialRef:{srid:this.map.getSrid()},tooltipWare:this._toolTipWare},a=new o.sfs.Path({spatialReference:this.map.getSrid()}),l=new o.sfs.Polyline({spatialReference:this.map.getSrid()});l.addGeometry(a),this._polylineTemplate=new o.sfs.Element({geometry:l,symbol:t}),this._lineTool=new o.draw.DrawTool({id:"measureLineTool",cursor:"crosshair",templateElement:this._polylineTemplate.copy(),drawLayer:this._drawLayer}),this._extendLineTool(this._lineTool),this._lineTool.onCreate(i);var c=new o.sfs.Ring({spatialReference:this.map.getSrid()}),u=new o.sfs.Polygon({spatialReference:this.map.getSrid()});u.addGeometry(c),this._polygonTemplate=new o.sfs.Element({geometry:u,symbol:n}),this._polygonTool=new o.draw.DrawTool({id:"measurePolygonTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendPolygonTool(this._polygonTool),this._polygonTool.onCreate(i),this._circleTool=new o.draw.DrawTool({id:"measureCircleTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendCircleTool(this._circleTool),this._circleTool.onCreate(i),this._ellipseTool=new o.draw.DrawTool({id:"measureEllipseTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendEllipseTool(this._ellipseTool),this._ellipseTool.onCreate(i),this._noopTool=new o.interact.NoopTool({id:s,cursor:"pointer"}),this._noopTool.onCreate(i)},_extendLineTool:function(e){var r=this;function n(e,r,n,a,s,l,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=this._lineTool.drawElement.geometry.paths[0].points.slice(f.points.length);"ontouchend"in document?0===f.points.length?h=h.slice(0,1).concat(h.slice(2)):1===f.points.length&&(h=h.slice(1)):h=h.slice(0,h.length-1);for(var p=0,d=h.length;p<d;p++){var y=this.map.pickSurfacePosition({x:n,y:a});y.spatialReference=this.map.getSrid();var m=this._addNodeEle(u,y,this._nodeSymbol);f.nodes.push(m),f.points.push(y);var g,v,b=this._getStyleName(0),_=this._measureLayer.id;1==f.points.length?g=this.options.lengthTipFn("start"):(v=this._measurePolyline(f.points),g=this.options.lengthTipFn("node",v));var w=new o.widget.Tooltip({id:t.newUUID32(),anchor:y,content:g,layerId:_,offset:[10,15],className:b});w[i]=u,f.tooltips.push(w),this._toolTipWare.add(w)}}function s(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r);if(n.points.length<2)throw new Error("距离测量至少两个点！");e.geometry=this._constructGeometry("polyline",n.points);var s=n.tooltips.splice(n.tooltips.length-1,1)[0];this._toolTipWare.remove(s.id);var c=this._measureLayer.id,u=this._getStyleName(1),f=this._measurePolyline(n.points),h=this.options.lengthTipFn("end",f),p=l.call(this,n),d=new o.widget.Tooltip({id:t.newUUID32(),anchor:s.anchor,content:h,layerId:c,offset:[10,p[1]],className:u});d[i]=r,n.tooltips.push(d),this._toolTipWare.add(d),this._deleteSymbol.offsetX=p[0],this._deleteSymbol.offsetY=p[1];var y=new o.sfs.Element({geometry:s.anchor,symbol:this._deleteSymbol});y[i]=r,y[a]="delete",this._measureLayer.add(y),n.deleteEle=y,e[i]=r,this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()}function l(e){var t=this.options.symbols.delete.options,r=t.width,n=t.height,o=t.offsetX,i=t.offsetY,a=e.points;if(isNaN(o)&&a.length>1){var s=a[a.length-1],l=a[a.length-2];o=s.x>=l.x?-5:r+5}return isNaN(i)&&(i=n/2),[o,i]}e.onPosition3d=function(e,t,r){this.mapz=r},e.onMouseUp=function(){n.apply(r,arguments)},e.onEndDraw=function(){s.apply(r,arguments)}},_extendPolygonTool:function(e){var r=this;function n(e,t,r,n,o,a,s){var l=this._measuringTool[i],c=this._getMeasuring(l),u=this.map.pickSurfacePosition({x:r,y:n});if(this._polygonTool&&this._polygonTool.drawElement){var f=this._polygonTool.drawElement.geometry.shell.points;f.length>2&&(u=f[f.length-3]);var h=this._addNodeEle(l,u,this._nodeSymbol);c.nodes.push(h),c.points.push(u)}}function s(e){var r=this;e=e||this._drawLayer.elements[0];var n=this._measuringTool[i],s=this._getMeasuring(n);if(s.points.length<3)throw new Error("多边形测量至少三个点！");e.geometry=this._constructGeometry("polygon",s.points);var l=this._measurePolygon(s.points),c=this._getStyleName(1),u=this._measureLayer.id,f=this.options.areaTipFn.apply(window,l),h=e.geometry.getBaryCenter(),p=new o.sfs.Point(h);p.spatialReference=this.map.getSrid(),this._getAltitude([h.x,h.y]).then((function(l){p.z=l;var h=new o.widget.Tooltip({id:t.newUUID32(),anchor:p,content:f,layerId:u,offset:d,className:c});h[i]=n,s.tooltips.push(h),r._toolTipWare.add(h);var d=r._caculateDeleteMarkerOffset(s);r._deleteSymbol.offsetX=d[0],r._deleteSymbol.offsetY=d[1];var y=s.points[s.points.length-1],m=new o.sfs.Element({geometry:y,symbol:r._deleteSymbol});m[i]=n,m[a]="delete",r._measureLayer.add(m),s.deleteEle=m,r._addLinkEle(s,p,y),e[i]=n,r._measureLayer.add(e),s.element=e,r._measures[n]=s,r._measuringObj=null,r.cancel()}))}e.onMouseUp=function(){n.apply(r,arguments)},e.onEndDraw=function(){s.apply(r,arguments)},e.onPosition3d=function(e,t,r){this.mapz=r}},_extendCircleTool:function(e){var t=this;function r(e,t,r,n,o,a,l){var c=this._measuringTool[i],u=this._getMeasuring(c),f=this.map.pickSurfacePosition({x:r,y:n});0==u.points.length?u.points.push(f):(s.call(this,u,f),this._onCircleEllipseEndDraw.call(this))}function a(e,t,r,n,o,a,l){var c=this._measuringTool[i],u=this._getMeasuring(c),f=this.map.pickSurfacePosition({x:r,y:n});s.call(this,u,f)}function s(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var r=e.points,i=r[0],a=r[1],s=this.map.getPixelFromCoordinate([i.x,i.y]),l=this.map.getPixelFromCoordinate([a.x,a.y]),c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2));if(0==parseFloat(c).toFixed(6))return;for(var u=n.getCirclePonits({center:s,radius:c,count:128,spatialReference:3857}),f=new o.sfs.Ring,h=0,p=u.length;h<p;h++){var d=u[h],y=this.map.getCoordinateFromPixel(d);f.addPoint(new o.sfs.Point({x:y[0],y:y[1],spatialReference:3857}))}var m=this._drawLayer.elements[0],g=m.geometry;g.removeAllGeometry(),g.addGeometry(f),this._drawLayer.update(m)}}e.onMouseUp=function(){r.apply(t,arguments)},e.onMouseMove=function(){a.apply(t,arguments)},e.onEndDraw=function(){t._onCircleEllipseEndDraw.apply(t,arguments)},e.onPosition3d=function(e,t,r){this.mapz=r}},_extendEllipseTool:function(e){var r=this;function n(e,t,r,n,o,a,c){var u=this._measuringTool[i],f=this._getMeasuring(u),h=this.map.pickSurfacePosition({x:r,y:n});0==f.points.length?(f.points.push(h),this._ellipseElement=s.call(this,{}),this._ellipseElement.plot.addControlPoint(h)):(l.call(this,f,h),this._onCircleEllipseEndDraw.call(this))}function a(e,t,r,n,o,a,s){var c=this._measuringTool[i],u=this._getMeasuring(c),f=this.map.pickSurfacePosition({x:r,y:n});l.call(this,u,f)}function s(e){var r=new o.plot.EllipseAlgorithm({}),n=new o.sfs.AttributeSet,i=new o.sfs.PlotElement({id:t.newUUID32(),kind:"ellipseTemplate",algorithm:r,attributeSet:n}),a=new o.sfs.Element({geometry:new o.sfs.Polygon,attributeSet:n});return i.add(a),i.reset(),i}function l(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var r=this._ellipseElement.plot,n=this._ellipseElement.algorithm.createGeometries(r,t)[0],o=this._drawLayer.elements[0];o.geometry=n,this._drawLayer.update(o)}}e.onMouseUp=function(){n.apply(r,arguments)},e.onMouseMove=function(){a.apply(r,arguments)},e.onEndDraw=function(){r._onCircleEllipseEndDraw.apply(r,arguments)},e.onPosition3d=function(e,t,r){this.mapz=r}},_constructGeometry:function(e,t){var r=this;return{polyline:function(e){for(var t=new o.sfs.Path({spatialReference:r.map.getSrid()}),n=0;n<e.length;n++)t.addPoint(e[n]);var i=new o.sfs.Polyline({spatialReference:r.map.getSrid()});return i.addGeometry(t),i},polygon:function(e){for(var t=new o.sfs.Ring({spatialReference:r.map.getSrid()}),n=0;n<e.length;n++)t.addPoint(e[n]);var i=new o.sfs.Polygon({spatialReference:r.map.getSrid()});return i.addGeometry(t),i}}[e](t)},_onCircleEllipseEndDraw:function(e){e=e||this._drawLayer.elements[0];var r=this._measuringTool[i],n=this._getMeasuring(r),s=e.geometry.shell,l=this._measurePolygon(s.points),c=this._getStyleName(1),u=this._measureLayer.id,f=[0,0],h=this.options.areaTipFn.apply(window,l),p=e.geometry.getBaryCenter(),d=new o.sfs.Point(p);d.spatialReference=this.map.getSrid();var y=new o.widget.Tooltip({id:t.newUUID32(),anchor:d,content:h,layerId:u,offset:f,className:c});n.tooltips.push(y),this._toolTipWare.add(y);f=this._caculateDeleteMarkerOffset(n,!0);this._deleteSymbol.offsetX=f[0],this._deleteSymbol.offsetY=f[1];var m=s.points[parseInt(7*(s.points.length-1)/8)],g=new o.sfs.Element({geometry:m,symbol:this._deleteSymbol});g[i]=r,g[a]="delete",this._measureLayer.add(g),n.deleteEle=g,this._addLinkEle(n,d,m),e[i]=r,this._measureLayer.add(e),n.element=e,this._measures[r]=n,this._measuringObj=null,this.cancel()},_caculateDeleteMarkerOffset:function(e,t){var r=this.options.symbols.delete.options,n=r.width,o=r.height,i=r.offsetX,a=r.offsetY,s=e.points;if(isNaN(i)&&s.length>1){var l=s[s.length-1],c=s[s.length-2];i=!0===t||l.x>=c.x?-5:n+5}return isNaN(a)&&(a=o/2),[i,a]},_addNodeEle:function(e,t,r){var n=new o.sfs.Element({geometry:t,symbol:r});return n[i]=e,this._measureLayer.add(n),n},_addLinkEle:function(e,t,n){if(!0===this.options.showTipLink){var a=this.options.symbols,s=new o.sfs.Path({spatialReference:this.map.getSrid()});s.addPoint(t),s.addPoint(n);var l=new o.sfs.Polyline({spatialReference:this.map.getSrid()});l.addGeometry(s);var c=jQuery.extend(!0,{},a.line);if("SimpleFillSymbol"==c.type)c={type:"SimpleLineSymbol",options:{color:c.options.borderColor}};c.options.style=3,c.options.width=2,c.options.color.a=.7*(c.options.color.a||c.options.color.alpha||0);var u=r.geoinfoToElement(l,c);u[i]=e.id,this._measureLayer.add(u),e.linkEle=u}},_getStyleName:function(e){return t.isArray(this.options.styleName)?this.options.styleName[e]:this.options.styleName},_getMeasuring:function(e){return this._measuringObj||(this._measuringObj={element:null,points:[],tooltips:[],nodes:[],deleteEle:null,linkEle:null}),this._measuringObj.id=e,this._measuringObj},_measurePolyline:function(e){for(var t=new o.sfs.Path({spatialReference:this.map.getSrid()}),r=0,i=e.length;r<i;r++)t.addPoint(e[r]);var a=new o.sfs.Polyline({spatialReference:this.map.getSrid()});return a.addGeometry(t),n.measureLength(a)},_measurePolygon:function(e){for(var t=[],r=[],i=0,a=e.length;i<a;i++)t.push([e[i].x,e[i].y]),r.push([e[i].x,e[i].y]);t.push([e[0].x,e[0].y]);var s={type:"Polygon",coordinates:[t]},l=o.sfs.GeometryFactory.createGeometryFromGeoJson(s,this.map.getSrid()),c=o.sfs.GeometryFactory.createGeometryFromGeoJson({type:"LineString",coordinates:r},this.map.getSrid());return[a=n.measureLength(c),n.measureArea(l)]},_getAltitude:function(e){var t=this;return new Promise((function(r,n){var i=new o.sfs.Point({x:e[0],y:e[1],z:0,spatialReference:t.map.getSrid()});t.map.getAltitude([i]).then((function(e){var t=e[0];r(parseFloat(t.z.toFixed(2)))}))}))},createSchema:function(){var e={measures:{},extent:this.map.getExtent()};for(var t in this._measures){var r=this._measures[t];if(r){var n={},o=r.element,s=r.nodes,l=r.tooltips,c=r.deleteEle,u=r.linkEle;if(c){var f=c.copy();f.unReset(),f.id=c.id,f[i]=c[i],f[a]=c[a],n.deleteEle=f}if(o){var h=o.copy();h.unReset(),h.id=o.id,h[i]=o[i],n.element=h}if(u){var p=u.copy();p.unReset(),p.id=u.id,p[i]=u[i],n.linkEle=p}n.nodes=[];for(var d=0;d<s.length;++d){var y=s[d];if(y){var m=y.copy();m.unReset(),m.id=y.id,m[i]=y[i],n.nodes.push(m)}}n.points=r.points,n.tooltips=l,n.id=t,r.schemaId&&(n.schemaId=r.schemaId),e.measures[t]=n}}var g=this.map.camera;return e.camera={heading:g.heading,pitch:g.pitch,roll:g.roll,position:g.position},e},loadSchema:function(e,t,r){var n=e.measures,i={},a=new o.core.Deserializer;for(var s in n){var l=n[s],c={};if(l)if(this._measures[l.id])this._measures[l.id].schemaId=t;else{var u=l.element,f=l.nodes,h=l.tooltips,p=l.deleteEle,d=l.linkEle;p&&((p=a.createJsInstance(p)).reset(),c.deleteEle=p,this._measureLayer.contains(p.id)||this._measureLayer.add(p)),u&&((u=a.createJsInstance(u)).reset(),c.element=u,this._measureLayer.contains(u.id)||this._measureLayer.add(u)),d&&((d=a.createJsInstance(d)).reset(),c.linkEle=d,this._measureLayer.contains(d.id)||this._measureLayer.add(d)),c.nodes=[];for(var y=0;y<f.length;++y){var m=f[y];(m=a.createJsInstance(m)).reset(),c.nodes.push(m),this._measureLayer.contains(m.id)||this._measureLayer.add(m)}c.tooltips=[];for(var g=0;g<h.length;++g){for(var v=h[g],b=this._toolTipWare.tooltips,_=!1,w=0;w<b.length;w++)b[w].id===v.id&&(_=!0);_||(this._toolTipWare.add(v),c.tooltips.push(v))}l.schemaId?c.schemaId=l.schemaId:t&&(c.schemaId=t),c.id=s,i[s]=c}}if(e.camera&&r){var S=a.createJsInstance(e.camera.position);this.map.camera.flyTo(S,e.camera.heading,e.camera.pitch,e.camera.roll)}else if(e.extent&&r){var L=a.createJsInstance(e.extent);L.spatialReference=this.map.getSrid(),this.map.camera.setView(L)}this._measures=Object.assign(this._measures,i)},removeSchema:function(e){for(var t in this._measures){var r=this._measures[t];r&&r.schemaId&&r.schemaId===e&&(this._clearMeasure(r),delete this._measures[t])}}})}}}.apply(t,n))||(e.exports=o)},function(e,t,r){var n=r(11),o=(r(2),n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this._addFullScreenStyle()},load:function(){n.prototype.load.call(this)},unload:function(){n.prototype.unload.call(this)},fullScreen:function(){this._handleFullScreen()},exit:function(){this._handleExit()},destroy:function(){n.prototype.destroy.call(this)},_handleFullScreen:function(){if(this._isFullScreenSupported()){var e,t=this.map;if(t)if(!this._isFullScreen())e=this.options.source?"string"==typeof this.options.source?document.getElementById(this.options.source):this.options.source:document.getElementById(t.options.targetId),this.keys_?this._requestFullScreenWithKeys(e):this._requestFullScreen(e)}},_handleExit:function(){this._isFullScreenSupported()&&(this.map&&this._isFullScreen()&&this._exitFullScreen())},_requestFullScreen:function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},_exitFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},_isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},_isFullScreenSupported:function(){var e=document.body;return!!(e.webkitRequestFullscreen||e.mozRequestFullScreen&&document.mozFullScreenEnabled||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)},_addFullScreenStyle:function(){var e;e=this.options.source?"string"==typeof this.options.source?this.options.source:this.options.source.id:this.map.options.targetId;var t=document.getElementById("fullscreen_style");t||((t=document.createElement("style")).type="text/css",t.id="fullscreen_style",document.getElementsByTagName("head")[0].appendChild(t));var r="#"+e+":-moz-full-screen {height: 100%;width: 100%;}",n="#"+e+":-webkit-full-screen {height: 100%;width: 100%;}",o="#"+e+":-ms-fullscreen {height: 100%;width: 100%;}",i="#"+e+":fullscreen {height: 100%;width: 100%;}";t.appendChild(document.createTextNode(r)),t.appendChild(document.createTextNode(n)),t.appendChild(document.createTextNode(o)),t.appendChild(document.createTextNode(i))}}));e.exports=o},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}var o=r(11),i=(r(2),o.extend({options:{},initialize:function(e){o.prototype.initialize.call(this,e)},getImage:function(e){var t=this;return new Promise((function(r,n){var o=document.getElementById(e||t.map.options.targetId);html2canvas(o,{onrendered:function(e){r(e.toDataURL())},useCORS:!0})}))},downloadImage:function(e,t){var r=this;return new Promise(function(){var o,i=(o=regeneratorRuntime.mark((function n(o,i){var a,s,l,c,u,f,h,p,d,y,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.getImage(e);case 2:if(a=n.sent,s=(t=t||"screenshot")+".png",window.ActiveXObject||"ActiveXObject"in window)l=function(e){for(var t=atob(e.split(",")[1]),r=[],n=0;n<t.length;n++)r.push(t.charCodeAt(n));return new Blob([new Uint8Array(r)],{type:"image/png"})}(a),window.navigator.msSaveOrOpenBlob(l,s);else{for(c=document.createElement("a"),u=a.split(";base64,"),f=u[0].split(":")[1],h=window.atob(u[1]),p=h.length,d=new Uint8Array(p),y=0;y<p;++y)d[y]=h.charCodeAt(y);m=new Blob([d],{type:f}),document.createEvent("HTMLEvents").initEvent("click",!0,!0),c.download=s,c.href=URL.createObjectURL(m),c.click()}o();case 7:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,i){var a=o.apply(e,t);function s(e){n(a,r,i,s,l,"next",e)}function l(e){n(a,r,i,s,l,"throw",e)}s(void 0)}))});return function(e,t){return i.apply(this,arguments)}}())},destroy:function(){o.prototype.destroy.call(this)}}));e.exports=i},function(e,t,r){var n=r(11),o=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.options.format=this.options.format?this.options.format:"{x} | {y}",this.options.precision=this.options.precision?this.options.precision:6,this.options.lnglatFormat=this.options.lnglatFormat?this.options.lnglatFormat:"DD",this.dom=document.getElementById(this.options.targetId),this.srid=this.map.spatialReference},load:function(){n.prototype.load.call(this),this.map.listen("mousemove",this._mapListener,this)},unload:function(){this.map.off("mousemove",this._mapListener,this),n.prototype.unload.call(this)},destroy:function(){this.unload(),n.prototype.destroy.call(this)},_mapListener:function(e){var t=this._updateView(e.screenX,e.screenY,e.mapX,e.mapY);this.fire(this.options.eventName,t)},_updateView:function(e,t,r,n){var o=parseFloat(r),i=parseFloat(n),a=0,s=0,l={},c=this;({DD:function(e){var t=c._transform([o,i],c.srid,4326);o=t[0],i=t[1],a=o.toFixed(e.precision),s=i.toFixed(e.precision),l.x=parseFloat(a),l.y=parseFloat(s)},DMS:function(e){var t=c._transform([o,i],c.srid,4326);o=t[0],i=t[1],a=o.toFixed(e.precision),s=i.toFixed(e.precision),l.x=o,l.y=i;var r=parseInt(o),n=60*(o-r),u=parseInt(n).toString(),f=parseInt(60*(n-u)).toString();a=r+"°"+(u.length>1?u:0+u)+"′"+(f.length>1?f:0+f)+"″";var h=parseInt(i),p=60*(i-h),d=parseInt(p).toString(),y=parseInt(60*(p-d)).toString();s=h+"°"+(d.length>1?d:0+d)+"′"+(y.length>1?y:0+y)+"″"},MM:function(e){a=o.toFixed(e.precision),s=i.toFixed(e.precision),l.x=parseFloat(a),l.y=parseFloat(s)}})[this.options.lnglatFormat](this.options),l.xText=a,l.yText=s,"1"==this.options.formatType?o>0&o<180&i>0&i<=90?(a="E "+a,s="N "+s):o>0&o<180&i>=-90&i<0?(a="E "+a,s="S "+s.replace(/-/g,"")):o>-180&o<0&i>-90&i<0?(a="W "+a.replace(/-/g,""),s="S "+s.replace(/-/g,"")):o>-180&o<0&i>0&i<=90&&(a="W "+a.replace(/-/g,""),s="N "+s):"2"==this.options.formatType&&(o>0&o<180&i>0&i<=90?(a+=" E",s+=" N"):o>0&o<180&i>=-90&i<0?(a+=" E",s=s.replace(/-/g,"")+" S"):o>-180&o<0&i>-90&i<0?(a=a.replace(/-/g,"")+" W",s=s.replace(/-/g,"")+" S"):o>-180&o<0&i>0&i<=90&&(a=a.replace(/-/g,"")+" W",s+=" N"));var u=this.options.format;return u=(u=u.replace("{x}",a)).replace("{y}",s),l.text=u,l},_transform:function(e,t,r){var n=new g2.sfs.CoordinateTransform,o=new g2.sfs.Point({x:e[0],y:e[1]});o.setSpatialReference(t);var i=n.transform(o,r);return[i.x,i.y]}});e.exports=o},function(e,t,r){var n=r(11),o=r(507),i=n.extend({options:{scaleMaxWidth:100},initialize:function(e){n.prototype.initialize.call(this,e)},addListeners:function(){this.map.listen("resolutionchanged",this._resolutionchanged,this)},removeListeners:function(){this.map.off("resolutionchanged",this._resolutionchanged)},getMapDom:function(){var e=this.map.options.targetId;return document.getElementById(e)},getScale:function(){return o.getScale(this.map,{scaleMaxWidth:this.options.scaleMaxWidth})},export:function(e){return new Promise((function(e,t){e({})}))},download:function(e){var t=new G.common.ScreenShot({map:this.map});t.downloadImage(e.domId,e.name),t.destroy},updateMapViewSize:function(e,t){var r=this.getMapDom();isNaN(e)||(r.style.width=e+"px"),isNaN(t)||(r.style.height=t+"px"),this.map.updateViewSize()},_resolutionchanged:function(){this._updateScale()},_updateScale:function(){var e=o.getScale(this.map,{scaleMaxWidth:this.options.scaleMaxWidth});e&&this.fire("update-scale",e)},destroy:function(){n.prototype.destroy.call(this)}});e.exports=i},function(e,t){var r={getScale:function(e,t){var r=e.getExtent(),n=r.center().y,o=6378137*Math.PI*Math.cos(n*Math.PI/180)*(r.maxx-r.minx)/180,i=e.getViewSize(),a=t.scaleMaxWidth,s=0;i[0]>0&&(s=o*(a/i[0]));var l=this.getRoundNum(s);return{width:this.getScaleWidth(t.scaleMaxWidth,l/s),scale:l,scaleText:l<1e3?l+" m":l/1e3+" km"}},getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),r=e/t;return t*(r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:1)},getScaleWidth:function(e,t){return Math.round(e*t)-10}};e.exports=r},function(e,t,r){var n=r(11),o=r(14),i=r(38),a=(r(1),n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e)},load:function(){n.prototype.load.call(this)},addListeners:function(){this.map.listen(i.LAYER_CHANGED,this._onLayerChanged,this)},removeListeners:function(){this.map.off(i.LAYER_CHANGED,this._onLayerChanged,this)},_onLayerChanged:function(e){var t=this._getList(this._listOptions);this.fire("layer_changed",{list:t})},getLayerList:function(e){var t=this;return this._listOptions=e,new Promise((function(r,n){t._checkLoaded();r(t._getList(e))}))},_getList:function(e){(e=e||{}).filter=e.filter||function(e){return e.name&&e.id};for(var t=[],r=o.defaultGroupLayers,n={},i=0;i<r.length;i++)n[r[i].id]=r[i];for(var a=this.map.getLayers(),s=0;s<a.length;s++){var l=a[s];if(e.filter(l))if(n.hasOwnProperty(l.id))for(var c=l.groupLayers,u=0;u<c.length;u++){var f=c[u];if(e.filter(f)){var h=this._buildLayerInfo(f);t.push(h)}}else{var p=this._buildLayerInfo(l);t.push(p)}}return t},_buildLayerInfo:function(e){var t={};return t.id=e.id,t.name=e.name,t.isBase=o.isBaseLayer(e),t.visible=e.visible,t},setLayerVisible:function(e){this._checkLoaded();var t=o.getLayerById(this.map,e.id);return t?(t.setVisible(!!e.visible),t):null},getLayerInfo:function(e){this._checkLoaded();var t=o.getLayerById(this.map,e);return t?this._buildLayerInfo(t):null},unload:function(){n.prototype.load.call(this)},destroy:function(){n.prototype.destroy.call(this)}}));e.exports=a},function(e,t,r){var n={Buffer:r(510),MousemoveOverlay:r(518),SelectLocation:r(519)};e.exports=n},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}var o,i,a=r(11),s=r(12),l=r(2),c=r(18),u=r(1),f=r(511),h=r(515),p=r(516),d=r(517),y=a.extend({options:{name:"缓冲区查询 ",radius:5e4,buffer_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAUCAYAAADskT9PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzdCRTQ5OTYzRkFFMTFFNDk1NTE5ODREMUQwMDhDMzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzdCRTQ5OTczRkFFMTFFNDk1NTE5ODREMUQwMDhDMzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDN0JFNDk5NDNGQUUxMUU0OTU1MTk4NEQxRDAwOEMzMyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDN0JFNDk5NTNGQUUxMUU0OTU1MTk4NEQxRDAwOEMzMyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpA7b9wAAAPDSURBVHjarFZbTxNREJ7d7ba7lbaAgqBUMETEW9OggCYiYIyKJhp+gA/6B4wPhGhMjET9CaivXggxXogkaqLxQXxofCCKFRSjQohRgZa2WLbXXWfWs02tB2ONk3xJe2Z25pvvzDm7Ql9fH3BMQEigaeWQTu8Cw9iB/0sQ1fA3ZhgGCMIs/gojXiGeg8czzwu1cQrbIJWqhETiOOj6YX9LS+X6hga3Q1Gk0rIyB/ylLcZiqaV4PPN5evr7i5GROYhEhpDUFSQS/qVgngJUXIFkcgsWP9dx4IC/pa2t2m63S8bPrqBoEwQzKT5pvHj27Mvj4eGXuHYKSUwWKkBxKmQyjVj8Uld397amnTurdF2HbDYL/8GE5ra2NStcLnloYKAfotFjSOJLPgHZ3F9NO7m3q2uzv7W1KpPJwH81bGaTz1eRTCS2PLx79yKunKBlkaEU9313jdfb3NrevjaLxal7Hvb1BE0U6yNkUE2cqaqtTU17UIUOi4AdUYkE9qCznDon2XkJ9veO5zX0u98yiuOSwLyU37d9+0qcqSMWAdUkoOt1NXV1nmw6bQYW4uDpt7kCDy5s4MbQumUUz4shdau9XjeGNFsEFEQZMnKqTqecpcErwKGz73OJh/vqgRdjgfyW0XOFftoGUZJErFWC2+CysQFUkIAoCoJAAcYfjpxe5KngxRtIRLbbRS2RUMTcMRTFBF4caYPtVT7unfXmHj56foorrQXyW0bPFfpZfiMWiWjgdoeIAFFMIoHw/Oxs3MDLgyft7TNrc4m7L8xwY2jdMornxZC2USouCNMkhmgWx5sTZHn6XTC4INtswFOBcKu36hdpC2EZxfH8lNeG+SffvAkhgadEgGZgCTEHDsfE2Oior76hwbOmtnYVXhjcWRjsqcwdw2J8OF5gk2UIzc1FR548mQRFGbJOASnwDfEVVDVwb2DgYyQcjuKQmHItd6kUA2qEiqeSyaWbV6++B0m6jA2HiIDU2dlJdTLmIEqSDanqrwMBtaa21rGyosJpsARFg3UtoeSKqkIkFIpc6+9/h1t9HUpK7rDGc++CBGLGvBUd+MYVxfjQ4GB8q9+/rtHnK3N7PKq7tFQ1ONIu+/YRRdDi8eRiNKqNjo8vjAYCnzD3DVT5Ptt2I5+Abg4iwAdEClnGaCiDExMbg2Nj61FHD8L9D6/jRWwmhJM3Bi7XI/xN+SPs5P32QUKLMUZiAbEaGU8h3Oy2lIq5f5iq1FTInK+fX0dLzLfsF5HOgpLsASfCweKEIghYc5VCaAzcK/SHAAMA4XIlf6DGCVoAAAAASUVORK5CYII=",close_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAGG0lEQVRYhc3Zb2wbdx3H8ffv7uy72vHVvSV206yJIy0pqipW0apj7TSghVpjzwZZ21VIWRDS/vCgYgOpQlSIgjaJiicg9gdGImBjm59MmlQWYH0C7bqVaJpWKtaA5rRNUqeJ5Z7j+M/940HtJCR27Zgk5fPs7vfnXpbOv7v7/kRoJEUzicci7cAB4AHgM0APEAQ2AjeBHDAK/BP4G/DucHJqcuk85ucida8lVoKMxyI+4BAw4HrenpzljN0sWp9mS/aNTNGaLrleqWA7BU2RNb8k/GHV1xryK20bVV930Cd3SUJcAH4DvD6cnLJWFRmPRQTQD5zIWY4zmStcGDPnLtuuZzf6AxVJKF16oLc9qO4O+hQFOAkMJgy8/xkZj0V6gKGC7XSOZnJ/nJgtXG0UVitbWrS7e8LBr2qKfAXoTxiMNo2MxyKHPI9fjs/mz19KZ9/3vPq/utEIgdhuhO7raNlwvxA8lTB4fcXIeCxyzHa9H16cNl9NzRWvrxZuaaIBdfOOVv2oIokfJQx+Vq2PVAP4nZLjfn8klXllLYEAqbni9ZFU5pWS4x7vS/NMQ8h4LPKo7XonRlKZoUzRyqwlsJJM0cqMpDJDtuv9oC/No7dFxmORXg9e/MeM+ZpZss31AFZilmzz4rT5mgcv9qXZVhVZXmYGx7P5c9dzxWWL7nokNVecHM/mzwGDfWnEMiTQX7Cdzkvp7Afrz1vIpXT2g4LtbAUer5yTYP5JcmI0kzu9mstMM/E8vNFM7jRwoi+Nbx4JHM5Ztj0xW7h253gLmZgtXMtZtgUchgXkwGSu+PdGJzkWDWwbv7ftu6mdbcdPbQ3trtf/552hz0/tbDt+9d62Z56KBO5p5BplzwCA+PqMt8X1vMtnrk6fclzPaWiCnW3fC0qipXL86kxh+Mkx82y1voPd+he+tkk7UDnOOF6m86MbVRftxZElIe/f2vqsJESPBOyftZyxRoEAPoF/8fHRu7T4C136vnpAAHXJ2FpxXM+ZtZwx4IAE7DOLVrJRIMAb6eK7S88dvUuLvxRbgFYDAt7vZgrLxtZK2fWgAmw3S/a/V4J8esx8zy9QDhnaVxafP2JocQC/QKkBfOfZq9kLDSNLdgrYoQDdZslueGAl30qafwWoBa0GfHrMfG8l1zBLdhrolICNRdsprBRZgb6RLvy5TremgABlly4BesFxi80goS60aSBA2RWSAFOTJbVZJIBPCLlGk1AEtdrqpuzKSsBNVZG1Zica6t74xUc2qftrtR8xtIMvxfQHmpm77DIl4FPdrxirCFz27G8WWnZdkYBLul+JrhbwtzP5d6rdo81Ay66LCnBWV30PAucbHfyLrtD9tYDfHsvO/0mqLE8H865nHbuSfb8hpOrrAv4gAWdafHJMlmre/MtyyNC+VA9Y619/ZPnYqpElIbf45G7gjDScnJqQhPgwpge21R1ZjuVi3Q54O2jRo6HlLqYHtklCfJgwmKi8qr3cHlTrvnJV8tz13FtZx8vOuV7u5Rv5t6sBF0OHpvOnC65XMB3PfG4y93Yj1yh7fgXl7+7ym/nlj6fNP/0/vPi2B7W7P9umHwR6EwaWBFAuHp3sCQcfEmLhA+hORAhE76bgQ8DJhHHrtlr8ITaoKfK17UZoz53h3cp2I7RHU+RxYLBybh45nJzygMc7Qhv2RgNq+50ARgNqe0fLhr3cKmLNPxT+qzgwnJz6RMATO1r1x3S/oq8nUPcr+o5W/TEheCJh8MnitmVlluHk1JuKJH68KxruD6u+8HoAw6ovvCsa7lck8ZOEwZtL26sWrIaTU6f8svT8rmh4IBpQN68lMBpQN++Khgf8svR8wuCn1frUq08e9jxeGJ/Nn1vD+uReIXiyqfrkImgP8PuC7WxZrUpve1Dr6N0UfFhT5AngGwmDy7fr32jNXGKhZm6Pz+bPXzHz/3K8xj+DZSHkTn3DPR0t2n2LauZDCQO33thmdh8OA990PG93znKSZtFKmiV7KlO0pi3HLRUct6jKkuqXJX9Y9bXqfiWiq75Y0CfHZCFGgF+zFrsPNcDtwJeBfSzs47QAOmACsyzs45wF/tLsPs5/AJzAxynEYGTgAAAAAElFTkSuQmCC"},initialize:function(e){a.prototype.initialize.call(this,e);var t=e.layer;this._createNewLayer=!1,t instanceof u.carto.GroupLayer||(t=new u.carto.GroupLayer({id:e.id||l.newUUID32(),name:e.name,map:this.map,zIndex:e.zIndex||100,layers:[],visible:!1}),this.map.addLayer(t),this._createNewLayer=!0),this._layer=t,this.bufferList=[],this.tool=new f({map:this.map}),this.tool.onCreate({map:this.map})},load:function(){this.isLoaded()||(a.prototype.load.call(this),this._layer.setVisible(!0),this.tool.onClick())},unload:function(){this.isLoaded()&&(a.prototype.unload.call(this),this.clearBuffer(),this.tool.deactivate(),this._layer.setVisible(!1))},destroy:function(){this._createNewLayer&&this.map.removeLayer(this._layer),a.prototype.destroy.call(this)},buffer:function(e){if(this._checkLoaded()){e.id=e.id||l.newUUID32(),e.buffer=e.buffer||{},e.buffer.draw=e.buffer.draw||{},this.removeBuffer(e.id);var t=this._createBufferLayer();this._layer.addLayer(t);var r=this._buffer(t,e);this.bufferList.push(r)}},drawBuffer:(o=regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._checkLoaded()){e.next=11;break}return t.id=t.id||l.newUUID32(),t.buffer=t.buffer||{},t.buffer.draw=t.buffer.draw||{},this.removeBuffer(t.id),r=this._createBufferLayer(),this._layer.addLayer(r),e.next=9,this._drawBuffer(r,t);case 9:n=e.sent,this.bufferList.push(n);case 11:case"end":return e.stop()}}),e,this)})),i=function(){var e=this,t=arguments;return new Promise((function(r,i){var a=o.apply(e,t);function s(e){n(a,r,i,s,l,"next",e)}function l(e){n(a,r,i,s,l,"throw",e)}s(void 0)}))},function(e){return i.apply(this,arguments)}),cancelDraw:function(){this.tool.endDraw()},setRadius:function(e,t){var r=this._getBufferById(t,!0);r&&(r.options.buffer.radius=e,this.buffer(r.options))},removeBuffer:function(e){for(var t=this,r=null,n=0;n<this.bufferList.length;n++){var o=this.bufferList[n];if(o.id===e){r=o,this.bufferList.splice(n,1),r.dragTool&&this.tool.remove(r.dragTool.id),r.closeTool&&this.tool.remove(r.closeTool.id),r.userTools&&r.userTools.forEach((function(e){t.tool.remove(e.id)})),r.layer.clear(),this._layer.removeLayer(r.layer);break}}return r},clearBuffer:function(){this._layer.removeAllLayers(),this.tool.clear(),this.bufferList=[]},getBufferGeometry:function(e){var t=this._getBufferById(e,!0);if(t){var r=t.layer;if(r&&r.elements.length>0)for(var n=r.elements,o=0;o<n.length;o++)if("buffer"===n[o].tag)return n[o].geometry}else console.debug("当前无缓冲！");return null}});y.include({_createBufferLayer:function(){return new u.carto.ElementLayer({id:l.newUUID32(),map:this.map,zIndex:this._layer.zIndex})},_buffer:function(e,t){var r={};t.buffer.hasOwnProperty("radius")||(t.buffer.radius=this.options.radius),t.buffer.callback=t.buffer.callback?t.buffer.callback:this.options.callback,t.buffer.onClose=t.buffer.onClose?t.buffer.onClose:this.options.onClose,t.buffer.close=t.buffer.close?t.buffer.close:this.options.close,t.buffer.drag=t.buffer.drag?t.buffer.drag:this.options.drag,t.buffer.axis=t.buffer.axis?t.buffer.axis:this.options.axis,t.buffer.label=t.buffer.label?t.buffer.label:this.options.label,t.buffer.fill=t.buffer.fill?t.buffer.fill:this.options.fill,t.buffer.drag=t.buffer.drag?t.buffer.drag:this.options.drag;var n,o,i=this._geometryConstructor2(t.data,!0),a=this._getBufferGeom(i,t.buffer.radius);n=this._getOutmostPoint(i),o=this._getOutmostPoint(a);var s=new u.sfs.Path({spatialReference:this.map.getSrid()});s.addPoint(n),s.addPoint(o);var l=new u.sfs.Polyline({spatialReference:this.map.spatialReference});l.addGeometry(s);var c=this._elementConstructor(this._geometryConstructor2(t.data,!1),t.buffer.draw.style,"buffertarget");c.id=t.id;var f=this._elementConstructor(l,t.buffer.axis?t.buffer.axis.style:null);f.id=t.id;var d=this._elementConstructor(a,t.buffer.fill?t.buffer.fill.style:null,"buffer");d.id=t.id,t.buffer.drag&&t.buffer.drag.visible&&(t.buffer.drag.style.options.source||(t.buffer.drag.style.options.source=this.options.buffer_img));var y=this._elementConstructor(o,t.buffer.drag?t.buffer.drag.style:null,"drag");y.id=t.id,t.buffer.close&&t.buffer.close.visible&&(t.buffer.close.style.options.source||(t.buffer.close.style.options.source=this.options.close_img));var m=this._elementConstructor(o,t.buffer.close?t.buffer.close.style:null,"closeButton");m.id=t.id;var g=l;if(t.buffer.label)if("middle"==t.buffer.label.position)g=l;else if("left"==t.buffer.label.position)g=n;else if("right"==t.buffer.label.position)g=o;t.buffer.draw.visible&&e.add(c);var v=this._elementConstructor(g,t.buffer.label?t.buffer.label.style:null);v.id=t.buffer.id;var b=this._getLength(l);if(console.log(b),v.symbol&&(v.symbol.text=Math.round(b)/1e3+"km"),t.buffer.fill&&t.buffer.fill.visible&&e.add(d),t.buffer.axis&&t.buffer.axis.visible&&e.add(f),t.buffer.close&&t.buffer.close.visible){e.add(m);var _=new p({bufferId:t.id,layer:e,removeBuffer:this.removeBuffer.bind(this),callback:t.buffer.onClose});_.id=t.id+"-close",r.closeTool=_,this.tool.add(_)}if(t.buffer.label&&t.buffer.label.visible&&(v.symbol.source||(v.symbol.source=this.options.buffer_img),e.add(v)),t.buffer.drag&&t.buffer.drag.visible){e.add(y);var w=new h({maxPoint:n,bufferMaxPoint:o,geometry:Object.assign({},i.asGeoJson()),bufferEle:d,parent:this,callBack:t.buffer.callback,map:this.map,drawLayer:e,lineEle:f,closeEle:m,picEle:y,textEle:v,textPosition:t.buffer.label?t.buffer.label.position:null,fillsymbol:d.symbol,context:t.buffer.context||this});w.id=t.id,r.dragTool=w,this.tool.add(w)}if(t.buffer.callback&&t.buffer.callback.call(this,a.asGeoJson(),t.buffer.radius,!1),t.buffer.buttons&&t.buffer.buttons.length>0){var S=this._createButtons(t,e,t.buffer.buttons,{_polyline:l,_startPoint:n,_endPoint:o},"userButton");r.userTools=S}return r.id=t.id,r.layer=e,r.options=t,r},_createButtons:function(e,t,r,n,o){var i=this,a=[];return r.forEach((function(r){var s=null;"middle"==r.position?s=n._polyline:"left"==r.position?s=n._startPoint:"right"==r.position&&(s=n._endPoint);var c=r.style||null,u=i._elementConstructor(s,c,o);u.id=r.id||l.newUUID32(),t.add(u);var f=new d({bufferId:e.id,toolId:u.id,layer:t,callback:r.callback});f.id=u.id+"-usertool",a.push(f),i.tool.add(f)})),a},_drawBuffer:function(e,t){var r=this;return new Promise((function(n,o){var i={};i.layer=e,i.symbol=t.buffer.draw.style||null,i.callback=function(r){if(this.tool.endDraw(),e.clear(),t.data={type:"wkt",geom:r.geometry.asWkt()},console.debug(t.data),t.buffer.draw.style=c.symbol2Object(r.symbol),s.getWktReader().read(t.data.geom).isValid()){var i=this._buffer(e,t);n(i)}else{this.fire("error",{type:"draw",message:"绘制图形无效！",tag:t.id}),o(new Error("绘制图形无效！"))}},i.context=r,r.tool.startDraw(t.type,i)}))},_getBufferById:function(e,t){var r=null;if(this.bufferList.length>0)if(void 0===e&&t)r=this.bufferList[this.bufferList.length-1];else for(var n=0;n<this.bufferList.length;n++)if(this.bufferList[n].id===e){r=this.bufferList[n];break}return r},_getLength:function(e){var t=new u.sfs.CoordinateTransform;return new u.sfs.MeasureService({projectService:t}).length(e)},_getOutmostPoint:function(e){var t=e.asGeoJson(),r=t.coordinates,n=this._sortFunction(r,t.type);return new u.sfs.Point({x:n[0][0],y:n[0][1],spatialReference:this.map.getSrid()})},_getBufferGeom:function(e,t){var r=G.utils.SpatialOPUtil.getBuffer({geometry:e.asGeoJson(),radius:parseFloat(t),spatialReference:4326});return u.sfs.GeometryFactory.createGeometryFromGeoJson(r,e.spatialReference)},_elementConstructor:function(e,t,r){var n=new u.sfs.Element({geometry:e,tag:r});return t&&(n.symbol=this._symbolConstructor(t)),n},_geojsonConstructor:function(e){var t,r=new jsts.io.GeoJSONReader,n=new jsts.io.WKTReader;return"wkt"==e.type.toLowerCase()?t=n.read(geo):"geojson"==e.type.toLowerCase()&&(t=r.read(geo)),(new jsts.io.GeoJSONWriter).write(t)},_geometryConstructor:function(e){var t=new u.sfs.Geometry;return"wkt"==e.type.toLowerCase()?t=u.sfs.GeometryFactory.createGeometryFromWkt(e.geom,this.map.getSrid()):"geojson"==e.type.toLowerCase()&&(t=u.sfs.GeometryFactory.createGeometryFromGeoJson(e.geom,this.map.getSrid())),t},_geometryConstructor2:function(e,t){var r;"wkt"==e.type.toLowerCase()?r=s.getWktReader().read(e.geom):"geojson"==e.type.toLowerCase()&&(r=s.getGeoJSONReader().read(e.geom)),!0===t&&"Polygon"!==r.getGeometryType()&&"Point"!==r.getGeometryType()&&(r=r.buffer(1e-5));var n=(new jsts.io.GeoJSONWriter).write(r);return u.sfs.GeometryFactory.createGeometryFromGeoJson(n,this.map.getSrid())},_symbolConstructor:function(e){return c.object2Symbol(e)},_sortFunction:function(e,t){var r=[];if("LineString"==t)(r=e).sort((function(e,t){return e[1]>t[1]?1:-1}));else if("Point"==t)r.push(e);else{for(var n=0;n<e.length;n++)for(var o=e[n],i=0;i<o.length;i++)r.push(o[i]);r.sort((function(e,t){return e[1]>t[1]?1:-1}))}return r},_getCircleGeoJson:function(e){for(var t=e.x,r=e.y,n=e.radius,o=e.count,i=[],a=(e.srs,{}),s=0;s<o;s++){var l=360/o;i.push(l*s)}a.type="Polygon";var c=[];n/=6378137;for(var u=0;u<i.length;u++){var f=i[u];f=f*Math.PI/180;var h=r*Math.PI/180,p=t*Math.PI/180,d=Math.asin(Math.sin(h)*Math.cos(n)+Math.cos(h)*Math.sin(n)*Math.cos(f)),y=p+Math.atan2(Math.sin(f)*Math.sin(n)*Math.cos(h),Math.cos(n)-Math.sin(h)*Math.sin(d));if(!isNaN(d)||!isNaN(y)){var m=[],g=180*y/Math.PI,v=180*d/Math.PI;m.push(g),m.push(v),c.unshift(m),u==i.length-1&&c.push(c[0])}}return a.coordinates=[c],a}}),e.exports=y},function(e,t,r){var n=r(1),o=r(512),i=r(513),a=r(514),s=n.interact.Tool.extend({initialize:function(e){var t=e||{};n.interact.Tool.call(this,t),this.map=e.map,this.toolCol={},this.tools=[],this.drawTools={},this.drawTools.point=new o({map:e.map,cursor:"crosshair"}),this.drawTools.line=new i({map:e.map,cursor:"crosshair"}),this.drawTools.polygon=new a({map:e.map,cursor:"crosshair"}),this.drawing=!1,this.currentDrawTool=null,this.handlers={click:this.onMouseClick.bind(this),mouseup:this.onMouseUp.bind(this),mousedown:this.onMouseDown.bind(this),mousemove:this.onMouseMove.bind(this),dblclick:this.onDblclick.bind(this)}},onClick:function(){for(var e in this.handlers)this.map.on(e,this.handlers[e])},deactivate:function(){for(var e in this.handlers)this.map.un(e,this.handlers[e])},add:function(e){e&&(this.toolCol.hasOwnProperty(e.id)||(this.tools.push(e),this.toolCol[e.id]=e))},remove:function(e){if(this.toolCol.hasOwnProperty(e)){for(var t=0;t<this.tools.length;t++)if(this.tools[t].id===e){this.tools.splice(t,1);break}delete this.toolCol[e]}},clear:function(){this.tools=[],this.toolCol={}},startDraw:function(e,t){this.drawing=!0,this.currentDrawTool=this.drawTools[e],this.currentDrawTool.onClick(t)},endDraw:function(){this.drawing=!1,this.currentDrawTool&&this.currentDrawTool.deactivate(),this.currentDrawTool=null},onMouseUp:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invoke("onMouseUp",t)},onMouseDown:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invoke("onMouseDown",t)},onMouseMove:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invoke("onMouseMove",t)},onMouseClick:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invoke("onMouseClick",t)},onDblclick:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invoke("onDblclick",t)},_invoke:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o;if(this.drawing&&this.currentDrawTool)(o=this.currentDrawTool[e]).apply.apply(o,[this.currentDrawTool].concat(r));else for(var i=0;i<this.tools.length;i++){var a=this.tools[i];try{var s;a[e]&&(s=a[e]).apply.apply(s,[a].concat(r))}catch(e){console.debug(e)}}}});e.exports=s},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(1),u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(h,e);var t,r,n,u,f=(t=h,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=f.call(this,e)).defaultSymbol=new c.sfs.SimpleMarkerSymbol,t}return r=h,(n=[{key:"onMouseUp",value:function(e,t,r,n,o,i,a){var s=new c.sfs.Point({x:o,y:i,spatialReference:this.options.map.spatialReference}),l=new c.sfs.Element({geometry:s,symbol:this.symbol});this.params.layer&&this.params.layer.add(l),this.params.callback.call(this.params.context,l)}}])&&o(r.prototype,n),u&&o(r,u),h}(r(133));e.exports=u},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=u.call(this,e)).defaultSymbol=new g2.sfs.SimpleLineSymbol,t}return r=f,(n=[{key:"onMouseUp",value:function(e,t,r,n,o,i,a){if(this.drawing){var s=[o,i];this.points.push(s),this._updateElement(!1)}}},{key:"onMouseMove",value:function(e,t,r,n,o,i,a){if(this.drawing&&this.points.length>0){var s=[o,i];this.movingPoint=s,this._updateElement(!0)}}},{key:"onDblclick",value:function(e,t,r,n,o,i,a){if(this.drawing&&this.params.layer.getCount()>0&&this.points.length>1){var s=this.params.layer.get(0),l=s.geometry.getGeometry(0);if(l.getPointCount()>2){var c=this.points.length,u=this.points[c-1],f=this.points[c-2];u[0]===f[0]&&u[1]===f[1]&&l.removePoint(l.getPointCount()-1),this.drawing=!1,this.params.callback.call(this.params.context,s)}}}},{key:"_updateElement",value:function(e){for(var t=new g2.sfs.Path,r=this.options.map.spatialReference,n=0;n<this.points.length;n++){var o=new g2.sfs.Point({x:this.points[n][0],y:this.points[n][1],spatialReference:r});t.addPoint(o)}if(e){var i=new g2.sfs.Point({x:this.movingPoint[0],y:this.movingPoint[1],spatialReference:r});t.addPoint(i)}if(t.getPointCount()>1){var a=new g2.sfs.Polyline;if(a.addGeometry(t),0===this.params.layer.getCount()){var s=new g2.sfs.Element({geometry:a,symbol:this.symbol});this.params.layer.add(s)}else{var l=this.params.layer.get(0);l.geometry=a,this.params.layer.update(l)}}}}])&&o(r.prototype,n),c&&o(r,c),f}(r(133));e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var t,r,n,c,u=(t=f,function(){var e,r=s(t);if(a()){var n=s(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return i(this,e)});function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=u.call(this,e)).defaultSymbol=new g2.sfs.SimpleFillSymbol,t}return r=f,(n=[{key:"onMouseUp",value:function(e,t,r,n,o,i,a){if(this.drawing){var s=[o,i];this.points.push(s),console.debug("add point ",s),this._updateElement(!1)}}},{key:"onMouseMove",value:function(e,t,r,n,o,i,a){if(this.drawing&&this.points.length>0){var s=[o,i];this.movingPoint=s,this._updateElement(!0)}}},{key:"onDblclick",value:function(e,t,r,n,o,i,a){if(this.drawing&&this.params.layer.getCount()>0&&this.points.length>1){var s=this.params.layer.get(0),l=s.geometry.getGeometry(0);if(l.getPointCount()>3){var c=this.points.length,u=this.points[0],f=this.points[c-1],h=this.points[c-2];f[0]===h[0]&&f[1]===h[1]&&l.removePoint(l.getPointCount()-1),l.addPoint(new g2.sfs.Point({x:u[0],y:u[1]})),this.drawing=!1,this.params.callback.call(this.params.context,s)}}}},{key:"_updateElement",value:function(e){for(var t=new g2.sfs.Ring,r=this.options.map.spatialReference,n=0;n<this.points.length;n++){var o=new g2.sfs.Point({x:this.points[n][0],y:this.points[n][1],spatialReference:r});t.addPoint(o)}if(e){var i=new g2.sfs.Point({x:this.movingPoint[0],y:this.movingPoint[1],spatialReference:r});t.addPoint(i)}if(t.getPointCount()>1){var a=new g2.sfs.Polygon;if(a.addGeometry(t),0===this.params.layer.getCount()){var s=new g2.sfs.Element({geometry:a,symbol:this.symbol});this.params.layer.add(s)}else{var l=this.params.layer.get(0);l.geometry=a,this.params.layer.update(l)}}}}])&&o(r.prototype,n),c&&o(r,c),f}(r(133));e.exports=c},function(e,t,r){r(12);var n=r(1),o=n.interact.Tool.extend({initialize:function(e){var t=e||{};n.interact.Tool.call(this,t),this.onMove=-1,this.currentElement=null,this.geometry=t.geometry,this.map=t.map,this.drawLayer=t.drawLayer,this.lineEle=t.lineEle,this.closeEle=t.closeEle,this.picEle=t.picEle,this.bufferEle=t.bufferEle,this.maxPoint=t.maxPoint,this.bufferMaxPoint=t.bufferMaxPoint,this.callback=t.callBack,this.context=t.context,this.parent=t.parent,this.textEle=t.textEle,this.fillSymbol=t.fillsymbol,this.textPosition=t.textPosition},onMouseUp:function(e,t,r,n,o,i,a){if(this.map.resumeDragPan(),0==this.onMove)this.onMove=-1;else if(this.onMove>0){this.callback&&this.callback.call(this.context,this.bufferGeoJSON,this.textlength,!0),this.onMove=-1,this.currentElement=null,this.drawLayer.update(this.picEle,!0)}},onMouseDown:function(e,t,r,n,o,i,a){if(this.onMove<0){var s=this.drawLayer.hitTest(r,n);if(s){var l=s.element.geometry;if(!l.x||!l.y)return;"drag"===s.element.tag&&(this.map.stopDragPan(),s&&this.picEle.id==s.element.id&&(this.currentElement=s.element,this.onMove++))}}},onMouseMove:function(e,t,r,o,i,a,s){var l,c,u;if(this.onMove>=0&&this.currentElement){var f=this.maxPoint,h=new n.sfs.Point({x:i,y:a,spatialReference:this.map.spatialReference}),p=new n.sfs.Polyline({spatialReference:this.map.spatialReference}),d=new n.sfs.Path({spatialReference:this.map.spatialReference});d.addPoint(f),d.addPoint(h),p.addGeometry(d),this.lineEle.geometry=p,this.closeEle.geometry=h,this.radius=Math.abs(f.x-h.x);var y=new n.sfs.CoordinateTransform,m=new n.sfs.MeasureService({projectService:y}).length(this.lineEle.geometry);this.textlength=m,this.drawLayer.remove(this.bufferEle);var g=(l=this.geometry,c=this.textlength,u=this.map.spatialReference,G.utils.SpatialOPUtil.getBuffer({geometry:l,radius:parseFloat(c),spatialReference:u}));this.bufferGeoJSON=g;var v=n.sfs.GeometryFactory.createGeometryFromGeoJson(g,this.map.spatialReference),b=new n.sfs.Ring({spatialReference:this.map.spatialReference});v.addGeometry(b);var _=this.fillSymbol;this.bufferEle=new n.sfs.Element({geometry:v,symbol:_}),this.drawLayer.add(this.bufferEle);var w=g.coordinates,S=this.parent._sortFunction(w,g.type),L=new n.sfs.Point({x:S[0][0],y:S[0][1],spatialReference:this.map.spatialReference});this.currentElement.geometry=L,this.drawLayer.update(this.currentElement);var x=new n.sfs.Polyline({spatialReference:this.map.spatialReference}),P=new n.sfs.Path({spatialReference:this.map.spatialReference});P.addPoint(f),P.addPoint(L),x.addGeometry(P),this.lineEle.geometry=x,this.drawLayer.update(this.lineEle),this.drawLayer.update(this.closeEle),this.textlength=m;var E=this.textEle.symbol;E||(E=new n.sfs.TextSymbol({text:T,foreground:new n.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0})),this.drawLayer.remove(this.textEle);var T=Math.round(this.textlength)/1e3+"km";E.text=T;var C=x;if("middle"==this.textPosition)C=x;else if("left"==this.textPosition)C=f;else if("right"==this.textPosition)C=L;this.textEle=new n.sfs.Element({geometry:C,symbol:E}),this.drawLayer.add(this.textEle),this.onMove++}},onMouseClick:function(e,t,r,n,o,i,a){}});e.exports=o},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.id="bufferCloseTool"}var t,n,o;return t=e,(n=[{key:"onMouseUp",value:function(e,t,r,n,o,i,a){if(this.options.layer){var s=this.options.layer.hitTest(r,n);s&&s.element&&"closeButton"===s.element.tag&&(this.options.removeBuffer(this.options.bufferId),this.options.callback&&this.options.callback())}}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.id="bufferUserTool",this.bufferId=t.bufferId,this.toolId=t.toolId}var t,n,o;return t=e,(n=[{key:"onMouseUp",value:function(e,t,r,n,o,i,a){if(this.options.layer){var s=this.options.layer.hitTest(r,n);s&&s.element&&"userButton"===s.element.tag&&s.element.id===this.toolId&&this.options.callback&&this.options.callback(s)}}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){var n=r(11),o=r(1),i=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e);var t=e.content||"<span>自定义内容</span>";this.options.element=this.parseDom(t),this.options.cursor=e.cursor||"crosshair",this.options.clearlast=void 0===e.clearlast||e.clearlast,this.options.callback=e.callback,this.options.position=new o.sfs.Point({spatialReference:this.map.getSrid()}),this.options.offset=e.offset||[2,2],this.options.keep=e.keep||!1,this.overlayWare=new o.widget.OverlayWare({map:this.map}),this.overlay=null},parseDom:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},load:function(){n.prototype.load.call(this),this.overlay=null,this.map.listen("mousemove",this._mousemove,this),this.map.listen("mousedown",this._mousedown,this),this.map.setCursor(this.options.cursor)},unload:function(){this.overlay=null,this.overlayWare.clear(),this.map.setCursor("default"),this.map.off("mousemove",this._mousemove,this),this.map.off("mousedown",this._mousedown,this),n.prototype.unload.call(this)},destroy:function(){this.unload(),this.overlayWare=null,n.prototype.destroy.call(this)},_mousemove:function(e){this.overlay||(this.overlay=new o.widget.OverLay({position:this.options.position,element:this.options.element,id:"mousemoveoverlay",stopEvent:!1,offset:this.options.offset||[2,2]}),this.overlayWare.add(this.overlay)),this.overlay.position.x=e.mapX,this.overlay.position.y=e.mapY,this.overlayWare.update(this.overlay)},_mousedown:function(e){this.options.keep?0===e.button&&(this.overlay.position.x=e.mapX,this.overlay.position.y=e.mapY,this.overlayWare.update(this.overlay),this.map.off("mousemove",this._mousemove,this),this.map.off("mousedown",this._mousedown,this),this.map.setCursor("default"),"function"==typeof this.options.callback&&this.options.callback.call(this,e)):this.unload()}});e.exports=i},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}var o=r(11),i=r(1),a=o.extend({options:{},initialize:function(e){o.prototype.initialize.call(this,e),this.coordUtil=G.utils.CoordUtil,this.options.cursor=e.cursor||"crosshair",this.options.callback=e.callback,this.options.geocodeService=e.geocodeService,this.options.coordService=e.coordService,this.defaultIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAmCAYAAAClI5npAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAmISURBVHjapFhdiF1XFf7W2vucc+89M3f+OjPJND8Tm5hia6hBkUpLUVHwzZdaUfx98UF8EKlPfVEqQhEE+2BBqIqCFFIRFVtKbdGa/iAtbRLatCVp4iQz+ZlJJvfec8/P3nstH86Zm2mbxClu2JcD9+6zvvWtb/3sS/vuewobi8AACCoexKZ+hrZVfJfI7CXiRRB2ECEBcBlKyyG4NwFdYrZDEDsVD6gHcQyK2sjOHsaZZ3+I6y0L3PC7DxP4BzZpf6GVxGlkLRnL1hoiqAbnQshLh6qqzoYgvwL0twAuA1BscV0PwIRCf9xqt780nnbmJ7sJTaQGScQgAC4IvCi8UzgP5FXo9rPiod4g/3ZZDH9OwKP/D4C9xPaRdCz97LbZLnbMJkgThhfBIPfoDT2KSuGcIigAYkAJ7U7HGhvd3uvRw3le3ArgAQDVBwWwM07iX4+Nde7aNT+GhdkYsQEu9RxW1ioMywBRQFWhAIgICgEpgZkRRRG6ExMdZnt/lg1SAr77QQCkIHqk0+nc9aGbu9g2bSEh4OT5ApcGAc4LVAQEAgEgAGCACFAiBCgYQGwtxsdSiOrXK48VAA+ONH4NbZibPvoNEJEh4vs7afq1xZu70cJMjLwIOHW+wFrPwfsAqIBUQRAoCaANAzUVNaDm9cYaRNbG3rt5Smb/bTvzy9nZ52/IwEKSxN/adtN4Z3YyxiB3OHuxRL/wAARMCg0CQKEEQKjxR2vDog0dCoUCqojjGO22u60o3fe7ez73lXhi5wZv7wYgobJsW/emaTo/MxkjBMHymsMgDyAooAKIQiEISlAPKBSMAGYGGzRBUQACAFAlqKomcULtOD+QV9Ht6fZPHrsmAyohJeCb3fFWGlvGhfUSWV57vmHchYDd820cuGUcH1kcw3Q3xspaiddPDXDkxADn1x0iW2NQNGFSkDGMVqezOCwufzmUVx64JgAyyWQURXNpwhgWAf1cIA21qoCoYPd8C1+8ex6fOTiF2ckYRAQvijtXJ/Dki2v420trWL3iYWwTGgJUVYmhxnDKwN2iASCAjXk3AGazkCSxZQbWM4/gpS7AUAWUJAC37R7HPXdMYW4q2XSQsGuuhU8fnMLxpQznLvVgDUHRsEBMUAITw1ibqmjL9fPiwitv1ZohahggmoosGecB57URMgFQggqCKG7d3cH2meSaKl7c1sLitjb++dqVUbbRhtioNsTMxGzbIC6y5dU6tM1v6u4DQlEpVDbpVGkU04mx6LqFJLKM8batC1RzeCPZtU4csDVUXM7o7OG3ATVUJ18dKwtFX1TEBbl6sPkkKAwBy2slKi+ILb8PQH8YcGHdgYmgqiDaVGsIUAic19CKtfrUwQLTY6qFj3D03CyCMKyoW3HOe5FRWK6eZgax4o1TA7yznGP/rvR9AI4vDXByeajWEoiIAL4aAgBBFOIdFua4+sTHxnFzp8B6YXDu+DTKYGAh4VJZuqGowjJDm1cIMaACw4Rj7/Tx1+cvIi8F+3elaCeMXubx+qkBnnhpDSeWh4hMHbaRE0oqouSd+oSqI5OtUq8MYjNFqsMCMhyCygC1oGgQfDhUleX3TLuVEDFUBczNiEKEy32Pp19ew/GlDDvm2ui2DS73Hc5cLLB0odSsUMQR19aJa1UREIKgqsrTCbtDqckNCOgVYyHmkj++cE6DEGjfvU8CqvviVucf0zPT24010OBBJFDvoaiV5L3CBYUPAhHAMMFaRhRZGGaAGEQb3alOgWHhqcwuPr2nu/LVhW4+GLP9YKAhjXKJbVAAajWUAHCqquyhoqi+k461YzIGGgAlbsqbwhiCMQRoE+PGDm14zRsVCABBvA9cFflySquP7eqezyYSIYPAlp0GYZTeyEZDBUCOQD/NsuGLZVGO+ns9FxoADKJNbRh1C8ZoM0hZAVYlgojysKgyE9b/vKe7+pcO9SOjOYPAAuJRDjbjTF27pFqpit6DvV7vbOkclLjOKW6oVdooGaNHENXASEHcZIEo8iJ4Ldef2905/fuF8XWJyJuqclaCYxAxs3JTg9hM3XpfDUA9IOFkAHsF7oyiuG3qyZhGhbHha8NzglEighITsSFVQVEEVMPLr+5I3nx439SZl5lCZAgKAlS8MhFM3Q8UgPK78r7OoV/kw+J3RVE4EBExQ9mArFEiAyLT8GdAzE2tMAARnFcUw/7SDN7+zWL75L9YfVtFjPO+KX1knHPGOcebhirF5t2w+6PhMP97WVYgMAwxAAMio2AD4qhRvCGQIeJaGUWRZ+1w+vGd6amnWta1ffBGgicR4RCCBcAiwpsAkCW+1mAsa64qH+r3+/sM8y1xFINIR6EAbxrFiKFCyPIKXK08s7N94k/duA/nKSIWbwwpiDSEoCLCqirGmKsiJBNh8wak1oP6Z8uifCQbFuuiCjIMIgNwBJDBhjiJCEUZUPXPHZ3F64/PRucuBC+RqLKqGFUxIvX23puGAajqqBtedxHRz4qi+GNRVg1cbvRXe87GoPTAsL96fjocPTRv33kteNcKIRgRsSEE02zrnDMhBHbOkTGmrh/1UHrjW1QI4SeDfv8Ww3xP3Iqb+2IzMQiQDTK0iuNPbI/fetrAtUWNJ5FQ42WICBFRUFVhZkqSRFut1kh0FmRuRAEAnCyr6peDLNszYe0ua009DRNhkHtQdurwNn7zibbJEII1zAIiYgBBValOJJYoirTdbruxsbFKVUMzwSoTJ7je1sZbED1WFOUzVVWNcAVR5FkvmwjHX5yxZ5aCcktVbQjBhhCM996EEAwzo9PphOnp6SJN0w3jIwCWSbZ0iVT1jw6H2UFr7YEkiZGXDnFx4oUJWnpBwB0JSkQKESFmRpIkodPp+ImJiWEURUMAJQC3yXgNIDFuSwAIeK4ossNlq30gSWIUw6yaDKffmLBrl0TjlqqoiAZjTNXpdIrp6elBp9PJVbUAkDcXVdlsHIBaL7zVmzSC8h+cc3f2h+UdpjrzyhidP0LMsfOBVdW3Wq18ampqbWpq6goRVarqG6/9ew1vTH62m+RbBkDQ5/JAx6706I758J8TYzi3lA0rr6ArMzMz/bm5udVWq9Vr4gy8t8xuMjwa7z+/+8iWAcTG4/DZ/UePXZAThs6fCL63mhW6vnPnzouLi4ul1On33ry+puERgIjDlgEYEky3ssPbk7It6yuvJeOdk3v3783SNA0iQk1123wN1//1d40VpS0DqIKlvZMrr+7p4i3orpxJM2uj+mZeW6dreI4bgfjvAOOpSBSGfhEFAAAAAElFTkSuQmCC",this.options.marker=e.marker||{},this.options.marker.show=!(!1===this.options.marker.show),this.options.marker.symbol=this.options.marker.symbol||{},this.options.marker.symbol.width=this.options.marker.symbol.width||32,this.options.marker.symbol.height=this.options.marker.symbol.height||38,this.options.marker.symbol.offsetX=this.options.marker.symbol.offsetX||16,this.options.marker.symbol.offsetY=this.options.marker.symbol.offsetY||38,this.options.marker.symbol.opacity=this.options.marker.symbol.width||1,this.options.marker.symbol.source=this.options.marker.symbol.source||this.defaultIcon,this.elementLayer=new i.carto.ElementLayer({id:"selectLocationElementLayer",name:"打点元素图层"})},load:function(){o.prototype.load.call(this),this.overlay=null,this.map.listen("mousedown",this._mousedown,this),this.map.setCursor(this.options.cursor),this.map.addLayer(this.elementLayer)},unload:function(){this.map.setCursor("default"),this.map.off("mousedown",this._mousedown,this),this.elementLayer.clear(),this.map.removeLayer(this.elementLayer),o.prototype.unload.call(this)},destroy:function(){this.unload(),o.prototype.destroy.call(this)},_mousedown:function(e){var t=this,r=this;this._getAddress(e).then((function(n){"function"==typeof r.options.callback&&(t._addPoint(e),r.options.callback.call(r,n))}))},_addPoint:function(e){this.elementLayer.clear();var t=e.mapX,r=e.mapY,n=new i.sfs.Point({x:t,y:r,spatialReference:this.map.spatialReference||4326}),o=new i.sfs.PictureMarkerSymbol(this.options.marker.symbol);this.currentElement=new i.sfs.Element({geometry:n,symbol:o}),this.elementLayer.add(this.currentElement)},_getAddress:function(e){var t=this;return new Promise(function(){var r,o=(r=regeneratorRuntime.mark((function r(n,o){var i,a,s,l,c,u,f,h;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i={location:null,result:null,msg:null,success:!1},a=e.mapX,s=e.mapY,l=[a,s],i.location=l,c=t.map.spatialReference||4326,u=t.coordUtil.verify(l,c),f=t._getIsWithinChina(l,c),u?f?(h={location:l},t.options.geocodeService.getAddressByLocation(h).then((function(e){i.success=!0,i.result=e.result,n(i),i.msg=e.msg})).catch((function(e){i.success=!1,i.result=e.result,i.msg=e.msg,n(i)}))):(i.msg="目前的选择不在中国境内,请重新在地图上选择！",n(i)):(i.msg="坐标无效",n(i));case 9:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(o,i){var a=r.apply(e,t);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))});return function(e,t){return o.apply(this,arguments)}}())},_getIsWithinChina:function(e,t){if(!this.options.coordService)return this.coordUtil.withinChina(e,t)}});e.exports=a},function(e,t,r){var n={RenderMgr:r(134),SimpleRenderMgr:r(521),StatisticsRenderMgr:r(528)};e.exports=n},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=r(134),l=(r(37),r(522)),c=r(523),u=r(524),f=r(525),h=r(526),p=r(185),d=r(184),y=r(131),m=r(1),g=s.extend({options:{layerZIndex:1},initialize:function(e){s.prototype.initialize.call(this,e),this._last_mouse_over=null},addListeners:function(){this.map.listen("click",this._clickHandler,this),this.map.listen("mousemove",this._mouseMoveHandler,this)},removeListeners:function(){this.map.off("click",this._clickHandler,this),this.map.off("mousemove",this._mouseMoveHandler,this)},add:function(e){this._checkLoaded(),this.remove(e.featureType);var t=this._getFeatureType(e.featureType)||{},r=this._getRendererClazz(e.type),n=e.geometryBuilder||new p({}),o=e.symbolBuilder||new d({}),i=new y({idField:e.idField,geometryBuilder:n,symbolBuilder:o}),a=t.renderer||new r({id:e.featureType,name:e.featureName,map:this.map,idField:e.idField,geometryType:n.getGeometryType(),featureBuilder:i,layer:e.layer||null,eventDispatcher:this.eventDispatcher,zIndex:e.zIndex||this.options.layerZIndex});a.add(e.list),t.featureType=e.featureType,t.featureName=e.featureName,t.idField=e.idField,t.geometryBuilder=n,t.symbolBuilder=o,t.renderer=a,t.listeners=e.listeners||{},this.featureTypeList.push(t),this._fireUpdateEvent()},addWMS:function(e){this._checkLoaded(),this.remove(e.featureType);var t=e.geometryBuilder||new p({geometryType:e.geometryType}),r=e.symbolBuilder||new d({}),n=new y({idField:e.idField,geometryBuilder:t,symbolBuilder:r}),o=this._getFeatureType(e.featureType)||{},i=new h({id:e.featureType,name:e.featureName,map:this.map,layer:e.layer||null,eventDispatcher:this.eventDispatcher,zIndex:e.zIndex||this.options.layerZIndex,layerOptions:e.layerOptions,geometryType:e.geometryType,featureBuilder:n});o.featureType=e.featureType,o.featureName=e.featureName,o.geometryBuilder=t,o.idField=e.idField,o.renderer=i,o.listeners=e.listeners||{},this.featureTypeList.push(o),this._fireUpdateEvent()},_getRendererClazz:function(e){return{0:l,1:c,2:u,3:f}[e=e||0]||null},update:function(e){this._checkLoaded();var t=this._getFeatureType(e.featureType);t&&(t.renderer.update(e.list),this._fireUpdateEvent())},getLayer:function(e){var t=this._getFeatureType(e);if(t)return t.renderer.getLayer()},visitFeature:function(e,t){var r=this.getLayer(e);if(r&&t){!function e(t,r){var n=!0;if(t instanceof m.carto.GroupLayer){var o,a=i(t.groupLayers);try{for(a.s();!(o=a.n()).done;){if(!e(o.value,r)){n=!1;break}}}catch(e){a.e(e)}finally{a.f()}}else if(t instanceof m.carto.ElementLayer||t instanceof m.carto.ClusterLayer||t instanceof m.carto.FeatureLayer)for(var s=0;s<t.getCount();s++){var l=t.get(s);if(!r.visit(l,t)){n=!1;break}}return n}(r,t)}},getExtent:function(e){var t=this._getFeatureType(e);if(t)return t.renderer.getExtent()},_clickHandler:function(e){var t=this;return o(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.listens("click")&&!t.listens("noclick")){r.next=6;break}return filter=function(e,t){return t},r.next=4,t._hitTest(e.screenX,e.screenY,"click",filter);case 4:(n=r.sent).length>0?(t._invokeFeatureListeners("click",n),t.fire("click",{list:n,event:e})):(t._invokeFeatureListeners("noclick"),t.fire("noclick"));case 6:case"end":return r.stop()}}),r)})))()},_mouseMoveHandler:function(e){var t=this;return o(regeneratorRuntime.mark((function r(){var n,o,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.listens("mouseover")&&!t.listens("mouseout")){r.next=6;break}return filter=function(e,t){return t.renderer instanceof h?null:t},r.next=4,t._hitTest(e.screenX,e.screenY,"mousemove",filter);case 4:(n=r.sent).length>0?(o=t._getHitTargetKey(n),null!=t._last_mouse_over&&t._last_mouse_over.key==o||(t._invokeFeatureListeners("mouseover",n),t.fire("mouseover",{list:n,event:e}),t._last_mouse_over={key:o,type:o.split("~")[1]})):t._last_mouse_over&&((i=t._getFeatureType(t._last_mouse_over.type))&&i.listeners.mouseout&&i.listeners.mouseout(),t.fire("mouseout",{event:e}),t._last_mouse_over=null);case 6:case"end":return r.stop()}}),r)})))()},_invokeFeatureListeners:function(e,t){var r={};if(t){for(var n=0;n<t.length;n++){var o=t[n];r[o.featureType]=r[o.featureType]||[],r[o.featureType].push(o)}for(var i in r){var a=this._getFeatureType(i);a&&a.listeners[e]&&a.listeners[e](r[i])}}else for(var s=0;s<this.featureTypeList.length;s++){var l=this.featureTypeList[s];l&&l.listeners[e]&&l.listeners[e]()}},_getHitTargetKey:function(e){var t=null;if(e.length>0){var r=e[0];t=[r.elementId,r.featureType].join("~")}return t},_hitTest:function(e,t,r,n){var i=this;return o(regeneratorRuntime.mark((function a(){var s,l,c,u,f,h,p,d;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s=[],l=[],c=[],u=[],f=i.featureTypeList.length-1;case 3:if(!(f>=0)){a.next=20;break}if(h=i.featureTypeList[f],!(p=n(r,h))){a.next=17;break}d=p.geometryBuilder.getGeometryType(),a.t0=d.toLowerCase(),a.next="point"===a.t0?11:"polyline"===a.t0?13:"polygon"===a.t0?15:17;break;case 11:return l.push(p),a.abrupt("break",17);case 13:return c.push(p),a.abrupt("break",17);case 15:return u.push(p),a.abrupt("break",17);case 17:f--,a.next=3;break;case 20:return s=l.concat(c,u),a.abrupt("return",new Promise(function(){var n=o(regeneratorRuntime.mark((function n(o,a){var l,c,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:l=[],c=0;case 2:if(!(c<s.length)){n.next=9;break}return u=s[c],n.next=6,i._hitTestFeatureType(r,u,u.renderer.getLayer(),l,e,t);case 6:c++,n.next=2;break;case 9:o(l);case 10:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()));case 22:case"end":return a.stop()}}),a)})))()},_hitTestFeatureType:function(e,t,r,n,i,a,s){var l=this,c=r,u=function(e,t,r){if(e.graphiclist.length>0)for(var n=0;n<e.graphiclist.length;n++){var o=e.graphiclist[n];if(o&&(o.element||o.feature||o.properties)){var i={};i.element=o.element||o.feature||o,i.elementId=(a=i.element,l=void 0,a instanceof m.sfs.Element?l=a.id:a instanceof m.sfs.Feature&&(l=a.objectId),l),i.layerId=c.getLayerId()||s,i.featureType=t.featureType,r.push(i)}}var a,l};return new Promise(function(){var r=o(regeneratorRuntime.mark((function r(o,f){var h,p,d,y,g,v,b,_,w,S,L;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(c&&(c instanceof m.carto.ElementLayer||c instanceof m.carto.FeatureLayer||c instanceof m.carto.ClusterLayer||c instanceof m.carto.GroupLayer||c instanceof m.carto.TileLayer)&&c.visible)){r.next=33;break}if(c.map=c.map||l.map,s=s||c.getLayerId(),!(c instanceof m.carto.GroupLayer)){r.next=15;break}h=c.groupLayers,p=h.length-1;case 6:if(!(p>=0)){r.next=13;break}return d=h[p],r.next=10,l._hitTestFeatureType(e,t,d,n,i,a,c.getLayerId());case 10:p--,r.next=6;break;case 13:r.next=33;break;case 15:if(!(c instanceof m.carto.ClusterLayer)){r.next=23;break}y=c.hitTestList(i,a),g=t.symbolBuilder.buildClusterStyle(),v="click"===e&&g.clusterScatterOnClick,b="mousemove"==e&&g.clusterScatterOnMousemove,y.graphiclist.length>0&&(null==y.radius||0==y.radius)?(u(y,t,n),(v||b)&&c.hitTestListScatter(i,a),o(n)):(_=null,v?(console.debug("click scatter"),c.hitTestListScatter&&(_=c.hitTestListScatter(i,a))):b&&(console.debug("mousemove scatter"),c.hitTestListScatter&&(_=c.hitTestListScatter(i,a))),!_||null!=_.radius&&0!=_.radius||u(_,t,n)),r.next=33;break;case 23:if(!(c instanceof m.carto.TileLayer)){r.next=31;break}return w=t.renderer,r.next=27,w.hitTest(i,a);case 27:(S=r.sent)&&S.length>0&&u({graphiclist:S},t,n),r.next=33;break;case 31:L=c.hitTestList(i,a),u(L,t,n);case 33:o();case 34:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}});e.exports=g},function(e,t,r){var n=r(64),o=r(14),i=(r(2),r(1)),a=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.options.geometryType=this.options.geometryType||"point",this.options.map.initialGroupLayers();var t=this.options.featureBuilder.options.symbolBuilder,r={id:e.id,name:e.name,zIndex:this.options.zIndex,declutter:!1};if(t.buildStyle){var a=t.buildStyle()||{};for(var s in a)r[s]=a[s]}this.layer=new i.carto.ElementLayer(r),o.addLayer2Group(this.options.map,this.layer,this.options.geometryType)},destroy:function(){this.clear(),o.removeLayerFromGroup(this.options.map,this.layer,this.options.geometryType),n.prototype.destroy.call(this)},getLayer:function(){return this.layer},getExtent:function(){return o.getLayerExtent(this.layer)},add:function(e){for(var t=e.length,r=0;r<t;r++){var n=e[r];try{var o=this.options.featureBuilder.buildElement(n);this.layer.add(o)}catch(e){console.warn(e)}}},update:function(e){for(var t=[].concat(this.layer.elements),r=e.length,n=0;n<r;n++){var o=e[n],i=void 0;try{i=this.options.featureBuilder.buildElement(o)}catch(e){console.warn(e)}for(var a=o[this.options.idField],s=0,l=t.length;s<l;s++)if(t[s].id==a){t.splice(s,1);break}i&&t.push(i)}this.layer.clear(),this.layer.addElements(t)},remove:function(e){var t=this.layer.find(e);return t&&this.layer.remove(t),t},clear:function(){this.layer.clear()},setVisible:function(e){this.layer.setVisible(!!e)},getVisible:function(){return this.layer.visible}});e.exports=a},function(e,t,r){var n=r(64),o=r(14),i=r(2),a=r(1),s=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.options.geometryType=this.options.geometryType||"point",this.options.map.initialGroupLayers(),this.featureLayerList=[],this.layer=new a.carto.GroupLayer({id:e.id,name:e.name,layers:[],zIndex:this.options.zIndex}),o.addLayer2Group(this.options.map,this.layer,this.options.geometryType)},destroy:function(){this.clear(),this.layer.removeAllLayers(),this.featureLayerList=null,o.removeLayerFromGroup(this.options.map,this.layer,this.options.geometryType),n.prototype.destroy.call(this)},getLayer:function(){return this.layer},getExtent:function(){return o.getLayerExtent(this.layer)},add:function(e){for(var t=(new Date).getTime(),r=e.length,n=0;n<r;n++){var o=e[n],i=this.options.featureBuilder.buildFeature(o,!0);this._getFeatureLayerObj(o).featureSet.add(i)}this._render(),console.debug(e.length+" features takes "+((new Date).getTime()-t)+"ms")},update:function(e){var t=e.length;this.clearLayerOnly();for(var r=0;r<t;r++){var n=e[r],o=this.options.featureBuilder.buildFeature(n,!0),i=this._getFeatureById(o.objectId);i.index>=0&&i.featureLayerObj.featureSet.features.splice(i.index,1),this._getFeatureLayerObj(n).featureSet.add(o)}this._render()},remove:function(e){var t=this._getFeatureById(feature.objectId);t.index>=0&&t.featureLayerObj.featureSet.features.splice(t.index,1),t.featureLayerObj.layer.clear();var r=new a.render.SimpleRenderer({symbol:featureLayerObj.symbol});featureLayerObj.layer.addFeatures(featureLayerObj.featureSet),featureLayerObj.layer.render(r)},_render:function(){for(var e=0,t=this.featureLayerList.length;e<t;e++){var r=this.featureLayerList[e],n=new a.render.SimpleRenderer({symbol:r.symbol});r.layer.addFeatures(r.featureSet),r.layer.setVisible(!0),r.layer.render(n)}},_getFeatureLayerObj:function(e){var t=this.options.featureBuilder.buildSymbol(e),r=this._getFeatureObjBySymbol(t);if(null==r){r={};var n=new a.carto.FeatureLayer({id:"featureLayer-"+i.newUUID32(),opacity:1,visible:!1,zIndex:this.options.zIndex});r.symbol=t,r.layer=n,r.featureSet=new a.sfs.FeatureSet,this.layer.addLayer(n),this.featureLayerList.push(r)}return r},_getFeatureObjBySymbol:function(e){for(var t=null,r=0,n=this.featureLayerList.length;r<n;r++){var o=this.featureLayerList[r].symbol;if(o===e){t=this.featureLayerList[r];break}var i=!0;for(var a in o)o[a]==e[a]||(i=!1);if(i){t=this.featureLayerList[r];break}}return t},_getFeatureById:function(e){for(var t={index:-1},r=0,n=this.featureLayerList.length;r<n;r++){for(var o=this.featureLayerList[r],i=0;i<o.featureSet.getCount();i++)if(e==o.featureSet.getFeature(i).objectId){t.featureLayerObj=o,t.index=i,t.feature=o.featureSet.getFeature(i);break}if(t.index>=0)break}return t},clearLayerOnly:function(){for(var e=0;e<this.layer.groupLayers.length;e++)this.layer.groupLayers[e].clear();this.layer.clear()},clear:function(){this.clearLayerOnly();for(var e=0,t=this.featureLayerList.length;e<t;e++){this.featureLayerList[e].featureSet.features=[]}},setVisible:function(e){this.layer.setVisible(!!e)},getVisible:function(){return this.layer.visible}});e.exports=s},function(e,t,r){var n=r(64),o=(r(14),r(2),r(1)),i=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.gvInstance=null,this.featureCol={type:"FeatureCollection",features:[]},this.initListeners()},destroy:function(){this.featureCol.features=[],this.featureCol=null,this.destroyGvInstance(),n.prototype.destroy.call(this)},getLayer:function(){return this.getGvInstance()},add:function(e){(new Date).getTime();for(var t=e.length,r=this.options.featureBuilder.options.geometryBuilder,n=this.options.idField,o=this.featureCol.features,i=0;i<t;i++){var a=e[i];a.id=a.id||a[n];var s=r.build(a),l={id:a.id,geometry:s.asGeoJson(),properties:a};o.push(l)}this.render()},update:function(e){(new Date).getTime();for(var t=e.length,r=this.options.featureBuilder.options.geometryBuilder,n=this.options.idField,o=[],i=0;i<t;i++){var a=e[i];a.id=a.id||a[n];var s=r.build(a),l={id:a.id,geometry:s.asGeoJson(),properties:a},c=this._getFeatureById(l.id);c.index>=0?this.featureCol.features[c.index]=l:o.push(l)}this.featureCol.features=this.featureCol.features.concat(o),this.render()},remove:function(e){var t=this._getFeatureById(e);return t.index>=0?(this.featureCol.features.splice(t.index,1),this.render(),t.feature):null},_getFeatureById:function(e){for(var t={feature:null,index:-1},r=0,n=this.featureCol.features.length;r<n;r++){var o=this.featureCol.features[r];if(e==o.id){t.feature=o,t.index=r;break}}return t},render:function(){var e=new gv.source.GeoJsonSource(this.featureCol),t=this.getGvInstance();0==t.source.featureCollection.features.length&&0==e.featureCollection.features.length||(t.setDataSource(e),t.render())},clear:function(){this.featureCol.features=[],this.render()},setVisible:function(e){var t=this.getGvInstance();return!!t&&(t.setVisible(!!e),!0)},getVisible:function(){var e=this.getGvInstance();if(e)return e.getVisible()},addListeners:function(){this.gvInstance&&(this.gvInstance.on("click",this.onClick),this.gvInstance.on("mouseover",this.onMouseOver),this.gvInstance.on("mouseout",this.onMouseOut))},removeListeners:function(){this.gvInstance&&(this.gvInstance.un("click",this.onClick),this.gvInstance.un("mouseover",this.onMouseOver),this.gvInstance.un("mouseout",this.onMouseOut))},initListeners:function(){var e=this;this.onClick=function(t){e.fireEvent("click",t)},this.onMouseOver=function(t){e.fireEvent("mouseover",t)},this.onMouseOut=function(t){e.fireEvent("mouseout",t)}},fireEvent:function(e,t){if(t&&this.options.eventDispatcher.listens(e)){var r={},n={};for(var i in t)"geometry"!=i&&(n[i]=t[i]);var a=new o.sfs.Element({id:n[this.options.idField],geometry:o.sfs.GeometryFactory.createGeometryFromGeoJson(t.geometry)});a.attributeSet=this.options.featureBuilder.buildAttributeSet(n),r.featureType=this.options.id,r.featureName=this.options.name,r.element=a,r.elementId=a.id,this.options.eventDispatcher.fire(e,r);var s=this.options.eventDispatcher.listener(this.options.id,e);s&&s(t)}},getGvInstance:function(){var e=this;if(null==this.gvInstance){var t=new gv.source.GeoJsonSource(this.featureCol);this.gvInstance=new gv.chart.PointClusterChart(t,this.getGvOptions()),this.gvInstance.bind(this.options.map,gv.chart.MapType.TSMap),this.addListeners(),this.gvInstance.renderComplete((function(){e.gvInstance.setVisible(e.gvInstance.getVisible())}))}return this.gvInstance},getGvOptions:function(){return this.options.featureBuilder.options.symbolBuilder.build()},destroyGvInstance:function(){this.gvInstance&&(this.gvInstance.unbind(this.options.map),this.removeListeners(),this.gvInstance=null)}});e.exports=i},function(e,t,r){var n=r(64),o=r(14),i=(r(2),r(1)),a=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.options.geometryType=this.options.geometryType||"point",this.options.map.initialGroupLayers();var t=this.options.featureBuilder.options.symbolBuilder,r=t.buildClusterStyle();if(r.id=e.id,r.name=e.name,r.zIndex=this.options.zIndex,r.map=this.options.map,this.layer=new i.carto.ClusterLayer(r),o.addLayer2Group(this.options.map,this.layer,this.options.geometryType),r.clusterLevel&&this.layer.setClusterLevel(r.clusterLevel),t.buildClusterStyleFn){var a=t.buildClusterStyleFn();a&&this.layer.setStyleFunc(a)}},destroy:function(){this.clear(),o.removeLayerFromGroup(this.options.map,this.layer,this.options.geometryType),n.prototype.destroy.call(this)},getLayer:function(){return this.layer},getExtent:function(){return o.getLayerExtent(this.layer)},add:function(e){for(var t=e.length,r=[],n=0;n<t;n++){var o=e[n],i=void 0;try{(i=this.options.featureBuilder.buildElement(o))&&r.push(i)}catch(e){console.warn(e)}}this.layer.addElements(r)},update:function(e){for(var t=[].concat(this.layer.elements),r=e.length,n=0;n<r;n++){var o=e[n],i=void 0;try{i=this.options.featureBuilder.buildElement(o)}catch(e){console.warn(e)}for(var a=o[this.options.idField],s=0,l=t.length;s<l;s++)if(t[s].id==a){t.splice(s,1);break}i&&t.push(i)}this.layer.clear(),this.layer.addElements(t)},remove:function(e){var t=this.layer.find(e);return t&&this.layer.remove(t),t},clear:function(){this.layer.clear()},setVisible:function(e){this.layer.setVisible(!!e)},getVisible:function(){return this.layer.visible}});e.exports=a},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}var o=r(64),i=r(14),a=(r(2),r(1)),s=r(527),l=o.extend({options:{},initialize:function(e){o.prototype.initialize.call(this,e),this.options.geometryType=this.options.geometryType||"point";var t=this.options.layerOptions,r={id:t.id,name:t.name,tileType:t.tileType||101,url:t.url,layers:t.layers,opacity:t.opacity||1,visible:t.visible||!0,projection:t.projection||this.options.map.spatialReference};this.layer=new a.carto.TileLayer(r),i.addLayer2Group(this.options.map,this.layer,this.options.geometryType),this.service=new s(e)},destroy:function(){this.clear(),o.prototype.destroy.call(this)},getLayer:function(){return this.layer},getExtent:function(){return i.getLayerExtent(this.layer)},clear:function(){i.removeLayerFromGroup(this.options.map,this.layer,this.options.geometryType)},setVisible:function(e){this.layer.setVisible(!!e)},getVisible:function(){return this.layer.visible},hitTest:function(e,t){var r=this;return new Promise(function(){var o,i=(o=regeneratorRuntime.mark((function n(o,i){var a,s,l,c,u,f,h,p,d,y,m,g,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.options.map,s=a.getViewSize(),l={layers:r.options.layerOptions.layers,featureCount:50,viewSize:a.getViewSize(),extent:a.getExtent(),width:s[0],height:s[1],x:Math.floor(e),y:Math.floor(t),srs:"EPSG:"+a.spatialReference,format:"application/json",buffe:2},n.next=5,r.service.getFeatureInfo(l);case 5:c=n.sent,u=[];try{if(c.featureInfos)for(f=c.featureInfos[0].entity.entities,h=0;h<f.length;h++);else if(c.features)for(p=c.features,d=0;d<p.length;d++)(y=r.options.featureBuilder.buildElementFromGeoJSON(p[d]))&&(y.geometry.spatialReference=r.options.map.spatialReference,u.push({element:y}));else if(c.entities)for(m=c.entities,g=0;g<m.length;g++)(v=r.options.featureBuilder.buildElementFromGFeature(m[g]))&&(v.geometry.spatialReference=r.options.map.spatialReference,u.push({element:v}))}catch(e){console.debug(e)}o(u);case 9:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,i){var a=o.apply(e,t);function s(e){n(a,r,i,s,l,"next",e)}function l(e){n(a,r,i,s,l,"throw",e)}s(void 0)}))});return function(e,t){return i.apply(this,arguments)}}())}});e.exports=l},function(e,t){function r(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new g2.core.Deserializer,n=new g2.core.RestHttp,o=t.layerOptions.url.split("/wms")[0];window.egis?this.service=new g2.ews.RestWMSService({url:o,http:n,deserializer:r}):this.service=new g2.ows.RestWMSService({url:o,http:n,deserializer:r})}var t,o,i;return t=e,(o=[{key:"getFeatureInfo",value:function(e){var t=this;return new Promise(function(){var n,o=(n=regeneratorRuntime.mark((function r(n,o){var i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:window.egis?(i=e.extent,a=new g2.ews.FeatureInfoInput({layers:e.layers,crs:e.srs,bbox:i,width:e.width,height:e.height,query_layers:e.layers,info_format:e.format,i:e.x,j:e.y}),t.service.getFeatureInfo(a).then((function(e){n(e)}))):t.service.getFeatureInfo(e.layers,[e.layers],e.featureCount,e.extent,e.width,e.height,e.x,e.y,e.srs,e.buffer,e.format).then((function(e){n(e)}));case 1:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(o,i){var a=n.apply(e,t);function s(e){r(a,o,i,s,l,"next",e)}function l(e){r(a,o,i,s,l,"throw",e)}s(void 0)}))});return function(e,t){return o.apply(this,arguments)}}())}}])&&n(t.prototype,o),i&&n(t,i),e}();e.exports=o},function(e,t,r){var n=r(134),o=r(529),i=r(530),a=r(531),s=r(131),l=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e)},addListeners:function(){this.map.listen("resolutionchanged",this._onResolutionChanged,this),this.map.listen("click",this._onClick,this)},removeListeners:function(){this.map.off("resolutionchanged",this._onResolutionChanged,this),this.map.off("click",this._onClick,this)},_onResolutionChanged:function(e){for(var t=this.featureTypeList.length-1;t>=0;t--){this.featureTypeList[t].renderer.onResolutionChanged(e)}},_onClick:function(e){for(var t=this.featureTypeList.length-1;t>=0;t--){this.featureTypeList[t].renderer.onClick(e)}},add:function(e){this._checkLoaded(),this.remove(e.featureType);var t=this._getFeatureType(e.featureType)||null,r=t||{},n=this._getRenderer(e.type||1),o=new s({idField:e.idField,geometryBuilder:e.geometryBuilder}),i=new n({id:e.featureType,name:e.featureName,map:this.map,idField:e.idField,featureBuilder:o,renderOption:e.renderOption,eventDispatcher:this.eventDispatcher});i.add(e.list),r.featureType=e.featureType,r.featureName=e.featureName,r.idField=e.idField,r.geometryBuilder=e.geometryBuilder,r.renderer=i,null==t&&this.featureTypeList.push(r)},update:function(e){this._checkLoaded();var t=this._getFeatureType(e.featureType);t&&t.renderer.update(e.list)},_getRenderer:function(e){return{1:o,2:i,3:a}[e]||null},getLayer:function(e){var t=this._getFeatureType(e);return t?t.renderer.getLayer():null},destroy:function(){n.prototype.destroy.call(this)}});e.exports=l},function(e,t,r){var n=r(195),o=r(81),i=(r(14),r(2),r(1),n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e)},getGvInstance:function(e){if(null==this.gvInstance){var t=new gv.source.GeoJsonSource(o.emptyFeatureCol());this.gvInstance=new gv.chart.PieStatisticsChart(e||t,this.getGvOptions()),this.gvInstance.bind(this.options.map,gv.chart.MapType.TSMap),this.addListeners()}return this.gvInstance}}));e.exports=i},function(e,t,r){var n=r(195),o=r(81),i=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e)},getGvInstance:function(e){if(null==this.gvInstance){var t=new gv.source.GeoJsonSource(o.emptyFeatureCol());this.gvInstance=new gv.chart.BarStatisticsChart(e||t,this.getGvOptions()),this.gvInstance.bind(this.options.map,gv.chart.MapType.TSMap),this.addListeners()}return this.gvInstance}});e.exports=i},function(e,t,r){var n=r(196),o=(r(81),r(14),r(2),r(1)),i=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),this.featureSet=new o.sfs.FeatureSet,this.layer=new o.carto.FeatureLayer({}),this.overlayWare=new o.widget.OverlayWare({map:this.options.map}),this.initListeners(),this.visible=!0},destroy:function(){this.clear(),n.prototype.destroy.call(this)},getLayer:function(){return this.layer},render:function(){var e=this,t=this.featureSet,r=this.options.renderOption.style,n=r.htmlFn;n||(n=function(t){var r=document.createElement("div");r.setAttribute("id",[e.options.id,t[e.options.idField]].join("-"));return r.innerHTML="-",r});for(var i=0;i<t.getCount();i++){var a=t.getFeature(i),s=new o.widget.OverLay({element:n(a._original_data),offset:r.offset||[10,10],position:a.geometry,positioning:r.offset||"top-left",stopEvent:!0});this.overlayWare.add(s),a._overlay=s}},clear:function(){this.layer.clear(),this.featureSet.features=[],this.overlayWare.clear()},setVisible:function(e){for(var t=e?"block":"none",r=this.featureSet,n=0;n<r.getCount();n++){r.getFeature(n)._overlay.element.style.display=t}this.visible=!!e},getVisible:function(){return this.visible},addListeners:function(){},removeListeners:function(){}});e.exports=i},function(e,t,r){var n={EarthquakeIntensity:r(533),ChemicalLeak:r(534),ChemicalExplode:r(535),ChemicalFire:r(536)};e.exports=n},function(e,t,r){var n=r(11),o=(r(2),n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e)},load:function(){n.prototype.load.call(this)},unload:function(){n.prototype.unload.call(this)},showIntensityRange:function(e){},clearIntensityRange:function(){}}));e.exports=o},function(e,t){},function(e,t){},function(e,t){},function(e,t,r){var n={TyphoonTrack:r(538),TyphoonWarningLine:r(539),TyphoonForecast:r(540),BufferQuery:r(542)};e.exports=n},function(e,t,r){function n(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}var a,s,l,c=r(11),u=r(2),f=r(18),h=r(12),p=r(1),d=c.extend({options:{},initialize:function(e){c.prototype.initialize.call(this,e),1!=this.enable&&(this.map=e.map,this.options={},this.options.picSymbol=this._initPicSymbolOptions(e),this.options.dataSpatialReference=4326,this.options.dataSpatialReference=this._mergeOptions(this.options.dataSpatialReference,e.dataSpatialReference),this.options.spatialReference=this.map.spatialReference,this.options.spatialReference=this._mergeOptions(this.options.spatialReference,e.spatialReference),this.options.projection=1,this.options.projection=this._mergeOptions(this.options.projection,e.projection),this.service=e.service,this.options.typhoon={},this.options.typhoon=this._initTyphoonOptions(e),this.options.forecast=this._initForecast(e),this.options.popup=this._initPopup(e),this.options.popupForecast=this._initPopupForecast(e),this.options.popupLand=this._initPopupLand(e),this.options.toolTipWare=new p.widget.TooltipWare({map:this.map}),this.options.layerOrder=this._initLayerOrder(e),this.options.tfbh=e.tfbh,this.enable=!0,this._initInterfaceMsg(e))},load:function(){this.isLoaded()||(this.tyhoonPlayFlag=0,null!=this.options.tfbh&&this.loadOneTyphoon(this.options.tfbh),this.tf={},this.tf.paths={},this.tf.realLine={},this.tf.realPoints={},this.tf.landPoints={},this.tf.realLabels={},this.tf.forecastLines={},this.tf.forecastPoints={},this.tf.forecastPolygons={},this.tf.nearestTyhoonPoints={},this.typhoonPlayFlags={},this._initLayers()),c.prototype.load.call(this)},addListeners:function(){null!=this.options.mapType?this._addListeners_tsmap():this._addListeners()},getIsLoaded:function(){return this.isLoaded},removeListeners:function(){this.map.off("click",this._getMapClickListener,this),this.map.off("mousemove",this._getMapMouseMoveListener,this)},service:null,setService:function(e){this.service=e},clearAll:function(){this.tf.Layer_point.clear(),this.tf.Layer_line.clear(),this.tf.selectPoint.clear(),this._forecastsClear(),this._clearCircle(),this.tf.typhoonIconLayer.clear(),this.options.toolTipWare.clear(),this.tf.Layer_label.clear(),this._clearIntervals(this.tf.typhoonInterval),this._clearIntervals(this.tf._ds),this.tyhoonPlayFlag=0,this.typhoonPlayFlags={}},removeAll:function(){this.clearAll(),this.tf.paths=null},clearOneTyphoon:function(e){if(null!=this.tf.realLine[e]){for(var t=0;t<this.tf.realLine[e].length;t++)this.tf.Layer_line.remove(this.tf.realLine[e][t]);for(var r=0;r<this.tf.realPoints[e].length;r++)this.tf.Layer_point.remove(this.tf.realPoints[e][r]);for(r=0;r<this.tf.landPoints[e].length;r++)this.tf.Layer_point.remove(this.tf.landPoints[e][r]);this.tf.Layer_label.remove(this.tf.realLabels[e]),this.tf.Layer_label.remove(this.tf.landPoints[e]),this._forecastsClear(),this._clearCircleByTfbh(e),this.tf.typhoonIconLayer.clear(),window.clearInterval(this.tf.typhoonInterval[e]),window.clearInterval(this.tf._ds[e]),this.tyhoonPlayFlag=0}},removeOneTyphoon:function(e){this.clearOneTyphoon(e),delete this.tf.paths[e]},loadOneTyphoon:function(e,t,r,n){var o=this;return new Promise((function(i,a){o._showTyphoonTrack(e,t,r,n).then((function(){i()}))}))},loadOneTyphoonData:function(e,t,r){this._showTyphoonTrackData(e,t,r)},pausePlay:function(e,t){this.typhoonPlayFlags[t]=!!e},playOneTyphoon:function(e,t,r,n,o,i){var a=500;if(t&&(a=t),this.tf.paths[e])if(null!=this.tf.realLine[e])if(1!=this.tyhoonPlayFlag)if(this.typhoonPlayFlags[e])console.log("当前台风正在播放。",e,"请等待...");else{this.tyhoonPlayFlag=1,this.typhoonPlayFlags[e]=!0,this.clearOneTyphoon(e),this._createTyphoonLabel(e);var s=this;this.tf.typhoonIconLayer.clear(),window.clearInterval(this.tf.typhoonInterval[e]),window.clearInterval(this.tf._ds[e]);var l=0,c=this.tf.realPoints[e].length,u=this.tf.realPoints[e];if(!u||u.length<1)this.tyhoonPlayFlag=0;else{var f=setInterval((function(){if(s.typhoonPlayFlags[e]){s.tf.typhoonIconLayer.clear();var t=s.tf.realPoints[e][l+1];s._addTyphoonIconById(e,t,a);var h=u[l+1],p=h._tfbh,d=h._data.properties.time.replace("T"," ");if(r&&0==r.show||s.showTyphoonCircle(p,d),n&&0==n.show||s.showTyphoonForecast(p,d),i&&0==i.show||s._showNearestLandPoint(l+1,e),s.tf.Layer_line.add(s.tf.realLine[e][l]),s.tf.Layer_point.add(u[l]),l++,s.fire("typhoonMove",u[l]),l>=c-1){s.tf.Layer_point.add(u[l]),s.tf.typhoonIconLayer.clear(),window.clearInterval(s.tf.typhoonInterval[e]);t=s.tf.realPoints[e][l];if(s._addTyphoonIconById(e,t,a),window.clearInterval(f),f=null,s.typhoonPlayFlags[e]=!1,!o||0!=o.show){var y=null;o&&o.type&&(function(e){throw new Error('"'+e+'" is read-only')}("showForecastPolyType"),y=o.type),s._getForecastCircleTan(t,y)}i&&0==i.show||s._createLandPoint(e,!0),s.fire("typhoonMoveEnd")}}}),a);this.tf._ds[e]=f}}else console.log("有正在播放。",e,"请等待...");else console.debug("no data ",e," ...")},showForecasts:function(e,t){for(var r in this.options.forecast.org[e].display=t,this.tf.Layer_forecast)if(this.tf.forecastLines[r]&&this.tf.Layer_forecast[r].showElement(this.tf.forecastLines[r][e],t),this.tf.forecastPoints[r]&&this.tf.forecastPoints[r][e])for(var n=0;n<this.tf.forecastPoints[r][e].length;n++){var o=this.tf.forecastPoints[r][e][n];this.tf.Layer_forecast.showElement(o,t)}},selectTyphoonTrackPoint:function(e,t){if(null!=this.tf.realPoints[e])for(var r=this.tf.realPoints[e],n=0;n<r.length;n++){if(r[n]._data.properties.time.replace("T"," ")==t)return void this._showRoutePointPopup(r[n])}},getTyphoonCircleInfo:function(e,t){if(null!=this.tf.realPoints[e]){for(var r={},n=this.tf.realPoints[e],o=0;o<n.length;o++){if(n[o]._data.properties.time.replace("T"," ")==t){r=this._getTyphoonCircleInfo(n[o]);break}}return r}},showTyphoonCircle:function(e,t){if(null!=this.tf.realPoints[e])for(var r=this.tf.realPoints[e],n=0;n<r.length;n++){for(var o=!0,i=n;i<r.length;i++){var a=r[i],s=a._data.properties.radius7?a._data.properties.radius7:0,l=a._data.properties.radius7_quad,c=0;for(var u in l){var f=l[u];f&&(c+=f)}if(c+s>0){o=!1;break}}if(r[n]._data.properties.time.replace("T"," ")==t&&0==o)return void this._showTyphoonCircle(r[n])}},showTyphoonForecast:function(e,t){if(null!=this.tf.realPoints[e])for(var r=this.tf.realPoints[e],n=0;n<r.length;n++){if(r[n]._data.properties.time.replace("T"," ")==t)return void this._showTyphoonForecast(r[n])}},_showTyphoonLastForestLine:function(e,t){if(null!=this.tf.realPoints[e]){var r=this.tf.realPoints[e];this._showTyphoonForecast(r[r.length-1])}},openInterfaceMsg:function(e,t){for(var r=0;r<this.options.interfaceMsg[e].length;r++)this.options.interfaceMsg[e][r].enable=t;this._updateEventsArray(this.options.interfaceMsg.trackPoint,this.options.interfaceMsg.forecastPoint,this.options.interfaceMsg.landPoint)},openTrackPopup:function(e){this.options.popup.display=e},openForecastPopup:function(e){this.options.popupForecast.display=e},getLoadedTyphoons:function(){var e={status:-1,data:"typhoon web component no init,no typhoon data..."};if(null==this.tf)return e;if(e={status:-1,data:"typhoon web component init,no typhoon data..."},null==this.tf.paths)return e;e={status:1,data:this.tf.paths};var t=[];for(var r in this.tf.paths)if(this.tf.paths.hasOwnProperty(r)){var n=this.tf.paths[r];t.push(n)}return e.data=t,e},getExtentById:function(e){var t=this;return new Promise(function(){var r=o(regeneratorRuntime.mark((function r(n,o){var i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=null,t.tf.paths[e]&&t.tf.paths[e].features?(a=t._getBoundRect(t.tf.paths[e].features),i=[a.minx,a.miny,a.maxx,a.maxy],n(i)):t._queryExtentById(e).then((function(e){n(i=e)}));case 2:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())},getTyphoonCircleTan:function(e,t,r){var n=this;return new Promise((function(o,i){n._getTyphoonCircleTan(e,t,r).then((function(){o()}))}))},_queryExtentById:(l=o(regeneratorRuntime.mark((function e(t){var r,n,o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.service.getTyphoonInfo({typhoonid:t});case 2:return r=e.sent,n=r[0],o=n.features,i=this._getBoundRect(o),a=[i.minx,i.miny,i.maxx,i.maxy],e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)}),unload:function(){if(0!=this.enable){for(var e=this.trackClickEvent.concat(this.trackMousemoveEvent).concat(this.forecastClickEvent).concat(this.forecastMousemoveEvent),t=0;t<e.length;t++){var r=e[t];this.off(r)}for(var n in this.clearAll(),this.map.removeLayer(this.tf.typhoonIconLayer),this.map.removeLayer(this.tf.Layer_line),this.map.removeLayer(this.tf.Layer_point),this.map.removeLayer(this.tf.selectPoint),this.map.removeLayer(this.tf.Layer_label),this.tf.Layer_Circle)this.map.removeLayer(this.tf.Layer_Circle[n]);for(var n in this.tf.Layer_forecast)this.map.removeLayer(this.tf.Layer_forecast[n]);this.tf.paths={},this.tf.realLine={},this.tf.realPoints={},this.tf.landPoints={},this.tf.realLabels={},this.tf.forecastLines={},this.tf.forecastPoints={},this.tf.forecastPolygons={},this.tf.nearestTyhoonPoints={},this.tf=void 0,c.prototype.unload.call(this)}},destroy:function(){this.unload(),this.options=void 0,this.enable=!1,c.prototype.destroy.call(this)},_clearIntervals:function(e){for(var t in e)window.clearInterval(e[t])},_mergeOptions:function(e){for(var t,r,n=1,o=arguments.length;n<o;n++)for(t in r=arguments[n])e[t]=r[t];return e},_mergeStr:function(e,t){return null!=t&&(e=t),e},_initPicSymbolOptions:function(e){return this.options.picSymbol={typhoonIcon:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAggSURBVGhDvZl7bFRVEMZREJAiogI+ACuIihhEQCIkCooGSEQSjMFIML7ABGs0xqhgokWDgMQYDBogqNWIEqr4DwLiIzw1IWKssWDaNLSlLX3Sd7t9wK6/7zqnuWy33bt06U1O9t7zmPlmzsycmbN9+iT5iUQifYuLi69JMtmLQ66kpGTZ6dOni/ldUVlZecXF4ZIkqmVlZQsAmo9214bD4QFJIttzMmz5JdFUSktLUwD7He2fY8eODfKPM/8ytJ6KIJOLiooeY+5zCLeM99n0T+V3VHZ2dv+eI+uCAgxHwHCsf7igoGAMYM9Ju/7+/Pz8ofRvAdg5WsTf6A/7GzQ1foQ2M6ngAXwTjNrLy8sHO8IwmVZVVRUB8DN+Zszby/w2AxPRnJqamlb6M1g/59SpU+NYO5z+IdoJtczMzL7Ru9RjAWCSA9PPHSHe5wJEgF/zCTELxws5sIxLo9udBvfv399PJsL3GtZtZWw9QsxFiMt7DDCaAMQXQzzi+tn625uamrSl2c7G0ezsuro6zww0F1BlFRUVt2oN6+fwfaKxsTGCUOeZinYhFApFAP4rNB5ImgND7CBM//BptAggZ913YWHh2IaGhg4wjP2sMcDfTAtF27S+ZdP8nhUdmZ39hiVUtLklvAto4Orm5uYIW75EixHgGxGGybc+U8l3wOjPUT/fnzkz8YPWbgDqbQS9Qf7BTvXTIcTuDYTXSOa+UF9fH4JOFd+zEgZsW7tZW6h3EQd0M0QFepj6IPyR23JpS87F79FoMzDgIfkAbbm0SXtIESkWMGislDkxvjph4CzKg8BBE2CltMd3tgmhGFzv02Q17//G0rCbI3tXw94jZ86cicispBTGv4fuQv+xL4Hor2b+1ljnQ0xhNBFCjbR3bcvbjfkGM5W07gDGsuV4fRIGfl+lp6df6vOhk6zbFUjjmMEwaQPpF9nBou2SVp43IdrigQgybjQ7HNkU0Ur/0w4ofdkI82Vc4DBcYmFsGrY7UcS1tfQ/iiC3JVHLTdDMEH1HE4CeCcFnjYDKbJjThAPf1y1wiGyS0zE5FWIzpDUjNJ/vxUG0GHQOdl0jRQD2Y3i0CLQv5j9r5jhGDt5t5sjCAwIt0+D9XhExR1woGwsKKIF5YU7MO8lnrmdNi1snZ0XDd5jG19HvaT/mw+BfAg3QawF+jyOCqSxNAMh5J2CQdWaKIyyquPWHHEiwFHRZXDD4Z21trSclzCY4h0Hru6urqxMGEwSwzWlUPgKw0ZjCWfUpz2EXbjFtj6ZvXYemAfaF+wDcHklL38MuejgTCQpA5gTzI6zfx3t50HXM225nw4vyI9GBxm5fGHylAzSTc/Py8rxTSvHZvPkt+/akDtpgEmKnrnLEdWSztjDIeu0wkeo645tna8qg4cVvpRf0TfVo87IWsC/pHcDTLdh7yRJjG4OGOVv3TrSzwLS/Yn8Q4Mz52wCmmX23K731KaGv9y67QUNZetepxMI2i9UTVI0EZOYdzXLeWB4ODcXlIMDbVCCYwtqkCGfXnegq3ADUK/15P2kO6Hkvu1AchKEOIdZtjiaOMCODatrs+HXRgNY2fdOWxlKEgH1C22uaf1MBXVKyUFFkeVQo6lJjzFd5NkmllPIYs0N/ghVE2yFT3lPCAP8NMUFjBpM1wQ0ysda025KbmzuA96Ig2tYcS/arlR/TWoOss1RBSZIXNZRnYxaTFPZcVIkJHC0dIVT9ZCax1G0p/QL8alBtBwEZPUc+BNiNrh/A07OyslKsOuo4ZDoBVx5g2zHBgP9gmlMoKpGDXgigIGtUf6oAdpEKLGnCoNOZ98Mxtew60eoBOaW+Ke+V8JcGYdrTOSrvoJHqc9htZtfNmNjObkErJrJY1YhXqOpwUA0Ynf/2FKTP9j3HhH6z+Lnqnj5nphWMeQVJtw/bdL9qNRdNzFRW2RVCEO+PO0eOpwTfp9nfnTmYQB9Y2GvCZIMVuwB/w+zpkDuWCYPjsa+DMAonQfMNCqc+535PIN21BGPzzTxC/hOxk7aRaLK/E4nXyDGsEl9J+BlqhIYrsVIteSFmYs42T0mZhTrtzEyyyCstiijkjTNNt7jcI6Z5oMUZADmvmFTp7yuHVOTqOK5hni5vXNEb1xyihPvNTO5D9Sti0VQEzNShJkGUTihnoe+XeOaso3MFTVmZF/b0AHoiJlHSxb1GTMACgtZqEewJaHXsCP11LrfwJWJZJsQWO8Y9UxFfl/XFBY5207VNMFyl49gtgPly+o7rlHLHvOUGnrbUz6+ugA8jeJpdR2TL/q1orVKObgBX25ngmQJzB6rIYLxFodbmeJdDgR8VtTCvs1vQObrCcos51oco+CPE+4DRxfpO2mq+/891efi+ES1VWDjTbtQ5rVnm2CZhaMfNdveY5r1Q26MHQgtp7aatTfFuOAE7hZbrbNiK4l3utoixQT4HbpPtEkFGmda9RCkpj7RsTrq7tbVVWqukHaXvR3530A7rAKLVuRBm5pVDlT3FgdA1sNZKAWi9nvnjZRZybLukXJQUwNFEdP+A9uRcGbQcHTgqkyxUnVMxQdNfGHf71wLwZUUF7FZ/beiSJkXjvH9qWl5/UQDHIqptVwXtQPjnYEopjD2IkC1WIJzg14u/ehRODfCOXgPcFSPZNYD2+ZxQRWqq/xZUqaeduF/3GmD+UhusaAG4x2lrZdc0XbSHZTICjVaf1C5EgwL8IDQcZmxBrwF2jDCJMSpkYf4I2tU93zxzrk7/O/rW6B+zTBevex10ogxVtqH9uxJdFz3/P/gcX4PsbnO8AAAAAElFTkSuQmCC"},this.options.picSymbol=this._mergeOptions(this.options.picSymbol,e.picSymbol),this.options.picSymbol},_createLayer:function(e,t){var r;return r=new p.carto.ElementLayer({id:e.id,name:e.name,zIndex:e.zIndex,map:t}),t.addLayer(r),r},_initTyphoonOptions:function(e){return this.options.typhoon.lineColor={a:153,r:255,g:255,b:255},this.options.typhoon.lineSingleColorFlag=0,this.options.typhoon.lineColor=this._mergeOptions(this.options.typhoon.lineColor,e.typhoon.lineColor),this.options.typhoon.lineSingleColorFlag=this._mergeOptions(this.options.typhoon.lineSingleColorFlag,e.typhoon.lineSingleColorFlag),this.options.typhoon.nameTextSymbol={text:"台风名称文本样式",fontSize:14,fontWeight:"normal",fontFamilyName:"宋体",foreground:{a:255,r:0,g:0,b:0},borderColor:{a:255,r:0,g:0,b:0},offsetY:20,borderThickness:1},this.options.typhoon.nameTextSymbol=this._mergeOptions(this.options.typhoon.nameTextSymbol,e.typhoon.nameTextSymbol),this.options.typhoon.focusPointSymbol={fillColor:"#FFFFFF",borderColor:"#80808C",weight:.5,opacity:153,fillOpacity:150,radius:12},this.options.typhoon.focusPointSymbol=this._mergeOptions(this.options.typhoon.focusPointSymbol,e.typhoon.focusPointSymbol),this.options.typhoon.typhoonSpeeds=[[.1,10.7],[10.8,17.1],[17.2,24.4],[24.5,32.6],[32.7,41.4],[41.5,50.9],[51,120]],this.options.typhoon.typhoonLevel=["常态气压","热带低压","热带风暴","强热带风暴","台风","强台风","超强台风"],this.options.typhoon.typhoonPointColor=["#000000","#02FF02","#39C7CF","#FBF9CC","#FFDE75","#FF8515","#FF5252"],this.options.typhoon.radius7_style={color:"#42A53C",fillColor:"#42A53C",opacity:153,fillOpacity:153,weight:0},this.options.typhoon.radius10_style={color:"#FFAA00",fillColor:"#FFAA00",opacity:153,fillOpacity:153,weight:0},this.options.typhoon.radius12_style={color:"#F2360E",fillColor:"#F2360E",opacity:153,fillOpacity:153,weight:0},this.options.typhoon.landPointSymbol={type:"PictureMarkerSymbol",options:{source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAuCAYAAAE6gvsvAAAABGdBTUEAALGPC/xhBQAACQFJREFUWAnNWFlsXNUZPvfOjMfLeLxhj+0odhLHtpqAgVoBmUSkIQtLE7GEpagIUJDygBTUQiCIh0CQQA2iPDRVVUVNRIjKCyEiCpsIarAUQlFCQZiWOl6SOo6dscdL7PEsnvHcft+ZOdd3ru/YIX3pL935z/n3s/3nPyNEBjqLiydVW+JkMmmMHTxoBJ991pCEcz5fNB6PGxc2bDCIO30+QyMnEokYmqYJwzBEYWGh5iZxpLq6IpJKjUDiB/ZNgNqA2WGjy+d78Fxx8UFJpNGxw4cNeu9ZudIQ09PT0tMgwqBXjRKLh4akdPzsWYkFifzSPadfBCdVgSWkUimp0en375HyaDyeSCSM0UOH0oyMyd6WFoN0ab7L7/9tLBYz+PU0N0vMdjQalW0zBmPlyrzuFSuMcDhsTE1NyW+0vd3AQP/pFJ4cQXdx8WpHpiKa5hXBjmH+C6xk51BlpS+Lh8VLXXrsMXPo8c7O2QmD1vHpoSFjZmbGGNy+XU4+21wEupQTt2xsTPSWlWVZJe3S2rVCJxUzKnwPPywFCu+8UywZGZG06g8/FNJCfSiUpY1gBPfN+BtvCIEYjnIj8essK5PY7KuVZTDWGWVbzYncirSvCMpXczhs8hRNYD4u2gXlKJREY319A4Lbq/pzMAL+nd3CHD8Qeg/DfHCOtoXg1vWmhomJLgsp3aR1fslQyOB2tX5cHuvXd9ddUha7+FfUlpFQ2XfffSLw9tvi8qOPiqlPPpnjxEpoGB+X3Z7SUhr4XMNWOoVjvXrp6KhcKXLte8BqgHIK4l9+KQa2bBFuWHLzYHJ/cLkJ3Ar/ue46uUfY51ZQQDkFWlWVbJrDqf3qK+FevlzxRQohJ3p6hLe11aTZG32VlXI4cn25Gwba2kTw3ntlRNKb3y9mEPpMNCojYTSky296WmQM7G4Khzem48+46K2qCiQikcvseq6/XpTs2SPybrpJJAcHRfSDD8Tkm29KSSj1Q3lxRs0ZGa+8oqslt2LsoQPOGgtQofhn5qH5xLKGYxdEFEzVNaQ7nqKMgqMRpqDxWOwPWFgmtVoIfaMZxh8bw+EjGb0slGWkx+9vTKZS57IkbB3spSNNk5MP2cjpLtO6mkTmOjtgaQ3mQ8owN4KfFYDgQSKTB4vCTp86gInh4fThg3xWNDTAW0wl00hHhxHcudMIPvecEevqMulJXHIX2toMZQgrd5yGmDY/B15vPZlZHmydonvuEdXvviuCTz4pwtiAXDWZe70tLWJRe7sUn+8EU2AZT3HmoEpZXX9Cnp2K114zz0fZCy/YfM92/U8/LTgRPEf8JBjG9vQt0NcndF/6diLzQkWF5GsFBaJwwwZh4MCVPv+8yLv55rRi5pdyWKKYrC54wNwNDWlFhOq99VaRd+ONovz1180ck+XdYgq1SoccztTRoyaZwtXHjwvvqlWSZle29xHJexqXCYzNdcPDpiE2LtbVicUYZi5IdncL5iCujo4tvIWCqpZRngInTojEwGyppOgK0wCiOEFdORyh6zuCd98tUphAJeRubBTBO+4wsxmFCeQP4WYgIDFtIoaxNGBYpyHQVvnRRyLPkldV8lZyg5irGQyzPD/fXxkKyfLRNEIhGPoXDP2M7eKdO0UBPLprasT0d9+JKy+/LBI/pEtDzeVqaLpypZdyhCwjJKh7iG0ncOXl1S0fHb1o5aXnxEJpnpxco2va7y0ks9lUX++1GyBzTiRKo7ukpBWn+mymfxlLKdOk4l81NlpbPV3FxfuvWsFJEBPNWmTgf832KnsNYji1To5ImzOxToLYK+840RUt58QqAWLcAqtmDGM3tutGhOa18nK1YTiOFHDCpWmvoqo6k0tO0XMGglthK1LFITgvUsLEzKS+zZtFwerVcjNzQxOYkuS9j7onjJI3/v33km7+aNoU7r8ncNzeN2nzNc75/a/yAlEfL5LI11/PuYl4ufB2UreRattvLOrShrJHTB/2GMwZwQzw6P4DU59PoYI1a8SiY8dQzskcbNdbsM/8wcSj8gieVeISyrDoqVNSF45jaPwcM/QjCTKQrtLSX6SSyZNSAj+LkBYLbrnFNDRx+LAYe+stkeg104cSNbEHBWPhxo0iHwnLU1srl2l8/34RQzGpl5eLZefPS3tMwf24ghTobve6xvHxL7SLfn85HrNBMOTQ686cER6kVgX9t98+d70V8ypxAAPxoV5WkOjqEn2Z2wi0ZKGuB/RoKrUPHRlE2YsvylKYU6q+WsyOC3X1tULNkSOiCJtb2SNmuU1fGXAzBh0no01Rih54IEuBSsLjEYu4rsA/BVg68BWRj0vLGoRq05cCxuDGkSqCOwmu6mqppAQU1vEAqP30UzGwfr0iiZJnnhGlqGFYduQCOZAcTFcgYHIYg44gzE0a//Zbx+hp0IMypfIAKnqchsVY49Ldu3G+8nPKq5ErTK/WwGLwZYF2LfMo6QfRnXfDDaLmZDouKqkjaFEQE/v2iejHH4uA7XWoZM3jatO38wfXrRPTHR08tinD663Tlw0NBXWX65d0Rsbwtm2yEGEgSE7miMknzb9jh3xFhbZvJ8nkk2f9FE8KZeQUjT7oi4DLfmvzyMglM6H1lJXVzSQSP2KpCl2o0ao/+0yefymNHzpRoyIt9Mgj8jlX8tJLSmRBnMLmvbxpkyyMIJzI07SWpZOT/6aiGYiygnv7AJxuY997222iAvuCCckJgvhLpQzvSS6pPVAVNDEDGHnqKRE/fTptRtOONU1M3A8exp0hqYYVdwcCValI5CSMr1D0AiQk/65dWU9uxXPCrGwn9u4VUZTSCjDqPo/bvXbp+PgFRVN4zowoBvH5ysrqRCz2NwQkS0gr76e04aRf1/V1yycmunPpzRuIUjq/ZEl+YmTkrwhoNgsp5vz4pNvjub9hbOzK/GIOe2QhBfwl+Wvc/3/B4spb2kE+gZLtN3h3/8mBl5N0VTPipM19NBOJvI9duoZ8bLy/53u9W+tCodnXjJPi/zvtmmeE5Tn2zC7rADEre/H0M69VK2+hNpbz2gBBPG7XdKLZZXL1rzkQvLeWcAZgeJCfnA3QcjlaiP5fBKSkFe4eINAAAAAASUVORK5CYII=",width:34,height:46,rotation:0,opacity:1,offsetX:17,offsetY:46}},this.options.typhoon.landPointSymbolHover={type:"PictureMarkerSymbol",options:{source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABGCAYAAAELN6JVAAAABGdBTUEAALGPC/xhBQAAGU1JREFUeAHtm21sXFeZx8/cO+MZv78mseM4seM4TZqkaUva0tbbpg0tpQoBhCgiLCwg8QUkJD6sxH4BPiwfEALEsgittNAC3S4VS2HpNg3blNJCum1aktI00ObNjp06L43f4tgee+bO7P935p7rO7FN0rSVdiWO9Pdz7nPOPed5/uc5L/fesTGXSAlXXjSmWfn3CZ3Cq8JuFV6QNEaFLcK/5W+4oTh77bXF2U2birr+nlDtKvzdVGdn0aXcrl3F8fp6Kt2VtDWMWTF96pS5UFlp8lIXEgkr64xp98IKzw57njmnixGkKhR6etSAedGWK5cSvvS7qqriU5WVxT2Suv6s4Bqwhqal+Pzo+vV5yZ2C6z7sREJKf7i1lbsj9+dKF8nZmtyp8uuFO4Sc8IRwSIXFZNjcR8Y2bvz32nTaFPJ5k0+ng8p9+96rSk/Sb8NIIvHMZEeH46k43tiIHQ8JaSq0v1BRkT+XThcnv/vd4uuSA5lMsdjbe1BldVTAvftflfKQOPij5H5J6b4hYJt1b/1UIvH7p0XQkyWSfq7CFbbQ/ZFinfCw8K9Ch9OXyTNdXdeosCaunMeYKqCj76oQUD4rTAlZFeYloxQ1oBu5qVXoFf5mJpG4qr+ycuuSlhavoFBpyeV+JT2R+JTwgjCmm4u2Ad2ckuJdwidGeno+V53SZaFgioKVQaCqRXud2rIlSD3yyD+q7oPCccGy1KZGvrQnnc6db262A5H9+tejgSEzIv7PieKzksXOzr2q/7dCrYs3fBxtzOfPjE9OmrGpKXP6K18xBcnjivKjAkFMQCNNf/8pZceFvHMB2SbsyCcSHzyYybxXrdupUcD0MI+8ZWrqpxL/ITypm+BhLqlCRldrBaZv7+6qqu3cVCULbh8efljZ3whE6qBuLBsN6eaSbmKKrRLuG92xY0byHmGJUAqtuar/B3JlHGCPzGRk0gKrEpwoGMy0QCTO6gZVmUtRA9KS58blwjqhS2gUFEXmDeGocJi8KjLtbYovLcT+BuFO4drDFRV31TY21qWmp01NNvtqZnaWRex54Sl11qdGiJ3S2iQFodwjvP813/9Yz5Yt3asJXxfKhcLG2SDYWHHoECs0dR/VPQNqpOAswNSbxhKJ27rWrevOT0yYoot/SeYEyHd0vL9qcBAuBgQC8wKM+MJm4Z9YwadWrSrGFyg3IcabmorjDQ3F3Cc/ycr6D8IKNWBdgHVMa6FnZl2B3mMp+53vmLzmCMMx8/DD/hJjlilbL5zEBblih87LX5BFrPxSzD77rBm9887omiYpU88k7qNj+4f6Y8L4tCrgIBjats1oITSTXEtSBiq3bKH+iGC3N1qhcabnayfz+QkqW0jRMThob7KNSk9jS/fufVSClWlUMJ7sx6phYd+N+fyPpwqFAjfQ24GVK+1N1grpNn/iE7Pi6CVlgbXAzq6vlqwQgyZoDYLpM75/7YVEIpFTIw43feADQepHP/pn1XlM+LM6npGcSzLDE5iyHxL+5XQymX+8urq4SxtB9rrrBqRjp9gq1AkQb1OU4UoFcEJQbRHunmlu3p4eGTkss/fpmoXkFWEydFvZBRKtC7XCu3Nf/GI2uPfe+5XfIGSEsg4XuL2koiI3nG1rK/avWzepPPH/zqTLMynsO3SBe+AK6aAiG8BWSom8rEQDiya1QkeESoVQKdTEwGoHNS6Ys8oTgsQXII+OxauwmFHzDFCn6FynOq3Zicsq2S60Ci1CreAMoD6zibikU6blWYHZdTKUTBTK2AiZilEqMyD0GG8JxQ6BPQ6s1MzqeKmi4vabrr/eT+i4aPd9rTxarkS4QNKal7twoVCcmjpbOTCwVxqMOCYwdY8LGAY7gTq2N0UGhJ2zrOPlVcI1wvpXUqnetRs3diXUia0c75Q8q7bT6Qabd7r29qDy6af/S9o+4aDwitAvwFIOI0ptlmhnjOn8amGLsP7X6fSHb1+1yqdzPHXeJnp6TPKjH7XLY/6HPzTF/v5Sx7op8/jjJnv33XOGaTmpqaral+jr+4OKWYMOCBjEsSLvthTGnG2UhbpLWPXfFRXbe5ub/SBc5F3nNWfOqHgupT71qbkL5fQcYIcCZrgHD/UYcKOChuE4LxAPrKRs1XkimIRMC0S5WjBVTZ6XZofJhWCz4HpU5xyXNNZm5pe/NLO7dpmxW281ZzMZk52ZMVkdxrPalbIyQquzmTilvm+7rUf3yQ4Lhto67xggIDgssVVnhdx4EBS5cKczKhjRSRqqrjaZD3/YTP3sZzaSKLMMqdzmuQ7rRiHf18fZgpli25dk5ljPkVwQnfB7Qji5LZd7bFgUxncz5pHdW6Q///LLZnb5cju37G6nmWHL1LHb0CbJ657Vn/1s1gwO9ik7IAwJDIE9l5Rc0pUshw2GgN1+o7BZ6HkhlfpAVTLJM09p3oQSZkjOU1du922Vuesbenv7vCee+I2qHhIIwiPCOWFGnZdmgS5s0k0EI4NMMK4RMGSdNsd1R9LpW2e1SdpuoTrWSaRTZatX+c333RdUPPDAL6ViHfhTCBhgCkZnxIgBKW1SY+hYjAgYTu0YwllxTZBIrDyeSt0xmExyloq8dHmpzO1bt2Yzu3axa9PZYeFVoV/A68Ufk1RYltQoM8MZ4qYnkbxaaB9ubLznhZkZ9ljT09YWdI2MPO+Pjvbp8oTAQRYMCpyACIVo9VM+SvMYiErCTGgI8cHUaRGIkW6hS1gqYOS4QGfQ3S+cFpjzRP2CHUv/5pIMYfwJxmqhbWLr1q+e1CPdoI6sZ2++eVq6bqFR4OkZ9t65RAdC8lht7drXamo+pzzPVMTFJRl956y6wpbflMWhh9DLfU5KHU0IFj7mNrrLSpc0IOyU9QFwAnIgMN1Y55UHrG6cgOwpSPKSxixqQMxbOuT0wyyoCUEeHUbhNR2yxrOcO7DbYRCzINoSdF2WFjQg7BwP2SE5ljUJTEHQILBIOQOUtR2xFTAdmfdsPGy7XKO3jKizeUMzzwDVgFY375uVZzVk7iOZ9xgAAxgHAzTqGOD5hhWPdeB1gY2HDY41wbFRZgQdRUklGISOwwmdrRJWh7JVsuGU56055/tX65RTqKuv94rT04Wizgqy5nzt7Oz+RBDgOXVhC/YwFGPYAxgmuw1L2hQZEHaOR3i3ROgS1gndQtuhiopbG1asWLq8rc1bpo1IxzTPngEktQNxBGvSDvmeqdHRoGZo6OlENku80BYxRCIOAvVDYEYxEQ2BCqCenZDO6fRqAQM6nslk7u3dvNm3HYZHLTq1KX6NIUC7YWJq6ljFsWPPq85x4ZDwqnBSIC44ntsGLAPKYchC1Lfvra2995Y1a/yCjlqhx1a6g6o1JOyYfGSk53XnNm3yUgcPQjmbEfHBDHHDMGeAlBjApsKYEWwrkbt1ML1Tp+LCrOLHNS7p8tZbMcDN7niubKlcevHclWppGTTnztE5s4P4cJuUHQa3kCCZVo0CW+/SU77ftbWry3qO95YBGYI027cb/2tfM4kPfcgUpQsol0x++cs2H2Sz9rowPm5m77jjVrVHQOIYkthg78Du0h9dEKmM/Xphi7Dp8XT6vq1tbb7zFlnxgx+Y5F13qXjxNNGiPmBLDLh766urf2dOnXpJd/1BQJ4QJmRB4Bhg/GGAIbDH8s319Zb6QJ7hJZ7nHn1UxYun4NgxW88xAisW99zzLt1VK9C+mxmWAWcAEhaYBZk3EokltfIioj1sKPfjH6t48XR+wwYT5HL2JX2g54K8WLDfJQoF4ov2WV/oA4fnGcAaQEFq2PcbiuG4YkQEGTL70EOqUkq5vXvtQ8n0975n3tBDCW909Na3tCPF5fAwndE2oB9gDUBBYkpE8PWuCRovLuB6/DOfMUt27jRn1KFRJ3YmSG+P40iXZ7ZQrutCKkVnUfthXqJkEZIpwXpOrzMtxeIwe2vUmPIk9yyQ1xs0vLVzPuxkXusxfWVHR7x9+mFt4JZoP0dB5xeAvqCc045SsC/J5Inb6KEX3dCNNxrvhhvm6NZNtAqoa+txTX1J7/TpsxKTAu2zKKGeZwD7N8skj00Tw0GQtY2qkeiUETY4MzZm2vbsiTq09XSTG/9ZGe06T+t1YeLnP39BxWxGLEYsSjhbthDBAAbQ+Rnhjd58/omJYrFA43jlOqFhOhr4yEdMLgw815mtG5a7+p3btk2ZIKBzzghs1bDgRthGpa6tNVhFxVMCq2FTbRAcmUylrlI+Gn831rNPPFFyQWVWp45dGfUJynXbtwfe97+/W5enhZMCRlgDFJVzQxBeYBX0UPmEMNiZz/9hNpebdp45rxwjTsYZsHXUeV1nZ7Fuz57fhu0NSGIAQ+A2I2XngpA8w0AhlQaF48jr8vnH/Fwub+NADdOZyzsZGaYyhifT3GzW5XIvmpGRfrXRF7aFY2xE0VasfDQLWBWghLYcCxhwVDixKZ//z8acUlgBSaBF0Y4+NKxu2TJzne/vM0eOcAZwbeAQO2GZ97qOYoA8RhRkBe0TC2Ur1loZoc+T9xxLp2v0lEz18hjQdc/atYXV/f2/M2NjdAwOCzBAYDP95j0n0klZ+mqJiYKUbojdouHpM/TZpiCoPJdMNuEK355toeS79W2wbd++3SabJX6OCa+FkqCGVV7L0W5ZcktxpFQlFlHaZVpCG4lrOwJ1hULulpmZoeMNDbccnZ722cV6N26crXnmmV3KcgrG4yOhdOPOC4l5natOaUMgc3GSEbrHDkNGskFoF7qENUKnsGx0zZr3Vc7O9mUGBvbrmpMvtBM3RD2rH1Nu0c5VtrgBFMaMYDvlnNAqdArdQoeAjslAZ3iOAS7gWHrnvRuWrizNG4J4qSiQDdrSS5JVkrigw+nCvfduuJBMfqy6u7vof/vbn5QOrxlv6jF8ZdNN128tyQjeCfDygZcQ3byU4AUF4GWFdHyL5uWF+xXBZXX4FxmItyA2mKJ4TzDlpsfGCtXJpCno/eDUiROP6KSJ5wTqot8GVPbWk4xICLwNSfF2hLckyuM1E+Kv6f8dAwqtty8pDGjvYhAa6JyM5+Od63Yb38h4nph3OivVAPJtSRhzRUkWuHvjDrn9E8kE580AMg7KIMMRomzkMM6y67DcxcHk5poyB0hw5GDMFZHinFBbl5dCx53TzmEcBexa6VCSd0DHZgKo50hw/TtncA5nWe0Ah1S2/TicjnrAEWLJeLNEOAPUzuIp5jT1ndM4g2M8aPK0y0Mnz/1xuDKIuBICcJxTFBsb23oc7LSuDFIgzJEBoZd8Qao6URiTXzCFzhOuOM7o4QiO4ah73OeswrEAiY4yCKEeJIGUHhNS8qgm53mVQbGYlrUZGlaDWT+RmEkWCtPqQL8jKbrRxTEAAe6pjpMdx1Ue4JAcstFBDvUgwkXGJffERSMg5jg2OsdxCgdxljdJzaFsksT5OsE6rk9cTSeSyfXTntfUpN9TNuj7a11Dg/G1edvzpio6aZ+vOYOi0ufOWX0aDc6fD/L5fEIdj2TOn/+zn83ypOKIwGmcR8cBgFMrElIgA7IcEUyNRYlYkIDQ+XioE+I4jpM43SIsCSVEQEiN3t92HE2lrulYtsxrb231fJ1SbAqdI2+dlbQvGEuKOV2sHHKoi4FIkVEo+H4hPTT0cvLcuUGpGXEcxvFzwhuhhAzIgQimSDQ11FaJZSldmkdAzHlWbuYuI4qDOI7Ty0JAgh31F9PpG/MVFS3XrF7tp/WDxviIqg4eWIEkZ53i9V2Y4o46h6N7VCdeztO2aWwMEtPT59IHDuxTsYsGSDgTAjIgAoKIBtYSu4vo7jIS6C9KCzjvRt053qrKEIDzjX2e19NXUXH1u3t6/BSGkUJnLQmxa1dWpnfE2NvmRtvVLd0uq1SP1q3l3AM0lbzu7iB17NifvKNHj6jYRQIknBaQEOGiYUESIgLUJHk33xl5FjLCG+fbQkCAdX6vflGytKWlYVVDg43zMsdUyV47wzE4TLy4LXPmYr2rK8ldtm5MdzHByRUrCqnm5jF/9+7fq7ojAQJOhYAE9EwZSGCBjNaEOAE4wrxnxcZ5wts5v1x5SFgqNO5Jpd7Ts2RJ9VL9hmOegaqA807v6w1W6vOfN15np0oWTgW9WM4/+aQpHDhgiqdOmYTebKT0FtS/6SZTHBkxk+vXlwjldsgAijhHptfWZjKbNk36P/3pHtXAWR5QIWAolC4SIIFdJfp8xzx3CZshgG3ORUC98kQBgJDal31/Y3NVVeUSX2/veXHtDFKhNQypBAmZX//a+Js2lRR/4a9C2VQIC6XpL3zBfndwhMb7oL7eJJugv9/4y5ZV+lu3bjS//e1LUrPwMdrsGu6swDV61oJoAQqXaalK0QYhjgBWfiLBoSqbSNSd8LyunkzGs6/+9Q7bkuA+BcQk77en9BumAu95ryBB4IUPftDMPvLI3IcYXtbH+yCvbVP7pZncu9cr6Edepr6erXie7dIxqPiGj/BpU5wA8m4auH2f6eCQOpNINDdpK4qM4HOEM8gZhxSKlOkT5oReZUPS5SYcn9aPb0eqqkx29+7SZ47wUwdDB9wpyb4Y1FSIrs+cKZjOTnYr7Hd2I3EcHRHu/FS2xIbNhH9g5mJwAzpvwvNqRa39eIQCYwlJK8NKLs8CZtPQkBnfutU0PPus05ipb37TTOkzG7/9IlHX1Ufq50G2TasL88x5km3f5a1m7t7s6Khf0dZWY/74x8hmVbG2h5J8qaHw3vgaQH/MDc7TTjrSkUFDsTg+oK9PKky6ryV2MYKI0NAy43WT1e/fb8Y+/nFT/5OfmDPt7aao7wtljsTut/W5T8kSEEqs5ppzAPloEoc6CZNatqxgDh7kXIAPcdvJc4uDsqW0EAFUZqWct4isCIKhVz1v86QMJp6sgRcbv9C16uaYy52dplG/9jutiHCEISOnw5FVdeuolfxxddS2IyUqC8uTdXUmvXx50Tz00JBU2M8CCPADoLNboGTEH6HiEm3DHJW4kRMUbHKaAuQnNxQKB07o7bCbd/M+TaiSLZPRyPg8Hf3Wt0xWP/preuCBqMwOU1g3ajNswy7ZYVn8q1NZn2H5ih07cvqN3ksKLeYVtjrbrd26hgS6wMeIR6LJJmnIu22QVZRTIAtKa4jlksvQDfn+mgHPu0ZbIYEw1xoXMojpQWP0EvVEmRIhvOJXvzJZTYuz+g+cBadMGEW2vosoe3fpj5s+Tq7buTOfOXjwFbNv32HV4AjMKZBIOBXm0UEE5MBr9JEimgIymK4IDVgiAhwhLkoin5brt6W1hcKFg8bc2uD7SQpIOMtDjg1pSeu8HHaGWil9344dpvuZZ0zyF78w0y+xbXNjWM/lJd19qEi0Z/ugrvJJ/Y51086dgf/44y+Yo0cHpMLRs4JznD140VOgyqyTSJvUKL44x9k6KgX21SYh/jywVNfNMrr+oO/flve8Ol/JGqyCyBkZ6pI1PiQnriNPGcnJeN7q4uSE9do3by4sv+qqyeSDDz6lb6BMUR6NGXkHiMB5yhhQewKULHtRMmehSkjqME4CIQ4JHIY4CTIlcN6B54IGHZCWvpZM9hY9LykySm0uYLTqRk7imA1/dC5aqOBSeP/FBPABcP22bUHF7t3/Y15/nTAfE9zI4zzHXkYe/YTA3LdhL1nmvK7LIwCFS+qY0AdMEw4TrAtEQ6OA4wAiiAx0DfrlcusJ378pq5/XihQ+IMyLhnhY23JVWShyKEPvSKpfssRs6O0NKp57bn/i2DHCnTnNqOMsTjPiLuTdfMd5twXOc15lixNAoYxgNCGBxZFo4DgJEe4ZgYiAAMggDxH1WqVbXhcRE75fMeL79rdlzpHIaVV0Ka6jQ+t8WNixalWha/16HH8xMaRTVWlUCW2cx3FABHCN4+xe8VGPnvykn5dK4TpPPacISViICKaFiwjWCEeCI6JWw1f7hue9S6/FmvXDa5/V1TlLD1E+Nl3QJfVSZZOcbshkLmSee+55ffXFMYDjgJHGaSShzjzHceY63fzFUVd5lC5JgKt5ERFMCxcR1crXCm6NgAwAEeggqWbG81bq/yk26mHKPxMEpemhAiKDRLgv1X/urevuLmQGB/+U7O/vkxqncBwncRyn3Wijoyw+4pftuO6z6bIJcDcsQARkuKkBEfGocGTYqaGyGuP7tecbG6+fSqcbDp0/nxQDZmN7e77a9ydqjhx50czM4NQFAelGHKddntGeEKYEQv1Njbjql6U3TYC7+yIi3Brhtk6iAiKIAJyHCOQcESItX1fXKkJMcnT0tMpw5mLHR6QDOA0hLszdsdY9tyy4wKn+JdMVE+BaDongMr5rQMRCUQEhoM50dLSaDRt6lNevWg8d0f+5QAJO4iyjTYiThxQ32mxnhLk7zl6x42rDprdMgGsIeVFUMDXc9IAMFs2aYO3aNdmbb75/eM+eTKD3BUwBXye6pm3bspXPPfdp//Dho6qH04CoADgN1MXc+zzl33LCwLctiU0M5LxnDVUeoxk1RpB5WzHW0HBnbv/+YpqXJBUEipLykwcOFGcaGlZq5XwSjRCf2xzR3/Joq4156W2NgHmtSyEm6IPp4aR3vLn50/rI8Y1KnRpZ/bP64wXB368eHr5f9dwz+zvmtPqI0jtOgOspJMJdun6dJGJITsJWlC8V/fXvO8LA/wIIQK+QFKWocQAAAABJRU5ErkJggg==",width:64,height:70,rotation:0,opacity:1,offsetX:32,offsetY:70}},this.options.typhoon.typhoonSpeeds=this._mergeOptions(this.options.typhoon.typhoonSpeeds,e.typhoon.typhoonSpeeds),this.options.typhoon.typhoonLevel=this._mergeOptions(this.options.typhoon.typhoonLevel,e.typhoon.typhoonLevel),this.options.typhoon.typhoonPointColor=this._mergeOptions(this.options.typhoon.typhoonPointColor,e.typhoon.typhoonPointColor),this.options.typhoon.radius7_style=this._mergeOptions(this.options.typhoon.radius7_style,e.typhoon.radius7_style),this.options.typhoon.radius10_style=this._mergeOptions(this.options.typhoon.radius10_style,e.typhoon.radius10_style),this.options.typhoon.radius12_style=this._mergeOptions(this.options.typhoon.radius12_style,e.typhoon.radius12_style),this.options.typhoon.landPointSymbol=this._mergeOptions(this.options.typhoon.landPointSymbol,e.typhoon.landPointSymbol),this.options.typhoon.landPointSymbolHover=this._mergeOptions(this.options.typhoon.landPointSymbolHover,e.typhoon.landPointSymbolHover),this.options.typhoon},_initForecast:function(e){return this.options.forecast={clickShowPolygon:{flag:!1},lineStyle:{width:2,style:2},polygonStyle:{type:"SimpleFillSymbol",options:{style:5}},org:{"中国":{rgb:"#FF0000",display:1},CN:{rgb:"#FF0000",display:1},"中国香港":{rgb:"#FFA500",display:1},HK:{rgb:"#FFA500",display:1},"中国台湾":{rgb:"#FFFF00",display:1},TW:{rgb:"#FFFF00",display:1},"日本":{rgb:"#00FF00",display:1},JP:{rgb:"#00FF00",display:1},"美国":{rgb:"#0000FF",display:1},US:{rgb:"#0000FF",display:1},"韩国":{rgb:"#B97A57",display:1},KR:{rgb:"#B97A57",display:1},"南海":{rgb:"#800080",display:1},NH:{rgb:"#800080",display:1},"浙江":{rgb:"#FFC0CB",display:1},ZJ:{rgb:"#FFC0CB",display:1},"菲律宾":{rgb:"#22B14C",display:1},"广东":{rgb:"#4B0082",display:1},"欧洲":{rgb:"#B5E61D",display:1},null:{rgb:"#000000",display:1}}},this.options.forecast.polygonStyle=this._mergeOptions(this.options.forecast.polygonStyle,e.forecast.polygonStyle),this.options.forecast.clickShowPolygon=this._mergeOptions(this.options.forecast.clickShowPolygon,e.forecast.clickShowPolygon),this.options.forecast.lineStyle=this._mergeOptions(this.options.forecast.lineStyle,e.forecast.lineStyle),this.options.forecast.org=this._mergeOptions(this.options.forecast.org,e.forecast.org),this.options.forecast},_initPopup:function(e){return this.options.popup={display:1,offset:[-200,100],divStyle:"font-size:12px;color:#000 ;background: transparent; margin-top: 8px;margin-left: 10px; margin-right: 0px;",liStyle:"height:20px;margin:2px;",pointEPSG:4326,pointPrecision:3,typhoonName:{display:1,label:"台风编号：",unit:""},passTime:{display:1,label:"过去时间：",unit:""},centerPoint:{display:1,label:"中心位置：",x:"#lon#",y:"#lat#",format:"#lon#E,#lat#N",unit:""},centerPressure:{display:1,label:"中心气压：",unit:"百帕"},power:{display:1,label:"最大风力：",unit:"级"},speed:{display:1,label:"最大风速：",unit:"米/秒"},moveSpeed:{display:1,label:"移动速度：",unit:"公里/小时"},moveDir:{display:1,label:"移动方向：",unit:""},sevenRingRadius:{display:1,label:"七级风圈半径:",unit:"公里"},tenRingRadius:{display:1,label:"十级风圈半径:",unit:"公里"},twelveRingRadius:{display:1,label:"十二级风圈半径:",unit:"公里"}},this.options.popup=this._mergeOptions(this.options.popup,e.popup),this.options.popup},_initPopupForecast:function(e){return this.options.popupForecast={display:1,offset:[-200,100],divStyle:"font-size:12px;color:#000 ;background: transparent; margin-top: 8px;margin-left: 10px; margin-right: 0px;",liStyle:"height:20px;margin:2px;",pointEPSG:4326,org:{display:1,label:"预报机构：",unit:""},arrivalTime:{display:1,label:"到达时间：",unit:""},centerPoint:{display:1,label:"中心位置：",x:"#lon#",y:"#lat#",format:"#lon#,#lat#",unit:""},power:{display:1,label:"最大风力：",unit:"级"},speed:{display:1,label:"最大风速：",unit:"米/秒"},moveSpeed:{display:1,label:"移动速度：",unit:"公里/小时"},moveDir:{display:1,label:"移动方向：",unit:""},centralPressure:{display:1,label:"中心气压：",unit:"百帕"},pointPrecision:3},this.options.popupForecast=this._mergeOptions(this.options.popupForecast,e.popupForecast),this.options.popupForecast},_initPopupLand:function(e){return this.options.popupLand={display:1,offset:[-200,100],divStyle:"font-size:12px;color:#000 ;background: transparent; margin-top: 8px;margin-left: 10px; margin-right: 0px;",liStyle:"height:20px;margin:2px;",info:{display:1,label:"详情：",unit:""},landtime:{display:1,label:"登陆时间：",unit:""},landaddress:{display:1,label:"登陆地址：",unit:""},strong:{display:1,label:"强度：",unit:""},lat:{display:1,label:"纬度：",unit:""},lng:{display:1,label:"经度：",unit:""}},this.options.popupLand=this._mergeOptions(this.options.popupLand,e.popupLand),this.options.popupLand},_initLayerOrder:function(e){return this.options.layerOrder={trackLine:{id:"typhoon_line",name:"台风路径线图层",zIndex:101},trackPoint:{id:"typhoon_point",name:"台风路径点图层",zIndex:102},focusPoint:{id:"typhoon_focus_point",name:"台风路径点焦点图层",zIndex:101},trackLabel:{id:"typhoon_label",name:"台风路径文本",zIndex:100},typhoonRing:{id:"typhoon_ring",name:"台风路径风圈",zIndex:100},typhoonForecast:{id:"typhoon_forecast",name:"预报图层",zIndex:101},typhoonIcon:{id:"typhoon_icon_Layer",name:"台风风眼图标",zIndex:100}},this.options.layerOrder=this._mergeOptions(this.options.layerOrder,e.layerOrder),this.options.layerOrder},_initLayers:function(){this.tf.typhoonIconLayer=null,this.tf.typhoonIconLayer=this._createLayer(this.options.layerOrder.typhoonIcon,this.map),this.tf.typhoonInterval={},this.tf._ds={},this.tf.Layer_line=null,this.tf.Layer_line=this._createLayer(this.options.layerOrder.trackLine,this.map),this.tf.Layer_point=null,this.tf.Layer_point=this._createLayer(this.options.layerOrder.trackPoint,this.map),this.tf.selectPoint=null,this.tf.selectPoint=this._createLayer(this.options.layerOrder.focusPoint,this.map),this.tf.Layer_label=null,this.tf.Layer_label=this._createLayer(this.options.layerOrder.trackLabel,this.map),this.tf.Layer_Circle={},this.tf.Layer_forecast={}},_initInterfaceMsg:function(e){var t=e.interfaceMsg.trackPoint,r=e.interfaceMsg.forecastPoint;u.isObject(t)&&(e.interfaceMsg.trackPoint=[t]),u.isObject(r)&&(e.interfaceMsg.forecastPoint=[r]),this.options.interfaceMsg={forecastPoint:[{name:"mousemoveForecastPoint",enable:1}],trackPoint:[{name:"mouseoverTrackPoint",enable:1}],landPoint:[{name:"mouseoverlandPoint",enable:1}]},this.options.interfaceMsg.forecastPoint=this._mergeOptions(this.options.interfaceMsg.forecastPoint,e.interfaceMsg.forecastPoint),this.options.interfaceMsg.trackPoint=this._mergeOptions(this.options.interfaceMsg.trackPoint,e.interfaceMsg.trackPoint),this.options.interfaceMsg.landPoint=this._mergeOptions(this.options.interfaceMsg.landPoint,e.interfaceMsg.landPoint)},_transformMap:function(e){return this.options.dataSpatialReference==this.map.spatialReference?e:(new p.sfs.CoordinateTransform).transform(e,this.options.map.spatialReference)},_transformData:function(e){return this.options.dataSpatialReference==this.map.spatialReference?e:(new p.sfs.CoordinateTransform).transform(e,this.options.dataSpatialReference)},_transformObj:function(e,t){return t==this.map.spatialReference?e:(new p.sfs.CoordinateTransform).transform(e,t)},_showTyphoonTrack:function(e,t,r,n){var o=this;return new Promise((function(i,a){var s=o,l={status:-1,data:""};o.service.getTyphoonInfo({typhoonid:e}).then((function(e){var o=e;if(o){if(l.status=1,l.data=o[0],null==o[0])return;s._drawOneTyphoon(o[0],t,r,n)}else l.status=-1,l.data="no data ! Please check data.....";i()}))}))},_showTyphoonTrackData:function(e,t,r){var n={status:-1,data:""};e?(n.status=1,n.data=e,this._drawOneTyphoon(e,t,r)):(n.status=-1,n.data="no data ! Please check data.....")},_drawOneTyphoon:function(e,t,r,n){var o=e.tfbh;this.clearOneTyphoon(o),this.tf.paths[o]=e,this._createlineById(o,t,r),this._createPointById(o,t,r,n),this._createTyphoonLabel(o,t),n&&n.showForecast&&n.showForecast.show&&this._showTyphoonLastForestLine(o,t)},_createlineById:function(e,t){this.tf.realLine[e]=[];for(var r,n=!0,o=0;o<this.tf.paths[e].features.length;o++){var i=this.tf.paths[e].features[o];if(!n){var a=new p.sfs.Polyline({spatialReference:this.options.dataSpatialReference}),s=new p.sfs.Path({spatialReference:this.options.dataSpatialReference}),l=new p.sfs.Point({x:r.geometry.coordinates[0],y:r.geometry.coordinates[1],spatialReference:this.options.dataSpatialReference}),c=new p.sfs.Point({x:i.geometry.coordinates[0],y:i.geometry.coordinates[1],spatialReference:this.options.dataSpatialReference});s.addPoint(l),s.addPoint(c),a.addGeometry(s);var u,f={a:153,r:0,g:0,b:0};if(null!=this.options.typhoon.lineColor&&(f=this.options.typhoon.lineColor),this.options.typhoon.lineSingleColorFlag>0)u=new p.sfs.SimpleLineSymbol({color:new p.sfs.Color(f)});else{var h=this._getTyphoonGrade(i.properties.speed);u=new p.sfs.SimpleLineSymbol({color:new p.sfs.Color.fromHex(h.color)})}a=this._transformMap(a),(y=new p.sfs.Element({geometry:a,symbol:u}))._tfbh=e,this.tf.realLine[e].push(y)}r=i,n=!1}if(this.tf.realLine[e]&&0!=t)for(var d=0;d<this.tf.realLine[e].length;d++){var y=this.tf.realLine[e][d];this.tf.Layer_line.add(y)}},_createPointById:function(e,t,r,n){this.tf.realPoints[e]=[],this.tf.landPoints[e]=[];for(var o=this.tf.paths[e].features.length,i=0;i<o;i++){var a=this.tf.paths[e].features[i].properties.speed,s=this._getTyphoonPointStyle(a),l=p.sfs.GeometryFactory.createGeometryFromGeoJson(this.tf.paths[e].features[i].geometry,this.options.dataSpatialReference),c=new p.sfs.SimpleMarkerSymbol({fillColor:p.sfs.Color.fromHex(s.fillColor),borderColor:p.sfs.Color.fromHex(s.borderColor),size:s.radius});c.fillColor.a=s.fillOpacity,c.borderColor.a=s.opacity,l=this._transformMap(l);var u=new p.sfs.Element({geometry:l,symbol:c});u._data=this.tf.paths[e].features[i],u._tfbh=e,u.islast=i==o-1,0!=t&&this.tf.Layer_point.add(u),this.tf.realPoints[e].push(u)}this.initNearestTyhoonPoints(e),n&&n.land&&n.land.show&&this._createLandPoint(e,t);var f=this._getBoundRect(this.tf.paths[e].features);0!=r&&this.map.pan(f,[200,200,200,200])},_showNearestLandPoint:function(e,t){var r=this.tf.nearestTyhoonPoints[t];if(r&&(r[e]||0===r[e])){var n=r[e];this._createLandPoint(t,!0,n)}},initNearestTyhoonPoints:function(e){var t=this;this.tf.nearestTyhoonPoints[e]=[];for(var r=this.tf.paths[e].land,n=this.tf.realPoints[e],o=function(){var o=parseFloat(r[i].lng),a=parseFloat(r[i].lat),s=0,l=0;n.forEach((function(e,t){var r=parseFloat(e.geometry.x),n=parseFloat(e.geometry.y),i=Math.pow(r-o,2)+Math.pow(n-a,2);0===t?s=i:i<s&&(s=i,l=t)})),t.tf.nearestTyhoonPoints[e][l]=i},i=0;i<r.length;i++)o()},_createLandPoint:function(e,t,r){var n=this.tf.paths[e].land,o=this.tf.paths[e].ename,i={typhoonName:"-"==this.tf.paths[e].name||""==this.tf.paths[e].name?this.tf.paths[e].ename:this.tf.paths[e].name,typhoonEName:o,symbol:f.object2Symbol(this.options.typhoon.landPointSymbol),tfbh:e};if(r||0===r)this._createOneLandPoint(n[r],t,i);else for(var a=0;a<n.length;a++)this._createOneLandPoint(n[a],t,i)},_createOneLandPoint:function(e,t,r){var n=parseFloat(e.lng),o=parseFloat(e.lat),i=new p.sfs.Point({x:n,y:o,spatialReference:this.options.dataSpatialReference}),a=new p.sfs.Element({geometry:i,symbol:r.symbol});a.tag={type:"land"},e.typhoonEName=r.typhoonEName,e.typhoonName=r.typhoonName,a._land_data=e,a._tfbh=r.tfbh,0!=t&&this.tf.Layer_point.add(a),this.tf.landPoints[r.tfbh].push(a)},_getBoundRect:function(e){var t=180,r=90,n=-180,o=-90,i=2;i=2;0==this.options.projection&&(i=1e4,null!=this.options.rect&&(null!=this.options.rect.maxx&&(t=this.options.rect.maxx),null!=this.options.rect.maxy&&(r=this.options.rect.maxy),null!=this.options.rect.minx&&(n=this.options.rect.minx),null!=this.options.rect.miny&&(o=this.options.rect.miny),null!=this.options.rect.noMinx&&(t=this.options.rect.minx),null!=this.options.rect.noMaxy&&(o=this.options.rect.maxy)));for(var a=0;a<e.length;a++){var s=p.sfs.GeometryFactory.createGeometryFromGeoJson(e[a].geometry,this.options.dataSpatialReference);t>s.x&&(t=s.x),r>s.y&&(r=s.y),n<s.x&&(n=s.x),o<s.y&&(o=s.y)}1==e.length&&(t-=i,r-=i,n+=i,o+=i);var l=new p.sfs.Point({x:t,y:r,spatialReference:this.options.dataSpatialReference});l=this._transformMap(l);var c=new p.sfs.Point({x:n,y:o,spatialReference:this.options.dataSpatialReference});return c=this._transformMap(c),new p.sfs.Envelope({minx:l.x,maxx:c.x,miny:l.y,maxy:c.y,spatialReference:this.options.spatialReference})},_createTyphoonLabel:function(e,t){var r=this.tf.realPoints[e][0],n=this.tf.paths[e].name;"-"==this.tf.paths[e].name&&(n=this.tf.paths[e].ename);var o=e+"\n"+n,i=this.options.typhoon.nameTextSymbol,a=new p.sfs.TextSymbol({text:o,fontSize:i.fontSize,fontWeight:i.fontWeight,fontFamilyName:i.fontFamilyName,foreground:new p.sfs.Color(i.foreground),borderColor:new p.sfs.Color(i.borderColor),offsetY:i.offsetY,borderThickness:i.borderThickness}),s=r.geometry,l=new p.sfs.Element({geometry:s,symbol:a});0!=t&&this.tf.Layer_label.add(l),this.tf.realLabels[e]=l},_createFocusPoint:function(e){if(e._data||e._land_data){this.tf.selectPoint.clear();var t=this.options.typhoon.focusPointSymbol;if(e.tag&&e.tag.type&&"land"===e.tag.type){var r=f.object2Symbol(this.options.typhoon.landPointSymbolHover);(n=new p.sfs.Element({geometry:e.geometry,symbol:r})).tag=e.tag,n._data=e._data,n._tfbh=e._tfbh,this.tf.selectPoint.add(n)}else{var n,o=p.sfs.GeometryFactory.createGeometryFromGeoJson(e._data.geometry,this.options.dataSpatialReference),i=new p.sfs.SimpleMarkerSymbol({fillColor:p.sfs.Color.fromHex(t.fillColor),borderColor:p.sfs.Color.fromHex(t.borderColor),size:t.radius});i.fillColor.a=t.fillOpacity,i.borderColor.a=t.opacity,o=this._transformMap(o),(n=new p.sfs.Element({geometry:o,symbol:i}))._data=e._data,n._tfbh=e._tfbh,this.tf.selectPoint.add(n)}}},_addTyphoonIconById:function(e,t,r){null==t&&(t=this.tf.realPoints[e][this.tf.realPoints[e].length-1],this.tyhoonPlayFlag=0);var n=360,o=this;window.clearInterval(this.tf.typhoonInterval[e]),this.tf.typhoonIconLayer.clear(),this.tf.typhoonInterval[e]=window.setInterval((function(){o.tf.typhoonIconLayer.clear();var e=new p.sfs.PictureMarkerSymbol({source:o.options.picSymbol.typhoonIcon,width:"50",height:"50",rotation:n+"",opacity:"1",offsetX:"23",offsetY:"23"}),r=new p.sfs.Element({geometry:t.geometry,symbol:e});o.tf.typhoonIconLayer.add(r),0==(n-=20)&&(n=360)}),r/5)},_getTyphoonPointStyle:function(e){return e=e||0,{fillColor:this._getTyphoonGrade(e).color,borderColor:"#80808C",weight:.5,opacity:153,fillOpacity:255,fill:!0,radius:5}},_getTyphoonGrade:function(e){var t=this.options.typhoon.typhoonSpeeds,r=this.options.typhoon.typhoonPointColor,n=this.options.typhoon.typhoonLevel,o=-1;if(null!=e&&null!=e||(e=0),(e=e.toFixed(1))<t[0][0]&&(o=0),e>t[t.length-1][1]&&(o=t.length-1),-1==o)for(var i=0;i<t.length;i++){var a=t[i],s=a[0],l=a[1];if((e==s||e>s)&&(e==l||e<l)){o=i;break}}return{color:r[o],level:n[o]}},_getRegineColor:function(e){var t=null;null==(t=this.options.forecast.org[e.trim()].rgb)&&(t=this.options.forecast.org.null),t=new p.sfs.Color.fromHex(t);var r=new p.sfs.SimpleLineSymbol({color:t,width:this.options.forecast.lineStyle.width,style:this.options.forecast.lineStyle.style});return r.color.a=this.options.forecast.lineStyle.opacity,r},_forecastsClear:function(){if(this.tf.Layer_forecast){for(var e in this.tf.Layer_forecast)this.tf.Layer_forecast[e].clear();this.tf.forecastPoints={},this.tf.forecastLines={},this.tf.forecastPolygons={}}},_forecastsClearByTfbh:function(e){this.tf.Layer_forecast&&(this.tf.Layer_forecast[e].clear(),this.tf.forecastPoints[e]={},this.tf.forecastLines[e]={},this.tf.forecastPolygons[e]={})},_drawForecasts:function(e){this.tf.forecastPoints[e._tfbh]||(this.tf.forecastPoints[e._tfbh]={}),this.tf.forecastLines[e._tfbh]||(this.tf.forecastLines[e._tfbh]={}),this.tf.forecastPolygons[e._tfbh]||(this.tf.forecastPolygons[e._tfbh]={}),this.tf.Layer_forecast[e._tfbh]?this._forecastsClearByTfbh(e._tfbh):this.tf.Layer_forecast[e._tfbh]=this._createLayer(this.options.layerOrder.typhoonForecast,this.map);var t,r,n=this.tf.paths[e._tfbh];n&&(t="-"==n.name||""==n.name?n.ename:n.name,r=n.ename);for(var o=0;o<e._data.properties.forecast.length;o++){var i=e._data.properties.forecast[o],a=new p.sfs.Path({spatialReference:this.options.spatialReference});a.addPoint(new p.sfs.Point({x:parseFloat(e.geometry.x),y:parseFloat(e.geometry.y),spatialReference:this.options.spatialReference}));for(var s=0;s<i.features.length;s++){var l=i.features[s],c=new p.sfs.Point({x:l.geometry.coordinates[0],y:l.geometry.coordinates[1],spatialReference:this.options.spatialReference}),u=this._getTyphoonPointStyle(l.properties.speed),f=new p.sfs.SimpleMarkerSymbol({fillColor:new p.sfs.Color.fromHex(u.fillColor),borderColor:new p.sfs.Color.fromHex(u.borderColor),size:u.radius-1}),h=new p.sfs.Element({geometry:c,symbol:f});l.region_ab=i.region_ab,l.region=i.region,l.tfName=t,l.tfNameEn=r,l.tfbh=e._tfbh,h.data_user=l,h._forecast=1,null==this.tf.forecastPoints[e._tfbh][l.region]&&(this.tf.forecastPoints[e._tfbh][l.region]=[]),this.tf.forecastPoints[e._tfbh][l.region].push(h),this.tf.Layer_forecast[e._tfbh].add(h),this.tf.Layer_forecast[e._tfbh].showElement(h,this.options.forecast.org[l.region].display),a.addPoint(c)}var d=new p.sfs.Polyline({spatialReference:this.options.spatialReference});d.addGeometry(a);var y=this._getRegineColor(i.region),m=new p.sfs.Element({geometry:d,symbol:y});this.tf.Layer_forecast[e._tfbh].add(m),this.tf.Layer_forecast[e._tfbh].showElement(m,this.options.forecast.org[l.region].display),this.tf.forecastLines[e._tfbh][i.region]=m}},_clearCircle:function(){if(this.tf.Layer_Circle){for(var e in this.tf.Layer_Circle)this.tf.Layer_Circle[e].clear();this.tf.selectPoint.clear()}},_clearCircleByTfbh:function(e){this.tf.Layer_Circle[e]&&(this.tf.Layer_Circle[e].clear(),this.tf.selectPoint.clear())},_showRoutePointPopup:function(e){var t;null!=(t=e)._data&&null!=t._data.properties&&(this._drawCircle(t),this._drawForecasts(t),this.options.forecast.clickShowPolygon.flag&&this._getForecastCircleTan(t))},_getTyphoonCircleInfo:function(e){var t;if(null!=(t=e)._data&&null!=t._data.properties){var r=this._getCircle(t);return r=this._typhoonCircle2Ring(r,"ne"),r=this._typhoonCircle2Ring(r,"nw"),r=this._typhoonCircle2Ring(r,"se"),(r=this._typhoonCircle2Ring(r,"sw")).grade_7&&(r=this._getUnionedGeom(r,"grade_7")),r.grade_10&&(r=this._getUnionedGeom(r,"grade_10")),r.grade_12&&(r=this._getUnionedGeom(r,"grade_12")),r}},_getUnionedGeom:function(e,t){var r=new jsts.io.GeoJSONReader,n=r.read(e[t].ne.geom),o=r.read(e[t].nw.geom),i=r.read(e[t].se.geom),a=r.read(e[t].sw.geom),s=n.union(o).union(i).union(a),l=new jsts.io.GeoJSONWriter;return e[t].geom=l.write(s),e},_typhoonCircle2Ring:function(e,t){var r,n,o,i=new jsts.io.GeoJSONWriter;return e.grade_12&&e.grade_12[t]&&e.grade_12[t].geom?(r=e.grade_12[t].geom,n=e.grade_10[t].geom.difference(e.grade_12[t].geom),o=e.grade_7[t].geom.difference(e.grade_10[t].geom)):e.grade_10&&e.grade_10[t]&&e.grade_10[t].geom?(n=e.grade_10[t].geom,o=e.grade_7[t].geom.difference(e.grade_10[t].geom)):e.grade_7&&e.grade_7[t]&&e.grade_7[t].geom&&(o=e.grade_7[t].geom),e.grade_7&&(e.grade_7[t].geom=o?i.write(o):null),e.grade_10&&(e.grade_10[t].geom=n?i.write(n):null),e.grade_12&&(e.grade_12[t].geom=r?i.write(r):null),e},_showTyphoonCircle:function(e){var t;null!=(t=e)._data&&null!=t._data.properties&&this._drawCircle(t)},_showTyphoonForecast:function(e){var t;null!=(t=e)._data&&null!=t._data.properties&&this._drawForecasts(t)},_showPopupForecast:function(e,t){if(e.data_user){this.options.toolTipWare.clear();var r=this._getForecastPopupContent(e,t),n=new p.widget.Tooltip({anchor:e.geometry,content:r,offset:[0,-10]});this.options.toolTipWare.add(n)}},_getForecastPopupContent:function(e,t){var r="font-size:12px;color:#000 ;background: #fff; border-radius:4px;padding-left:20px;";null!=this.options.popupForecast.divStyle&&(r=this.options.popupForecast.divStyle);var n=this._parseForecastData(e),o='<div id="'+t+'" style="'+r+'"><ul >';return o=o+this._getLiHtml(n.forecastOrg)+this._getLiHtml(n.arrivalTime)+this._getLiHtml(n.power)+this._getLiHtml(n.speed)+this._getLiHtml(n.centralPressure)+"</ul ></div>"},_getCircle:function(e){var t={},r=e._data,n=r.properties.radius7_quad,o=r.properties.radius10_quad,i=r.properties.radius12_quad,a=new p.sfs.Point({x:r.geometry.coordinates[0],y:r.geometry.coordinates[1],spatialReference:this.options.dataSpatialReference}),s=[(a=this._transformMap(a)).x,a.y];if(null==n&&null==o&&null==i){var l=r.properties.radius7,c=r.properties.radius10,u=r.properties.radius12;if(null!=l){var f={center:s,radius:0,direction:"ne",radiusQuad:{ne:l,se:l,sw:l,nw:l}};t.grade_7=this._getRing(f)}if(null!=c){f={center:s,radius:c,direction:"ne",radiusQuad:{ne:c,se:c,sw:c,nw:c}};t.grade_10=this._getRing(f)}if(null!=u){f={center:s,radius:u,direction:"ne",radiusQuad:{ne:u,se:u,sw:u,nw:u}};t.grade_12=this._getRing(f)}}else{if(n.ne>0){f={center:s,radius:0,direction:"ne",radiusQuad:r.properties.radius7_quad};t.grade_7=this._getRing(f)}if(o.ne>0){f={center:s,radius:c,direction:"ne",radiusQuad:r.properties.radius10_quad};t.grade_10=this._getRing(f)}if(i.ne>0){f={center:s,radius:u,direction:"ne",radiusQuad:r.properties.radius12_quad};t.grade_12=this._getRing(f)}}return t},_getRing:function(e){var t={};return e.direction="ne",e.radius=e.radiusQuad.ne,t[e.direction]={},t[e.direction].geom=h.toJstsGeometry(this._getRingArcGeom(e)),e.direction="nw",e.radius=e.radiusQuad.nw,t[e.direction]={},t[e.direction].geom=h.toJstsGeometry(this._getRingArcGeom(e)),e.direction="sw",e.radius=e.radiusQuad.sw,t[e.direction]={},t[e.direction].geom=h.toJstsGeometry(this._getRingArcGeom(e)),e.direction="se",e.radius=e.radiusQuad.se,t[e.direction]={},t[e.direction].geom=h.toJstsGeometry(this._getRingArcGeom(e)),t},_drawCircle:function(e){var t=e._data;this.tf.Layer_Circle[e._tfbh]?this._clearCircleByTfbh(e._tfbh):this.tf.Layer_Circle[e._tfbh]=this._createLayer(this.options.layerOrder.typhoonRing,this.map);var r=t.properties.radius7_quad,n=t.properties.radius10_quad,o=t.properties.radius12_quad,i=new p.sfs.Point({x:t.geometry.coordinates[0],y:t.geometry.coordinates[1],spatialReference:this.options.dataSpatialReference}),a=[(i=this._transformMap(i)).x,i.y],s=this.options.typhoon.radius7_style,l=this.options.typhoon.radius10_style,c=this.options.typhoon.radius12_style;if(null==r&&null==n&&null==o){var u=t.properties.radius7,f=t.properties.radius10,h=t.properties.radius12;if(null!=u){var d={ne:u,se:u,sw:u,nw:u},y={layer:this.tf.Layer_Circle[e._tfbh],center:a,radius:0,style:s,direction:"ne",radiusQuad:d};this._drawRing(y)}if(null!=f){var m={ne:f,se:f,sw:f,nw:f};y={layer:this.tf.Layer_Circle[e._tfbh],center:a,radius:f,style:l,direction:"ne",radiusQuad:m};this._drawRing(y)}if(null!=h){var g={ne:h,se:h,sw:h,nw:h};y={layer:this.tf.Layer_Circle[e._tfbh],center:a,radius:h,style:c,direction:"ne",radiusQuad:g};this._drawRing(y)}}else{if(r.ne>0){y={layer:this.tf.Layer_Circle[e._tfbh],center:a,radius:0,style:s,direction:"ne",radiusQuad:t.properties.radius7_quad};this._drawRing(y)}if(n.ne>0){y={layer:this.tf.Layer_Circle[e._tfbh],center:a,radius:f,style:l,direction:"ne",radiusQuad:t.properties.radius10_quad};this._drawRing(y)}if(o.ne>0){y={layer:this.tf.Layer_Circle[e._tfbh],center:a,radius:h,style:c,direction:"ne",radiusQuad:t.properties.radius12_quad};this._drawRing(y)}}},_drawRing:function(e){e.direction="ne",e.radius=e.radiusQuad.ne,this._drawRingArc(e),e.direction="nw",e.radius=e.radiusQuad.nw,this._drawRingArc(e),e.direction="sw",e.radius=e.radiusQuad.sw,this._drawRingArc(e),e.direction="se",e.radius=e.radiusQuad.se,this._drawRingArc(e)},_drawRingArc:function(e){var t=new p.sfs.SimpleFillSymbol({borderThickness:.01,fillColor:new p.sfs.Color.fromHex(e.style.fillColor),borderColor:new p.sfs.Color.fromHex(e.style.color)});t.fillColor.a=e.style.fillOpacity,t.borderColor.a=e.style.opacity;var r=this._getRingArcGeom(e),n=new p.sfs.Element({geometry:r,symbol:t});e.layer.add(n)},_getRingArcGeom:function(e){var t=this._arcPointsConstructor[e.direction](e.center,e.radius,this.options.projection),r=t.startP,n=t.endP,o=new p.sfs.Plot,i=[],a=new p.sfs.Point({x:e.center[0],y:e.center[1],spatialReference:this.options.spatialReference}),s=new p.sfs.Point({x:r[0],y:r[1],spatialReference:this.options.spatialReference}),l=new p.sfs.Point({x:n[0],y:n[1],spatialReference:this.options.spatialReference});return i.push(a),i.push(s),i.push(l),o.controlPoints=i,(new p.plot.SectorAlgorithm).createGeometries(o,null)[0]},_arcPointsConstructor:{ne:function(e,t,r){var n=new Array(2),o=new Array(2);return n[0]=0==r?e[0]+1e3*t:e[0]+t/111,n[1]=e[1],o[0]=e[0],o[1]=0==r?e[1]+1e3*t:e[1]+t/111,{startP:n,endP:o}},nw:function(e,t,r){var n=new Array(2),o=new Array(2);return n[0]=e[0],n[1]=0==r?e[1]+1e3*t:e[1]+t/111,o[0]=0==r?e[0]-1e3*t:e[0]-t/111,o[1]=e[1],{startP:n,endP:o}},sw:function(e,t,r){var n=new Array(2),o=new Array(2);return n[0]=0==r?e[0]-1e3*t:e[0]-t/111,n[1]=e[1],o[0]=e[0],o[1]=0==r?e[1]-1e3*t:e[1]-t/111,{startP:n,endP:o}},se:function(e,t,r){var n=new Array(2),o=new Array(2);return n[0]=e[0],n[1]=0==r?e[1]-1e3*t:e[1]-t/111,o[0]=0==r?e[0]+1e3*t:e[0]+t/111,o[1]=e[1],{startP:n,endP:o}}},removeTooltipById:function(e){var t=this.options.toolTipWare;if(t.tooltips)for(var r=t.tooltips.length,n=0;n<r;n++)t.tooltips[n]&&t.tooltips[n].id===e&&this.options.toolTipWare.remove(e)},_showLandPopup:function(e,t,r){var n=this;if(null!=e._land_data){this.options.toolTipWare.clear();var o=this._getLandPopupContent(e,r),i=this.options.popup.offset,a=new p.widget.Tooltip({id:"close_"+r,anchor:e.geometry,content:o,layerId:t.getLayerId(),offset:i});a.tag={type:"land"},this.options.toolTipWare.add(a),$("#close_"+r).click((function(){n.removeTooltipById("close_"+r)}))}},_getLandPopupContent:function(e,t){var r="font-size:12px;color:#000 ;background: #F0F8FF; margin-top: 8px;margin-left: 10px; margin-right: 0px;";null!=this.options.popupLand.divStyle&&(r=this.options.popupLand.divStyle);var n="right: 10px;position: absolute;bottom: 15px;";null!=this.options.popupLand.spanStyle&&(n=this.options.popupLand.spanStyle);var o=this._parseLandData(e),i="close_"+t,a='<div id="'+t+'" style="'+r+'"><ul >',s=this._getLiHtml(o.landaddress),l=this._getLiHtml(o.landtime);return a=a+this._getLiHtml(o.info)+s+l+this._getLiHtml(o.strong)+this._getLiHtml(o.lng)+this._getLiHtml(o.lat)+'</ul ><span id="'+i+'" style="'+n+'">X</span></div>'},_parseLandData:function(e){if(null!=e._land_data){var t=e._land_data;return{typhoonBh:{label:this.options.popup.typhoonBh.label,data:e._tfbh},typhoonNameEn:{label:this.options.popup.typhoonNameEn.label,data:t.typhoonNameEn},typhoonName:{label:this.options.popup.typhoonName.label,data:t.typhoonName},landaddress:{label:this.options.popupLand.landaddress.label,data:t.landaddress},landtime:{label:this.options.popupLand.landtime.label,data:t.landtime},info:{label:this.options.popupLand.info.label,data:t.info},lat:{label:this.options.popupLand.lat.label,data:t.lat},lng:{label:this.options.popupLand.lng.label,data:t.lng},strong:{label:this.options.popupLand.strong.label,data:t.strong}}}},_showPopup:function(e,t,r){if(null!=e._data){this.options.toolTipWare.clear();var n=this._getTrackPopupContent(e,r),o=this.options.popup.offset,i=new p.widget.Tooltip({anchor:e.geometry,content:n,layerId:t.getLayerId(),offset:o});this.options.toolTipWare.add(i)}},_getTrackPopupContent:function(e,t){var r="font-size:12px;color:#000 ;background: #fff; border-radius:4px;padding-left:20px;";null!=this.options.popup.divStyle&&(r=this.options.popup.divStyle);var n=this._parseTrackData(e),o='<div id="'+t+'" style="'+r+'"><ul >';return o+=this._getLiHtml(n.typhoonBh),o+=this._getLiHtml(n.typhoonName),o+=this._getLiHtml(n.passTime),o+=this._getLiHtml(n.centerPressure),o+="</ul ></div>"},_getLiHtml:function(e){var t=e.unit?e.unit:"",r="height:20px;";return null!=this.options.popup.liStyle&&(r=this.options.popup.liStyle),'<li style="'+r+'">'+e.label+e.data+t+"</li>"},_updateEventsArray:function(e,t,r){this.trackClickEvent=[],this.trackMousemoveEvent=[],this.forecastClickEvent=[],this.forecastMousemoveEvent=[],this.landClickEvent=[],this.landMousemoveEvent=[];for(var n=0;n<e.length;n++){var o=e[n];0!=o.enable&&"click"==o.event?this.trackClickEvent.push(o.name):0!=o.enable&&"mousemove"==o.event&&this.trackMousemoveEvent.push(o.name)}for(var i=0;i<t.length;i++){var a=t[i];0!=a.enable&&"click"==a.event?this.forecastClickEvent.push(a.name):0!=a.enable&&"mousemove"==a.event&&this.forecastMousemoveEvent.push(a.name)}for(var s=0;s<r.length;s++){var l=r[s];0!=l.enable&&"click"==l.event?this.landClickEvent.push(l.name):0!=l.enable&&"mousemove"==l.event&&this.landMousemoveEvent.push(l.name)}},_addListeners:function(){var e=this,t=e.options.interfaceMsg.trackPoint,r=e.options.interfaceMsg.forecastPoint,n=e.options.interfaceMsg.landPoint;this._updateEventsArray(t,r,n),this._getMapClickListener=function(t){var r=t.screenX,n=t.screenY,i=e.tf.Layer_point.hitTest(r,n);if(i){var a=i.element;if(null==a._tfbh)return;var s=u.newUUID32();if(e.trackClickEvent.length>0&&a._data){for(var l=0;l<e.trackClickEvent.length;l++){1==o.options.popup.display&&o._showPopup(a,o.tf.Layer_point,s);var c=e.trackClickEvent[l];e.fire(c,{id:s,data:o._parseTrackData(a)})}e._showRoutePointPopup(a)}if(e.landClickEvent.length>0&&a._land_data)for(var f=0;f<e.landClickEvent.length;f++){1==o.options.popupLand.display&&o._showLandPopup(a,o.tf.Layer_point,s);var h=e.landClickEvent[f];e.fire(h,{id:s,data:o._parseLandData(a)})}}var p=null,d=[];for(var y in e.tf.Layer_forecast){var m=e.tf.Layer_forecast[y].hitTest(r,n);m&&d.push(m)}if(d.length>0&&(p=d[0]),p){var g=p.element;if(!g||null==g._forecast)return;s=u.newUUID32();if(e.forecastClickEvent.length>0&&g.data_user)for(var v=0;v<e.forecastClickEvent.length;v++){1==e.options.popupForecast.display&&e._showPopupForecast(g,s);var b=e.forecastClickEvent[v];e.fire(b,{id:s,data:e._parseForecastData(g)})}}},this.map.listen("click",this._getMapClickListener,this);var o=this;this._getMapMouseMoveListener=function(t){var r=t.screenX,n=t.screenY,i=!1,a=o.options.toolTipWare;if(a.tooltips)for(var s=a.tooltips.length,l=0;l<s;l++)a.tooltips[l]&&a.tooltips[l].tag&&"land"===a.tooltips[l].tag.type&&(i=!0);i||o.options.toolTipWare.clear(),o.tf.selectPoint.clear();var c=o.tf.Layer_point.hitTest(r,n);if(c){var f=u.newUUID32(),h=c.element;if(o._createFocusPoint(h),o.trackMousemoveEvent.length>0&&h._data)for(var p=0;p<o.trackMousemoveEvent.length;p++){1==o.options.popup.display&&o._showPopup(h,o.tf.Layer_point,f);var d=o.trackMousemoveEvent[p];o.fire(d,{id:f,data:o._parseTrackData(h)})}if(o.landMousemoveEvent.length>0&&h._land_data)for(var y=0;y<o.landMousemoveEvent.length;y++){1==o.options.popupLand.display&&o._showLandPopup(h,o.tf.Layer_point,f);var m=o.landMousemoveEvent[y];o.fire(m,{id:f,data:o._parseLandData(h)})}}var g=null,v=[];for(var b in e.tf.Layer_forecast){var _=e.tf.Layer_forecast[b].hitTest(r,n);_&&v.push(_)}if(v.length>0&&(g=v[0]),g){var w=g.element;if(!w||null==w._forecast)return;f=u.newUUID32();if(o.forecastMousemoveEvent.length>0&&w.data_user)for(var S=0;S<o.forecastMousemoveEvent.length;S++){1==o.options.popupForecast.display&&o._showPopupForecast(w,f);var L=o.forecastMousemoveEvent[S];o.fire(L,{id:f,data:o._parseForecastData(w)})}}},this.map.listen("mousemove",this._getMapMouseMoveListener,this)},_parseTrackData:function(e){if(null!=e._data){var t=this._transformObj(e.geometry,this.options.popup.pointEPSG);if(null!=this.options.popup.pointPrecision){var r=parseFloat(t.x),n=parseFloat(t.y);r=r.toFixed(this.options.popup.pointPrecision),n=n.toFixed(this.options.popup.pointPrecision),t.x=r,t.y=n}var o,i=e._data.properties.move_speed,a=e._data.properties.move_dir,s=e._data.properties.radius7_quad,l=e._data.properties.radius10_quad,c=e._data.properties.radius12_quad,u=e._tfbh,f=this.tf.paths[u].ename;o="-"==this.tf.paths[u].name||""==this.tf.paths[u].name?this.tf.paths[u].ename:this.tf.paths[u].name;var h=e._data.properties.time;h=h.replace("T"," ");var p=e._data.properties.pressure,d=e._data.properties.power,y=e._data.properties.speed;return{typhoonBh:{label:this.options.popup.typhoonBh.label,data:e._tfbh},typhoonNameEn:{label:this.options.popup.typhoonNameEn.label,data:f},typhoonName:{label:this.options.popup.typhoonName.label,data:o},passTime:{label:this.options.popup.passTime.label,data:h},centerPoint:{label:this.options.popup.centerPoint.label,unit:this.options.popup.centerPoint.unit,data:[t.x,t.y]},centerPressure:{label:this.options.popup.centerPressure.label,unit:this.options.popup.centerPressure.unit,data:p},power:{label:this.options.popup.power.label,unit:this.options.popup.power.unit,data:d},speed:{label:this.options.popup.speed.label,unit:this.options.popup.speed.unit,data:y},moveSpeed:{label:this.options.popup.moveSpeed.label,unit:this.options.popup.moveSpeed.unit,data:i},moveDir:{label:this.options.popup.moveDir.label,unit:this.options.popup.moveDir.unit,data:a},radius7:{label:this.options.popup.sevenRingRadius.label,unit:this.options.popup.sevenRingRadius.unit,data:s},radius10:{label:this.options.popup.tenRingRadius.label,unit:this.options.popup.tenRingRadius.unit,data:l},radius12:{label:this.options.popup.twelveRingRadius.label,unit:this.options.popup.twelveRingRadius.unit,data:c},islast:{label:"是否为最新轨迹点位",data:e.islast}}}},_parseForecastData:function(e){if(null!=e.data_user){var t=e.data_user,r=new p.sfs.Point({x:t.geometry.coordinates[0],y:t.geometry.coordinates[1],spatialReference:this.options.dataSpatialReference}),n=this._transformObj(r,this.options.popupForecast.pointEPSG),o=t.properties.time.replace("T"," "),i=t.region,a=t.properties.power,s=t.properties.speed,l=t.properties.pressure,c=t.properties.move_speed,u=t.properties.move_dir,f=t.tfbh,h=t.tfNameEn,d=t.tfName;return{typhoonBh:{label:this.options.popup.typhoonBh.label,data:f},typhoonNameEn:{label:this.options.popup.typhoonNameEn.label,data:h},typhoonName:{label:this.options.popup.typhoonName.label,data:d},forecastOrg:{label:this.options.popupForecast.org.label,data:i},arrivalTime:{label:this.options.popupForecast.arrivalTime.label,data:o},centerPoint:{label:this.options.popupForecast.centerPoint.label,unit:this.options.popupForecast.centerPoint.unit,data:[n.x,n.y]},power:{label:this.options.popupForecast.power.label,unit:this.options.popupForecast.power.unit,data:a},speed:{label:this.options.popupForecast.speed.label,unit:this.options.popupForecast.speed.unit,data:s},centralPressure:{label:this.options.popupForecast.centralPressure.label,unit:this.options.popupForecast.centralPressure.unit,data:l},moveSpeed:{label:this.options.popupForecast.moveSpeed.label,unit:this.options.popupForecast.moveSpeed.unit,data:c},moveDir:{label:this.options.popupForecast.moveDir.label,unit:this.options.popupForecast.moveDir.unit,data:u}}}},_getString:function(e,t){return null!=e&&(context=t.label+e+t.unit),0==t.display&&(context=""),context},_addListeners_tsmap:function(){var e=this;this._getMapClickListener_ts=function(t,r,n,o,i,a,s){var l=e.tf.Layer_point.hitTest(n,o);if(l){var c=l.element;if(null==c._tfbh)return;e._showRoutePointPopup(c)}},this.map.listen("click",this._getMapClickListener_ts,this);var t=this;this._getMapMouseMoveListener_ts=function(r,n,o,i,a,s,l){t.options.toolTipWare.clear(),t.tf.selectPoint.clear();var c=t.tf.Layer_point.hitTest(o,i);if(c){var u=c.element;t._createFocusPoint(u),1==t.options.popup.display&&t._showPopup(u,t.tf.Layer_point)}var f=e.tf.Layer_forecast.hitTest(o,i);if(f){var h=f.element;if(!h||null==h._forecast)return;1==t.options.popupForecast.display&&t._showPopupForecast(h,uuid)}},this.map.listen("mousemove",this._getMapMouseMoveListener_ts,this)},getTyphoonCircleGeom:(s=o(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,s,l,c,u,f,h,p,d,y,m,g,v,b,_,w,S,L=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,o={grade7:{},grade10:{},grade12:{}},r&&r.length>0&&(o={},r.indexOf(7)>-1&&(o.grade7=!0),r.indexOf(10)>-1&&(o.grade10=!0),r.indexOf(12)>-1&&(o.grade12=!0)),e.next=5,this.service.getTyphoonInfo({typhoonid:t});case 5:return i=e.sent,a=i[0],s=a.features,l=[],c=[],u=[],s.forEach((function(e){if(e&&e.properties&&e.geometry){var t={_data:e},r=n._getCircle(t);r=n._typhoonCircle2Ring(r,"ne"),r=n._typhoonCircle2Ring(r,"nw"),r=n._typhoonCircle2Ring(r,"se"),r=n._typhoonCircle2Ring(r,"sw"),o.grade7&&r.grade_7&&(r=L._getUnionedGeom(r,"grade_7")).grade_7.geom&&l.push(r.grade_7.geom),o.grade10&&r.grade_10&&(r=L._getUnionedGeom(r,"grade_10")).grade_10.geom&&c.push(r.grade_10.geom),o.grade12&&r.grade_12&&(r=L._getUnionedGeom(r,"grade_12")).grade_12.geom&&u.push(r.grade_12.geom)}})),o.grade7&&(f=this._getUnionedGeometry(l),h=this._simplifyGeom(f),p=this._getG2GeometryFromGeojson(h),d=this._removeHolesGeom(p),o.grade7=d),o.grade10&&(y=this._getUnionedGeometry(c),m=this._simplifyGeom(y),g=this._getG2GeometryFromGeojson(m),v=this._removeHolesGeom(g),o.grade10=v),o.grade12&&(b=this._getUnionedGeometry(u),_=this._simplifyGeom(b),w=this._getG2GeometryFromGeojson(_),S=this._removeHolesGeom(w),o.grade12=S),e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)}),_simplifyGeom:function(e){var t=this._smoothGeom(e);return turf.simplify(t,{tolerance:.01,highQuality:!0})},_smoothGeom:function(e){var t=null;"Polygon"===e.type?t=turf.polygon(e.coordinates):"MultiPolygon"===e.type&&(t=turf.multiPolygon(e.coordinates));var r=turf.polygonToLine(t),n=null;if(r.type&&"FeatureCollection"===r.type&&r.features){var o=[];r.features.forEach((function(e){if("LineString"===e.geometry.type){var t=turf.lineString(e.geometry.coordinates),r=turf.bezierSpline(t);o.push(r.geometry.coordinates)}else if("MultiLineString"===e.geometry.type)for(var n=0;n<e.geometry.coordinates.length;n++){t=turf.lineString(e.geometry.coordinates[n]),r=turf.bezierSpline(t);o.push(r.geometry.coordinates)}}));var i=turf.multiLineString(o);n=turf.lineToPolygon(i)}else if("MultiLineString"===r.geometry.type){o=[];for(var a=0;a<r.geometry.coordinates.length;a++){var s=turf.lineString(r.geometry.coordinates[a]),l=turf.bezierSpline(s);o.push(l.geometry.coordinates)}i=turf.multiLineString(o);n=turf.lineToPolygon(i)}else if("LineString"===r.geometry.type){s=turf.lineString(r.geometry.coordinates),l=turf.bezierSpline(s);n=turf.lineToPolygon(l)}return n.geometry},_removeHolesGeom:function(e){var t=new p.sfs.CoordinateTransform,r=new p.sfs.MeasureService({projectService:t}),n=e.getGeometryType();if(14===n){if(e.holes.length>0)for(var o=e.holes.length-1;o>=0;o--){var i=e.holes[o].asGeoJson().coordinates[0],a=turf.lineString(i),s=turf.lineToPolygon(a),l=p.sfs.GeometryFactory.createGeometryFromGeoJson(s.geometry,this.options.dataSpatialReference),c=r.area(l)/1e6;c&&c<5e3&&e.holes.splice(o,1)}}else if(16===n)for(var u=0;u<e.geometries.length;u++){var f=this._removeHolesGeom(e.geometries[u]);e.geometries[u]=f}return e},_getG2GeometryFromGeojson:function(e){return p.sfs.GeometryFactory.createGeometryFromGeoJson(e,this.options.dataSpatialReference)},_getUnionedGeometry:function(e){for(var t=new jsts.io.GeoJSONReader,r=null,n=0;n<e.length;n++)r=0===n?t.read(e[n]):r.union(t.read(e[n]));var o=new jsts.io.GeoJSONWriter,i=null;return r&&(i=o.write(r)),i},_getTyphoonCircleTan:function(e,t,r){var n=this;return new Promise((function(o,i){var a=n,s={status:-1,data:""};n.service.getTyphoonInfo({typhoonid:e}).then((function(e){var n=e;if(n){if(s.status=1,s.data=n[0],null==n[0])return;a._calculateTyphoonCircleTan(n[0],t,r)}else s.status=-1,s.data="no data ! Please check data.....";o()}))}))},_calculateTyphoonCircleTan:function(e,t,r){new Date(e.begin_time.replace("T"," ")),e.features[i]},_calRadius:function(e,t){var r=Math.PI/180,n=e.x-2/r*Math.asin(Math.sin(t/2/6378.137/1e3)/Math.cos(r*e.y));return Math.abs(n-e.x)},_getForecastCircleTan:(a=o(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,s,l,c,u,h,d,y,m,g,v,b,_,w,S,L,x,P=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,r=r||"中国",o=this.tf.forecastLines[t._tfbh][r],i=o.geometry.asGeoJson().coordinates[0],a=turf.lineString(i),new p.sfs.SimpleFillSymbol({borderThickness:0,fillColor:new p.sfs.Color({r:171,g:130,b:255,a:50}),borderColor:new p.sfs.Color({r:255,g:100,b:100,a:190})}),new p.sfs.SimpleMarkerSymbol({fillColor:new p.sfs.Color({r:171,g:130,b:255,a:250}),borderColor:new p.sfs.Color({r:255,g:100,b:100,a:250}),size:5}),s=f.object2Symbol(this.options.forecast.polygonStyle),e.next=10,this.getExtentById(t._tfbh);case 10:(l=e.sent)[0]=l[0]-5,l[1]=l[1]-5,l[2]=l[2]+5,l[3]=l[3]+5,c=[parseFloat(t.geometry.x),parseFloat(t.geometry.y)],u=t._data.properties,h=new Date(u.time.replace("T"," ")),d=null,u.forecast.forEach((function(e){"中国"===e.region&&(d=e)})),y=0,m=[],g=[],d.features.forEach((function(e,t){var r=(new Date(e.properties.time.replace("T"," "))-h)/36e5,o=n._calRadiusByTimeDiff(r);if(o>0){var i=p.sfs.GeometryFactory.createGeometryFromGeoJson(e.geometry,P.options.dataSpatialReference);o=n._calRadius(i,1e3*o);var a=new p.sfs.Circle({radius:o,center:i,spatialReference:P.options.dataSpatialReference});turf.booleanPointInPolygon(c,a.asGeoJson())||(g.push(a),m.push(a.asGeoJson()),y++)}})),v=new Array(2*y+1),g.forEach((function(e,t){var r=e.asGeoJson().coordinates;e.asGeoJson();var o,i,s=turf.polygon(r),l=null;if(0===t){var u=c;v[0]=u,l=turf.point(u),(y=turf.polygonTangents(l,s)).features.forEach((function(e,t){var r=p.sfs.GeometryFactory.createGeometryFromGeoJson(e.geometry,n.options.dataSpatialReference);0==t?(o=[r.x,r.y],v[1]=o):(i=[r.x,r.y],v[v.length-1]=i)}))}else{l=v[t];var f,h=turf.booleanPointInPolygon(l,s);if(h)f={coordinates:l};else{var y=turf.polygonTangents(l,s),m={intersects:{},feature:{}},g={intersects:{},feature:{}},b=null;if(y.features.forEach((function(e,t){var r=turf.lineString([l,e.geometry.coordinates]),n=turf.lineIntersect(r,a);0===t?(m.intersects=n,m.feature=e):1===t&&(g.intersects=n,g.feature=e)})),m.intersects.features&&m.intersects.features.length<=0&&g.intersects.features&&g.intersects.features.length>0)b=m;else if(m.intersects.features&&m.intersects.features.length>0&&g.intersects.features&&g.intersects.features.length<=0)b=g;else if(m.intersects.features&&m.intersects.features.length<=0&&g.intersects.features&&g.intersects.features.length<=0){var _=m.feature.geometry.coordinates,w=g.feature.geometry.coordinates;b=P._calAngleByThreePoints({x:l[0],y:l[1]},{x:v[t-1][0],y:v[t-1][1]},{x:_[0],y:_[1]})>=P._calAngleByThreePoints({x:l[0],y:l[1]},{x:v[t-1][0],y:v[t-1][1]},{x:w[0],y:w[1]})?m:g}else b=m;f=b.feature.geometry}v[t+1]=f.coordinates;var S=v[v.length-t];if(h=turf.booleanPointInPolygon(S,s))f={coordinates:S};else{var L={intersects:{},feature:{}},x={intersects:{},feature:{}},E=null;if((y=turf.polygonTangents(S,s)).features.forEach((function(e,t){var r=turf.lineString([S,e.geometry.coordinates]),n=turf.lineIntersect(r,a);0===t?(L.intersects=n,L.feature=e):1===t&&(x.intersects=n,x.feature=e)})),L.intersects.features&&L.intersects.features.length<=0&&x.intersects.features&&x.intersects.features.length>0)E=L;else if(L.intersects.features&&L.intersects.features.length>0&&x.intersects.features&&x.intersects.features.length<=0)E=x;else if(L.intersects.features&&L.intersects.features.length<=0&&x.intersects.features&&x.intersects.features.length<=0){var T=L.feature.geometry.coordinates,C=x.feature.geometry.coordinates;E=P._calAngleByThreePoints({x:S[0],y:S[1]},{x:v[v.length-t+1][0],y:v[v.length-t+1][1]},{x:T[0],y:T[1]})>=P._calAngleByThreePoints({x:S[0],y:S[1]},{x:v[v.length-t+1][0],y:v[v.length-t+1][1]},{x:C[0],y:C[1]})?L:x}else E=L;f=E.feature.geometry}v[v.length-t-1]=f.coordinates,t===d.features.length-1&&e.asGeoJson()}})),b=turf.lineString(v),_=turf.lineToPolygon(b),w=[_.geometry].concat(m),S=this._getUnionGeometryByTurf(w),L=this._getG2GeometryFromGeojson(S),x=new p.sfs.Element({geometry:L,symbol:s}),this.tf.Layer_forecast[t._tfbh].add(x);case 34:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)}),_getUnionGeometryByTurf:function(e){for(var t=null,r=0;r<e.length;r++){var n=turf.polygon(e[r].coordinates);t=0===r?n:turf.union(t,n)}return t.geometry},_calAngleByThreePoints:function(e,t,r){var n=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)),i=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),a=(Math.pow(n,2)+Math.pow(o,2)-Math.pow(i,2))/(2*n*o);return Math.round(180*Math.acos(a)/Math.PI)},_calcTangent:function(e,t,r,n){var o=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),i=Math.acos((r-n)/o),a={x:t.x-e.x,y:t.y-e.y},s=Math.acos(a.x/Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2)));return t.y<=e.y?[{x:e.x+Math.cos(i+s)*r,y:e.y-Math.sin(i+s)*r},{x:e.x+Math.cos(i-s)*r,y:e.y+Math.sin(i-s)*r},{x:t.x+Math.cos(i+s)*n,y:t.y-Math.sin(i+s)*n},{x:t.x+Math.cos(i-s)*n,y:t.y+Math.sin(i-s)*n}]:(s=Math.PI-s,[{x:e.x+Math.cos(Math.PI-i-s)*r,y:e.y+Math.sin(Math.PI-i-s)*r},{x:e.x+Math.cos(Math.PI-(i-s))*r,y:e.y-Math.sin(Math.PI-(i-s))*r},{x:t.x+Math.cos(Math.PI-i-s)*n,y:t.y+Math.sin(Math.PI-i-s)*n},{x:t.x+Math.cos(Math.PI-(i-s))*n,y:t.y-Math.sin(Math.PI-(i-s))*n}])},_calRadiusByTimeDiff:function(e){var t=null;return e>0&&e<=12?t=100:e>12&&e<=24?t=150:e>24&&e<=36?t=165:e>36&&e<=48?t=180:e>48&&e<=60?t=195:e>60&&e<=72?t=210:e>72&&e<=84?t=225:e>84&&e<=96?t=240:e>96&&(t=270),t},_segmentsIntr:function(e,t,r,n){var o=t.y-e.y,i=e.x-t.x,a=n.y-r.y,s=r.x-n.x,l=o*s-i*a;if(0==l)return!1;var c=a*r.x+s*r.y,u=a*e.x+s*e.y-c;if(u*(a*t.x+s*t.y-c)>=0)return!1;var f=o*e.x+i*e.y;if((o*r.x+i*r.y-f)*(o*n.x+i*n.y-f)>=0)return!1;var h=u/l,p=h*i,d=-h*o;return{x:e.x+p,y:e.y+d}}});e.exports=d},function(e,t,r){var n=r(11),o=r(1),i=n.extend({options:{map:null,warningLineParm:null},initialize:function(e){if(n.prototype.initialize.call(this,e),1!=this.enable){this.dataSpatialReference=4326,this.dataSpatialReference=this._mergeOptions(this.dataSpatialReference,e.dataSpatialReference),this.map=e.map;this.warning_line_parm={id:"typhoon_alertline",name:"台风警戒线",zIndex:100,pic24_xy:[127,30],pic48_xy:[132,30],lineStyle48h:3,lineStyle24h:5,points_24h:[[126.993568,34.005024],[126.993568,21.971252],[118.995521,17.96586],[118.995521,10.97105],[113.018959,4.48627],[104.998939,-.035506]],points_48h:[[131.981361,33.959474],[131.981361,14.96886],[119.962318,-.035506],[104.998939,-.035506]],color_24h:"#FFFF00",color_48h:"#160DFF",pic_base24:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAByCAYAAABA87G+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACPElEQVRoge2aQW7EIAxFIaqUG4y67KrqEXr/4/QCo9kMXcxEIdQ23zaJwpS/adJkeBgMNpCYUgpHajqUNoCnBaY0pZQmyPveagXl9zHeo6diIQgWLrAY73EBUVagllWBiLQwEZhbJsG0zQxZaC3cBKRgngpEaS6VCub6r1YJFljCEDhiMdSkkjfmzxCvFZt0D/U5lw5gP0BN3GsCbKEBZPvN2p9mC6W0wwysRQELFEqipAK0UBLYMqUoRealWpDm/fMNi+6B4tpikXfCzjVymn8OtESMcwwLqtat5lVyWOSTt6bJkEpBA58rzBJVzuWlZXPunpeWTWXNY2DgHoKdZpF3eKj6sIVUfdhC1SSqNVTdhyH4mnpE/BcHPubO97Ref6XtM73zVDf3VIV5NvfWH1+y68/Nc8t4dVmYZwQoUFgffj/vLs+/y/0M7aFyEqe2R4E/TIVWCzVgcWqj9rnL/6sXr1LWphUCP3wuVZ09cdI06+tbCAVgrkCLc401/gCq1SRNPGx9aFlNmSykoPD7XUQLz44xkCZOqbz2yD0stBWBNoa257wfLivhY3Vps6jffRpOZdam6UfTyYz27D6X6DRU/sl9wYAKHvhcIsxV0A1spT68tCsglAjTTjKHEG6Bei7pPBGfm0c5qBtY100cm5zgFONvlJhDjFd1xK9uX1JWeCK/yUupykjvbd5BPzOjACikCqx9JLeMwxiv6o0hV5pYVgTR4RG/Og5rXto04kug3SO+pBHxB3AAXfoFW1EPwh6Vf8EAAAAASUVORK5CYII=",pic_base48:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAByCAYAAABA87G+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ9SURBVHja7FrbboMwDI1DmKj60h/c1+0HeZkqjYL3sGXK0oTYjkEFJU+lrXI4vsQ+BkBEs+eyZufVANWXS377+f7vEhHQGGMAEIo7Xj8EgIQ1Td1TePf9DDKGCXYpsBBgmjqcpg57Y0DswxTYZkGz5jfPzDNNMd4sSlO+ZPuwFJXqPvRAiIChHzV8mo3SkB0rDzXTAhEQAKHvZ/AmVM/DHCvK5q1aNMD9AefZ4jxbbCY9FuCyAC7L86Et9aeYYdct4IHVAD0za9PnqQTUSsGkoLYGTK0ecoE8y5aHLyRmEkm+KyAnKJoPjwWYaoaPkRZSOV2dFl5DlHQgR5CShwqpzThArxmlsRnH8YrjeN2uL41Ndbt9ggc+V7VIsdzFh5sHjVayF00aAmmDiqaJNaYWAdawbgV4X8BQA8Z6UKoPHaUXzX2OryntpKX0oqmNum6B0n9YgGusarpxK2ntYxFaLddic+VuKASmMnZUTZELDq7ucBKT5n6ngLut1RLLpNSqwDnMndZGKoD3+xuJ4eXypcOwtCH1htiAko1FgBxTtQJ8nFY/dSDspg/jR7ObMaw5jchDBS3TOsldS7Q9Wa6FUwwN+abyWL06aOINwutaljbnw5xGjJ/dH3tOQ8m93CN2NuCauWp86qhg8TEmOdZYiR9unDKp+lm6Fonni9LzVHzfHsbd2zkqfsgux1St4qfWMEyGmptswLC1958BEObZ4hJIR0nFd6UWPwT/0f4bThPXfKfaROXAYpOqBU3Kh8MwPZk0PLirgoYq03ZrMWoqfjEP/UzGWvx7qU694seDHz+3QQR8PKz4WGMPhn7fS3wyLwcU2qvzDbABxut7ABMu/tuAIt6cAAAAAElFTkSuQmCC"},this.warning_line_parm=this._mergeOptions(this.warning_line_parm,e.warningLineParm),this.warnLinelayer=new o.carto.ElementLayer({id:this.warning_line_parm.id,name:this.warning_line_parm.name,zIndex:this.warning_line_parm.zIndex,map:this.map}),this.warnLinelayer._typeLayer="typhoon",this.enable=!0}},load:function(){n.prototype.load.call(this),this.map.addLayer(this.warnLinelayer),this.warnLine()},destroy:function(){this.unload(),this.warning_line_parm=void 0,this.enable=!1,n.prototype.destroy.call(this)},getValidDataValue:function(e,t){return null!=t&&(e=t),e},warnLine:function(){this.warnLineObj=new Array;var e=this,t=[[126.993568,34.005024],[126.993568,21.971252],[118.995521,17.96586],[118.995521,10.97105],[113.018959,4.48627],[104.998939,-.035506]],r="#FFFF00",n=[[131.981361,33.959474],[131.981361,14.96886],[119.962318,-.035506],[104.998939,-.035506]],i="#160DFF",a=void 0,s=void 0;t=this.getValidDataValue(t,e.warning_line_parm.points_24h),r=this.getValidDataValue(r,e.warning_line_parm.color_24h),i=this.getValidDataValue(i,e.warning_line_parm.color_48h),n=this.getValidDataValue(n,e.warning_line_parm.points_48h),a=this.getValidDataValue(a,e.warning_line_parm.lineStyle24h),s=this.getValidDataValue(s,e.warning_line_parm.lineStyle48h),this.addLine(this.warnLinelayer,t,r,a),this.addLine(this.warnLinelayer,n,i,s);var l,c,u=function(t,r,n){var i=new o.sfs.PictureMarkerSymbol({source:n,width:"28",height:"144",rotation:"0",opacity:"1",offsetX:"13",offsetY:"31"});r=new o.sfs.Point({x:r[0],y:r[1],spatialReference:e.dataSpatialReference});r=e._transformMap(r);var a=new o.sfs.Element({geometry:r,symbol:i});t.add(a)};l=e.warning_line_parm.pic24_xy,c=e.warning_line_parm.pic48_xy,u(this.warnLinelayer,l,e.warning_line_parm.pic_base24),u(this.warnLinelayer,c,e.warning_line_parm.pic_base48)},addLine:function(e,t,r,n){var i=new o.sfs.Color.fromHex(r);i.a=153;var a=new o.sfs.SimpleLineSymbol({color:i});null!=n&&(a.style=n);for(var s=new o.sfs.Polyline({spatialReference:this.map.spatialReference}),l=new o.sfs.Path({spatialReference:this.map.spatialReference}),c=0;c<t.length;c++){var u=new o.sfs.Point({x:t[c][0],y:t[c][1],spatialReference:this.dataSpatialReference});l.addPoint(u)}s.addGeometry(l),s=this._transformMap(s);var f=new o.sfs.Element({geometry:s,symbol:a});e.add(f)},unload:function(){n.prototype.unload.call(this),0!=this.enable&&this._removeLayer(this.warning_line_parm.id)},_removeLayer:function(e){var t=this.map.findLayer(e);do{this.map.removeLayer(t),t=this.map.findLayer(e)}while(null!=t)},_mergeOptions:function(e){for(var t,r,n=1,o=arguments.length;n<o;n++)for(t in r=arguments[n])e[t]=r[t];return e},_transformMap:function(e){return this.dataSpatialReference==this.map.spatialReference?e:(new o.sfs.CoordinateTransform).transform(e,this.map.spatialReference)}});e.exports=i},function(e,t,r){var n=r(11),o=r(2),i=r(1),a=r(541),s=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e),e.typhoon=e.typhoon||{},e.typhoon.layer?this.typhoonLayer=e.layer:this.typhoonLayer=new i.carto.ElementLayer({id:e.typhoon.id||o.newUUID32(),name:e.typhoon.name,map:e.map,zIndex:e.typhoon.zIndex||100}),e.probability=e.probability||{},e.probability.layer?this.probabilityLayer=e.layer:this.probabilityLayer=new i.carto.ElementLayer({id:e.probability.id||o.newUUID32(),name:e.probability.name,map:e.map,zIndex:e.zIndex||100}),e.service&&this.setService(e.service)},load:function(){n.prototype.load.call(this),this.toolTipWareTyphoon=new i.widget.TooltipWare({map:this.map}),this.toolTipWareProbability=new i.widget.TooltipWare({map:this.map}),this.map.addLayer(this.typhoonLayer),this.map.addLayer(this.probabilityLayer)},unload:function(){this.map.removeLayer(this.typhoonLayer),this.map.removeLayer(this.probabilityLayer),this.toolTipWareProbability.clear(),this.toolTipWareProbability.clear(),this.typhoonTooltipHash=null,this.probabilityTooltipHash=null,n.prototype.unload.call(this)},destroy:function(){this.unload(),n.prototype.destroy.call(this)},showTyphoonRealtime:function(e){var t=this,r=this;return new Promise((function(n,o){e.data?r._showTyphoon(e).catch((function(e){o(e)})):e.param&&t.service.getForecastRealtime({tfid:e.param.tfid}).then((function(t){t.data&&t.data.typhoon?(e.data=t.data.typhoon,r._showTyphoon(e).catch((function(e){o(e)}))):o(new Error("无实时台风信息"))})).catch((function(e){o(e)}))}))},showTyphoon:function(e){var t=this,r=this;return new Promise((function(n,o){e.data?r._showTyphoon(e).catch((function(e){o(e)})):e.param&&t.service.getForecastByTime({tfid:e.param.tfid,time:e.param.time}).then((function(t){t.data&&t.data.typhoon?(e.data=t.data.typhoon,r._showTyphoon(e).catch((function(e){o(e)}))):o(new Error("无该时间点台风信息"))})).catch((function(e){o(e)}))}))},showProbabilityRealtime:function(e){var t=this,r=this;return new Promise((function(n,o){e.data?r._showProbability(e).catch((function(e){o(e)})):e.param&&t.service.getForecastRealtime({tfid:e.param.tfid}).then((function(t){t.data&&t.data.wsp?(e.data=t.data.wsp,r._showProbability(e).catch((function(e){o(e)}))):o(new Error("无该时间点实时概率信息"))})).catch((function(e){o(e)}))}))},showProbability:function(e){var t=this,r=this;return new Promise((function(n,o){e.data?r._showProbability(e).catch((function(e){o(e)})):e.param&&t.service.getForecastByTime({tfid:e.param.tfid,time:e.param.time}).then((function(t){t.data&&t.data.typhoon?(e.data=t.data.typhoon,r._showProbability(e).catch((function(e){o(e)}))):o(new Error("无该时间点概率信息"))})).catch((function(e){o(e)}))}))},removeTyphoon:function(e){for(var t=this.typhoonLayer.elements.length-1;t>=0;t--){var r=this.typhoonLayer.elements[t];r.id===e&&this.typhoonLayer.remove(r)}for(var n in this.typhoonTooltipHash)if(this.typhoonTooltipHash.hasOwnProperty(n))for(var o=this.typhoonTooltipHash[n],i=0;i<o.length;i++){var a=o[i];this.toolTipWareTyphoon.remove(a)}},removeProbability:function(e){for(var t=this.probabilityLayer.elements.length-1;t>=0;t--){var r=this.probabilityLayer.elements[t];r.id===e&&this.probabilityLayer.remove(r)}for(var n in this.probabilityTooltipHash)if(this.probabilityTooltipHash.hasOwnProperty(n))for(var o=this.probabilityTooltipHash[n],i=0;i<o.length;i++){var a=o[i];this.toolTipWareProbability.remove(a)}},clearTyphoon:function(){this.typhoonLayer.clear(),this.toolTipWareTyphoon.clear()},clearProbability:function(){this.probabilityLayer.clear(),this.toolTipWareProbability.clear()},clear:function(){this.clearTyphoon(),this.clearProbability()},service:null,setService:function(e){this.service=e},typhoonTooltipHash:{},probabilityTooltipHash:{},_showTyphoon:function(e){var t=this;return new Promise((function(r,n){e.id&&t.removeTyphoon(e.id);var o=t._getGeojson(e);!o.features||o.features.length<1?n(new Error("无空间信息")):t._drawTyphoon(o,e)}))},_showProbability:function(e){var t=this;return new Promise((function(r,n){e.id&&t.removeProbability(e.id);var o=t._getGeojson(e);!o.features||o.features.length<1?n(new Error("无空间信息")):t._drawProbability(o,e)}))},_getGeojson:function(e){var t=null;if(e.format&&"geojson"==e.format.toLowerCase())t=e.data,o.isString(t)&&(t=JSON.parse(t));else{var r=e.data;if(o.isString(r))r=(new DOMParser).parseFromString(r,"text/xml");t=G.utils.GeoJSONUtil.fromKml(r)}return t},_drawTyphoon:function(e,t){var r=this;t.id&&(this.typhoonTooltipHash[t.id]=[]);for(var n=0;n<e.features.length;n++){var o=e.features[n];if("Point"==o.geometry.type){this._getForcastRangeTooltips(o).forEach((function(e){r.toolTipWareTyphoon.add(e),t.id&&r.typhoonTooltipHash[t.id].push(e.id)}))}else{var i=this._parseElement(o,t);this.typhoonLayer.add(i)}}},_drawProbability:function(e,t){var r=t.label||{};t.id&&(this.probabilityTooltipHash[t.id]=[]);for(var n=0;n<e.features.length;n++){var o=e.features[n],i=this._parseElement(o,t);if(this.probabilityLayer.add(i),0!=r.display){var a=this._parseTooltipFromPolygon(o,t);this.toolTipWareProbability.add(a),t.id&&this.probabilityTooltipHash[t.id].push(a.id)}}},_parseElement:function(e,t){var r=this._getSymbol;t.style&&(r=t.style);var n=new(G.utils.SymbolBuilder.extend({build:function(e){return r(e)}})),o=new G.utils.GeometryBuilder({geometryField:["geometry"]}),i=new G.utils.FeatureBuilder({geometryBuilder:o,symbolBuilder:n}).buildElement(e);return i.id=t.id,i},_getSymbol:function(e){var t=1;e.properties["fill-opacity"]?t=e.properties["fill-opacity"]:e.properties["stroke-opacity"]&&(t=e.properties["stroke-opacity"]);var r=255*t,n={r:100,g:100,b:100,a:255};e.properties.fill?n=i.sfs.Color.fromHex(e.properties.fill):e.properties.stroke&&(n=i.sfs.Color.fromHex(e.properties.stroke)),n.a=r;var o=e.geometry.type,a={};return"Polygon"==o?a={type:"SimpleFillSymbol",options:{borderColor:n,fillColor:n,borderThickness:3}}:"LineString"==o&&(a={type:"SimpleLineSymbol",options:{color:n,width:3}}),G.utils.RenderUtil.object2Symbol(a)},_getForcastRangeTooltips:function(e){var t=[],r={x:e.geometry.coordinates[0],y:e.geometry.coordinates[1]},n='<div style = ""><img height="16" width = "16" src="data/'+e.properties.icon+'"/></div>',s=new i.widget.Tooltip({id:o.newUUID32(),anchor:r,content:n,offset:[-8,-8]});t.push(s);var l=e.properties.name,c='<div style = "font-size:6px"><span>'+(l=a.t2s(l))+"</span></div>",u=new i.widget.Tooltip({id:o.newUUID32(),anchor:r,content:c,offset:[5,0]});return t.push(u),t},_parseTooltipFromPolygon:function(e,t){var r=new G.utils.GeometryBuilder({geometryField:["geometry"]}),n=e.properties.name,s="<div style='width:20px'><span>"+(n=a.t2s(n))+"</span><div>",l=r.build(e),c=this._getLabelAnchor(l,t);return new i.widget.Tooltip({id:o.newUUID32(),anchor:c,content:s,offset:[-10,-5]})},_getLabelAnchor:function(e,t){var r=(t.label||{}).position||"left",n=e.shell.points,o=function(e,t){return e.x<t.x};switch(r){case"left":o=function(e,t){return e.x-t.x};break;case"right":o=function(e,t){return t.x-e.x};break;case"bottom":o=function(e,t){return e.y-t.y};break;case"top":o=function(e,t){return t.y-e.y}}var i=n.sort(o);return{x:i[0].x,y:i[0].y}},_mergeOptions:function(e){for(var t,r,n=1,o=arguments.length;n<o;n++)for(t in r=arguments[n])e[t]=r[t];return e}});e.exports=s},function(e,t,r){"use strict";var n="万与丑专业丛东丝丢两严丧个丬丰临为丽举么义乌乐乔习乡书买乱争于亏云亘亚产亩亲亵亸亿仅从仑仓仪们价众优伙会伛伞伟传伤伥伦伧伪伫体余佣佥侠侣侥侦侧侨侩侪侬俣俦俨俩俪俭债倾偬偻偾偿傥傧储傩儿兑兖党兰关兴兹养兽冁内冈册写军农冢冯冲决况冻净凄凉凌减凑凛几凤凫凭凯击凼凿刍划刘则刚创删别刬刭刽刿剀剂剐剑剥剧劝办务劢动励劲劳势勋勐勚匀匦匮区医华协单卖卢卤卧卫却卺厂厅历厉压厌厍厕厢厣厦厨厩厮县参叆叇双发变叙叠叶号叹叽吁后吓吕吗吣吨听启吴呒呓呕呖呗员呙呛呜咏咔咙咛咝咤咴咸哌响哑哒哓哔哕哗哙哜哝哟唛唝唠唡唢唣唤唿啧啬啭啮啰啴啸喷喽喾嗫呵嗳嘘嘤嘱噜噼嚣嚯团园囱围囵国图圆圣圹场坂坏块坚坛坜坝坞坟坠垄垅垆垒垦垧垩垫垭垯垱垲垴埘埙埚埝埯堑堕塆墙壮声壳壶壸处备复够头夸夹夺奁奂奋奖奥妆妇妈妩妪妫姗姜娄娅娆娇娈娱娲娴婳婴婵婶媪嫒嫔嫱嬷孙学孪宁宝实宠审宪宫宽宾寝对寻导寿将尔尘尧尴尸尽层屃屉届属屡屦屿岁岂岖岗岘岙岚岛岭岳岽岿峃峄峡峣峤峥峦崂崃崄崭嵘嵚嵛嵝嵴巅巩巯币帅师帏帐帘帜带帧帮帱帻帼幂幞干并广庄庆庐庑库应庙庞废庼廪开异弃张弥弪弯弹强归当录彟彦彻径徕御忆忏忧忾怀态怂怃怄怅怆怜总怼怿恋恳恶恸恹恺恻恼恽悦悫悬悭悯惊惧惨惩惫惬惭惮惯愍愠愤愦愿慑慭憷懑懒懔戆戋戏戗战戬户扎扑扦执扩扪扫扬扰抚抛抟抠抡抢护报担拟拢拣拥拦拧拨择挂挚挛挜挝挞挟挠挡挢挣挤挥挦捞损捡换捣据捻掳掴掷掸掺掼揸揽揿搀搁搂搅携摄摅摆摇摈摊撄撑撵撷撸撺擞攒敌敛数斋斓斗斩断无旧时旷旸昙昼昽显晋晒晓晔晕晖暂暧札术朴机杀杂权条来杨杩杰极构枞枢枣枥枧枨枪枫枭柜柠柽栀栅标栈栉栊栋栌栎栏树栖样栾桊桠桡桢档桤桥桦桧桨桩梦梼梾检棂椁椟椠椤椭楼榄榇榈榉槚槛槟槠横樯樱橥橱橹橼檐檩欢欤欧歼殁殇残殒殓殚殡殴毁毂毕毙毡毵氇气氢氩氲汇汉污汤汹沓沟没沣沤沥沦沧沨沩沪沵泞泪泶泷泸泺泻泼泽泾洁洒洼浃浅浆浇浈浉浊测浍济浏浐浑浒浓浔浕涂涌涛涝涞涟涠涡涢涣涤润涧涨涩淀渊渌渍渎渐渑渔渖渗温游湾湿溃溅溆溇滗滚滞滟滠满滢滤滥滦滨滩滪漤潆潇潋潍潜潴澜濑濒灏灭灯灵灾灿炀炉炖炜炝点炼炽烁烂烃烛烟烦烧烨烩烫烬热焕焖焘煅煳熘爱爷牍牦牵牺犊犟状犷犸犹狈狍狝狞独狭狮狯狰狱狲猃猎猕猡猪猫猬献獭玑玙玚玛玮环现玱玺珉珏珐珑珰珲琎琏琐琼瑶瑷璇璎瓒瓮瓯电画畅畲畴疖疗疟疠疡疬疮疯疱疴痈痉痒痖痨痪痫痴瘅瘆瘗瘘瘪瘫瘾瘿癞癣癫癯皑皱皲盏盐监盖盗盘眍眦眬着睁睐睑瞒瞩矫矶矾矿砀码砖砗砚砜砺砻砾础硁硅硕硖硗硙硚确硷碍碛碜碱碹磙礼祎祢祯祷祸禀禄禅离秃秆种积称秽秾稆税稣稳穑穷窃窍窑窜窝窥窦窭竖竞笃笋笔笕笺笼笾筑筚筛筜筝筹签简箓箦箧箨箩箪箫篑篓篮篱簖籁籴类籼粜粝粤粪粮糁糇紧絷纟纠纡红纣纤纥约级纨纩纪纫纬纭纮纯纰纱纲纳纴纵纶纷纸纹纺纻纼纽纾线绀绁绂练组绅细织终绉绊绋绌绍绎经绐绑绒结绔绕绖绗绘给绚绛络绝绞统绠绡绢绣绤绥绦继绨绩绪绫绬续绮绯绰绱绲绳维绵绶绷绸绹绺绻综绽绾绿缀缁缂缃缄缅缆缇缈缉缊缋缌缍缎缏缐缑缒缓缔缕编缗缘缙缚缛缜缝缞缟缠缡缢缣缤缥缦缧缨缩缪缫缬缭缮缯缰缱缲缳缴缵罂网罗罚罢罴羁羟羡翘翙翚耢耧耸耻聂聋职聍联聩聪肃肠肤肷肾肿胀胁胆胜胧胨胪胫胶脉脍脏脐脑脓脔脚脱脶脸腊腌腘腭腻腼腽腾膑臜舆舣舰舱舻艰艳艹艺节芈芗芜芦苁苇苈苋苌苍苎苏苘苹茎茏茑茔茕茧荆荐荙荚荛荜荞荟荠荡荣荤荥荦荧荨荩荪荫荬荭荮药莅莜莱莲莳莴莶获莸莹莺莼萚萝萤营萦萧萨葱蒇蒉蒋蒌蓝蓟蓠蓣蓥蓦蔷蔹蔺蔼蕲蕴薮藁藓虏虑虚虫虬虮虽虾虿蚀蚁蚂蚕蚝蚬蛊蛎蛏蛮蛰蛱蛲蛳蛴蜕蜗蜡蝇蝈蝉蝎蝼蝾螀螨蟏衅衔补衬衮袄袅袆袜袭袯装裆裈裢裣裤裥褛褴襁襕见观觃规觅视觇览觉觊觋觌觍觎觏觐觑觞触觯詟誉誊讠计订讣认讥讦讧讨让讪讫训议讯记讱讲讳讴讵讶讷许讹论讻讼讽设访诀证诂诃评诅识诇诈诉诊诋诌词诎诏诐译诒诓诔试诖诗诘诙诚诛诜话诞诟诠诡询诣诤该详诧诨诩诪诫诬语诮误诰诱诲诳说诵诶请诸诹诺读诼诽课诿谀谁谂调谄谅谆谇谈谊谋谌谍谎谏谐谑谒谓谔谕谖谗谘谙谚谛谜谝谞谟谠谡谢谣谤谥谦谧谨谩谪谫谬谭谮谯谰谱谲谳谴谵谶谷豮贝贞负贠贡财责贤败账货质贩贪贫贬购贮贯贰贱贲贳贴贵贶贷贸费贺贻贼贽贾贿赀赁赂赃资赅赆赇赈赉赊赋赌赍赎赏赐赑赒赓赔赕赖赗赘赙赚赛赜赝赞赟赠赡赢赣赪赵赶趋趱趸跃跄跖跞践跶跷跸跹跻踊踌踪踬踯蹑蹒蹰蹿躏躜躯车轧轨轩轪轫转轭轮软轰轱轲轳轴轵轶轷轸轹轺轻轼载轾轿辀辁辂较辄辅辆辇辈辉辊辋辌辍辎辏辐辑辒输辔辕辖辗辘辙辚辞辩辫边辽达迁过迈运还这进远违连迟迩迳迹适选逊递逦逻遗遥邓邝邬邮邹邺邻郁郄郏郐郑郓郦郧郸酝酦酱酽酾酿释里鉅鉴銮錾钆钇针钉钊钋钌钍钎钏钐钑钒钓钔钕钖钗钘钙钚钛钝钞钟钠钡钢钣钤钥钦钧钨钩钪钫钬钭钮钯钰钱钲钳钴钵钶钷钸钹钺钻钼钽钾钿铀铁铂铃铄铅铆铈铉铊铋铍铎铏铐铑铒铕铗铘铙铚铛铜铝铞铟铠铡铢铣铤铥铦铧铨铪铫铬铭铮铯铰铱铲铳铴铵银铷铸铹铺铻铼铽链铿销锁锂锃锄锅锆锇锈锉锊锋锌锍锎锏锐锑锒锓锔锕锖锗错锚锜锞锟锠锡锢锣锤锥锦锨锩锫锬锭键锯锰锱锲锳锴锵锶锷锸锹锺锻锼锽锾锿镀镁镂镃镆镇镈镉镊镌镍镎镏镐镑镒镕镖镗镙镚镛镜镝镞镟镠镡镢镣镤镥镦镧镨镩镪镫镬镭镮镯镰镱镲镳镴镶长门闩闪闫闬闭问闯闰闱闲闳间闵闶闷闸闹闺闻闼闽闾闿阀阁阂阃阄阅阆阇阈阉阊阋阌阍阎阏阐阑阒阓阔阕阖阗阘阙阚阛队阳阴阵阶际陆陇陈陉陕陧陨险随隐隶隽难雏雠雳雾霁霉霭靓静靥鞑鞒鞯鞴韦韧韨韩韪韫韬韵页顶顷顸项顺须顼顽顾顿颀颁颂颃预颅领颇颈颉颊颋颌颍颎颏颐频颒颓颔颕颖颗题颙颚颛颜额颞颟颠颡颢颣颤颥颦颧风飏飐飑飒飓飔飕飖飗飘飙飚飞飨餍饤饥饦饧饨饩饪饫饬饭饮饯饰饱饲饳饴饵饶饷饸饹饺饻饼饽饾饿馀馁馂馃馄馅馆馇馈馉馊馋馌馍馎馏馐馑馒馓馔馕马驭驮驯驰驱驲驳驴驵驶驷驸驹驺驻驼驽驾驿骀骁骂骃骄骅骆骇骈骉骊骋验骍骎骏骐骑骒骓骔骕骖骗骘骙骚骛骜骝骞骟骠骡骢骣骤骥骦骧髅髋髌鬓魇魉鱼鱽鱾鱿鲀鲁鲂鲄鲅鲆鲇鲈鲉鲊鲋鲌鲍鲎鲏鲐鲑鲒鲓鲔鲕鲖鲗鲘鲙鲚鲛鲜鲝鲞鲟鲠鲡鲢鲣鲤鲥鲦鲧鲨鲩鲪鲫鲬鲭鲮鲯鲰鲱鲲鲳鲴鲵鲶鲷鲸鲹鲺鲻鲼鲽鲾鲿鳀鳁鳂鳃鳄鳅鳆鳇鳈鳉鳊鳋鳌鳍鳎鳏鳐鳑鳒鳓鳔鳕鳖鳗鳘鳙鳛鳜鳝鳞鳟鳠鳡鳢鳣鸟鸠鸡鸢鸣鸤鸥鸦鸧鸨鸩鸪鸫鸬鸭鸮鸯鸰鸱鸲鸳鸴鸵鸶鸷鸸鸹鸺鸻鸼鸽鸾鸿鹀鹁鹂鹃鹄鹅鹆鹇鹈鹉鹊鹋鹌鹍鹎鹏鹐鹑鹒鹓鹔鹕鹖鹗鹘鹚鹛鹜鹝鹞鹟鹠鹡鹢鹣鹤鹥鹦鹧鹨鹩鹪鹫鹬鹭鹯鹰鹱鹲鹳鹴鹾麦麸黄黉黡黩黪黾鼋鼌鼍鼗鼹齄齐齑齿龀龁龂龃龄龅龆龇龈龉龊龋龌龙龚龛龟志制咨只里系范松没尝尝闹面准钟别闲乾尽脏拼",o="萬與醜專業叢東絲丟兩嚴喪個丬豐臨爲麗舉麼義烏樂喬習鄉書買亂爭於虧雲亙亞產畝親褻嚲億僅從侖倉儀們價衆優夥會傴傘偉傳傷倀倫傖僞佇體餘傭僉俠侶僥偵側僑儈儕儂俁儔儼倆儷儉債傾傯僂僨償儻儐儲儺兒兌兗黨蘭關興茲養獸囅內岡冊寫軍農冢馮沖決況凍淨淒涼凌減湊凜幾鳳鳧憑凱擊凼鑿芻劃劉則剛創刪別剗剄劊劌剴劑剮劍剝劇勸辦務勱動勵勁勞勢勳勐勩勻匭匱區醫華協單賣盧滷臥衛卻巹廠廳歷厲壓厭厙廁廂厴廈廚廄廝縣參靉靆雙發變敘疊葉號嘆嘰籲後嚇呂嗎唚噸聽啓吳嘸囈嘔嚦唄員咼嗆嗚詠咔嚨嚀噝吒咴鹹哌響啞噠嘵嗶噦譁噲嚌噥喲嘜嗊嘮啢嗩唣喚唿嘖嗇囀齧囉嘽嘯噴嘍嚳囁呵噯噓嚶囑嚕噼囂嚯團園囪圍圇國圖圓聖壙場阪壞塊堅壇壢壩塢墳墜壟壠壚壘墾垧堊墊埡墶壋塏堖塒壎堝埝垵塹墮壪牆壯聲殼壺壼處備復夠頭誇夾奪奩奐奮獎奧妝婦媽嫵嫗嬀姍姜婁婭嬈嬌孌娛媧嫺嫿嬰嬋嬸媼嬡嬪嬙嬤孫學孿寧寶實寵審憲宮寬賓寢對尋導壽將爾塵堯尷屍盡層屓屜屆屬屢屨嶼歲豈嶇崗峴嶴嵐島嶺嶽崬巋嶨嶧峽嶢嶠崢巒嶗崍嶮嶄嶸嶔嵛嶁嵴巔鞏巰幣帥師幃帳簾幟帶幀幫幬幘幗冪襆幹並廣莊慶廬廡庫應廟龐廢廎廩開異棄張彌弳彎彈強歸當錄彠彥徹徑徠御憶懺憂愾懷態慫憮慪悵愴憐總懟懌戀懇惡慟懨愷惻惱惲悅愨懸慳憫驚懼慘懲憊愜慚憚慣愍慍憤憒願懾憖憷懣懶懍戇戔戲戧戰戩戶扎撲扦執擴捫掃揚擾撫拋摶摳掄搶護報擔擬攏揀擁攔擰撥擇掛摯攣掗撾撻挾撓擋撟掙擠揮撏撈損撿換搗據捻擄摑擲撣摻摜揸攬撳攙擱摟攪攜攝攄擺搖擯攤攖撐攆擷擼攛擻攢敵斂數齋斕鬥斬斷無舊時曠暘曇晝曨顯晉曬曉曄暈暉暫曖札術樸機殺雜權條來楊榪傑極構樅樞棗櫪梘棖槍楓梟櫃檸檉梔柵標棧櫛櫳棟櫨櫟欄樹棲樣欒桊椏橈楨檔榿橋樺檜槳樁夢檮棶檢櫺槨櫝槧欏橢樓欖櫬櫚櫸檟檻檳櫧橫檣櫻櫫櫥櫓櫞檐檁歡歟歐殲歿殤殘殞殮殫殯毆毀轂畢斃氈毿氌氣氫氬氳匯漢污湯洶沓溝沒灃漚瀝淪滄渢潙滬沵濘淚澩瀧瀘濼瀉潑澤涇潔灑窪浹淺漿澆湞溮濁測澮濟瀏滻渾滸濃潯濜塗涌濤澇淶漣潿渦溳渙滌潤澗漲澀澱淵淥漬瀆漸澠漁瀋滲溫遊灣溼潰濺漵漊潷滾滯灩灄滿瀅濾濫灤濱灘澦漤瀠瀟瀲濰潛瀦瀾瀨瀕灝滅燈靈災燦煬爐燉煒熗點煉熾爍爛烴燭煙煩燒燁燴燙燼熱煥燜燾煅煳熘愛爺牘犛牽犧犢犟狀獷獁猶狽狍獮獰獨狹獅獪猙獄猻獫獵獼玀豬貓蝟獻獺璣璵瑒瑪瑋環現瑲璽珉珏琺瓏璫琿璡璉瑣瓊瑤璦璇瓔瓚甕甌電畫暢畲疇癤療瘧癘瘍癧瘡瘋皰痾癰痙癢瘂癆瘓癇癡癉瘮瘞瘻癟癱癮癭癩癬癲癯皚皺皸盞鹽監蓋盜盤瞘眥矓着睜睞瞼瞞矚矯磯礬礦碭碼磚硨硯碸礪礱礫礎硜硅碩硤磽磑礄確礆礙磧磣鹼碹磙禮禕禰禎禱禍稟祿禪離禿稈種積稱穢穠穭稅穌穩穡窮竊竅窯竄窩窺竇窶豎競篤筍筆筧箋籠籩築篳篩簹箏籌籤簡籙簀篋籜籮簞簫簣簍籃籬籪籟糴類秈糶糲粵糞糧糝餱緊縶糹糾紆紅紂纖紇約級紈纊紀紉緯紜紘純紕紗綱納紝縱綸紛紙紋紡紵紖紐紓線紺紲紱練組紳細織終縐絆紼絀紹繹經紿綁絨結絝繞絰絎繪給絢絳絡絕絞統綆綃絹繡綌綏絛繼綈績緒綾緓續綺緋綽鞝緄繩維綿綬繃綢綯綹綣綜綻綰綠綴緇緙緗緘緬纜緹緲緝縕繢緦綞緞緶線緱縋緩締縷編緡緣縉縛縟縝縫縗縞纏縭縊縑繽縹縵縲纓縮繆繅纈繚繕繒繮繾繰繯繳纘罌網羅罰罷羆羈羥羨翹翽翬耮耬聳恥聶聾職聹聯聵聰肅腸膚肷腎腫脹脅膽勝朧腖臚脛膠脈膾髒臍腦膿臠腳脫腡臉臘醃膕齶膩靦膃騰臏臢輿艤艦艙艫艱豔艹藝節羋薌蕪蘆蓯葦藶莧萇蒼苧蘇檾蘋莖蘢蔦塋煢繭荊薦薘莢蕘蓽蕎薈薺蕩榮葷滎犖熒蕁藎蓀蔭蕒葒葤藥蒞莜萊蓮蒔萵薟獲蕕瑩鶯蓴蘀蘿螢營縈蕭薩蔥蕆蕢蔣蔞藍薊蘺蕷鎣驀薔蘞藺藹蘄蘊藪藁蘚虜慮虛蟲虯蟣雖蝦蠆蝕蟻螞蠶蠔蜆蠱蠣蟶蠻蟄蛺蟯螄蠐蛻蝸蠟蠅蟈蟬蠍螻蠑螿蟎蠨釁銜補襯袞襖嫋褘襪襲襏裝襠褌褳襝褲襉褸襤襁襴見觀覎規覓視覘覽覺覬覡覿覥覦覯覲覷觴觸觶讋譽謄訁計訂訃認譏訐訌討讓訕訖訓議訊記訒講諱謳詎訝訥許訛論訩訟諷設訪訣證詁訶評詛識詗詐訴診詆謅詞詘詔詖譯詒誆誄試詿詩詰詼誠誅詵話誕詬詮詭詢詣諍該詳詫諢詡譸誡誣語誚誤誥誘誨誑說誦誒請諸諏諾讀諑誹課諉諛誰諗調諂諒諄誶談誼謀諶諜謊諫諧謔謁謂諤諭諼讒諮諳諺諦謎諞諝謨讜謖謝謠謗諡謙謐謹謾謫譾謬譚譖譙讕譜譎讞譴譫讖谷豶貝貞負貟貢財責賢敗賬貨質販貪貧貶購貯貫貳賤賁貰貼貴貺貸貿費賀貽賊贄賈賄貲賃賂贓資賅贐賕賑賚賒賦賭齎贖賞賜贔賙賡賠賧賴賵贅賻賺賽賾贗贊贇贈贍贏贛赬趙趕趨趲躉躍蹌跖躒踐躂蹺蹕躚躋踊躊蹤躓躑躡蹣躕躥躪躦軀車軋軌軒軑軔轉軛輪軟轟軲軻轤軸軹軼軤軫轢軺輕軾載輊轎輈輇輅較輒輔輛輦輩輝輥輞輬輟輜輳輻輯轀輸轡轅轄輾轆轍轔辭辯辮邊遼達遷過邁運還這進遠違連遲邇逕跡適選遜遞邐邏遺遙鄧鄺鄔郵鄒鄴鄰鬱郄郟鄶鄭鄆酈鄖鄲醞醱醬釅釃釀釋裏鉅鑑鑾鏨釓釔針釘釗釙釕釷釺釧釤鈒釩釣鍆釹鍚釵鈃鈣鈈鈦鈍鈔鍾鈉鋇鋼鈑鈐鑰欽鈞鎢鉤鈧鈁鈥鈄鈕鈀鈺錢鉦鉗鈷鉢鈳鉕鈽鈸鉞鑽鉬鉭鉀鈿鈾鐵鉑鈴鑠鉛鉚鈰鉉鉈鉍鈹鐸鉶銬銠鉺銪鋏鋣鐃銍鐺銅鋁銱銦鎧鍘銖銑鋌銩銛鏵銓鉿銚鉻銘錚銫鉸銥鏟銃鐋銨銀銣鑄鐒鋪鋙錸鋱鏈鏗銷鎖鋰鋥鋤鍋鋯鋨鏽銼鋝鋒鋅鋶鐦鐗銳銻鋃鋟鋦錒錆鍺錯錨錡錁錕錩錫錮鑼錘錐錦杴錈錇錟錠鍵鋸錳錙鍥鍈鍇鏘鍶鍔鍤鍬鍾鍛鎪鍠鍰鎄鍍鎂鏤鎡鏌鎮鎛鎘鑷鐫鎳鎿鎦鎬鎊鎰鎔鏢鏜鏍鏰鏞鏡鏑鏃鏇鏐鐔钁鐐鏷鑥鐓鑭鐠鑹鏹鐙鑊鐳鐶鐲鐮鐿鑔鑣鑞鑲長門閂閃閆閈閉問闖閏闈閒閎間閔閌悶閘鬧閨聞闥閩閭闓閥閣閡閫鬮閱閬闍閾閹閶鬩閿閽閻閼闡闌闃闠闊闋闔闐闒闕闞闤隊陽陰陣階際陸隴陳陘陝隉隕險隨隱隸雋難雛讎靂霧霽黴靄靚靜靨韃鞽韉鞴韋韌韍韓韙韞韜韻頁頂頃頇項順須頊頑顧頓頎頒頌頏預顱領頗頸頡頰頲頜潁熲頦頤頻頮頹頷頴穎顆題顒顎顓顏額顳顢顛顙顥纇顫顬顰顴風颺颭颮颯颶颸颼颻飀飄飆飈飛饗饜飣飢飥餳飩餼飪飫飭飯飲餞飾飽飼飿飴餌饒餉餄餎餃餏餅餑餖餓餘餒餕餜餛餡館餷饋餶餿饞饁饃餺餾饈饉饅饊饌饢馬馭馱馴馳驅馹駁驢駔駛駟駙駒騶駐駝駑駕驛駘驍罵駰驕驊駱駭駢驫驪騁驗騂駸駿騏騎騍騅騌驌驂騙騭騤騷騖驁騮騫騸驃騾驄驏驟驥驦驤髏髖髕鬢魘魎魚魛魢魷魨魯魴魺鮁鮃鮎鱸鮋鮓鮒鮊鮑鱟鮍鮐鮭鮚鮳鮪鮞鮦鰂鮜鱠鱭鮫鮮鮺鯗鱘鯁鱺鰱鰹鯉鰣鰷鯀鯊鯇鮶鯽鯒鯖鯪鯕鯫鯡鯤鯧鯝鯢鮎鯛鯨鰺鯴鯔鱝鰈鰏鱨鯷鰮鰃鰓鱷鰍鰒鰉鰁鱂鯿鰠鰲鰭鰨鰥鰩鰟鰜鰳鰾鱈鱉鰻鰵鱅鰼鱖鱔鱗鱒鱯鱤鱧鱣鳥鳩雞鳶鳴鳲鷗鴉鶬鴇鴆鴣鶇鸕鴨鴞鴦鴒鴟鴝鴛鷽鴕鷥鷙鴯鴰鵂鴴鵃鴿鸞鴻鵐鵓鸝鵑鵠鵝鵒鷳鵜鵡鵲鶓鵪鵾鵯鵬鵮鶉鶊鵷鷫鶘鶡鶚鶻鶿鶥鶩鷊鷂鶲鶹鶺鷁鶼鶴鷖鸚鷓鷚鷯鷦鷲鷸鷺鸇鷹鸌鸏鸛鸘鹺麥麩黃黌黶黷黲黽黿鼂鼉鞀鼴齇齊齏齒齔齕齗齟齡齙齠齜齦齬齪齲齷龍龔龕龜志制諮只裏系範鬆沒嚐嚐鬧面準鍾別閒乾盡髒拼";function i(e,t){var r,i,a,s,l,c,u="";if(t?(l=n,c=o):(l=o,c=n),"string"!=typeof e)return e;for(r=0;r<e.length;r++)i=e.charAt(r),(a=e.charCodeAt(r))>13312&&a<40899||a>63744&&a<64106?u+=-1!==(s=l.indexOf(i))?c.charAt(s):i:u+=i;return u}var a={s2t:function(e){return i(e,!0)},t2s:function(e){return i(e,!1)}};e.exports=a},function(e,t,r){var n=r(11),o=n.extend({options:{},initialize:function(e){n.prototype.initialize.call(this,e)},destroy:function(){n.prototype.destroy.call(this)}});e.exports=o}])}));